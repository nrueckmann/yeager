Koala.mapLoggerFunctions=function(){var chkLoglevel=function(param){var lastParam=param[param.length-1];if(lastParam){var isLoglevel;for(var item in $K.Log){if(lastParam==$K.Log[item])isLoglevel=true;}
if(isLoglevel&&(lastParam<=$K.loglevel))
return true;}
return false;};if($K.devMode&&window.console&&window.console.firebug){Koala.debug=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.debug.apply(this,arguments);}}catch(ex){}};Koala.log=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.log.apply(this,arguments);}}catch(ex){}};Koala.info=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.info.apply(this,arguments);}}catch(ex){}};Koala.warn=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.warn.apply(this,arguments);}}catch(ex){}};Koala.error=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.error.apply(this,arguments);}}catch(ex){}};Koala.assert=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.assert.apply(this,arguments);}}catch(ex){}};Koala.dir=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.dir.apply(this,arguments);}}catch(ex){}};Koala.dirxml=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.dirxml.apply(this,arguments);}}catch(ex){}};Koala.trace=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.trace.apply(this,arguments);}}catch(ex){}};Koala.group=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.group.apply(this,arguments);}}catch(ex){}};Koala.groupEnd=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.groupEnd.apply(this,arguments);}}catch(ex){}};Koala.time=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.time.apply(this,arguments);}}catch(ex){}};Koala.timeEnd=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.timeEnd.apply(this,arguments);}}catch(ex){}};Koala.profile=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.profile.apply(this,arguments);}}catch(ex){}};Koala.profileEnd=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.profileEnd.apply(this,arguments);}}catch(ex){}};Koala.count=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.count.apply(this,arguments);}}catch(ex){}};}else if($K.devMode&&(!(window.console&&window.console.firebug&&(firebug&&firebug.d.console))||(window.console&&!window.console.firebug))){Koala.debug=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.debug.apply(this,arguments);}}catch(ex){}};Koala.log=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.log.apply(this,arguments);}}catch(ex){}};Koala.info=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.info.apply(this,arguments);}}catch(ex){}};Koala.warn=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.warn.apply(this,arguments);}}catch(ex){}};Koala.error=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.error.apply(this,arguments);}}catch(ex){}};Koala.assert=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.assert.apply(this,arguments);}}catch(ex){}};Koala.dir=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.dir.apply(this,arguments);}}catch(ex){}};Koala.dirxml=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.dirxml.apply(this,arguments);}}catch(ex){}};Koala.trace=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.trace.apply(this,arguments);}}catch(ex){}};Koala.group=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.group.apply(this,arguments);}}catch(ex){}};Koala.groupEnd=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.groupEnd.apply(this,arguments);}}catch(ex){}};Koala.time=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.time.apply(this,arguments);}}catch(ex){}};Koala.timeEnd=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.timeEnd.apply(this,arguments);}}catch(ex){}};Koala.profile=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.profile.apply(this,arguments);}}catch(ex){}};Koala.profileEnd=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.profileEnd.apply(this,arguments);}}catch(ex){}};Koala.count=function(){try{if(chkLoglevel(arguments)){Array.prototype.pop.call(arguments);window.console.count.apply(this,arguments);}}catch(ex){}};}else{Koala.debug=function(){};Koala.log=function(){};Koala.info=function(){};Koala.warn=function(){};Koala.error=function(){};Koala.assert=function(){};Koala.dir=function(){};Koala.dirxml=function(){};Koala.trace=function(){};Koala.group=function(){};Koala.groupEnd=function(){};Koala.time=function(){};Koala.timeEnd=function(){};Koala.profile=function(){};Koala.profileEnd=function(){};Koala.count=function(){};}}
if(!$K.devMode){if(!(window.console)){console=new Object();console.log=function(){return false;}
console.warn=function(){return false;}}
window.onerror=function(msg,url,line){$K.error('Javascript Error: '+msg+' -- Location: '+url+' -- Line: '+line,$K.Log.INFO);return true;}}
Koala.mapLoggerFunctions();
;var Prototype={Version:'1.7',Browser:(function(){var ua=navigator.userAgent;var isOpera=Object.prototype.toString.call(window.opera)=='[object Opera]';return{IE:!!window.attachEvent&&!isOpera,Opera:isOpera,WebKit:ua.indexOf('AppleWebKit/')>-1,Gecko:ua.indexOf('Gecko')>-1&&ua.indexOf('KHTML')===-1,MobileSafari:/Apple.*Mobile/.test(ua)}})(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:(function(){var constructor=window.Element||window.HTMLElement;return!!(constructor&&constructor.prototype);})(),SpecificElementExtensions:(function(){if(typeof window.HTMLDivElement!=='undefined')
return true;var div=document.createElement('div'),form=document.createElement('form'),isSupported=false;if(div['__proto__']&&(div['__proto__']!==form['__proto__'])){isSupported=true;}
div=form=null;return isSupported;})()},ScriptFragment:'<script[^>]*>([\\S\\s]*?)<\/script>',JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(x){return x}};if(Prototype.Browser.MobileSafari)
Prototype.BrowserFeatures.SpecificElementExtensions=false;var Abstract={};var Try={these:function(){var returnValue;for(var i=0,length=arguments.length;i<length;i++){var lambda=arguments[i];try{returnValue=lambda();break;}catch(e){}}
return returnValue;}};var Class=(function(){var IS_DONTENUM_BUGGY=(function(){for(var p in{toString:1}){if(p==='toString')return false;}
return true;})();function subclass(){};function create(){var parent=null,properties=$A(arguments);if(Object.isFunction(properties[0]))
parent=properties.shift();function klass(){this.initialize.apply(this,arguments);}
Object.extend(klass,Class.Methods);klass.superclass=parent;klass.subclasses=[];if(parent){subclass.prototype=parent.prototype;klass.prototype=new subclass;parent.subclasses.push(klass);}
for(var i=0,length=properties.length;i<length;i++)
klass.addMethods(properties[i]);if(!klass.prototype.initialize)
klass.prototype.initialize=Prototype.emptyFunction;klass.prototype.constructor=klass;return klass;}
function addMethods(source){var ancestor=this.superclass&&this.superclass.prototype,properties=Object.keys(source);if(IS_DONTENUM_BUGGY){if(source.toString!=Object.prototype.toString)
properties.push("toString");if(source.valueOf!=Object.prototype.valueOf)
properties.push("valueOf");}
for(var i=0,length=properties.length;i<length;i++){var property=properties[i],value=source[property];if(ancestor&&Object.isFunction(value)&&value.argumentNames()[0]=="$super"){var method=value;value=(function(m){return function(){return ancestor[m].apply(this,arguments);};})(property).wrap(method);value.valueOf=method.valueOf.bind(method);value.toString=method.toString.bind(method);}
this.prototype[property]=value;}
return this;}
return{create:create,Methods:{addMethods:addMethods}};})();(function(){var _toString=Object.prototype.toString,NULL_TYPE='Null',UNDEFINED_TYPE='Undefined',BOOLEAN_TYPE='Boolean',NUMBER_TYPE='Number',STRING_TYPE='String',OBJECT_TYPE='Object',FUNCTION_CLASS='[object Function]',BOOLEAN_CLASS='[object Boolean]',NUMBER_CLASS='[object Number]',STRING_CLASS='[object String]',ARRAY_CLASS='[object Array]',DATE_CLASS='[object Date]',NATIVE_JSON_STRINGIFY_SUPPORT=window.JSON&&typeof JSON.stringify==='function'&&JSON.stringify(0)==='0'&&typeof JSON.stringify(Prototype.K)==='undefined';function Type(o){switch(o){case null:return NULL_TYPE;case(void 0):return UNDEFINED_TYPE;}
var type=typeof o;switch(type){case'boolean':return BOOLEAN_TYPE;case'number':return NUMBER_TYPE;case'string':return STRING_TYPE;}
return OBJECT_TYPE;}
function extend(destination,source){for(var property in source)
destination[property]=source[property];return destination;}
function inspect(object){try{if(isUndefined(object))return'undefined';if(object===null)return'null';return object.inspect?object.inspect():String(object);}catch(e){if(e instanceof RangeError)return'...';throw e;}}
function toJSON(value){return Str('',{'':value},[]);}
function Str(key,holder,stack){var value=holder[key],type=typeof value;if(Type(value)===OBJECT_TYPE&&typeof value.toJSON==='function'){value=value.toJSON(key);}
var _class=_toString.call(value);switch(_class){case NUMBER_CLASS:case BOOLEAN_CLASS:case STRING_CLASS:value=value.valueOf();}
switch(value){case null:return'null';case true:return'true';case false:return'false';}
type=typeof value;switch(type){case'string':return value.inspect(true);case'number':return isFinite(value)?String(value):'null';case'object':for(var i=0,length=stack.length;i<length;i++){if(stack[i]===value){throw new TypeError();}}
stack.push(value);var partial=[];if(_class===ARRAY_CLASS){for(var i=0,length=value.length;i<length;i++){var str=Str(i,value,stack);partial.push(typeof str==='undefined'?'null':str);}
partial='['+partial.join(',')+']';}else{var keys=Object.keys(value);for(var i=0,length=keys.length;i<length;i++){var key=keys[i],str=Str(key,value,stack);if(typeof str!=="undefined"){partial.push(key.inspect(true)+':'+str);}}
partial='{'+partial.join(',')+'}';}
stack.pop();return partial;}}
function stringify(object){return JSON.stringify(object);}
function toQueryString(object){return $H(object).toQueryString();}
function toHTML(object){return object&&object.toHTML?object.toHTML():String.interpret(object);}
function keys(object){if(Type(object)!==OBJECT_TYPE){throw new TypeError();}
var results=[];for(var property in object){if(object.hasOwnProperty(property)){results.push(property);}}
return results;}
function values(object){var results=[];for(var property in object)
results.push(object[property]);return results;}
function clone(object){return extend({},object);}
function isElement(object){return!!(object&&object.nodeType==1);}
function isArray(object){return _toString.call(object)===ARRAY_CLASS;}
var hasNativeIsArray=(typeof Array.isArray=='function')&&Array.isArray([])&&!Array.isArray({});if(hasNativeIsArray){isArray=Array.isArray;}
function isHash(object){return object instanceof Hash;}
function isFunction(object){return _toString.call(object)===FUNCTION_CLASS;}
function isString(object){return _toString.call(object)===STRING_CLASS;}
function isNumber(object){return _toString.call(object)===NUMBER_CLASS;}
function isDate(object){return _toString.call(object)===DATE_CLASS;}
function isUndefined(object){return typeof object==="undefined";}
extend(Object,{extend:extend,inspect:inspect,toJSON:NATIVE_JSON_STRINGIFY_SUPPORT?stringify:toJSON,toQueryString:toQueryString,toHTML:toHTML,keys:Object.keys||keys,values:values,clone:clone,isElement:isElement,isArray:isArray,isHash:isHash,isFunction:isFunction,isString:isString,isNumber:isNumber,isDate:isDate,isUndefined:isUndefined});})();Object.extend(Function.prototype,(function(){var slice=Array.prototype.slice;function update(array,args){var arrayLength=array.length,length=args.length;while(length--)array[arrayLength+length]=args[length];return array;}
function merge(array,args){array=slice.call(array,0);return update(array,args);}
function argumentNames(){var names=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,'').replace(/\s+/g,'').split(',');return names.length==1&&!names[0]?[]:names;}
function bind(context){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var __method=this,args=slice.call(arguments,1);return function(){var a=merge(args,arguments);return __method.apply(context,a);}}
function bindAsEventListener(context){var __method=this,args=slice.call(arguments,1);return function(event){var a=update([event||window.event],args);return __method.apply(context,a);}}
function curry(){if(!arguments.length)return this;var __method=this,args=slice.call(arguments,0);return function(){var a=merge(args,arguments);return __method.apply(this,a);}}
function delay(timeout){var __method=this,args=slice.call(arguments,1);timeout=timeout*1000;return window.setTimeout(function(){return __method.apply(__method,args);},timeout);}
function defer(){var args=update([0.01],arguments);return this.delay.apply(this,args);}
function wrap(wrapper){var __method=this;return function(){var a=update([__method.bind(this)],arguments);return wrapper.apply(this,a);}}
function methodize(){if(this._methodized)return this._methodized;var __method=this;return this._methodized=function(){var a=update([this],arguments);return __method.apply(null,a);};}
return{argumentNames:argumentNames,bind:bind,bindAsEventListener:bindAsEventListener,curry:curry,delay:delay,defer:defer,wrap:wrap,methodize:methodize}})());(function(proto){function toISOString(){return this.getUTCFullYear()+'-'+
(this.getUTCMonth()+1).toPaddedString(2)+'-'+
this.getUTCDate().toPaddedString(2)+'T'+
this.getUTCHours().toPaddedString(2)+':'+
this.getUTCMinutes().toPaddedString(2)+':'+
this.getUTCSeconds().toPaddedString(2)+'Z';}
function toJSON(){return this.toISOString();}
if(!proto.toISOString)proto.toISOString=toISOString;if(!proto.toJSON)proto.toJSON=toJSON;})(Date.prototype);RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(str){return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g,'\\$1');};var PeriodicalExecuter=Class.create({initialize:function(callback,frequency){this.callback=callback;this.frequency=frequency;this.currentlyExecuting=false;this.registerCallback();},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000);},execute:function(){this.callback(this);},stop:function(){if(!this.timer)return;clearInterval(this.timer);this.timer=null;},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.execute();this.currentlyExecuting=false;}catch(e){this.currentlyExecuting=false;throw e;}}}});Object.extend(String,{interpret:function(value){return value==null?'':String(value);},specialChar:{'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','\\':'\\\\'}});Object.extend(String.prototype,(function(){var NATIVE_JSON_PARSE_SUPPORT=window.JSON&&typeof JSON.parse==='function'&&JSON.parse('{"test": true}').test;function prepareReplacement(replacement){if(Object.isFunction(replacement))return replacement;var template=new Template(replacement);return function(match){return template.evaluate(match)};}
function gsub(pattern,replacement){var result='',source=this,match;replacement=prepareReplacement(replacement);if(Object.isString(pattern))
pattern=RegExp.escape(pattern);if(!(pattern.length||pattern.source)){replacement=replacement('');return replacement+source.split('').join(replacement)+replacement;}
while(source.length>0){if(match=source.match(pattern)){result+=source.slice(0,match.index);result+=String.interpret(replacement(match));source=source.slice(match.index+match[0].length);}else{result+=source,source='';}}
return result;}
function sub(pattern,replacement,count){replacement=prepareReplacement(replacement);count=Object.isUndefined(count)?1:count;return this.gsub(pattern,function(match){if(--count<0)return match[0];return replacement(match);});}
function scan(pattern,iterator){this.gsub(pattern,iterator);return String(this);}
function truncate(length,truncation){length=length||30;truncation=Object.isUndefined(truncation)?'...':truncation;return this.length>length?this.slice(0,length-truncation.length)+truncation:String(this);}
function strip(){return this.replace(/^\s+/,'').replace(/\s+$/,'');}
function stripTags(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,'');}
function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,'img'),'');}
function extractScripts(){var matchAll=new RegExp(Prototype.ScriptFragment,'img'),matchOne=new RegExp(Prototype.ScriptFragment,'im');return(this.match(matchAll)||[]).map(function(scriptTag){return(scriptTag.match(matchOne)||['',''])[1];});}
function evalScripts(){return this.extractScripts().map(function(script){return eval(script)});}
function escapeHTML(){try{var x=this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}catch(err){$K.warn('CATCHED ERROR',$K.Log.INFO);}
return x;}
function unescapeHTML(){return this.stripTags().replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&amp;/g,'&');}
function toQueryParams(separator){var match=this.strip().match(/([^?#]*)(#.*)?$/);if(!match)return{};return match[1].split(separator||'&').inject({},function(hash,pair){if((pair=pair.split('='))[0]){var key=decodeURIComponent(pair.shift()),value=pair.length>1?pair.join('='):pair[0];if(value!=undefined)value=decodeURIComponent(value);if(key in hash){if(!Object.isArray(hash[key]))hash[key]=[hash[key]];hash[key].push(value);}
else hash[key]=value;}
return hash;});}
function toArray(){return this.split('');}
function succ(){return this.slice(0,this.length-1)+
String.fromCharCode(this.charCodeAt(this.length-1)+1);}
function times(count){return count<1?'':new Array(count+1).join(this);}
function camelize(){return this.replace(/-+(.)?/g,function(match,chr){return chr?chr.toUpperCase():'';});}
function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase();}
function underscore(){return this.replace(/::/g,'/').replace(/([A-Z]+)([A-Z][a-z])/g,'$1_$2').replace(/([a-z\d])([A-Z])/g,'$1_$2').replace(/-/g,'_').toLowerCase();}
function dasherize(){return this.replace(/_/g,'-');}
function inspect(useDoubleQuotes){var escapedString=this.replace(/[\x00-\x1f\\]/g,function(character){if(character in String.specialChar){return String.specialChar[character];}
return'\\u00'+character.charCodeAt().toPaddedString(2,16);});if(useDoubleQuotes)return'"'+escapedString.replace(/"/g,'\\"')+'"';return"'"+escapedString.replace(/'/g,'\\\'')+"'";}
function unfilterJSON(filter){return this.replace(filter||Prototype.JSONFilter,'$1');}
function isJSON(){var str=this;if(str.blank())return false;str=str.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@');str=str.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']');str=str.replace(/(?:^|:|,)(?:\s*\[)+/g,'');return(/^[\],:{}\s]*$/).test(str);}
function evalJSON(sanitize){var json=this.unfilterJSON(),cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;if(cx.test(json)){json=json.replace(cx,function(a){return'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
try{if(!sanitize||json.isJSON())return eval('('+json+')');}catch(e){}
throw new SyntaxError('Badly formed JSON string: '+this.inspect());}
function parseJSON(){var json=this.unfilterJSON();return JSON.parse(json);}
function include(pattern){return this.indexOf(pattern)>-1;}
function startsWith(pattern){return this.lastIndexOf(pattern,0)===0;}
function endsWith(pattern){var d=this.length-pattern.length;return d>=0&&this.indexOf(pattern,d)===d;}
function empty(){return this=='';}
function blank(){return /^\s*$/.test(this);}
function interpolate(object,pattern){return new Template(this,pattern).evaluate(object);}
return{gsub:gsub,sub:sub,scan:scan,truncate:truncate,strip:String.prototype.trim||strip,stripTags:stripTags,stripScripts:stripScripts,extractScripts:extractScripts,evalScripts:evalScripts,escapeHTML:escapeHTML,unescapeHTML:unescapeHTML,toQueryParams:toQueryParams,parseQuery:toQueryParams,toArray:toArray,succ:succ,times:times,camelize:camelize,capitalize:capitalize,underscore:underscore,dasherize:dasherize,inspect:inspect,unfilterJSON:unfilterJSON,isJSON:isJSON,evalJSON:NATIVE_JSON_PARSE_SUPPORT?parseJSON:evalJSON,include:include,startsWith:startsWith,endsWith:endsWith,empty:empty,blank:blank,interpolate:interpolate};})());var Template=Class.create({initialize:function(template,pattern){this.template=template.toString();this.pattern=pattern||Template.Pattern;},evaluate:function(object){if(object&&Object.isFunction(object.toTemplateReplacements))
object=object.toTemplateReplacements();return this.template.gsub(this.pattern,function(match){if(object==null)return(match[1]+'');var before=match[1]||'';if(before=='\\')return match[2];var ctx=object,expr=match[3],pattern=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;match=pattern.exec(expr);if(match==null)return before;while(match!=null){var comp=match[1].startsWith('[')?match[2].replace(/\\\\]/g,']'):match[1];ctx=ctx[comp];if(null==ctx||''==match[3])break;expr=expr.substring('['==match[3]?match[1].length:match[0].length);match=pattern.exec(expr);}
return before+String.interpret(ctx);});}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable=(function(){function each(iterator,context){var index=0;try{this._each(function(value){iterator.call(context,value,index++);});}catch(e){if(e!=$break)throw e;}
return this;}
function eachSlice(number,iterator,context){var index=-number,slices=[],array=this.toArray();if(number<1)return array;while((index+=number)<array.length)
slices.push(array.slice(index,index+number));return slices.collect(iterator,context);}
function all(iterator,context){iterator=iterator||Prototype.K;var result=true;this.each(function(value,index){result=result&&!!iterator.call(context,value,index);if(!result)throw $break;});return result;}
function any(iterator,context){iterator=iterator||Prototype.K;var result=false;this.each(function(value,index){if(result=!!iterator.call(context,value,index))
throw $break;});return result;}
function collect(iterator,context){iterator=iterator||Prototype.K;var results=[];this.each(function(value,index){results.push(iterator.call(context,value,index));});return results;}
function detect(iterator,context){var result;this.each(function(value,index){if(iterator.call(context,value,index)){result=value;throw $break;}});return result;}
function findAll(iterator,context){var results=[];this.each(function(value,index){if(value&&value.tagName=='!')
return;if(iterator.call(context,value,index))
results.push(value);});return results;}
function grep(filter,iterator,context){iterator=iterator||Prototype.K;var results=[];if(Object.isString(filter))
filter=new RegExp(RegExp.escape(filter));this.each(function(value,index){if(filter.match(value))
results.push(iterator.call(context,value,index));});return results;}
function include(object){if(Object.isFunction(this.indexOf))
if(this.indexOf(object)!=-1)return true;var found=false;this.each(function(value){if(value==object){found=true;throw $break;}});return found;}
function inGroupsOf(number,fillWith){fillWith=Object.isUndefined(fillWith)?null:fillWith;return this.eachSlice(number,function(slice){while(slice.length<number)slice.push(fillWith);return slice;});}
function inject(memo,iterator,context){this.each(function(value,index){memo=iterator.call(context,memo,value,index);});return memo;}
function invoke(method){var args=$A(arguments).slice(1);return this.map(function(value){return value[method].apply(value,args);});}
function max(iterator,context){iterator=iterator||Prototype.K;var result;this.each(function(value,index){value=iterator.call(context,value,index);if(result==null||value>=result)
result=value;});return result;}
function min(iterator,context){iterator=iterator||Prototype.K;var result;this.each(function(value,index){value=iterator.call(context,value,index);if(result==null||value<result)
result=value;});return result;}
function partition(iterator,context){iterator=iterator||Prototype.K;var trues=[],falses=[];this.each(function(value,index){(iterator.call(context,value,index)?trues:falses).push(value);});return[trues,falses];}
function pluck(property){var results=[];this.each(function(value){results.push(value[property]);});return results;}
function reject(iterator,context){var results=[];this.each(function(value,index){if(!iterator.call(context,value,index))
results.push(value);});return results;}
function sortBy(iterator,context){return this.map(function(value,index){return{value:value,criteria:iterator.call(context,value,index)};}).sort(function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0;}).pluck('value');}
function toArray(){return this.map();}
function zip(){var iterator=Prototype.K,args=$A(arguments);if(Object.isFunction(args.last()))
iterator=args.pop();var collections=[this].concat(args).map($A);return this.map(function(value,index){return iterator(collections.pluck(index));});}
function size(){return this.toArray().length;}
function inspect(){return'#<Enumerable:'+this.toArray().inspect()+'>';}
return{each:each,eachSlice:eachSlice,all:all,every:all,any:any,some:any,collect:collect,map:collect,detect:detect,findAll:findAll,select:findAll,filter:findAll,grep:grep,include:include,member:include,inGroupsOf:inGroupsOf,inject:inject,invoke:invoke,max:max,min:min,partition:partition,pluck:pluck,reject:reject,sortBy:sortBy,toArray:toArray,entries:toArray,zip:zip,size:size,inspect:inspect,find:detect};})();function $A(iterable){if(!iterable)return[];if('toArray'in Object(iterable))return iterable.toArray();var length=iterable.length||0,results=new Array(length);while(length--)results[length]=iterable[length];return results;}
function $w(string){if(!Object.isString(string))return[];string=string.strip();return string?string.split(/\s+/):[];}
Array.from=$A;(function(){var arrayProto=Array.prototype,slice=arrayProto.slice,_each=arrayProto.forEach;function each(iterator,context){for(var i=0,length=this.length>>>0;i<length;i++){if(i in this)iterator.call(context,this[i],i,this);}}
if(!_each)_each=each;function clear(){this.length=0;return this;}
function first(){return this[0];}
function last(){return this[this.length-1];}
function compact(){return this.select(function(value){return value!=null;});}
function flatten(){return this.inject([],function(array,value){if(Object.isArray(value))
return array.concat(value.flatten());array.push(value);return array;});}
function without(){var values=slice.call(arguments,0);return this.select(function(value){return!values.include(value);});}
function reverse(inline){return(inline===false?this.toArray():this)._reverse();}
function uniq(sorted){return this.inject([],function(array,value,index){if(0==index||(sorted?array.last()!=value:!array.include(value)))
array.push(value);return array;});}
function intersect(array){return this.uniq().findAll(function(item){return array.detect(function(value){return item===value});});}
function clone(){return slice.call(this,0);}
function size(){return this.length;}
function inspect(){return'['+this.map(Object.inspect).join(', ')+']';}
function indexOf(item,i){i||(i=0);var length=this.length;if(i<0)i=length+i;for(;i<length;i++)
if(this[i]===item)return i;return-1;}
function lastIndexOf(item,i){i=isNaN(i)?this.length:(i<0?this.length+i:i)+1;var n=this.slice(0,i).reverse().indexOf(item);return(n<0)?n:i-n-1;}
function concat(){var array=slice.call(this,0),item;for(var i=0,length=arguments.length;i<length;i++){item=arguments[i];if(Object.isArray(item)&&!('callee'in item)){for(var j=0,arrayLength=item.length;j<arrayLength;j++)
array.push(item[j]);}else{array.push(item);}}
return array;}
Object.extend(arrayProto,Enumerable);if(!arrayProto._reverse)
arrayProto._reverse=arrayProto.reverse;Object.extend(arrayProto,{_each:_each,clear:clear,first:first,last:last,compact:compact,flatten:flatten,without:without,reverse:reverse,uniq:uniq,intersect:intersect,clone:clone,toArray:clone,size:size,inspect:inspect});var CONCAT_ARGUMENTS_BUGGY=(function(){return[].concat(arguments)[0][0]!==1;})(1,2)
if(CONCAT_ARGUMENTS_BUGGY)arrayProto.concat=concat;if(!arrayProto.indexOf)arrayProto.indexOf=indexOf;if(!arrayProto.lastIndexOf)arrayProto.lastIndexOf=lastIndexOf;})();function $H(object){return new Hash(object);};var Hash=Class.create(Enumerable,(function(){function initialize(object){this._object=Object.isHash(object)?object.toObject():Object.clone(object);}
function _each(iterator){for(var key in this._object){var value=this._object[key],pair=[key,value];pair.key=key;pair.value=value;iterator(pair);}}
function set(key,value){return this._object[key]=value;}
function get(key){if(this._object[key]!==Object.prototype[key])
return this._object[key];}
function unset(key){var value=this._object[key];delete this._object[key];return value;}
function toObject(){return Object.clone(this._object);}
function keys(){return this.pluck('key');}
function values(){return this.pluck('value');}
function index(value){var match=this.detect(function(pair){return pair.value===value;});return match&&match.key;}
function merge(object){return this.clone().update(object);}
function update(object){return new Hash(object).inject(this,function(result,pair){result.set(pair.key,pair.value);return result;});}
function toQueryPair(key,value){if(Object.isUndefined(value))return key;return key+'='+encodeURIComponent(String.interpret(value));}
function toQueryString(){return this.inject([],function(results,pair){var key=encodeURIComponent(pair.key),values=pair.value;if(values&&typeof values=='object'){if(Object.isArray(values)){var queryValues=[];for(var i=0,len=values.length,value;i<len;i++){value=values[i];queryValues.push(toQueryPair(key,value));}
return results.concat(queryValues);}}else results.push(toQueryPair(key,values));return results;}).join('&');}
function inspect(){return'#<Hash:{'+this.map(function(pair){return pair.map(Object.inspect).join(': ');}).join(', ')+'}>';}
function clone(){return new Hash(this);}
return{initialize:initialize,_each:_each,set:set,get:get,unset:unset,toObject:toObject,toTemplateReplacements:toObject,keys:keys,values:values,index:index,merge:merge,update:update,toQueryString:toQueryString,inspect:inspect,toJSON:toObject,clone:clone};})());Hash.from=$H;Object.extend(Number.prototype,(function(){function toColorPart(){return this.toPaddedString(2,16);}
function succ(){return this+1;}
function times(iterator,context){$R(0,this,true).each(iterator,context);return this;}
function toPaddedString(length,radix){var string=this.toString(radix||10);return'0'.times(length-string.length)+string;}
function abs(){return Math.abs(this);}
function round(){return Math.round(this);}
function ceil(){return Math.ceil(this);}
function floor(){return Math.floor(this);}
return{toColorPart:toColorPart,succ:succ,times:times,toPaddedString:toPaddedString,abs:abs,round:round,ceil:ceil,floor:floor};})());function $R(start,end,exclusive){return new ObjectRange(start,end,exclusive);}
var ObjectRange=Class.create(Enumerable,(function(){function initialize(start,end,exclusive){this.start=start;this.end=end;this.exclusive=exclusive;}
function _each(iterator){var value=this.start;while(this.include(value)){iterator(value);value=value.succ();}}
function include(value){if(value<this.start)
return false;if(this.exclusive)
return value<this.end;return value<=this.end;}
return{initialize:initialize,_each:_each,include:include};})());var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject('Msxml2.XMLHTTP')},function(){return new ActiveXObject('Microsoft.XMLHTTP')})||false;},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(iterator){this.responders._each(iterator);},register:function(responder){if(!this.include(responder))
this.responders.push(responder);},unregister:function(responder){this.responders=this.responders.without(responder);},dispatch:function(callback,request,transport,json){this.each(function(responder){if(Object.isFunction(responder[callback])){try{responder[callback].apply(responder,[request,transport,json]);}catch(e){}}});}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onLoaded:function(){Ajax.activeRequestCount--}});Ajax.Base=Class.create({initialize:function(options){this.options={method:'post',asynchronous:true,contentType:'application/x-www-form-urlencoded',encoding:'UTF-8',parameters:'',evalJSON:true,evalJS:true};Object.extend(this.options,options||{});this.options.method=this.options.method.toLowerCase();if(Object.isHash(this.options.parameters))
this.options.parameters=this.options.parameters.toObject();}});Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,url,options){$super(options);this.transport=Ajax.getTransport();this.request(url);},request:function(url){this.url=url;this.method=this.options.method;var params=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);if(!['get','post'].include(this.method)){params+=(params?'&':'')+"_method="+this.method;this.method='post';}
if(params&&this.method==='get'){this.url+=(this.url.include('?')?'&':'?')+params;}
this.parameters=params.toQueryParams();try{var response=new Ajax.Response(this);if(this.options.onCreate)this.options.onCreate(response);Ajax.Responders.dispatch('onCreate',this,response);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous)this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=='post'?(this.options.postBody||params):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType)
this.onStateChange();}
catch(e){this.dispatchException(e);}},onStateChange:function(){var readyState=this.transport.readyState;if(readyState>1&&!((readyState==4)&&this._complete))
this.respondToReadyState(this.transport.readyState);},setRequestHeaders:function(){var headers={'X-Requested-With':'XMLHttpRequest','X-Prototype-Version':Prototype.Version,'Accept':'text/javascript, text/html, application/xml, text/xml, */*'};if(this.method=='post'){headers['Content-type']=this.options.contentType+
(this.options.encoding?'; charset='+this.options.encoding:'');if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005)
headers['Connection']='close';}
if(typeof this.options.requestHeaders=='object'){var extras=this.options.requestHeaders;if(Object.isFunction(extras.push))
for(var i=0,length=extras.length;i<length;i+=2)
headers[extras[i]]=extras[i+1];else
$H(extras).each(function(pair){headers[pair.key]=pair.value});}
for(var name in headers)
this.transport.setRequestHeader(name,headers[name]);},success:function(){var status=this.getStatus();return!status||(status>=200&&status<300)||status==304;},getStatus:function(){try{if(this.transport.status===1223)return 204;return this.transport.status||0;}catch(e){return 0}},respondToReadyState:function(readyState){var state=Ajax.Request.Events[readyState],response=new Ajax.Response(this);if(state=='Complete'){try{this._complete=true;(this.options['on'+response.status]||this.options['on'+(this.success()?'Success':'Failure')]||Prototype.emptyFunction)(response,response.headerJSON);}catch(e){this.dispatchException(e);}
var contentType=response.getHeader('Content-type');if(this.options.evalJS=='force'||(this.options.evalJS&&this.isSameOrigin()&&contentType&&contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i)))
this.evalResponse();}
try{(this.options['on'+state]||Prototype.emptyFunction)(response,response.headerJSON);Ajax.Responders.dispatch('on'+state,this,response,response.headerJSON);}catch(e){this.dispatchException(e);}
if(state=='Complete'){this.transport.onreadystatechange=Prototype.emptyFunction;}},isSameOrigin:function(){var m=this.url.match(/^\s*https?:\/\/[^\/]*/);return!m||(m[0]=='#{protocol}//#{domain}#{port}'.interpolate({protocol:location.protocol,domain:document.domain,port:location.port?':'+location.port:''}));},getHeader:function(name){try{return this.transport.getResponseHeader(name)||null;}catch(e){return null;}},evalResponse:function(){try{return eval((this.transport.responseText||'').unfilterJSON());}catch(e){this.dispatchException(e);}},dispatchException:function(exception){(this.options.onException||Prototype.emptyFunction)(this,exception);Ajax.Responders.dispatch('onException',this,exception);}});Ajax.Request.Events=['Uninitialized','Loading','Loaded','Interactive','Complete'];Ajax.Response=Class.create({initialize:function(request){this.request=request;var transport=this.transport=request.transport,readyState=this.readyState=transport.readyState;if((readyState>2&&!Prototype.Browser.IE)||readyState==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(transport.responseText);this.headerJSON=this._getHeaderJSON();}
if(readyState==4){var xml=transport.responseXML;this.responseXML=Object.isUndefined(xml)?null:xml;this.responseJSON=this._getResponseJSON();}},status:0,statusText:'',getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||'';}catch(e){return''}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders();}catch(e){return null}},getResponseHeader:function(name){return this.transport.getResponseHeader(name);},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders();},_getHeaderJSON:function(){var json=this.getHeader('X-JSON');if(!json)return null;json=decodeURIComponent(escape(json));try{return json.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin());}catch(e){this.request.dispatchException(e);}},_getResponseJSON:function(){var options=this.request.options;if(!options.evalJSON||(options.evalJSON!='force'&&!(this.getHeader('Content-type')||'').include('application/json'))||this.responseText.blank())
return null;try{return this.responseText.evalJSON(options.sanitizeJSON||!this.request.isSameOrigin());}catch(e){this.request.dispatchException(e);}}});Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,container,url,options){this.container={success:(container.success||container),failure:(container.failure||(container.success?null:container))};options=Object.clone(options);var onComplete=options.onComplete;options.onComplete=(function(response,json){this.updateContent(response.responseText);if(Object.isFunction(onComplete))onComplete(response,json);}).bind(this);$super(url,options);},updateContent:function(responseText){var receiver=this.container[this.success()?'success':'failure'],options=this.options;if(!options.evalScripts)responseText=responseText.stripScripts();if(receiver=$(receiver)){if(options.insertion){if(Object.isString(options.insertion)){var insertion={};insertion[options.insertion]=responseText;receiver.insert(insertion);}
else options.insertion(receiver,responseText);}
else receiver.update(responseText);}}});Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,container,url,options){$super(options);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=container;this.url=url;this.start();},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent();},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments);},updateComplete:function(response){if(this.options.decay){this.decay=(response.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=response.responseText;}
this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency);},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options);}});function $(element){if(arguments.length>1){for(var i=0,elements=[],length=arguments.length;i<length;i++)
elements.push($(arguments[i]));return elements;}
if(Object.isString(element))
element=document.getElementById(element);return Element.extend(element);}
if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(expression,parentElement){var results=[];var query=document.evaluate(expression,$(parentElement)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var i=0,length=query.snapshotLength;i<length;i++)
results.push(Element.extend(query.snapshotItem(i)));return results;};}
if(!Node)var Node={};if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});}
(function(global){function shouldUseCache(tagName,attributes){if(tagName==='select')return false;if('type'in attributes)return false;return true;}
var HAS_EXTENDED_CREATE_ELEMENT_SYNTAX=(function(){try{var el=document.createElement('<input name="x">');return el.tagName.toLowerCase()==='input'&&el.name==='x';}
catch(err){return false;}})();var element=global.Element;global.Element=function(tagName,attributes){attributes=attributes||{};tagName=tagName.toLowerCase();var cache=Element.cache;if(HAS_EXTENDED_CREATE_ELEMENT_SYNTAX&&attributes.name){tagName='<'+tagName+' name="'+attributes.name+'">';delete attributes.name;return Element.writeAttribute(document.createElement(tagName),attributes);}
if(!cache[tagName])cache[tagName]=Element.extend(document.createElement(tagName));var node=shouldUseCache(tagName,attributes)?cache[tagName].cloneNode(false):document.createElement(tagName);return Element.writeAttribute(node,attributes);};Object.extend(global.Element,element||{});if(element)global.Element.prototype=element.prototype;})(this);Element.idCounter=1;Element.cache={};Element._purgeElement=function(element){var uid=element._prototypeUID;if(uid){Element.stopObserving(element);element._prototypeUID=void 0;delete Element.Storage[uid];}}
Element.Methods={visible:function(element){return $(element).style.display!='none';},toggle:function(element){element=$(element);Element[Element.visible(element)?'hide':'show'](element);return element;},hide:function(element){element=$(element);element.style.display='none';return element;},show:function(element){element=$(element);element.style.display='';return element;},remove:function(element){element=$(element);element.parentNode.removeChild(element);return element;},update:(function(){var SELECT_ELEMENT_INNERHTML_BUGGY=(function(){var el=document.createElement("select"),isBuggy=true;el.innerHTML="<option value=\"test\">test</option>";if(el.options&&el.options[0]){isBuggy=el.options[0].nodeName.toUpperCase()!=="OPTION";}
el=null;return isBuggy;})();var TABLE_ELEMENT_INNERHTML_BUGGY=(function(){try{var el=document.createElement("table");if(el&&el.tBodies){el.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var isBuggy=typeof el.tBodies[0]=="undefined";el=null;return isBuggy;}}catch(e){return true;}})();var LINK_ELEMENT_INNERHTML_BUGGY=(function(){try{var el=document.createElement('div');el.innerHTML="<link>";var isBuggy=(el.childNodes.length===0);el=null;return isBuggy;}catch(e){return true;}})();var ANY_INNERHTML_BUGGY=SELECT_ELEMENT_INNERHTML_BUGGY||TABLE_ELEMENT_INNERHTML_BUGGY||LINK_ELEMENT_INNERHTML_BUGGY;var SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING=(function(){var s=document.createElement("script"),isBuggy=false;try{s.appendChild(document.createTextNode(""));isBuggy=!s.firstChild||s.firstChild&&s.firstChild.nodeType!==3;}catch(e){isBuggy=true;}
s=null;return isBuggy;})();function update(element,content){element=$(element);var purgeElement=Element._purgeElement;var descendants=element.getElementsByTagName('*'),i=descendants.length;while(i--)purgeElement(descendants[i]);if(content&&content.toElement)
content=content.toElement();if(Object.isElement(content))
return element.update().insert(content);content=Object.toHTML(content);var tagName=element.tagName.toUpperCase();if(tagName==='SCRIPT'&&SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING){element.text=content;return element;}
if(ANY_INNERHTML_BUGGY){if(tagName in Element._insertionTranslations.tags){while(element.firstChild){element.removeChild(element.firstChild);}
Element._getContentFromAnonymousElement(tagName,content.stripScripts()).each(function(node){element.appendChild(node)});}else if(LINK_ELEMENT_INNERHTML_BUGGY&&Object.isString(content)&&content.indexOf('<link')>-1){while(element.firstChild){element.removeChild(element.firstChild);}
var nodes=Element._getContentFromAnonymousElement(tagName,content.stripScripts(),true);nodes.each(function(node){element.appendChild(node)});}
else{element.innerHTML=content.stripScripts();}}
else{element.innerHTML=content.stripScripts();}
content.evalScripts.bind(content).defer();return element;}
return update;})(),replace:function(element,content){element=$(element);if(content&&content.toElement)content=content.toElement();else if(!Object.isElement(content)){content=Object.toHTML(content);var range=element.ownerDocument.createRange();range.selectNode(element);content.evalScripts.bind(content).defer();content=range.createContextualFragment(content.stripScripts());}
element.parentNode.replaceChild(content,element);return element;},insert:function(element,insertions){element=$(element);if(Object.isString(insertions)||Object.isNumber(insertions)||Object.isElement(insertions)||(insertions&&(insertions.toElement||insertions.toHTML)))
insertions={bottom:insertions};var content,insert,tagName,childNodes;for(var position in insertions){content=insertions[position];position=position.toLowerCase();insert=Element._insertionTranslations[position];if(content&&content.toElement)content=content.toElement();if(Object.isElement(content)){insert(element,content);continue;}
content=Object.toHTML(content);tagName=((position=='before'||position=='after')?element.parentNode:element).tagName.toUpperCase();childNodes=Element._getContentFromAnonymousElement(tagName,content.stripScripts());if(position=='top'||position=='after')childNodes.reverse();childNodes.each(insert.curry(element));content.evalScripts.bind(content).defer();}
return element;},wrap:function(element,wrapper,attributes){element=$(element);if(Object.isElement(wrapper))
$(wrapper).writeAttribute(attributes||{});else if(Object.isString(wrapper))wrapper=new Element(wrapper,attributes);else wrapper=new Element('div',wrapper);if(element.parentNode)
element.parentNode.replaceChild(wrapper,element);wrapper.appendChild(element);return wrapper;},inspect:function(element){element=$(element);var result='<'+element.tagName.toLowerCase();$H({'id':'id','className':'class'}).each(function(pair){var property=pair.first(),attribute=pair.last(),value=(element[property]||'').toString();if(value)result+=' '+attribute+'='+value.inspect(true);});return result+'>';},recursivelyCollect:function(element,property,maximumLength){element=$(element);maximumLength=maximumLength||-1;var elements=[];while(element=element[property]){if(element.nodeType==1)
elements.push(Element.extend(element));if(elements.length==maximumLength)
break;}
return elements;},ancestors:function(element){return Element.recursivelyCollect(element,'parentNode');},descendants:function(element){return Element.select(element,"*");},firstDescendant:function(element){element=$(element).firstChild;while(element&&element.nodeType!=1)element=element.nextSibling;return $(element);},immediateDescendants:function(element){var results=[],child=$(element).firstChild;while(child){if(child.nodeType===1){results.push(Element.extend(child));}
child=child.nextSibling;}
return results;},previousSiblings:function(element,maximumLength){return Element.recursivelyCollect(element,'previousSibling');},nextSiblings:function(element){return Element.recursivelyCollect(element,'nextSibling');},siblings:function(element){element=$(element);return Element.previousSiblings(element).reverse().concat(Element.nextSiblings(element));},match:function(element,selector){element=$(element);if(Object.isString(selector))
return Prototype.Selector.match(element,selector);return selector.match(element);},up:function(element,expression,index){element=$(element);if(arguments.length==1)return $(element.parentNode);var ancestors=Element.ancestors(element);return Object.isNumber(expression)?ancestors[expression]:Prototype.Selector.find(ancestors,expression,index);},down:function(element,expression,index){element=$(element);if(arguments.length==1)return Element.firstDescendant(element);return Object.isNumber(expression)?Element.descendants(element)[expression]:Element.select(element,expression)[index||0];},previous:function(element,expression,index){element=$(element);if(Object.isNumber(expression))index=expression,expression=false;if(!Object.isNumber(index))index=0;if(expression){return Prototype.Selector.find(element.previousSiblings(),expression,index);}else{return element.recursivelyCollect("previousSibling",index+1)[index];}},next:function(element,expression,index){element=$(element);if(Object.isNumber(expression))index=expression,expression=false;if(!Object.isNumber(index))index=0;if(expression){return Prototype.Selector.find(element.nextSiblings(),expression,index);}else{var maximumLength=Object.isNumber(index)?index+1:1;return element.recursivelyCollect("nextSibling",index+1)[index];}},select:function(element){element=$(element);var expressions=Array.prototype.slice.call(arguments,1).join(', ');return Prototype.Selector.select(expressions,element);},adjacent:function(element){element=$(element);var expressions=Array.prototype.slice.call(arguments,1).join(', ');return Prototype.Selector.select(expressions,element.parentNode).without(element);},identify:function(element){element=$(element);var id=Element.readAttribute(element,'id');if(id)return id;do{id='anonymous_element_'+Element.idCounter++}while($(id));Element.writeAttribute(element,'id',id);return id;},readAttribute:function(element,name){element=$(element);if(Prototype.Browser.IE){var t=Element._attributeTranslations.read;if(t.values[name])return t.values[name](element,name);if(t.names[name])name=t.names[name];if(name.include(':')){return(!element.attributes||!element.attributes[name])?null:element.attributes[name].value;}}
return element.getAttribute(name);},writeAttribute:function(element,name,value){element=$(element);var attributes={},t=Element._attributeTranslations.write;if(typeof name=='object')attributes=name;else attributes[name]=Object.isUndefined(value)?true:value;for(var attr in attributes){name=t.names[attr]||attr;value=attributes[attr];if(t.values[attr])name=t.values[attr](element,value);if(value===false||value===null)
element.removeAttribute(name);else if(value===true)
element.setAttribute(name,name);else element.setAttribute(name,value);}
return element;},getHeight:function(element){return Element.getDimensions(element).height;},getWidth:function(element){return Element.getDimensions(element).width;},classNames:function(element){return new Element.ClassNames(element);},hasClassName:function(element,className){if(!(element=$(element)))return;var elementClassName=element.className;return(elementClassName.length>0&&(elementClassName==className||new RegExp("(^|\\s)"+className+"(\\s|$)").test(elementClassName)));},addClassName:function(element,className){if(!(element=$(element)))return;if(!Element.hasClassName(element,className))
element.className+=(element.className?' ':'')+className;return element;},removeClassName:function(element,className){if(!(element=$(element)))return;element.className=element.className.replace(new RegExp("(^|\\s+)"+className+"(\\s+|$)"),' ').strip();return element;},toggleClassName:function(element,className){if(!(element=$(element)))return;return Element[Element.hasClassName(element,className)?'removeClassName':'addClassName'](element,className);},cleanWhitespace:function(element){element=$(element);var node=element.firstChild;while(node){var nextNode=node.nextSibling;if(node.nodeType==3&&!/\S/.test(node.nodeValue))
element.removeChild(node);node=nextNode;}
return element;},empty:function(element){return $(element).innerHTML.blank();},descendantOf:function(element,ancestor){element=$(element),ancestor=$(ancestor);if(element.compareDocumentPosition){try{return(element.compareDocumentPosition(ancestor)&8)===8;}catch(err){}}
if(ancestor&&ancestor.contains)
return ancestor.contains(element)&&ancestor!==element;try{while(element=element.parentNode)
if(element==ancestor)return true;}catch(err){}
return false;},scrollTo:function(element){element=$(element);var pos=Element.cumulativeOffset(element);window.scrollTo(pos[0],pos[1]);return element;},getStyle:function(element,style){element=$(element);style=style=='float'?'cssFloat':style.camelize();var value=element.style[style];if(!value||value=='auto'){var css=document.defaultView.getComputedStyle(element,null);value=css?css[style]:null;}
if(style=='opacity')return value?parseFloat(value):1.0;return value=='auto'?null:value;},getOpacity:function(element){return $(element).getStyle('opacity');},setStyle:function(element,styles){element=$(element);var elementStyle=element.style,match;if(Object.isString(styles)){element.style.cssText+=';'+styles;return styles.include('opacity')?element.setOpacity(styles.match(/opacity:\s*(\d?\.?\d*)/)[1]):element;}
for(var property in styles)
if(property=='opacity')element.setOpacity(styles[property]);else
elementStyle[(property=='float'||property=='cssFloat')?(Object.isUndefined(elementStyle.styleFloat)?'cssFloat':'styleFloat'):property]=styles[property];return element;},setOpacity:function(element,value){element=$(element);element.style.opacity=(value==1||value==='')?'':(value<0.00001)?0:value;return element;},makePositioned:function(element){element=$(element);var pos=Element.getStyle(element,'position');if(pos=='static'||!pos){element._madePositioned=true;element.style.position='relative';if(Prototype.Browser.Opera){element.style.top=0;element.style.left=0;}}
return element;},undoPositioned:function(element){element=$(element);if(element._madePositioned){element._madePositioned=undefined;element.style.position=element.style.top=element.style.left=element.style.bottom=element.style.right='';}
return element;},makeClipping:function(element){element=$(element);if(element._overflow)return element;element._overflow=Element.getStyle(element,'overflow')||'auto';if(element._overflow!=='hidden')
element.style.overflow='hidden';return element;},undoClipping:function(element){element=$(element);if(!element._overflow)return element;element.style.overflow=element._overflow=='auto'?'':element._overflow;element._overflow=null;return element;},clonePosition:function(element,source){var options=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});source=$(source);var p=Element.viewportOffset(source),delta=[0,0],parent=null;element=$(element);if(Element.getStyle(element,'position')=='absolute'){parent=Element.getOffsetParent(element);delta=Element.viewportOffset(parent);}
if(parent==document.body){delta[0]-=document.body.offsetLeft;delta[1]-=document.body.offsetTop;}
if(options.setLeft)element.style.left=(p[0]-delta[0]+options.offsetLeft)+'px';if(options.setTop)element.style.top=(p[1]-delta[1]+options.offsetTop)+'px';if(options.setWidth)element.style.width=source.offsetWidth+'px';if(options.setHeight)element.style.height=source.offsetHeight+'px';return element;}};Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:'class',htmlFor:'for'},values:{}}};if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(proceed,element,style){switch(style){case'height':case'width':if(!Element.visible(element))return null;var dim=parseInt(proceed(element,style),10);if(dim!==element['offset'+style.capitalize()])
return dim+'px';var properties;if(style==='height'){properties=['border-top-width','padding-top','padding-bottom','border-bottom-width'];}
else{properties=['border-left-width','padding-left','padding-right','border-right-width'];}
return properties.inject(dim,function(memo,property){var val=proceed(element,property);return val===null?memo:memo-parseInt(val,10);})+'px';default:return proceed(element,style);}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(proceed,element,attribute){if(attribute==='title')return element.title;return proceed(element,attribute);});}
else if(Prototype.Browser.IE){Element.Methods.getStyle=function(element,style){element=$(element);style=(style=='float'||style=='cssFloat')?'styleFloat':style.camelize();var value=element.style[style];if(!value&&element.currentStyle)value=element.currentStyle[style];if(style=='opacity'){if(value=(element.getStyle('filter')||'').match(/alpha\(opacity=(.*)\)/))
if(value[1])return parseFloat(value[1])/100;return 1.0;}
if(value=='auto'){if((style=='width'||style=='height')&&(element.getStyle('display')!='none'))
return element['offset'+style.capitalize()]+'px';return null;}
return value;};Element.Methods.setOpacity=function(element,value){function stripAlpha(filter){return filter.replace(/alpha\([^\)]*\)/gi,'');}
element=$(element);var currentStyle=element.currentStyle;if((currentStyle&&!currentStyle.hasLayout)||(!currentStyle&&element.style.zoom=='normal'))
element.style.zoom=1;var filter=element.getStyle('filter'),style=element.style;if(value==1||value===''){(filter=stripAlpha(filter))?style.filter=filter:style.removeAttribute('filter');return element;}else if(value<0.00001)value=0;style.filter=stripAlpha(filter)+'alpha(opacity='+(value*100)+')';return element;};Element._attributeTranslations=(function(){var classProp='className',forProp='for',el=document.createElement('div');el.setAttribute(classProp,'x');if(el.className!=='x'){el.setAttribute('class','x');if(el.className==='x'){classProp='class';}}
el=null;el=document.createElement('label');el.setAttribute(forProp,'x');if(el.htmlFor!=='x'){el.setAttribute('htmlFor','x');if(el.htmlFor==='x'){forProp='htmlFor';}}
el=null;return{read:{names:{'class':classProp,'className':classProp,'for':forProp,'htmlFor':forProp},values:{_getAttr:function(element,attribute){return element.getAttribute(attribute);},_getAttr2:function(element,attribute){return element.getAttribute(attribute,2);},_getAttrNode:function(element,attribute){var node=element.getAttributeNode(attribute);return node?node.value:"";},_getEv:(function(){var el=document.createElement('div'),f;el.onclick=Prototype.emptyFunction;var value=el.getAttribute('onclick');if(String(value).indexOf('{')>-1){f=function(element,attribute){attribute=element.getAttribute(attribute);if(!attribute)return null;attribute=attribute.toString();attribute=attribute.split('{')[1];attribute=attribute.split('}')[0];return attribute.strip();};}
else if(value===''){f=function(element,attribute){attribute=element.getAttribute(attribute);if(!attribute)return null;return attribute.strip();};}
el=null;return f;})(),_flag:function(element,attribute){return $(element).hasAttribute(attribute)?attribute:null;},style:function(element){return element.style.cssText.toLowerCase();},title:function(element){return element.title;}}}}})();Element._attributeTranslations.write={names:Object.extend({cellpadding:'cellPadding',cellspacing:'cellSpacing'},Element._attributeTranslations.read.names),values:{checked:function(element,value){element.checked=!!value;},style:function(element,value){element.style.cssText=value?value:'';}}};Element._attributeTranslations.has={};$w('colSpan rowSpan vAlign dateTime accessKey tabIndex '+'encType maxLength readOnly longDesc frameBorder').each(function(attr){Element._attributeTranslations.write.names[attr.toLowerCase()]=attr;Element._attributeTranslations.has[attr.toLowerCase()]=attr;});(function(v){Object.extend(v,{href:v._getAttr2,src:v._getAttr2,type:v._getAttr,action:v._getAttrNode,disabled:v._flag,checked:v._flag,readonly:v._flag,multiple:v._flag,onload:v._getEv,onunload:v._getEv,onclick:v._getEv,ondblclick:v._getEv,onmousedown:v._getEv,onmouseup:v._getEv,onmouseover:v._getEv,onmousemove:v._getEv,onmouseout:v._getEv,onfocus:v._getEv,onblur:v._getEv,onkeypress:v._getEv,onkeydown:v._getEv,onkeyup:v._getEv,onsubmit:v._getEv,onreset:v._getEv,onselect:v._getEv,onchange:v._getEv});})(Element._attributeTranslations.read.values);if(Prototype.BrowserFeatures.ElementExtensions){(function(){function _descendants(element){var nodes=element.getElementsByTagName('*'),results=[];for(var i=0,node;node=nodes[i];i++)
if(node.tagName!=="!")
results.push(node);return results;}
Element.Methods.down=function(element,expression,index){element=$(element);if(arguments.length==1)return element.firstDescendant();return Object.isNumber(expression)?_descendants(element)[expression]:Element.select(element,expression)[index||0];}})();}}
else if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)){Element.Methods.setOpacity=function(element,value){element=$(element);element.style.opacity=(value==1)?0.999999:(value==='')?'':(value<0.00001)?0:value;return element;};}
else if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(element,value){element=$(element);element.style.opacity=(value==1||value==='')?'':(value<0.00001)?0:value;if(value==1)
if(element.tagName.toUpperCase()=='IMG'&&element.width){element.width++;element.width--;}else try{var n=document.createTextNode(' ');element.appendChild(n);element.removeChild(n);}catch(e){}
return element;};}
if('outerHTML'in document.documentElement){Element.Methods.replace=function(element,content){element=$(element);if(content&&content.toElement)content=content.toElement();if(Object.isElement(content)){element.parentNode.replaceChild(content,element);return element;}
content=Object.toHTML(content);var parent=element.parentNode,tagName=parent.tagName.toUpperCase();if(Element._insertionTranslations.tags[tagName]){var nextSibling=element.next(),fragments=Element._getContentFromAnonymousElement(tagName,content.stripScripts());parent.removeChild(element);if(nextSibling)
fragments.each(function(node){parent.insertBefore(node,nextSibling)});else
fragments.each(function(node){parent.appendChild(node)});}
else element.outerHTML=content.stripScripts();content.evalScripts.bind(content).defer();return element;};}
Element._returnOffset=function(l,t){var result=[l,t];result.left=l;result.top=t;return result;};Element._getContentFromAnonymousElement=function(tagName,html,force){var div=new Element('div'),t=Element._insertionTranslations.tags[tagName];var workaround=false;if(t)workaround=true;else if(force){workaround=true;t=['','',0];}
if(workaround){div.innerHTML='&nbsp;'+t[0]+html+t[1];div.removeChild(div.firstChild);for(var i=t[2];i--;){div=div.firstChild;}}
else{div.innerHTML=html;}
return $A(div.childNodes);};Element._insertionTranslations={before:function(element,node){element.parentNode.insertBefore(node,element);},top:function(element,node){element.insertBefore(node,element.firstChild);},bottom:function(element,node){element.appendChild(node);},after:function(element,node){element.parentNode.insertBefore(node,element.nextSibling);},tags:{TABLE:['<table>','</table>',1],TBODY:['<table><tbody>','</tbody></table>',2],TR:['<table><tbody><tr>','</tr></tbody></table>',3],TD:['<table><tbody><tr><td>','</td></tr></tbody></table>',4],SELECT:['<select>','</select>',1]}};(function(){var tags=Element._insertionTranslations.tags;Object.extend(tags,{THEAD:tags.TBODY,TFOOT:tags.TBODY,TH:tags.TD});})();Element.Methods.Simulated={hasAttribute:function(element,attribute){attribute=Element._attributeTranslations.has[attribute]||attribute;var node=$(element).getAttributeNode(attribute);return!!(node&&node.specified);}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);(function(div){if(!Prototype.BrowserFeatures.ElementExtensions&&div['__proto__']){window.HTMLElement={};window.HTMLElement.prototype=div['__proto__'];Prototype.BrowserFeatures.ElementExtensions=true;}
div=null;})(document.createElement('div'));Element.extend=(function(){function checkDeficiency(tagName){if(typeof window.Element!='undefined'){var proto=window.Element.prototype;if(proto){var id='_'+(Math.random()+'').slice(2),el=document.createElement(tagName);proto[id]='x';var isBuggy=(el[id]!=='x');delete proto[id];el=null;return isBuggy;}}
return false;}
function extendElementWith(element,methods){for(var property in methods){var value=methods[property];if(Object.isFunction(value)&&!(property in element))
element[property]=value.methodize();}}
var HTMLOBJECTELEMENT_PROTOTYPE_BUGGY=checkDeficiency('object');if(Prototype.BrowserFeatures.SpecificElementExtensions){if(HTMLOBJECTELEMENT_PROTOTYPE_BUGGY){return function(element){if(element&&typeof element._extendedByPrototype=='undefined'){var t=element.tagName;if(t&&(/^(?:object|applet|embed)$/i.test(t))){extendElementWith(element,Element.Methods);extendElementWith(element,Element.Methods.Simulated);extendElementWith(element,Element.Methods.ByTag[t.toUpperCase()]);}}
return element;}}
return Prototype.K;}
var Methods={},ByTag=Element.Methods.ByTag;var extend=Object.extend(function(element){if(!element||typeof element._extendedByPrototype!='undefined'||element.nodeType!=1||element==window)return element;var methods=Object.clone(Methods),tagName=element.tagName.toUpperCase();if(ByTag[tagName])Object.extend(methods,ByTag[tagName]);extendElementWith(element,methods);element._extendedByPrototype=Prototype.emptyFunction;return element;},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(Methods,Element.Methods);Object.extend(Methods,Element.Methods.Simulated);}}});extend.refresh();return extend;})();if(document.documentElement.hasAttribute){Element.hasAttribute=function(element,attribute){return element.hasAttribute(attribute);};}
else{Element.hasAttribute=Element.Methods.Simulated.hasAttribute;}
Element.addMethods=function(methods){var F=Prototype.BrowserFeatures,T=Element.Methods.ByTag;if(!methods){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{"FORM":Object.clone(Form.Methods),"INPUT":Object.clone(Form.Element.Methods),"SELECT":Object.clone(Form.Element.Methods),"TEXTAREA":Object.clone(Form.Element.Methods),"BUTTON":Object.clone(Form.Element.Methods)});}
if(arguments.length==2){var tagName=methods;methods=arguments[1];}
if(!tagName)Object.extend(Element.Methods,methods||{});else{if(Object.isArray(tagName))tagName.each(extend);else extend(tagName);}
function extend(tagName){tagName=tagName.toUpperCase();if(!Element.Methods.ByTag[tagName])
Element.Methods.ByTag[tagName]={};Object.extend(Element.Methods.ByTag[tagName],methods);}
function copy(methods,destination,onlyIfAbsent){onlyIfAbsent=onlyIfAbsent||false;for(var property in methods){var value=methods[property];if(!Object.isFunction(value))continue;if(!onlyIfAbsent||!(property in destination))
try{destination[property]=value.methodize();}catch(e){}}}
function findDOMClass(tagName){var klass;var trans={"OPTGROUP":"OptGroup","TEXTAREA":"TextArea","P":"Paragraph","FIELDSET":"FieldSet","UL":"UList","OL":"OList","DL":"DList","DIR":"Directory","H1":"Heading","H2":"Heading","H3":"Heading","H4":"Heading","H5":"Heading","H6":"Heading","Q":"Quote","INS":"Mod","DEL":"Mod","A":"Anchor","IMG":"Image","CAPTION":"TableCaption","COL":"TableCol","COLGROUP":"TableCol","THEAD":"TableSection","TFOOT":"TableSection","TBODY":"TableSection","TR":"TableRow","TH":"TableCell","TD":"TableCell","FRAMESET":"FrameSet","IFRAME":"IFrame"};if(trans[tagName])klass='HTML'+trans[tagName]+'Element';if(window[klass])return window[klass];klass='HTML'+tagName+'Element';if(window[klass])return window[klass];klass='HTML'+tagName.capitalize()+'Element';if(window[klass])return window[klass];var element=document.createElement(tagName),proto=element['__proto__']||element.constructor.prototype;element=null;return proto;}
var elementPrototype=window.HTMLElement?HTMLElement.prototype:Element.prototype;if(F.ElementExtensions){copy(Element.Methods,elementPrototype);copy(Element.Methods.Simulated,elementPrototype,true);}
if(F.SpecificElementExtensions){for(var tag in Element.Methods.ByTag){var klass=findDOMClass(tag);if(Object.isUndefined(klass))continue;copy(T[tag],klass.prototype);}}
Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh)Element.extend.refresh();Element.cache={};};document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()};},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop);}};(function(viewport){var B=Prototype.Browser,doc=document,element,property={};function getRootElement(){if(B.WebKit&&!doc.evaluate)
return document;if(B.Opera&&window.parseFloat(window.opera.version())<9.5)
return document.body;return document.documentElement;}
function define(D){if(!element)element=getRootElement();property[D]='client'+D;viewport['get'+D]=function(){return element[property[D]]};return viewport['get'+D]();}
viewport.getWidth=define.curry('Width');viewport.getHeight=define.curry('Height');})(document.viewport);Element.Storage={UID:1};Element.addMethods({getStorage:function(element){if(!(element=$(element)))return;var uid;if(element===window){uid=0;}else{if(typeof element._prototypeUID==="undefined")
element._prototypeUID=Element.Storage.UID++;uid=element._prototypeUID;}
if(!Element.Storage[uid])
Element.Storage[uid]=$H();return Element.Storage[uid];},store:function(element,key,value){if(!(element=$(element)))return;if(arguments.length===2){Element.getStorage(element).update(key);}else{Element.getStorage(element).set(key,value);}
return element;},retrieve:function(element,key,defaultValue){if(!(element=$(element)))return;var hash=Element.getStorage(element),value=hash.get(key);if(Object.isUndefined(value)){hash.set(key,defaultValue);value=defaultValue;}
return value;},clone:function(element,deep){if(!(element=$(element)))return;var clone=element.cloneNode(deep);clone._prototypeUID=void 0;if(deep){var descendants=Element.select(clone,'*'),i=descendants.length;while(i--){descendants[i]._prototypeUID=void 0;}}
return Element.extend(clone);},purge:function(element){if(!(element=$(element)))return;var purgeElement=Element._purgeElement;purgeElement(element);var descendants=element.getElementsByTagName('*'),i=descendants.length;while(i--)purgeElement(descendants[i]);return null;}});(function(){function toDecimal(pctString){var match=pctString.match(/^(\d+)%?$/i);if(!match)return null;return(Number(match[1])/100);}
function getPixelValue(value,property,context){var element=null;if(Object.isElement(value)){element=value;value=element.getStyle(property);}
if(value===null){return null;}
if((/^(?:-)?\d+(\.\d+)?(px)?$/i).test(value)){return window.parseFloat(value);}
var isPercentage=value.include('%'),isViewport=(context===document.viewport);if(/\d/.test(value)&&element&&element.runtimeStyle&&!(isPercentage&&isViewport)){var style=element.style.left,rStyle=element.runtimeStyle.left;element.runtimeStyle.left=element.currentStyle.left;element.style.left=value||0;value=element.style.pixelLeft;element.style.left=style;element.runtimeStyle.left=rStyle;return value;}
if(element&&isPercentage){context=context||element.parentNode;var decimal=toDecimal(value);var whole=null;var position=element.getStyle('position');var isHorizontal=property.include('left')||property.include('right')||property.include('width');var isVertical=property.include('top')||property.include('bottom')||property.include('height');if(context===document.viewport){if(isHorizontal){whole=document.viewport.getWidth();}else if(isVertical){whole=document.viewport.getHeight();}}else{if(isHorizontal){whole=$(context).measure('width');}else if(isVertical){whole=$(context).measure('height');}}
return(whole===null)?0:whole*decimal;}
return 0;}
function toCSSPixels(number){if(Object.isString(number)&&number.endsWith('px')){return number;}
return number+'px';}
function isDisplayed(element){var originalElement=element;while(element&&element.parentNode){var display=element.getStyle('display');if(display==='none'){return false;}
element=$(element.parentNode);}
return true;}
var hasLayout=Prototype.K;if('currentStyle'in document.documentElement){hasLayout=function(element){if(!element.currentStyle.hasLayout){element.style.zoom=1;}
return element;};}
function cssNameFor(key){if(key.include('border'))key=key+'-width';return key.camelize();}
Element.Layout=Class.create(Hash,{initialize:function($super,element,preCompute){$super();this.element=$(element);Element.Layout.PROPERTIES.each(function(property){this._set(property,null);},this);if(preCompute){this._preComputing=true;this._begin();Element.Layout.PROPERTIES.each(this._compute,this);this._end();this._preComputing=false;}},_set:function(property,value){return Hash.prototype.set.call(this,property,value);},set:function(property,value){throw"Properties of Element.Layout are read-only.";},get:function($super,property){var value=$super(property);return value===null?this._compute(property):value;},_begin:function(){if(this._prepared)return;var element=this.element;if(isDisplayed(element)){this._prepared=true;return;}
var originalStyles={position:element.style.position||'',width:element.style.width||'',visibility:element.style.visibility||'',display:element.style.display||''};element.store('prototype_original_styles',originalStyles);var position=element.getStyle('position'),width=element.getStyle('width');if(width==="0px"||width===null){element.style.display='block';width=element.getStyle('width');}
var context=(position==='fixed')?document.viewport:element.parentNode;element.setStyle({position:'absolute',visibility:'hidden',display:'block'});var positionedWidth=element.getStyle('width');var newWidth;if(width&&(positionedWidth===width)){newWidth=getPixelValue(element,'width',context);}else if(position==='absolute'||position==='fixed'){newWidth=getPixelValue(element,'width',context);}else{var parent=element.parentNode,pLayout=$(parent).getLayout();newWidth=pLayout.get('width')-
this.get('margin-left')-
this.get('border-left')-
this.get('padding-left')-
this.get('padding-right')-
this.get('border-right')-
this.get('margin-right');}
element.setStyle({width:newWidth+'px'});this._prepared=true;},_end:function(){var element=this.element;var originalStyles=element.retrieve('prototype_original_styles');element.store('prototype_original_styles',null);element.setStyle(originalStyles);this._prepared=false;},_compute:function(property){var COMPUTATIONS=Element.Layout.COMPUTATIONS;if(!(property in COMPUTATIONS)){throw"Property not found.";}
return this._set(property,COMPUTATIONS[property].call(this,this.element));},toObject:function(){var args=$A(arguments);var keys=(args.length===0)?Element.Layout.PROPERTIES:args.join(' ').split(' ');var obj={};keys.each(function(key){if(!Element.Layout.PROPERTIES.include(key))return;var value=this.get(key);if(value!=null)obj[key]=value;},this);return obj;},toHash:function(){var obj=this.toObject.apply(this,arguments);return new Hash(obj);},toCSS:function(){var args=$A(arguments);var keys=(args.length===0)?Element.Layout.PROPERTIES:args.join(' ').split(' ');var css={};keys.each(function(key){if(!Element.Layout.PROPERTIES.include(key))return;if(Element.Layout.COMPOSITE_PROPERTIES.include(key))return;var value=this.get(key);if(value!=null)css[cssNameFor(key)]=value+'px';},this);return css;},inspect:function(){return"#<Element.Layout>";}});Object.extend(Element.Layout,{PROPERTIES:$w('height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height'),COMPOSITE_PROPERTIES:$w('padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height'),COMPUTATIONS:{'height':function(element){if(!this._preComputing)this._begin();var bHeight=this.get('border-box-height');if(bHeight<=0){if(!this._preComputing)this._end();return 0;}
var bTop=this.get('border-top'),bBottom=this.get('border-bottom');var pTop=this.get('padding-top'),pBottom=this.get('padding-bottom');if(!this._preComputing)this._end();return bHeight-bTop-bBottom-pTop-pBottom;},'width':function(element){if(!this._preComputing)this._begin();var bWidth=this.get('border-box-width');if(bWidth<=0){if(!this._preComputing)this._end();return 0;}
var bLeft=this.get('border-left'),bRight=this.get('border-right');var pLeft=this.get('padding-left'),pRight=this.get('padding-right');if(!this._preComputing)this._end();return bWidth-bLeft-bRight-pLeft-pRight;},'padding-box-height':function(element){var height=this.get('height'),pTop=this.get('padding-top'),pBottom=this.get('padding-bottom');return height+pTop+pBottom;},'padding-box-width':function(element){var width=this.get('width'),pLeft=this.get('padding-left'),pRight=this.get('padding-right');return width+pLeft+pRight;},'border-box-height':function(element){if(!this._preComputing)this._begin();var height=element.offsetHeight;if(!this._preComputing)this._end();return height;},'border-box-width':function(element){if(!this._preComputing)this._begin();var width=element.offsetWidth;if(!this._preComputing)this._end();return width;},'margin-box-height':function(element){var bHeight=this.get('border-box-height'),mTop=this.get('margin-top'),mBottom=this.get('margin-bottom');if(bHeight<=0)return 0;return bHeight+mTop+mBottom;},'margin-box-width':function(element){var bWidth=this.get('border-box-width'),mLeft=this.get('margin-left'),mRight=this.get('margin-right');if(bWidth<=0)return 0;return bWidth+mLeft+mRight;},'top':function(element){var offset=element.positionedOffset();return offset.top;},'bottom':function(element){var offset=element.positionedOffset(),parent=element.getOffsetParent(),pHeight=parent.measure('height');var mHeight=this.get('border-box-height');return pHeight-mHeight-offset.top;},'left':function(element){var offset=element.positionedOffset();return offset.left;},'right':function(element){var offset=element.positionedOffset(),parent=element.getOffsetParent(),pWidth=parent.measure('width');var mWidth=this.get('border-box-width');return pWidth-mWidth-offset.left;},'padding-top':function(element){return getPixelValue(element,'paddingTop');},'padding-bottom':function(element){return getPixelValue(element,'paddingBottom');},'padding-left':function(element){return getPixelValue(element,'paddingLeft');},'padding-right':function(element){return getPixelValue(element,'paddingRight');},'border-top':function(element){return getPixelValue(element,'borderTopWidth');},'border-bottom':function(element){return getPixelValue(element,'borderBottomWidth');},'border-left':function(element){return getPixelValue(element,'borderLeftWidth');},'border-right':function(element){return getPixelValue(element,'borderRightWidth');},'margin-top':function(element){return getPixelValue(element,'marginTop');},'margin-bottom':function(element){return getPixelValue(element,'marginBottom');},'margin-left':function(element){return getPixelValue(element,'marginLeft');},'margin-right':function(element){return getPixelValue(element,'marginRight');}}});if('getBoundingClientRect'in document.documentElement){Object.extend(Element.Layout.COMPUTATIONS,{'right':function(element){var parent=hasLayout(element.getOffsetParent());var rect=element.getBoundingClientRect(),pRect=parent.getBoundingClientRect();return(pRect.right-rect.right).round();},'bottom':function(element){var parent=hasLayout(element.getOffsetParent());var rect=element.getBoundingClientRect(),pRect=parent.getBoundingClientRect();return(pRect.bottom-rect.bottom).round();}});}
Element.Offset=Class.create({initialize:function(left,top){this.left=left.round();this.top=top.round();this[0]=this.left;this[1]=this.top;},relativeTo:function(offset){return new Element.Offset(this.left-offset.left,this.top-offset.top);},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this);},toString:function(){return"[#{left}, #{top}]".interpolate(this);},toArray:function(){return[this.left,this.top];}});function getLayout(element,preCompute){return new Element.Layout(element,preCompute);}
function measure(element,property){return $(element).getLayout().get(property);}
function getDimensions(element){element=$(element);var display=Element.getStyle(element,'display');if(display&&display!=='none'){return{width:element.offsetWidth,height:element.offsetHeight};}
var style=element.style;var originalStyles={visibility:style.visibility,position:style.position,display:style.display};var newStyles={visibility:'hidden',display:'block'};if(originalStyles.position!=='fixed')
newStyles.position='absolute';Element.setStyle(element,newStyles);var dimensions={width:element.offsetWidth,height:element.offsetHeight};Element.setStyle(element,originalStyles);return dimensions;}
function getOffsetParent(element){element=$(element);if(isDocument(element)||isDetached(element)||isBody(element)||isHtml(element))
return $(document.body);var isInline=(Element.getStyle(element,'display')==='inline');if(!isInline&&element.offsetParent)return $(element.offsetParent);while((element=element.parentNode)&&element!==document.body){if(Element.getStyle(element,'position')!=='static'){return isHtml(element)?$(document.body):$(element);}}
return $(document.body);}
function cumulativeOffset(element){element=$(element);var valueT=0,valueL=0;if(element.parentNode){do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;element=element.offsetParent;}while(element);}
return new Element.Offset(valueL,valueT);}
function positionedOffset(element){element=$(element);var layout=element.getLayout();var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;element=element.offsetParent;if(element){if(isBody(element))break;var p=Element.getStyle(element,'position');if(p!=='static')break;}}while(element);valueL-=layout.get('margin-top');valueT-=layout.get('margin-left');return new Element.Offset(valueL,valueT);}
function cumulativeScrollOffset(element){var valueT=0,valueL=0;do{valueT+=element.scrollTop||0;valueL+=element.scrollLeft||0;element=element.parentNode;}while(element);return new Element.Offset(valueL,valueT);}
function viewportOffset(forElement){element=$(element);var valueT=0,valueL=0,docBody=document.body;var element=forElement;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;if(element.offsetParent==docBody&&Element.getStyle(element,'position')=='absolute')break;}while(element=element.offsetParent);element=forElement;do{if(element!=docBody){valueT-=element.scrollTop||0;valueL-=element.scrollLeft||0;}}while(element=element.parentNode);return new Element.Offset(valueL,valueT);}
function absolutize(element){element=$(element);if(Element.getStyle(element,'position')==='absolute'){return element;}
var offsetParent=getOffsetParent(element);var eOffset=element.viewportOffset(),pOffset=offsetParent.viewportOffset();var offset=eOffset.relativeTo(pOffset);var layout=element.getLayout();element.store('prototype_absolutize_original_styles',{left:element.getStyle('left'),top:element.getStyle('top'),width:element.getStyle('width'),height:element.getStyle('height')});element.setStyle({position:'absolute',top:offset.top+'px',left:offset.left+'px',width:layout.get('width')+'px',height:layout.get('height')+'px'});return element;}
function relativize(element){element=$(element);if(Element.getStyle(element,'position')==='relative'){return element;}
var originalStyles=element.retrieve('prototype_absolutize_original_styles');if(originalStyles)element.setStyle(originalStyles);return element;}
if(Prototype.Browser.IE){getOffsetParent=getOffsetParent.wrap(function(proceed,element){element=$(element);if(isDocument(element)||isDetached(element)||isBody(element)||isHtml(element))
return $(document.body);var position=element.getStyle('position');if(position!=='static')return proceed(element);element.setStyle({position:'relative'});var value=proceed(element);element.setStyle({position:position});return value;});positionedOffset=positionedOffset.wrap(function(proceed,element){element=$(element);if(!element.parentNode)return new Element.Offset(0,0);var position=element.getStyle('position');if(position!=='static')return proceed(element);var offsetParent=element.getOffsetParent();if(offsetParent&&offsetParent.getStyle('position')==='fixed')
hasLayout(offsetParent);element.setStyle({position:'relative'});var value=proceed(element);element.setStyle({position:position});return value;});}else if(Prototype.Browser.Webkit){cumulativeOffset=function(element){element=$(element);var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;if(element.offsetParent==document.body)
if(Element.getStyle(element,'position')=='absolute')break;element=element.offsetParent;}while(element);return new Element.Offset(valueL,valueT);};}
Element.addMethods({getLayout:getLayout,measure:measure,getDimensions:getDimensions,getOffsetParent:getOffsetParent,cumulativeOffset:cumulativeOffset,positionedOffset:positionedOffset,cumulativeScrollOffset:cumulativeScrollOffset,viewportOffset:viewportOffset,absolutize:absolutize,relativize:relativize});function isBody(element){return element.nodeName.toUpperCase()==='BODY';}
function isHtml(element){return element.nodeName.toUpperCase()==='HTML';}
function isDocument(element){return element.nodeType===Node.DOCUMENT_NODE;}
function isDetached(element){return element!==document.body&&!Element.descendantOf(element,document.body);}
if('getBoundingClientRect'in document.documentElement){Element.addMethods({viewportOffset:function(element){element=$(element);if(isDetached(element))return new Element.Offset(0,0);var rect=element.getBoundingClientRect(),docEl=document.documentElement;return new Element.Offset(rect.left-docEl.clientLeft,rect.top-docEl.clientTop);}});}})();window.$$=function(){var expression=$A(arguments).join(', ');return Prototype.Selector.select(expression,document);};Prototype.Selector=(function(){function select(){throw new Error('Method "Prototype.Selector.select" must be defined.');}
function match(){throw new Error('Method "Prototype.Selector.match" must be defined.');}
function find(elements,expression,index){index=index||0;var match=Prototype.Selector.match,length=elements.length,matchIndex=0,i;for(i=0;i<length;i++){if(match(elements[i],expression)&&index==matchIndex++){return Element.extend(elements[i]);}}}
function extendElements(elements){for(var i=0,length=elements.length;i<length;i++){Element.extend(elements[i]);}
return elements;}
var K=Prototype.K;return{select:select,match:match,find:find,extendElements:(Element.extend===K)?K:extendElements,extendElement:Element.extend};})();Prototype._original_property=window.Sizzle;
/*
 * Sizzle CSS Selector Engine - v1.0
 *  Copyright 2009, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
(function(){var chunker=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,done=0,toString=Object.prototype.toString,hasDuplicate=false,baseHasDuplicate=true;[0,0].sort(function(){baseHasDuplicate=false;return 0;});var Sizzle=function(selector,context,results,seed){results=results||[];var origContext=context=context||document;if(context.nodeType!==1&&context.nodeType!==9){return[];}
if(!selector||typeof selector!=="string"){return results;}
var parts=[],m,set,checkSet,check,mode,extra,prune=true,contextXML=isXML(context),soFar=selector;while((chunker.exec(""),m=chunker.exec(soFar))!==null){soFar=m[3];parts.push(m[1]);if(m[2]){extra=m[3];break;}}
if(parts.length>1&&origPOS.exec(selector)){if(parts.length===2&&Expr.relative[parts[0]]){set=posProcess(parts[0]+parts[1],context);}else{set=Expr.relative[parts[0]]?[context]:Sizzle(parts.shift(),context);while(parts.length){selector=parts.shift();if(Expr.relative[selector])
selector+=parts.shift();set=posProcess(selector,set);}}}else{if(!seed&&parts.length>1&&context.nodeType===9&&!contextXML&&Expr.match.ID.test(parts[0])&&!Expr.match.ID.test(parts[parts.length-1])){var ret=Sizzle.find(parts.shift(),context,contextXML);context=ret.expr?Sizzle.filter(ret.expr,ret.set)[0]:ret.set[0];}
if(context){var ret=seed?{expr:parts.pop(),set:makeArray(seed)}:Sizzle.find(parts.pop(),parts.length===1&&(parts[0]==="~"||parts[0]==="+")&&context.parentNode?context.parentNode:context,contextXML);set=ret.expr?Sizzle.filter(ret.expr,ret.set):ret.set;if(parts.length>0){checkSet=makeArray(set);}else{prune=false;}
while(parts.length){var cur=parts.pop(),pop=cur;if(!Expr.relative[cur]){cur="";}else{pop=parts.pop();}
if(pop==null){pop=context;}
Expr.relative[cur](checkSet,pop,contextXML);}}else{checkSet=parts=[];}}
if(!checkSet){checkSet=set;}
if(!checkSet){throw"Syntax error, unrecognized expression: "+(cur||selector);}
if(toString.call(checkSet)==="[object Array]"){if(!prune){results.push.apply(results,checkSet);}else if(context&&context.nodeType===1){for(var i=0;checkSet[i]!=null;i++){if(checkSet[i]&&(checkSet[i]===true||checkSet[i].nodeType===1&&contains(context,checkSet[i]))){results.push(set[i]);}}}else{for(var i=0;checkSet[i]!=null;i++){if(checkSet[i]&&checkSet[i].nodeType===1){results.push(set[i]);}}}}else{makeArray(checkSet,results);}
if(extra){Sizzle(extra,origContext,results,seed);Sizzle.uniqueSort(results);}
return results;};Sizzle.uniqueSort=function(results){if(sortOrder){hasDuplicate=baseHasDuplicate;results.sort(sortOrder);if(hasDuplicate){for(var i=1;i<results.length;i++){if(results[i]===results[i-1]){results.splice(i--,1);}}}}
return results;};Sizzle.matches=function(expr,set){return Sizzle(expr,null,null,set);};Sizzle.find=function(expr,context,isXML){var set,match;if(!expr){return[];}
for(var i=0,l=Expr.order.length;i<l;i++){var type=Expr.order[i],match;if((match=Expr.leftMatch[type].exec(expr))){var left=match[1];match.splice(1,1);if(left.substr(left.length-1)!=="\\"){match[1]=(match[1]||"").replace(/\\/g,"");set=Expr.find[type](match,context,isXML);if(set!=null){expr=expr.replace(Expr.match[type],"");break;}}}}
if(!set){set=context.getElementsByTagName("*");}
return{set:set,expr:expr};};Sizzle.filter=function(expr,set,inplace,not){var old=expr,result=[],curLoop=set,match,anyFound,isXMLFilter=set&&set[0]&&isXML(set[0]);while(expr&&set.length){for(var type in Expr.filter){if((match=Expr.match[type].exec(expr))!=null){var filter=Expr.filter[type],found,item;anyFound=false;if(curLoop==result){result=[];}
if(Expr.preFilter[type]){match=Expr.preFilter[type](match,curLoop,inplace,result,not,isXMLFilter);if(!match){anyFound=found=true;}else if(match===true){continue;}}
if(match){for(var i=0;(item=curLoop[i])!=null;i++){if(item){found=filter(item,match,i,curLoop);var pass=not^!!found;if(inplace&&found!=null){if(pass){anyFound=true;}else{curLoop[i]=false;}}else if(pass){result.push(item);anyFound=true;}}}}
if(found!==undefined){if(!inplace){curLoop=result;}
expr=expr.replace(Expr.match[type],"");if(!anyFound){return[];}
break;}}}
if(expr==old){if(anyFound==null){throw"Syntax error, unrecognized expression: "+expr;}else{break;}}
old=expr;}
return curLoop;};var Expr=Sizzle.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(elem){return elem.getAttribute("href");}},relative:{"+":function(checkSet,part,isXML){var isPartStr=typeof part==="string",isTag=isPartStr&&!/\W/.test(part),isPartStrNotTag=isPartStr&&!isTag;if(isTag&&!isXML){part=part.toUpperCase();}
for(var i=0,l=checkSet.length,elem;i<l;i++){if((elem=checkSet[i])){while((elem=elem.previousSibling)&&elem.nodeType!==1){}
checkSet[i]=isPartStrNotTag||elem&&elem.nodeName===part?elem||false:elem===part;}}
if(isPartStrNotTag){Sizzle.filter(part,checkSet,true);}},">":function(checkSet,part,isXML){var isPartStr=typeof part==="string";if(isPartStr&&!/\W/.test(part)){part=isXML?part:part.toUpperCase();for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){var parent=elem.parentNode;checkSet[i]=parent.nodeName===part?parent:false;}}}else{for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){checkSet[i]=isPartStr?elem.parentNode:elem.parentNode===part;}}
if(isPartStr){Sizzle.filter(part,checkSet,true);}}},"":function(checkSet,part,isXML){var doneName=done++,checkFn=dirCheck;if(!/\W/.test(part)){var nodeCheck=part=isXML?part:part.toUpperCase();checkFn=dirNodeCheck;}
checkFn("parentNode",part,doneName,checkSet,nodeCheck,isXML);},"~":function(checkSet,part,isXML){var doneName=done++,checkFn=dirCheck;if(typeof part==="string"&&!/\W/.test(part)){var nodeCheck=part=isXML?part:part.toUpperCase();checkFn=dirNodeCheck;}
checkFn("previousSibling",part,doneName,checkSet,nodeCheck,isXML);}},find:{ID:function(match,context,isXML){if(typeof context.getElementById!=="undefined"&&!isXML){var m=context.getElementById(match[1]);return m?[m]:[];}},NAME:function(match,context,isXML){if(typeof context.getElementsByName!=="undefined"){var ret=[],results=context.getElementsByName(match[1]);for(var i=0,l=results.length;i<l;i++){if(results[i].getAttribute("name")===match[1]){ret.push(results[i]);}}
return ret.length===0?null:ret;}},TAG:function(match,context){return context.getElementsByTagName(match[1]);}},preFilter:{CLASS:function(match,curLoop,inplace,result,not,isXML){match=" "+match[1].replace(/\\/g,"")+" ";if(isXML){return match;}
for(var i=0,elem;(elem=curLoop[i])!=null;i++){if(elem){if(not^(elem.className&&(" "+elem.className+" ").indexOf(match)>=0)){if(!inplace)
result.push(elem);}else if(inplace){curLoop[i]=false;}}}
return false;},ID:function(match){return match[1].replace(/\\/g,"");},TAG:function(match,curLoop){for(var i=0;curLoop[i]===false;i++){}
return curLoop[i]&&isXML(curLoop[i])?match[1]:match[1].toUpperCase();},CHILD:function(match){if(match[1]=="nth"){var test=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(match[2]=="even"&&"2n"||match[2]=="odd"&&"2n+1"||!/\D/.test(match[2])&&"0n+"+match[2]||match[2]);match[2]=(test[1]+(test[2]||1))-0;match[3]=test[3]-0;}
match[0]=done++;return match;},ATTR:function(match,curLoop,inplace,result,not,isXML){var name=match[1].replace(/\\/g,"");if(!isXML&&Expr.attrMap[name]){match[1]=Expr.attrMap[name];}
if(match[2]==="~="){match[4]=" "+match[4]+" ";}
return match;},PSEUDO:function(match,curLoop,inplace,result,not){if(match[1]==="not"){if((chunker.exec(match[3])||"").length>1||/^\w/.test(match[3])){match[3]=Sizzle(match[3],null,null,curLoop);}else{var ret=Sizzle.filter(match[3],curLoop,inplace,true^not);if(!inplace){result.push.apply(result,ret);}
return false;}}else if(Expr.match.POS.test(match[0])||Expr.match.CHILD.test(match[0])){return true;}
return match;},POS:function(match){match.unshift(true);return match;}},filters:{enabled:function(elem){return elem.disabled===false&&elem.type!=="hidden";},disabled:function(elem){return elem.disabled===true;},checked:function(elem){return elem.checked===true;},selected:function(elem){elem.parentNode.selectedIndex;return elem.selected===true;},parent:function(elem){return!!elem.firstChild;},empty:function(elem){return!elem.firstChild;},has:function(elem,i,match){return!!Sizzle(match[3],elem).length;},header:function(elem){return /h\d/i.test(elem.nodeName);},text:function(elem){return"text"===elem.type;},radio:function(elem){return"radio"===elem.type;},checkbox:function(elem){return"checkbox"===elem.type;},file:function(elem){return"file"===elem.type;},password:function(elem){return"password"===elem.type;},submit:function(elem){return"submit"===elem.type;},image:function(elem){return"image"===elem.type;},reset:function(elem){return"reset"===elem.type;},button:function(elem){return"button"===elem.type||elem.nodeName.toUpperCase()==="BUTTON";},input:function(elem){return /input|select|textarea|button/i.test(elem.nodeName);}},setFilters:{first:function(elem,i){return i===0;},last:function(elem,i,match,array){return i===array.length-1;},even:function(elem,i){return i%2===0;},odd:function(elem,i){return i%2===1;},lt:function(elem,i,match){return i<match[3]-0;},gt:function(elem,i,match){return i>match[3]-0;},nth:function(elem,i,match){return match[3]-0==i;},eq:function(elem,i,match){return match[3]-0==i;}},filter:{PSEUDO:function(elem,match,i,array){var name=match[1],filter=Expr.filters[name];if(filter){return filter(elem,i,match,array);}else if(name==="contains"){return(elem.textContent||elem.innerText||"").indexOf(match[3])>=0;}else if(name==="not"){var not=match[3];for(var i=0,l=not.length;i<l;i++){if(not[i]===elem){return false;}}
return true;}},CHILD:function(elem,match){var type=match[1],node=elem;switch(type){case'only':case'first':while((node=node.previousSibling)){if(node.nodeType===1)return false;}
if(type=='first')return true;node=elem;case'last':while((node=node.nextSibling)){if(node.nodeType===1)return false;}
return true;case'nth':var first=match[2],last=match[3];if(first==1&&last==0){return true;}
var doneName=match[0],parent=elem.parentNode;if(parent&&(parent.sizcache!==doneName||!elem.nodeIndex)){var count=0;for(node=parent.firstChild;node;node=node.nextSibling){if(node.nodeType===1){node.nodeIndex=++count;}}
parent.sizcache=doneName;}
var diff=elem.nodeIndex-last;if(first==0){return diff==0;}else{return(diff%first==0&&diff/first>=0);}}},ID:function(elem,match){return elem.nodeType===1&&elem.getAttribute("id")===match;},TAG:function(elem,match){return(match==="*"&&elem.nodeType===1)||elem.nodeName===match;},CLASS:function(elem,match){return(" "+(elem.className||elem.getAttribute("class"))+" ").indexOf(match)>-1;},ATTR:function(elem,match){var name=match[1],result=Expr.attrHandle[name]?Expr.attrHandle[name](elem):elem[name]!=null?elem[name]:elem.getAttribute(name),value=result+"",type=match[2],check=match[4];return result==null?type==="!=":type==="="?value===check:type==="*="?value.indexOf(check)>=0:type==="~="?(" "+value+" ").indexOf(check)>=0:!check?value&&result!==false:type==="!="?value!=check:type==="^="?value.indexOf(check)===0:type==="$="?value.substr(value.length-check.length)===check:type==="|="?value===check||value.substr(0,check.length+1)===check+"-":false;},POS:function(elem,match,i,array){var name=match[2],filter=Expr.setFilters[name];if(filter){return filter(elem,i,match,array);}}}};var origPOS=Expr.match.POS;for(var type in Expr.match){Expr.match[type]=new RegExp(Expr.match[type].source+/(?![^\[]*\])(?![^\(]*\))/.source);Expr.leftMatch[type]=new RegExp(/(^(?:.|\r|\n)*?)/.source+Expr.match[type].source);}
var makeArray=function(array,results){array=Array.prototype.slice.call(array,0);if(results){results.push.apply(results,array);return results;}
return array;};try{Array.prototype.slice.call(document.documentElement.childNodes,0);}catch(e){makeArray=function(array,results){var ret=results||[];if(toString.call(array)==="[object Array]"){Array.prototype.push.apply(ret,array);}else{if(typeof array.length==="number"){for(var i=0,l=array.length;i<l;i++){ret.push(array[i]);}}else{for(var i=0;array[i];i++){ret.push(array[i]);}}}
return ret;};}
var sortOrder;if(document.documentElement.compareDocumentPosition){sortOrder=function(a,b){if(!a.compareDocumentPosition||!b.compareDocumentPosition){if(a==b){hasDuplicate=true;}
return 0;}
var ret=a.compareDocumentPosition(b)&4?-1:a===b?0:1;if(ret===0){hasDuplicate=true;}
return ret;};}else if("sourceIndex"in document.documentElement){sortOrder=function(a,b){if(!a.sourceIndex||!b.sourceIndex){if(a==b){hasDuplicate=true;}
return 0;}
var ret=a.sourceIndex-b.sourceIndex;if(ret===0){hasDuplicate=true;}
return ret;};}else if(document.createRange){sortOrder=function(a,b){if(!a.ownerDocument||!b.ownerDocument){if(a==b){hasDuplicate=true;}
return 0;}
var aRange=a.ownerDocument.createRange(),bRange=b.ownerDocument.createRange();aRange.setStart(a,0);aRange.setEnd(a,0);bRange.setStart(b,0);bRange.setEnd(b,0);var ret=aRange.compareBoundaryPoints(Range.START_TO_END,bRange);if(ret===0){hasDuplicate=true;}
return ret;};}
(function(){var form=document.createElement("div"),id="script"+(new Date).getTime();form.innerHTML="<a name='"+id+"'/>";var root=document.documentElement;root.insertBefore(form,root.firstChild);if(!!document.getElementById(id)){Expr.find.ID=function(match,context,isXML){if(typeof context.getElementById!=="undefined"&&!isXML){var m=context.getElementById(match[1]);return m?m.id===match[1]||typeof m.getAttributeNode!=="undefined"&&m.getAttributeNode("id").nodeValue===match[1]?[m]:undefined:[];}};Expr.filter.ID=function(elem,match){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");return elem.nodeType===1&&node&&node.nodeValue===match;};}
root.removeChild(form);root=form=null;})();(function(){var div=document.createElement("div");div.appendChild(document.createComment(""));if(div.getElementsByTagName("*").length>0){Expr.find.TAG=function(match,context){var results=context.getElementsByTagName(match[1]);if(match[1]==="*"){var tmp=[];for(var i=0;results[i];i++){if(results[i].nodeType===1){tmp.push(results[i]);}}
results=tmp;}
return results;};}
div.innerHTML="<a href='#'></a>";if(div.firstChild&&typeof div.firstChild.getAttribute!=="undefined"&&div.firstChild.getAttribute("href")!=="#"){Expr.attrHandle.href=function(elem){return elem.getAttribute("href",2);};}
div=null;})();if(document.querySelectorAll)(function(){var oldSizzle=Sizzle,div=document.createElement("div");div.innerHTML="<p class='TEST'></p>";if(div.querySelectorAll&&div.querySelectorAll(".TEST").length===0){return;}
Sizzle=function(query,context,extra,seed){context=context||document;if(!seed&&context.nodeType===9&&!isXML(context)){try{return makeArray(context.querySelectorAll(query),extra);}catch(e){}}
return oldSizzle(query,context,extra,seed);};for(var prop in oldSizzle){Sizzle[prop]=oldSizzle[prop];}
div=null;})();if(document.getElementsByClassName&&document.documentElement.getElementsByClassName)(function(){var div=document.createElement("div");div.innerHTML="<div class='test e'></div><div class='test'></div>";if(div.getElementsByClassName("e").length===0)
return;div.lastChild.className="e";if(div.getElementsByClassName("e").length===1)
return;Expr.order.splice(1,0,"CLASS");Expr.find.CLASS=function(match,context,isXML){if(typeof context.getElementsByClassName!=="undefined"&&!isXML){return context.getElementsByClassName(match[1]);}};div=null;})();function dirNodeCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){var sibDir=dir=="previousSibling"&&!isXML;for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){if(sibDir&&elem.nodeType===1){elem.sizcache=doneName;elem.sizset=i;}
elem=elem[dir];var match=false;while(elem){if(elem.sizcache===doneName){match=checkSet[elem.sizset];break;}
if(elem.nodeType===1&&!isXML){elem.sizcache=doneName;elem.sizset=i;}
if(elem.nodeName===cur){match=elem;break;}
elem=elem[dir];}
checkSet[i]=match;}}}
function dirCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){var sibDir=dir=="previousSibling"&&!isXML;for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){if(sibDir&&elem.nodeType===1){elem.sizcache=doneName;elem.sizset=i;}
elem=elem[dir];var match=false;while(elem){if(elem.sizcache===doneName){match=checkSet[elem.sizset];break;}
if(elem.nodeType===1){if(!isXML){elem.sizcache=doneName;elem.sizset=i;}
if(typeof cur!=="string"){if(elem===cur){match=true;break;}}else if(Sizzle.filter(cur,[elem]).length>0){match=elem;break;}}
elem=elem[dir];}
checkSet[i]=match;}}}
var contains=document.compareDocumentPosition?function(a,b){return a.compareDocumentPosition(b)&16;}:function(a,b){return a!==b&&(a.contains?a.contains(b):true);};var isXML=function(elem){return elem.nodeType===9&&elem.documentElement.nodeName!=="HTML"||!!elem.ownerDocument&&elem.ownerDocument.documentElement.nodeName!=="HTML";};var posProcess=function(selector,context){var tmpSet=[],later="",match,root=context.nodeType?[context]:context;while((match=Expr.match.PSEUDO.exec(selector))){later+=match[0];selector=selector.replace(Expr.match.PSEUDO,"");}
selector=Expr.relative[selector]?selector+"*":selector;for(var i=0,l=root.length;i<l;i++){Sizzle(selector,root[i],tmpSet);}
return Sizzle.filter(later,tmpSet);};window.Sizzle=Sizzle;})();;(function(engine){var extendElements=Prototype.Selector.extendElements;function select(selector,scope){return extendElements(engine(selector,scope||document));}
function match(element,selector){return engine.matches(selector,[element]).length==1;}
Prototype.Selector.engine=engine;Prototype.Selector.select=select;Prototype.Selector.match=match;})(Sizzle);window.Sizzle=Prototype._original_property;delete Prototype._original_property;var Form={reset:function(form){form=$(form);form.reset();return form;},serializeElements:function(elements,options){if(typeof options!='object')options={hash:!!options};else if(Object.isUndefined(options.hash))options.hash=true;var key,value,submitted=false,submit=options.submit,accumulator,initial;if(options.hash){initial={};accumulator=function(result,key,value){if(key in result){if(!Object.isArray(result[key]))result[key]=[result[key]];result[key].push(value);}else result[key]=value;return result;};}else{initial='';accumulator=function(result,key,value){return result+(result?'&':'')+encodeURIComponent(key)+'='+encodeURIComponent(value);}}
return elements.inject(initial,function(result,element){if(!element.disabled&&element.name){key=element.name;value=$(element).getValue();if(value!=null&&element.type!='file'&&(element.type!='submit'||(!submitted&&submit!==false&&(!submit||key==submit)&&(submitted=true)))){result=accumulator(result,key,value);}}
return result;});}};Form.Methods={serialize:function(form,options){return Form.serializeElements(Form.getElements(form),options);},getElements:function(form){var elements=$(form).getElementsByTagName('*'),element,arr=[],serializers=Form.Element.Serializers;for(var i=0;element=elements[i];i++){arr.push(element);}
return arr.inject([],function(elements,child){if(serializers[child.tagName.toLowerCase()])
elements.push(Element.extend(child));return elements;})},getInputs:function(form,typeName,name){form=$(form);var inputs=form.getElementsByTagName('input');if(!typeName&&!name)return $A(inputs).map(Element.extend);for(var i=0,matchingInputs=[],length=inputs.length;i<length;i++){var input=inputs[i];if((typeName&&input.type!=typeName)||(name&&input.name!=name))
continue;matchingInputs.push(Element.extend(input));}
return matchingInputs;},disable:function(form){form=$(form);Form.getElements(form).invoke('disable');return form;},enable:function(form){form=$(form);Form.getElements(form).invoke('enable');return form;},findFirstElement:function(form){var elements=$(form).getElements().findAll(function(element){return'hidden'!=element.type&&!element.disabled;});var firstByIndex=elements.findAll(function(element){return element.hasAttribute('tabIndex')&&element.tabIndex>=0;}).sortBy(function(element){return element.tabIndex}).first();return firstByIndex?firstByIndex:elements.find(function(element){return /^(?:input|select|textarea)$/i.test(element.tagName);});},focusFirstElement:function(form){form=$(form);var element=form.findFirstElement();if(element)element.activate();return form;},request:function(form,options){form=$(form),options=Object.clone(options||{});var params=options.parameters,action=form.readAttribute('action')||'';if(action.blank())action=window.location.href;options.parameters=form.serialize(true);if(params){if(Object.isString(params))params=params.toQueryParams();Object.extend(options.parameters,params);}
if(form.hasAttribute('method')&&!options.method)
options.method=form.method;return new Ajax.Request(action,options);}};Form.Element={focus:function(element){$(element).focus();return element;}};Form.Element.Methods={serialize:function(element){element=$(element);if(!element.disabled&&element.name){var value=element.getValue();if(value!=undefined){var pair={};pair[element.name]=value;return Object.toQueryString(pair);}}
return'';},getValue:function(element){element=$(element);var method=element.tagName.toLowerCase();return Form.Element.Serializers[method](element);},setValue:function(element,value){element=$(element);var method=element.tagName.toLowerCase();Form.Element.Serializers[method](element,value);return element;},clear:function(element){$(element).value='';return element;},present:function(element){return $(element).value!='';},activate:function(element){element=$(element);try{element.focus();if(element.select&&(element.tagName.toLowerCase()!='input'||!(/^(?:button|reset|submit)$/i.test(element.type))))
element.select();}catch(e){}
return element;},disable:function(element){element=$(element);element.disabled=true;return element;},enable:function(element){element=$(element);element.disabled=false;return element;}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers=(function(){function input(element,value){switch(element.type.toLowerCase()){case'checkbox':case'radio':return inputSelector(element,value);default:return valueSelector(element,value);}}
function inputSelector(element,value){if(Object.isUndefined(value))
return element.checked?element.value:null;else element.checked=!!value;}
function valueSelector(element,value){if(Object.isUndefined(value))return element.value;else element.value=value;}
function select(element,value){if(Object.isUndefined(value))
return(element.type==='select-one'?selectOne:selectMany)(element);var opt,currentValue,single=!Object.isArray(value);for(var i=0,length=element.length;i<length;i++){opt=element.options[i];currentValue=this.optionValue(opt);if(single){if(currentValue==value){opt.selected=true;return;}}
else opt.selected=value.include(currentValue);}}
function selectOne(element){var index=element.selectedIndex;return index>=0?optionValue(element.options[index]):null;}
function selectMany(element){var values,length=element.length;if(!length)return null;for(var i=0,values=[];i<length;i++){var opt=element.options[i];if(opt.selected)values.push(optionValue(opt));}
return values;}
function optionValue(opt){return Element.hasAttribute(opt,'value')?opt.value:opt.text;}
return{input:input,inputSelector:inputSelector,textarea:valueSelector,select:select,selectOne:selectOne,selectMany:selectMany,optionValue:optionValue,button:valueSelector};})();Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,element,frequency,callback){$super(callback,frequency);this.element=$(element);this.lastValue=this.getValue();},execute:function(){var value=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(value)?this.lastValue!=value:String(this.lastValue)!=String(value)){this.callback(this.element,value);this.lastValue=value;}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element);}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element);}});Abstract.EventObserver=Class.create({initialize:function(element,callback){this.element=$(element);this.callback=callback;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=='form')
this.registerFormCallbacks();else
this.registerCallback(this.element);},onElementEvent:function(){var value=this.getValue();if(this.lastValue!=value){this.callback(this.element,value);this.lastValue=value;}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this);},registerCallback:function(element){if(element.type){switch(element.type.toLowerCase()){case'checkbox':case'radio':Event.observe(element,'click',this.onElementEvent.bind(this));break;default:Event.observe(element,'change',this.onElementEvent.bind(this));break;}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element);}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element);}});(function(){var Event={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}};var docEl=document.documentElement;var MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED='onmouseenter'in docEl&&'onmouseleave'in docEl;var isIELegacyEvent=function(event){return false;};if(window.attachEvent){if(window.addEventListener){isIELegacyEvent=function(event){return!(event instanceof window.Event);};}else{isIELegacyEvent=function(event){return true;};}}
var _isButton;function _isButtonForDOMEvents(event,code){return event.which?(event.which===code+1):(event.button===code);}
var legacyButtonMap={0:1,1:4,2:2};function _isButtonForLegacyEvents(event,code){return event.button===legacyButtonMap[code];}
function _isButtonForWebKit(event,code){switch(code){case 0:return event.which==1&&!event.metaKey;case 1:return event.which==2||(event.which==1&&event.metaKey);case 2:return event.which==3;default:return false;}}
if(window.attachEvent){if(!window.addEventListener){_isButton=_isButtonForLegacyEvents;}else{_isButton=function(event,code){return isIELegacyEvent(event)?_isButtonForLegacyEvents(event,code):_isButtonForDOMEvents(event,code);}}}else if(Prototype.Browser.WebKit){_isButton=_isButtonForWebKit;}else{_isButton=_isButtonForDOMEvents;}
function isLeftClick(event){return _isButton(event,0)}
function isMiddleClick(event){return _isButton(event,1)}
function isRightClick(event){return _isButton(event,2)}
function element(event){event=Event.extend(event);var node=event.target,type=event.type,currentTarget=event.currentTarget;if(currentTarget&&currentTarget.tagName){if(type==='load'||type==='error'||(type==='click'&&currentTarget.tagName.toLowerCase()==='input'&&currentTarget.type==='radio'))
node=currentTarget;}
if(node.nodeType==Node.TEXT_NODE)
node=node.parentNode;return Element.extend(node);}
function findElement(event,expression){var element=Event.element(event);if(!expression)return element;while(element){if(Object.isElement(element)&&Prototype.Selector.match(element,expression)){return Element.extend(element);}
element=element.parentNode;}}
function pointer(event){return{x:pointerX(event),y:pointerY(event)};}
function pointerX(event){var docElement=document.documentElement,body=document.body||{scrollLeft:0};return event.pageX||(event.clientX+
(docElement.scrollLeft||body.scrollLeft)-
(docElement.clientLeft||0));}
function pointerY(event){var docElement=document.documentElement,body=document.body||{scrollTop:0};return event.pageY||(event.clientY+
(docElement.scrollTop||body.scrollTop)-
(docElement.clientTop||0));}
function stop(event){Event.extend(event);event.preventDefault();event.stopPropagation();event.stopped=true;}
Event.Methods={isLeftClick:isLeftClick,isMiddleClick:isMiddleClick,isRightClick:isRightClick,element:element,findElement:findElement,pointer:pointer,pointerX:pointerX,pointerY:pointerY,stop:stop};var methods=Object.keys(Event.Methods).inject({},function(m,name){m[name]=Event.Methods[name].methodize();return m;});if(window.attachEvent){function _relatedTarget(event){var element;switch(event.type){case'mouseover':case'mouseenter':element=event.fromElement;break;case'mouseout':case'mouseleave':element=event.toElement;break;default:return null;}
return Element.extend(element);}
var additionalMethods={stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return'[object Event]'}};Event.extend=function(event,element){if(!event)return false;if(!isIELegacyEvent(event))return event;if(event._extendedByPrototype)return event;event._extendedByPrototype=Prototype.emptyFunction;var pointer=Event.pointer(event);Object.extend(event,{target:event.srcElement||element,relatedTarget:_relatedTarget(event),pageX:pointer.x,pageY:pointer.y});Object.extend(event,methods);Object.extend(event,additionalMethods);return event;};}else{Event.extend=Prototype.K;}
if(window.addEventListener){Event.prototype=window.Event.prototype||document.createEvent('HTMLEvents').__proto__;Object.extend(Event.prototype,methods);}
function _createResponder(element,eventName,handler){var registry=Element.retrieve(element,'prototype_event_registry');if(Object.isUndefined(registry)){CACHE.push(element);registry=Element.retrieve(element,'prototype_event_registry',$H());}
var respondersForEvent=registry.get(eventName);if(Object.isUndefined(respondersForEvent)){respondersForEvent=[];registry.set(eventName,respondersForEvent);}
if(respondersForEvent.pluck('handler').include(handler))return false;var responder;if(eventName.include(":")){responder=function(event){if(Object.isUndefined(event.eventName))
return false;if(event.eventName!==eventName)
return false;Event.extend(event,element);handler.call(element,event);};}else{if(!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED&&(eventName==="mouseenter"||eventName==="mouseleave")){if(eventName==="mouseenter"||eventName==="mouseleave"){responder=function(event){Event.extend(event,element);var parent=event.relatedTarget;while(parent&&parent!==element){try{parent=parent.parentNode;}
catch(e){parent=element;}}
if(parent===element)return;handler.call(element,event);};}}else{responder=function(event){Event.extend(event,element);handler.call(element,event);};}}
responder.handler=handler;respondersForEvent.push(responder);return responder;}
function _destroyCache(){for(var i=0,length=CACHE.length;i<length;i++){Event.stopObserving(CACHE[i]);CACHE[i]=null;}}
var CACHE=[];if(Prototype.Browser.IE)
window.attachEvent('onunload',_destroyCache);if(Prototype.Browser.WebKit)
window.addEventListener('unload',Prototype.emptyFunction,false);var _getDOMEventName=Prototype.K,translations={mouseenter:"mouseover",mouseleave:"mouseout"};if(!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED){_getDOMEventName=function(eventName){return(translations[eventName]||eventName);};}
function observe(element,eventName,handler){element=$(element);var responder=_createResponder(element,eventName,handler);if(!responder)return element;if(eventName.include(':')){if(element.addEventListener)
element.addEventListener("dataavailable",responder,false);else{element.attachEvent("ondataavailable",responder);element.attachEvent("onlosecapture",responder);}}else{var actualEventName=_getDOMEventName(eventName);if(element.addEventListener)
element.addEventListener(actualEventName,responder,false);else
element.attachEvent("on"+actualEventName,responder);}
return element;}
function stopObserving(element,eventName,handler){element=$(element);var registry=Element.retrieve(element,'prototype_event_registry');if(!registry)return element;if(!eventName){registry.each(function(pair){var eventName=pair.key;stopObserving(element,eventName);});return element;}
var responders=registry.get(eventName);if(!responders)return element;if(!handler){responders.each(function(r){stopObserving(element,eventName,r.handler);});return element;}
var i=responders.length,responder;while(i--){if(responders[i].handler===handler){responder=responders[i];break;}}
if(!responder)return element;if(eventName.include(':')){if(element.removeEventListener)
element.removeEventListener("dataavailable",responder,false);else{element.detachEvent("ondataavailable",responder);element.detachEvent("onlosecapture",responder);}}else{var actualEventName=_getDOMEventName(eventName);if(element.removeEventListener)
element.removeEventListener(actualEventName,responder,false);else
element.detachEvent('on'+actualEventName,responder);}
registry.set(eventName,responders.without(responder));return element;}
function fire(element,eventName,memo,bubble){element=$(element);if(Object.isUndefined(bubble))
bubble=true;if(element==document&&document.createEvent&&!element.dispatchEvent)
element=document.documentElement;var event;if(document.createEvent){event=document.createEvent('HTMLEvents');event.initEvent('dataavailable',bubble,true);}else{event=document.createEventObject();event.eventType=bubble?'ondataavailable':'onlosecapture';}
event.eventName=eventName;event.memo=memo||{};if(document.createEvent)
element.dispatchEvent(event);else
element.fireEvent(event.eventType,event);return Event.extend(event);}
Event.Handler=Class.create({initialize:function(element,eventName,selector,callback){this.element=$(element);this.eventName=eventName;this.selector=selector;this.callback=callback;this.handler=this.handleEvent.bind(this);},start:function(){Event.observe(this.element,this.eventName,this.handler);return this;},stop:function(){Event.stopObserving(this.element,this.eventName,this.handler);return this;},handleEvent:function(event){var element=Event.findElement(event,this.selector);if(element)this.callback.call(this.element,event,element);}});function on(element,eventName,selector,callback){element=$(element);if(Object.isFunction(selector)&&Object.isUndefined(callback)){callback=selector,selector=null;}
return new Event.Handler(element,eventName,selector,callback).start();}
Object.extend(Event,Event.Methods);Object.extend(Event,{fire:fire,observe:observe,stopObserving:stopObserving,on:on});Element.addMethods({fire:fire,observe:observe,stopObserving:stopObserving,on:on});Object.extend(document,{fire:fire.methodize(),observe:observe.methodize(),stopObserving:stopObserving.methodize(),on:on.methodize(),loaded:false});if(window.Event)Object.extend(window.Event,Event);else window.Event=Event;})();(function(){var timer;function fireContentLoadedEvent(){if(document.loaded)return;if(timer)window.clearTimeout(timer);document.loaded=true;document.fire('dom:loaded');}
function checkReadyState(){if(document.readyState==='complete'){document.stopObserving('readystatechange',checkReadyState);fireContentLoadedEvent();}}
function pollDoScroll(){try{document.documentElement.doScroll('left');}
catch(e){timer=pollDoScroll.defer();return;}
fireContentLoadedEvent();}
if(document.addEventListener){document.addEventListener('DOMContentLoaded',fireContentLoadedEvent,false);}else{document.observe('readystatechange',checkReadyState);if(window==top)
timer=pollDoScroll.defer();}
Event.observe(window,'load',fireContentLoadedEvent);})();Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(element,content){return Element.insert(element,{before:content});},Top:function(element,content){return Element.insert(element,{top:content});},Bottom:function(element,content){return Element.insert(element,{bottom:content});},After:function(element,content){return Element.insert(element,{after:content});}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;},within:function(element,x,y){try{if(Prototype.Browser.IE)if(!element.descendantOf(document.body))return false;}catch(e){return;}
if(this.includeScrollOffsets)
return this.withinIncludingScrolloffsets(element,x,y);this.xcomp=x;this.ycomp=y;this.offset=Element.cumulativeOffset(element);return(y>=this.offset[1]&&y<this.offset[1]+element.offsetHeight&&x>=this.offset[0]&&x<this.offset[0]+element.offsetWidth);},withinIncludingScrolloffsets:function(element,x,y){var offsetcache=Element.cumulativeScrollOffset(element);this.xcomp=x+offsetcache[0]-this.deltaX;this.ycomp=y+offsetcache[1]-this.deltaY;this.offset=Element.cumulativeOffset(element);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+element.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+element.offsetWidth);},overlap:function(mode,element){if(!mode)return 0;if(mode=='vertical')
return((this.offset[1]+element.offsetHeight)-this.ycomp)/element.offsetHeight;if(mode=='horizontal')
return((this.offset[0]+element.offsetWidth)-this.xcomp)/element.offsetWidth;},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(element){Position.prepare();return Element.absolutize(element);},relativize:function(element){Position.prepare();return Element.relativize(element);},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(source,target,options){options=options||{};return Element.clonePosition(target,source,options);}};if(!document.getElementsByClassName)document.getElementsByClassName=function(instanceMethods){function iter(name){return name.blank()?null:"[contains(concat(' ', @class, ' '), ' "+name+" ')]";}
instanceMethods.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(element,className){className=className.toString().strip();var cond=/\s/.test(className)?$w(className).map(iter).join(''):iter(className);return cond?document._getElementsByXPath('.//*'+cond,element):[];}:function(element,className){className=className.toString().strip();var elements=[],classNames=(/\s/.test(className)?$w(className):null);if(!classNames&&!className)return elements;var nodes=$(element).getElementsByTagName('*');className=' '+className+' ';for(var i=0,child,cn;child=nodes[i];i++){if(child.className&&(cn=' '+child.className+' ')&&(cn.include(className)||(classNames&&classNames.all(function(name){return!name.toString().blank()&&cn.include(' '+name+' ');}))))
elements.push(Element.extend(child));}
return elements;};return function(className,parentElement){return $(parentElement||document.body).getElementsByClassName(className);};}(Element.Methods);Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(element){this.element=$(element);},_each:function(iterator){this.element.className.split(/\s+/).select(function(name){return name.length>0;})._each(iterator);},set:function(className){this.element.className=className;},add:function(classNameToAdd){if(this.include(classNameToAdd))return;this.set($A(this).concat(classNameToAdd).join(' '));},remove:function(classNameToRemove){if(!this.include(classNameToRemove))return;this.set($A(this).without(classNameToRemove).join(' '));},toString:function(){return $A(this).join(' ');}};Object.extend(Element.ClassNames.prototype,Enumerable);(function(){window.Selector=Class.create({initialize:function(expression){this.expression=expression.strip();},findElements:function(rootElement){return Prototype.Selector.select(this.expression,rootElement);},match:function(element){return Prototype.Selector.match(element,this.expression);},toString:function(){return this.expression;},inspect:function(){return"#<Selector: "+this.expression+">";}});Object.extend(Selector,{matchElements:function(elements,expression){var match=Prototype.Selector.match,results=[];for(var i=0,length=elements.length;i<length;i++){var element=elements[i];if(match(element,expression)){results.push(Element.extend(element));}}
return results;},findElement:function(elements,expression,index){index=index||0;var matchIndex=0,element;for(var i=0,length=elements.length;i<length;i++){element=elements[i];if(Prototype.Selector.match(element,expression)&&index===matchIndex++){return Element.extend(element);}}},findChildElements:function(element,expressions){var selector=expressions.toArray().join(', ');return Prototype.Selector.select(selector,element||document);}});})();
;if(!Prototype.Browser.IE){Element.addMethods({onmouseenter:function(element,observer){element=$(element);element.observe('mouseover',function(evt,currentTarget){var relatedTarget=$(evt.relatedTarget||evt.fromElement);if(relatedTarget!=currentTarget&&relatedTarget.childOf(currentTarget)==false){observer();}}.bindAsEventListener({},element));return element;},onmouseleave:function(element,observer){element=$(element);element.observe('mouseout',function(evt,currentTarget){var relatedTarget=$(evt.relatedTarget||evt.toElement);if(relatedTarget!=currentTarget&&relatedTarget.childOf(currentTarget)==false){observer();}}.bindAsEventListener({},element));return element;}});}
Ajax.currentRequests={};Ajax.Responders.register({onCreate:function(request){if(request.options.onlyLatestOfClass&&Ajax.currentRequests[request.options.onlyLatestOfClass]){$K.log('Trying to cancel current Request... ('+request.options.onlyLatestOfClass+')',$K.Log.DEBUG);try{Ajax.currentRequests[request.options.onlyLatestOfClass].transport.aborted=true;Ajax.currentRequests[request.options.onlyLatestOfClass].abort();Ajax.activeRequestCount--;}catch(e){}}
Ajax.currentRequests[request.options.onlyLatestOfClass]=request;},onComplete:function(request){if(request.options.onlyLatestOfClass){Ajax.currentRequests[request.options.onlyLatestOfClass]=null;}}});Ajax.Request.prototype.abort=function(){this.transport.onreadystatechange=Prototype.emptyFunction;this.transport.abort();if(!(/Konqueror|Safari|KHTML/.test(navigator.userAgent))){Ajax.activeRequestCount--;}};Element.addMethods('iframe',{document:function(element){element=$(element);var retElement;if(element.contentWindow){retElement=element.contentWindow.document;}else if(element.contentDocument){retElement=element.contentDocument;}else{retElement=null;}
return retElement;},$:function(element,frameElement){element=$(element);if(typeof element.document=='function'){var frameDocument=element.document();}else{var frameDocument=element.document;}
if(arguments.length>2){for(var i=1,frameElements=[],length=arguments.length;i<length;i++)
frameElements.push(element.$(arguments[i]));return frameElements;}
if(Object.isString(frameElement))
frameElement=frameDocument.getElementById(frameElement);return frameElement||element;}});
;var Scriptaculous={Version:'1.9.0',require:function(libraryName){try{document.write('<script type="text/javascript" src="'+libraryName+'"><\/script>');}catch(e){var script=document.createElement('script');script.type='text/javascript';script.src=libraryName;document.getElementsByTagName('head')[0].appendChild(script);}},REQUIRED_PROTOTYPE:'1.6.0.3',load:function(){function convertVersionString(versionString){var v=versionString.replace(/_.*|\./g,'');v=parseInt(v+'0'.times(4-v.length));return versionString.indexOf('_')>-1?v-1:v;}
if((typeof Prototype=='undefined')||(typeof Element=='undefined')||(typeof Element.Methods=='undefined')||(convertVersionString(Prototype.Version)<convertVersionString(Scriptaculous.REQUIRED_PROTOTYPE)))
throw("script.aculo.us requires the Prototype JavaScript framework >= "+
Scriptaculous.REQUIRED_PROTOTYPE);var js=/scriptaculous\.js(\?.*)?$/;$$('script[src]').findAll(function(s){return s.src.match(js);}).each(function(s){var path=s.src.replace(js,''),includes=s.src.match(/\?.*load=([a-z,]*)/);(includes?includes[1]:'builder,effects,dragdrop,controls,slider,sound').split(',').each(function(include){Scriptaculous.require(path+include+'.js')});});}};Scriptaculous.load();
;var Builder={NODEMAP:{AREA:'map',CAPTION:'table',COL:'table',COLGROUP:'table',LEGEND:'fieldset',OPTGROUP:'select',OPTION:'select',PARAM:'object',TBODY:'table',TD:'table',TFOOT:'table',TH:'table',THEAD:'table',TR:'table'},node:function(elementName){elementName=elementName.toUpperCase();var parentTag=this.NODEMAP[elementName]||'div';var parentElement=document.createElement(parentTag);try{parentElement.innerHTML="<"+elementName+"></"+elementName+">";}catch(e){}
var element=parentElement.firstChild||null;if(element&&(element.tagName.toUpperCase()!=elementName))
element=element.getElementsByTagName(elementName)[0];if(!element)element=document.createElement(elementName);if(!element)return;if(arguments[1])
if(this._isStringOrNumber(arguments[1])||(arguments[1]instanceof Array)||arguments[1].tagName){this._children(element,arguments[1]);}else{var attrs=this._attributes(arguments[1]);if(attrs.length){try{parentElement.innerHTML="<"+elementName+" "+
attrs+"></"+elementName+">";}catch(e){}
element=parentElement.firstChild||null;if(!element){element=document.createElement(elementName);for(attr in arguments[1])
element[attr=='class'?'className':attr]=arguments[1][attr];}
if(element.tagName.toUpperCase()!=elementName)
element=parentElement.getElementsByTagName(elementName)[0];}}
if(arguments[2])
this._children(element,arguments[2]);return $(element);},_text:function(text){return document.createTextNode(text);},ATTR_MAP:{'className':'class','htmlFor':'for'},_attributes:function(attributes){var attrs=[];for(attribute in attributes)
attrs.push((attribute in this.ATTR_MAP?this.ATTR_MAP[attribute]:attribute)+'="'+attributes[attribute].toString().escapeHTML().gsub(/"/,'&quot;')+'"');return attrs.join(" ");},_children:function(element,children){if(children.tagName){element.appendChild(children);return;}
if(typeof children=='object'){children.flatten().each(function(e){if(typeof e=='object')
element.appendChild(e);else
if(Builder._isStringOrNumber(e))
element.appendChild(Builder._text(e));});}else
if(Builder._isStringOrNumber(children))
element.appendChild(Builder._text(children));},_isStringOrNumber:function(param){return(typeof param=='string'||typeof param=='number');},build:function(html){var element=this.node('div');$(element).update(html.strip());return element.down();},dump:function(scope){if(typeof scope!='object'&&typeof scope!='function')scope=window;var tags=("A ABBR ACRONYM ADDRESS APPLET AREA B BASE BASEFONT BDO BIG BLOCKQUOTE BODY "+"BR BUTTON CAPTION CENTER CITE CODE COL COLGROUP DD DEL DFN DIR DIV DL DT EM FIELDSET "+"FONT FORM FRAME FRAMESET H1 H2 H3 H4 H5 H6 HEAD HR HTML I IFRAME IMG INPUT INS ISINDEX "+"KBD LABEL LEGEND LI LINK MAP MENU META NOFRAMES NOSCRIPT OBJECT OL OPTGROUP OPTION P "+"PARAM PRE Q S SAMP SCRIPT SELECT SMALL SPAN STRIKE STRONG STYLE SUB SUP TABLE TBODY TD "+"TEXTAREA TFOOT TH THEAD TITLE TR TT U UL VAR").split(/\s+/);tags.each(function(tag){scope[tag]=function(){return Builder.node.apply(Builder,[tag].concat($A(arguments)));};});}};
;String.prototype.parseColor=function(){var color='#';if(this.slice(0,4)=='rgb('){var cols=this.slice(4,this.length-1).split(',');var i=0;do{color+=parseInt(cols[i]).toColorPart()}while(++i<3);}else{if(this.slice(0,1)=='#'){if(this.length==4)for(var i=1;i<4;i++)color+=(this.charAt(i)+this.charAt(i)).toLowerCase();if(this.length==7)color=this.toLowerCase();}}
return(color.length==7?color:(arguments[0]||this));};Element.collectTextNodes=function(element){return $A($(element).childNodes).collect(function(node){return(node.nodeType==3?node.nodeValue:(node.hasChildNodes()?Element.collectTextNodes(node):''));}).flatten().join('');};Element.collectTextNodesIgnoreClass=function(element,className){return $A($(element).childNodes).collect(function(node){return(node.nodeType==3?node.nodeValue:((node.hasChildNodes()&&!Element.hasClassName(node,className))?Element.collectTextNodesIgnoreClass(node,className):''));}).flatten().join('');};Element.setContentZoom=function(element,percent){element=$(element);element.setStyle({fontSize:(percent/100)+'em'});if(Prototype.Browser.WebKit)window.scrollBy(0,0);return element;};Element.getInlineOpacity=function(element){return $(element).style.opacity||'';};Element.forceRerendering=function(element){try{element=$(element);var n=document.createTextNode(' ');element.appendChild(n);element.removeChild(n);}catch(e){}};var Effect={_elementDoesNotExistError:{name:'ElementDoesNotExistError',message:'The specified DOM element does not exist, but is required for this effect to operate'},Transitions:{linear:Prototype.K,sinoidal:function(pos){return(-Math.cos(pos*Math.PI)/2)+.5;},reverse:function(pos){return 1-pos;},flicker:function(pos){var pos=((-Math.cos(pos*Math.PI)/4)+.75)+Math.random()/4;return pos>1?1:pos;},wobble:function(pos){return(-Math.cos(pos*Math.PI*(9*pos))/2)+.5;},pulse:function(pos,pulses){return(-Math.cos((pos*((pulses||5)-.5)*2)*Math.PI)/2)+.5;},spring:function(pos){return 1-(Math.cos(pos*4.5*Math.PI)*Math.exp(-pos*6));},none:function(pos){return 0;},full:function(pos){return 1;}},DefaultOptions:{duration:1.0,fps:100,sync:false,from:0.0,to:1.0,delay:0.0,queue:'parallel'},tagifyText:function(element){var tagifyStyle='position:relative';if(Prototype.Browser.IE)tagifyStyle+=';zoom:1';element=$(element);$A(element.childNodes).each(function(child){if(child.nodeType==3){child.nodeValue.toArray().each(function(character){element.insertBefore(new Element('span',{style:tagifyStyle}).update(character==' '?String.fromCharCode(160):character),child);});Element.remove(child);}});},multiple:function(element,effect){var elements;if(((typeof element=='object')||Object.isFunction(element))&&(element.length))
elements=element;else
elements=$(element).childNodes;var options=Object.extend({speed:0.1,delay:0.0},arguments[2]||{});var masterDelay=options.delay;$A(elements).each(function(element,index){new effect(element,Object.extend(options,{delay:index*options.speed+masterDelay}));});},PAIRS:{'slide':['SlideDown','SlideUp'],'blind':['BlindDown','BlindUp'],'appear':['Appear','Fade']},toggle:function(element,effect,options){element=$(element);effect=(effect||'appear').toLowerCase();return Effect[Effect.PAIRS[effect][element.visible()?1:0]](element,Object.extend({queue:{position:'end',scope:(element.id||'global'),limit:1}},options||{}));}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null;},_each:function(iterator){this.effects._each(iterator);},add:function(effect){var timestamp=new Date().getTime();var position=Object.isString(effect.options.queue)?effect.options.queue:effect.options.queue.position;switch(position){case'front':this.effects.findAll(function(e){return e.state=='idle'}).each(function(e){e.startOn+=effect.finishOn;e.finishOn+=effect.finishOn;});break;case'with-last':timestamp=this.effects.pluck('startOn').max()||timestamp;break;case'end':timestamp=this.effects.pluck('finishOn').max()||timestamp;break;}
effect.startOn+=timestamp;effect.finishOn+=timestamp;if(!effect.options.queue.limit||(this.effects.length<effect.options.queue.limit))
this.effects.push(effect);if(!this.interval)
this.interval=setInterval(this.loop.bind(this),15);},remove:function(effect){this.effects=this.effects.reject(function(e){return e==effect});if(this.effects.length==0){clearInterval(this.interval);this.interval=null;}},loop:function(){var timePos=new Date().getTime();for(var i=0,len=this.effects.length;i<len;i++)
this.effects[i]&&this.effects[i].loop(timePos);}});Effect.Queues={instances:$H(),get:function(queueName){if(!Object.isString(queueName))return queueName;return this.instances.get(queueName)||this.instances.set(queueName,new Effect.ScopedQueue());}};Effect.Queue=Effect.Queues.get('global');Effect.Base=Class.create({position:null,start:function(options){if(options&&options.transition===false)options.transition=Effect.Transitions.linear;this.options=Object.extend(Object.extend({},Effect.DefaultOptions),options||{});this.currentFrame=0;this.state='idle';this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;this.render=(function(){function dispatch(effect,eventName){if(effect.options[eventName+'Internal'])
effect.options[eventName+'Internal'](effect);if(effect.options[eventName])
effect.options[eventName](effect);}
return function(pos){if(this.state==="idle"){this.state="running";dispatch(this,'beforeSetup');if(this.setup)this.setup();dispatch(this,'afterSetup');}
if(this.state==="running"){pos=(this.options.transition(pos)*this.fromToDelta)+this.options.from;this.position=pos;dispatch(this,'beforeUpdate');if(this.update)this.update(pos);dispatch(this,'afterUpdate');}};})();this.event('beforeStart');if(!this.options.sync)
Effect.Queues.get(Object.isString(this.options.queue)?'global':this.options.queue.scope).add(this);},loop:function(timePos){if(timePos>=this.startOn){if(timePos>=this.finishOn){this.render(1.0);this.cancel();this.event('beforeFinish');if(this.finish)this.finish();this.event('afterFinish');return;}
var pos=(timePos-this.startOn)/this.totalTime,frame=(pos*this.totalFrames).round();if(frame>this.currentFrame){this.render(pos);this.currentFrame=frame;}}},cancel:function(){if(!this.options.sync)
Effect.Queues.get(Object.isString(this.options.queue)?'global':this.options.queue.scope).remove(this);this.state='finished';},event:function(eventName){if(this.options[eventName+'Internal'])this.options[eventName+'Internal'](this);if(this.options[eventName])this.options[eventName](this);},inspect:function(){var data=$H();for(property in this)
if(!Object.isFunction(this[property]))data.set(property,this[property]);return'#<Effect:'+data.inspect()+',options:'+$H(this.options).inspect()+'>';}});Effect.Parallel=Class.create(Effect.Base,{initialize:function(effects){this.effects=effects||[];this.start(arguments[1]);},update:function(position){this.effects.invoke('render',position);},finish:function(position){this.effects.each(function(effect){effect.render(1.0);effect.cancel();effect.event('beforeFinish');if(effect.finish)effect.finish(position);effect.event('afterFinish');});}});Effect.Tween=Class.create(Effect.Base,{initialize:function(object,from,to){object=Object.isString(object)?$(object):object;var args=$A(arguments),method=args.last(),options=args.length==5?args[3]:null;this.method=Object.isFunction(method)?method.bind(object):Object.isFunction(object[method])?object[method].bind(object):function(value){object[method]=value};this.start(Object.extend({from:from,to:to},options||{}));},update:function(position){this.method(position);}});Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}));},update:Prototype.emptyFunction});Effect.Opacity=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout))
this.element.setStyle({zoom:1});var options=Object.extend({from:this.element.getOpacity()||0.0,to:1.0},arguments[1]||{});this.start(options);},update:function(position){this.element.setOpacity(position);}});Effect.Move=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({x:0,y:0,mode:'relative'},arguments[1]||{});this.start(options);},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle('left')||'0');this.originalTop=parseFloat(this.element.getStyle('top')||'0');if(this.options.mode=='absolute'){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop;}},update:function(position){this.element.setStyle({left:(this.options.x*position+this.originalLeft).round()+'px',top:(this.options.y*position+this.originalTop).round()+'px'});}});Effect.MoveBy=function(element,toTop,toLeft){return new Effect.Move(element,Object.extend({x:toLeft,y:toTop},arguments[3]||{}));};Effect.Scale=Class.create(Effect.Base,{initialize:function(element,percent){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:'box',scaleFrom:100.0,scaleTo:percent},arguments[2]||{});this.start(options);},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle('position');this.originalStyle={};['top','left','width','height','fontSize'].each(function(k){this.originalStyle[k]=this.element.style[k];}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var fontSize=this.element.getStyle('font-size')||'100%';['em','px','%','pt'].each(function(fontSizeType){if(fontSize.indexOf(fontSizeType)>0){this.fontSize=parseFloat(fontSize);this.fontSizeType=fontSizeType;}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=='box')
this.dims=[this.element.offsetHeight,this.element.offsetWidth];if(/^content/.test(this.options.scaleMode))
this.dims=[this.element.scrollHeight,this.element.scrollWidth];if(!this.dims)
this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth];},update:function(position){var currentScale=(this.options.scaleFrom/100.0)+(this.factor*position);if(this.options.scaleContent&&this.fontSize)
this.element.setStyle({fontSize:this.fontSize*currentScale+this.fontSizeType});this.setDimensions(this.dims[0]*currentScale,this.dims[1]*currentScale);},finish:function(position){if(this.restoreAfterFinish)this.element.setStyle(this.originalStyle);},setDimensions:function(height,width){var d={};if(this.options.scaleX)d.width=width.round()+'px';if(this.options.scaleY)d.height=height.round()+'px';if(this.options.scaleFromCenter){var topd=(height-this.dims[0])/2;var leftd=(width-this.dims[1])/2;if(this.elementPositioning=='absolute'){if(this.options.scaleY)d.top=this.originalTop-topd+'px';if(this.options.scaleX)d.left=this.originalLeft-leftd+'px';}else{if(this.options.scaleY)d.top=-topd+'px';if(this.options.scaleX)d.left=-leftd+'px';}}
this.element.setStyle(d);}});Effect.Highlight=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({startcolor:'#ffff99'},arguments[1]||{});this.start(options);},setup:function(){if(this.element.getStyle('display')=='none'){this.cancel();return;}
this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle('background-image');this.element.setStyle({backgroundImage:'none'});}
if(!this.options.endcolor)
this.options.endcolor=this.element.getStyle('background-color').parseColor('#ffffff');if(!this.options.restorecolor)
this.options.restorecolor=this.element.getStyle('background-color');this._base=$R(0,2).map(function(i){return parseInt(this.options.startcolor.slice(i*2+1,i*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(i){return parseInt(this.options.endcolor.slice(i*2+1,i*2+3),16)-this._base[i]}.bind(this));},update:function(position){this.element.setStyle({backgroundColor:$R(0,2).inject('#',function(m,v,i){return m+((this._base[i]+(this._delta[i]*position)).round().toColorPart());}.bind(this))});},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{'background-color':this.options.restorecolor}));}});Effect.ScrollTo=function(element){var options=arguments[1]||{},scrollOffsets=document.viewport.getScrollOffsets(),elementOffsets=$(element).cumulativeOffset();if(options.offset)elementOffsets[1]+=options.offset;return new Effect.Tween(null,scrollOffsets.top,elementOffsets[1],options,function(p){scrollTo(scrollOffsets.left,p.round());});};Effect.Fade=function(element){element=$(element);var oldOpacity=element.getInlineOpacity();var options=Object.extend({from:element.getOpacity()||1.0,to:0.0,afterFinishInternal:function(effect){if(effect.options.to!=0)return;effect.element.hide().setStyle({opacity:oldOpacity});}},arguments[1]||{});return new Effect.Opacity(element,options);};Effect.Appear=function(element){element=$(element);var options=Object.extend({from:(element.getStyle('display')=='none'?0.0:element.getOpacity()||0.0),to:1.0,afterFinishInternal:function(effect){effect.element.forceRerendering();},beforeSetup:function(effect){effect.element.setOpacity(effect.options.from).show();}},arguments[1]||{});return new Effect.Opacity(element,options);};Effect.Puff=function(element){element=$(element);var oldStyle={opacity:element.getInlineOpacity(),position:element.getStyle('position'),top:element.style.top,left:element.style.left,width:element.style.width,height:element.style.height};return new Effect.Parallel([new Effect.Scale(element,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(element,{sync:true,to:0.0})],Object.extend({duration:1.0,beforeSetupInternal:function(effect){Position.absolutize(effect.effects[0].element);},afterFinishInternal:function(effect){effect.effects[0].element.hide().setStyle(oldStyle);}},arguments[1]||{}));};Effect.BlindUp=function(element){element=$(element);element.makeClipping();return new Effect.Scale(element,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(effect){effect.element.hide().undoClipping();}},arguments[1]||{}));};Effect.BlindDown=function(element){element=$(element);var elementDimensions=element.getDimensions();return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makeClipping().setStyle({height:'0px'}).show();},afterFinishInternal:function(effect){effect.element.undoClipping();}},arguments[1]||{}));};Effect.SwitchOff=function(element){element=$(element);var oldOpacity=element.getInlineOpacity();return new Effect.Appear(element,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(effect){new Effect.Scale(effect.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(effect){effect.element.makePositioned().makeClipping();},afterFinishInternal:function(effect){effect.element.hide().undoClipping().undoPositioned().setStyle({opacity:oldOpacity});}});}},arguments[1]||{}));};Effect.DropOut=function(element){element=$(element);var oldStyle={top:element.getStyle('top'),left:element.getStyle('left'),opacity:element.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(element,{x:0,y:100,sync:true}),new Effect.Opacity(element,{sync:true,to:0.0})],Object.extend({duration:0.5,beforeSetup:function(effect){effect.effects[0].element.makePositioned();},afterFinishInternal:function(effect){effect.effects[0].element.hide().undoPositioned().setStyle(oldStyle);}},arguments[1]||{}));};Effect.Shake=function(element){element=$(element);var options=Object.extend({distance:20,duration:0.5},arguments[1]||{});var distance=parseFloat(options.distance);var split=parseFloat(options.duration)/10.0;var oldStyle={top:element.getStyle('top'),left:element.getStyle('left')};return new Effect.Move(element,{x:distance,y:0,duration:split,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance,y:0,duration:split,afterFinishInternal:function(effect){effect.element.undoPositioned().setStyle(oldStyle);}});}});}});}});}});}});};Effect.SlideDown=function(element){element=$(element).cleanWhitespace();var oldInnerBottom=element.down().getStyle('bottom');var elementDimensions=element.getDimensions();return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makePositioned();effect.element.down().makePositioned();if(window.opera)effect.element.setStyle({top:''});effect.element.makeClipping().setStyle({height:'0px'}).show();},afterUpdateInternal:function(effect){effect.element.down().setStyle({bottom:(effect.dims[0]-effect.element.clientHeight)+'px'});},afterFinishInternal:function(effect){effect.element.undoClipping().undoPositioned();effect.element.down().undoPositioned().setStyle({bottom:oldInnerBottom});}},arguments[1]||{}));};Effect.SlideUp=function(element){element=$(element).cleanWhitespace();var oldInnerBottom=element.down().getStyle('bottom');var elementDimensions=element.getDimensions();return new Effect.Scale(element,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:'box',scaleFrom:100,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makePositioned();effect.element.down().makePositioned();if(window.opera)effect.element.setStyle({top:''});effect.element.makeClipping().show();},afterUpdateInternal:function(effect){effect.element.down().setStyle({bottom:(effect.dims[0]-effect.element.clientHeight)+'px'});},afterFinishInternal:function(effect){effect.element.hide().undoClipping().undoPositioned();effect.element.down().undoPositioned().setStyle({bottom:oldInnerBottom});}},arguments[1]||{}));};Effect.Squish=function(element){return new Effect.Scale(element,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(effect){effect.element.makeClipping();},afterFinishInternal:function(effect){effect.element.hide().undoClipping();}});};Effect.Grow=function(element){element=$(element);var options=Object.extend({direction:'center',moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var oldStyle={top:element.style.top,left:element.style.left,height:element.style.height,width:element.style.width,opacity:element.getInlineOpacity()};var dims=element.getDimensions();var initialMoveX,initialMoveY;var moveX,moveY;switch(options.direction){case'top-left':initialMoveX=initialMoveY=moveX=moveY=0;break;case'top-right':initialMoveX=dims.width;initialMoveY=moveY=0;moveX=-dims.width;break;case'bottom-left':initialMoveX=moveX=0;initialMoveY=dims.height;moveY=-dims.height;break;case'bottom-right':initialMoveX=dims.width;initialMoveY=dims.height;moveX=-dims.width;moveY=-dims.height;break;case'center':initialMoveX=dims.width/2;initialMoveY=dims.height/2;moveX=-dims.width/2;moveY=-dims.height/2;break;}
return new Effect.Move(element,{x:initialMoveX,y:initialMoveY,duration:0.01,beforeSetup:function(effect){effect.element.hide().makeClipping().makePositioned();},afterFinishInternal:function(effect){new Effect.Parallel([new Effect.Opacity(effect.element,{sync:true,to:1.0,from:0.0,transition:options.opacityTransition}),new Effect.Move(effect.element,{x:moveX,y:moveY,sync:true,transition:options.moveTransition}),new Effect.Scale(effect.element,100,{scaleMode:{originalHeight:dims.height,originalWidth:dims.width},sync:true,scaleFrom:window.opera?1:0,transition:options.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(effect){effect.effects[0].element.setStyle({height:'0px'}).show();},afterFinishInternal:function(effect){effect.effects[0].element.undoClipping().undoPositioned().setStyle(oldStyle);}},options));}});};Effect.Shrink=function(element){element=$(element);var options=Object.extend({direction:'center',moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var oldStyle={top:element.style.top,left:element.style.left,height:element.style.height,width:element.style.width,opacity:element.getInlineOpacity()};var dims=element.getDimensions();var moveX,moveY;switch(options.direction){case'top-left':moveX=moveY=0;break;case'top-right':moveX=dims.width;moveY=0;break;case'bottom-left':moveX=0;moveY=dims.height;break;case'bottom-right':moveX=dims.width;moveY=dims.height;break;case'center':moveX=dims.width/2;moveY=dims.height/2;break;}
return new Effect.Parallel([new Effect.Opacity(element,{sync:true,to:0.0,from:1.0,transition:options.opacityTransition}),new Effect.Scale(element,window.opera?1:0,{sync:true,transition:options.scaleTransition,restoreAfterFinish:true}),new Effect.Move(element,{x:moveX,y:moveY,sync:true,transition:options.moveTransition})],Object.extend({beforeStartInternal:function(effect){effect.effects[0].element.makePositioned().makeClipping();},afterFinishInternal:function(effect){effect.effects[0].element.hide().undoClipping().undoPositioned().setStyle(oldStyle);}},options));};Effect.Pulsate=function(element){element=$(element);var options=arguments[1]||{},oldOpacity=element.getInlineOpacity(),transition=options.transition||Effect.Transitions.linear,reverser=function(pos){return 1-transition((-Math.cos((pos*(options.pulses||5)*2)*Math.PI)/2)+.5);};return new Effect.Opacity(element,Object.extend(Object.extend({duration:2.0,from:0,afterFinishInternal:function(effect){effect.element.setStyle({opacity:oldOpacity});}},options),{transition:reverser}));};Effect.Fold=function(element){element=$(element);var oldStyle={top:element.style.top,left:element.style.left,width:element.style.width,height:element.style.height};element.makeClipping();return new Effect.Scale(element,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(effect){new Effect.Scale(element,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(effect){effect.element.hide().undoClipping().setStyle(oldStyle);}});}},arguments[1]||{}));};Effect.Morph=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(options.style))this.style=$H(options.style);else{if(options.style.include(':'))
this.style=options.style.parseStyle();else{this.element.addClassName(options.style);this.style=$H(this.element.getStyles());this.element.removeClassName(options.style);var css=this.element.getStyles();this.style=this.style.reject(function(style){return style.value==css[style.key];});options.afterFinishInternal=function(effect){effect.element.addClassName(effect.options.style);effect.transforms.each(function(transform){effect.element.style[transform.style]='';});};}}
this.start(options);},setup:function(){function parseColor(color){if(!color||['rgba(0, 0, 0, 0)','transparent'].include(color))color='#ffffff';color=color.parseColor();return $R(0,2).map(function(i){return parseInt(color.slice(i*2+1,i*2+3),16);});}
this.transforms=this.style.map(function(pair){var property=pair[0],value=pair[1],unit=null;if(value.parseColor('#zzzzzz')!='#zzzzzz'){value=value.parseColor();unit='color';}else if(property=='opacity'){value=parseFloat(value);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout))
this.element.setStyle({zoom:1});}else if(Element.CSS_LENGTH.test(value)){var components=value.match(/^([\+\-]?[0-9\.]+)(.*)$/);value=parseFloat(components[1]);unit=(components.length==3)?components[2]:null;}
var originalValue=this.element.getStyle(property);return{style:property.camelize(),originalValue:unit=='color'?parseColor(originalValue):parseFloat(originalValue||0),targetValue:unit=='color'?parseColor(value):value,unit:unit};}.bind(this)).reject(function(transform){return((transform.originalValue==transform.targetValue)||(transform.unit!='color'&&(isNaN(transform.originalValue)||isNaN(transform.targetValue))));});},update:function(position){var style={},transform,i=this.transforms.length;while(i--)
style[(transform=this.transforms[i]).style]=transform.unit=='color'?'#'+
(Math.round(transform.originalValue[0]+
(transform.targetValue[0]-transform.originalValue[0])*position)).toColorPart()+
(Math.round(transform.originalValue[1]+
(transform.targetValue[1]-transform.originalValue[1])*position)).toColorPart()+
(Math.round(transform.originalValue[2]+
(transform.targetValue[2]-transform.originalValue[2])*position)).toColorPart():(transform.originalValue+
(transform.targetValue-transform.originalValue)*position).toFixed(3)+
(transform.unit===null?'':transform.unit);this.element.setStyle(style,true);}});Effect.Transform=Class.create({initialize:function(tracks){this.tracks=[];this.options=arguments[1]||{};this.addTracks(tracks);},addTracks:function(tracks){tracks.each(function(track){track=$H(track);var data=track.values().first();this.tracks.push($H({ids:track.keys().first(),effect:Effect.Morph,options:{style:data}}));}.bind(this));return this;},play:function(){return new Effect.Parallel(this.tracks.map(function(track){var ids=track.get('ids'),effect=track.get('effect'),options=track.get('options');var elements=[$(ids)||$$(ids)].flatten();return elements.map(function(e){return new effect(e,Object.extend({sync:true},options))});}).flatten(),this.options);}});Element.CSS_PROPERTIES=$w('backgroundColor backgroundPosition borderBottomColor borderBottomStyle '+'borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth '+'borderRightColor borderRightStyle borderRightWidth borderSpacing '+'borderTopColor borderTopStyle borderTopWidth bottom clip color '+'fontSize fontWeight height left letterSpacing lineHeight '+'marginBottom marginLeft marginRight marginTop markerOffset maxHeight '+'maxWidth minHeight minWidth opacity outlineColor outlineOffset '+'outlineWidth paddingBottom paddingLeft paddingRight paddingTop '+'right textIndent top width wordSpacing zIndex');Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement('div');String.prototype.parseStyle=function(){var style,styleRules=$H();if(Prototype.Browser.WebKit)
style=new Element('div',{style:this}).style;else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';style=String.__parseStyleElement.childNodes[0].style;}
Element.CSS_PROPERTIES.each(function(property){if(style[property])styleRules.set(property,style[property]);});if(Prototype.Browser.IE&&this.include('opacity'))
styleRules.set('opacity',this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);return styleRules;};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(element){var css=document.defaultView.getComputedStyle($(element),null);return Element.CSS_PROPERTIES.inject({},function(styles,property){styles[property]=css[property];return styles;});};}else{Element.getStyles=function(element){element=$(element);var css=element.currentStyle,styles;styles=Element.CSS_PROPERTIES.inject({},function(results,property){results[property]=css[property];return results;});if(!styles.opacity)styles.opacity=element.getOpacity();return styles;};}
Effect.Methods={morph:function(element,style){element=$(element);new Effect.Morph(element,Object.extend({style:style},arguments[2]||{}));return element;},visualEffect:function(element,effect,options){element=$(element);var s=effect.dasherize().camelize(),klass=s.charAt(0).toUpperCase()+s.substring(1);new Effect[klass](element,options);return element;},highlight:function(element,options){element=$(element);new Effect.Highlight(element,options);return element;}};$w('fade appear grow shrink fold blindUp blindDown slideUp slideDown '+'pulsate shake puff squish switchOff dropOut').each(function(effect){Effect.Methods[effect]=function(element,options){element=$(element);Effect[effect.charAt(0).toUpperCase()+effect.substring(1)](element,options);return element;};});$w('getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles').each(function(f){Effect.Methods[f]=Element[f];});Element.addMethods(Effect.Methods);
;if(Object.isUndefined(Effect))
throw("dragdrop.js requires including script.aculo.us' effects.js library");var Droppables={drops:[],remove:function(element){this.drops=this.drops.reject(function(d){return d.element==$(element)});},add:function(element){element=$(element);var options=Object.extend({greedy:true,hoverclass:null,tree:false},arguments[1]||{});if(options.containment){options._containers=[];var containment=options.containment;if(Object.isArray(containment)){containment.each(function(c){options._containers.push($(c))});}else{options._containers.push($(containment));}}
if(options.accept)options.accept=[options.accept].flatten();if((element.tagName!='TR')&&(element.tagName!='TBODY'))
Element.makePositioned(element);options.element=element;this.drops.push(options);},findDeepestChild:function(drops){deepest=drops[0];for(i=1;i<drops.length;++i)
if(Element.isParent(drops[i].element,deepest.element))
deepest=drops[i];return deepest;},isContained:function(element,drop){var containmentNode;if(drop.tree){containmentNode=element.treeNode;}else{containmentNode=element.parentNode;}
return true;},isAffected:function(point,element,drop){return(((drop.element!=element)||this.isContained(element,drop))&&((!drop.accept)||(Element.classNames(element).detect(function(v){return drop.accept.include(v)})))&&Position.within(drop.element,point[0],point[1]));},deactivate:function(drop){if(drop.hoverclass)
Element.removeClassName(drop.element,drop.hoverclass);this.last_active=null;},activate:function(drop){if(drop.hoverclass)
Element.addClassName(drop.element,drop.hoverclass);this.last_active=drop;},show:function(point,element){if(!this.drops.length)return;var drop,affected=[];this.drops.each(function(drop){if(Droppables.isAffected(point,element,drop)){if(drop.element.id==($K.yg_currentHover)){affected.push(drop);}else if(drop.element.parentNode.id==($K.yg_currentHover)){affected.push(drop);}}});if(affected.length>0)
drop=Droppables.findDeepestChild(affected);if(this.last_active&&this.last_active!=drop)this.deactivate(this.last_active);if(drop){Position.within(drop.element,point[0],point[1]);if(drop.onHover)
drop.onHover(element,drop.element,Position.overlap(drop.overlap,drop.element));if(drop!=this.last_active)Droppables.activate(drop);}},fire:function(event,element){if(!this.last_active)return;Position.prepare();if(this.isAffected([Event.pointerX(event),Event.pointerY(event)],element,this.last_active))
if(this.last_active.onDrop){this.last_active.onDrop(element,this.last_active.element,event);return true;}},reset:function(){if(this.last_active)
this.deactivate(this.last_active);}};var Draggables={drags:[],observers:[],register:function(draggable){if(this.drags.length==0){this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.updateDrag.bindAsEventListener(this);this.eventKeypress=this.keyPress.bindAsEventListener(this);Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"keypress",this.eventKeypress);}
this.drags.push(draggable);},unregister:function(draggable){this.drags=this.drags.reject(function(d){return d==draggable});if(this.drags.length==0){Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"keypress",this.eventKeypress);}},activate:function(draggable){if(draggable.options.delay){this._timeout=setTimeout(function(){Draggables._timeout=null;window.focus();Draggables.activeDraggable=draggable;}.bind(this),draggable.options.delay);}else{window.focus();this.activeDraggable=draggable;}},deactivate:function(){this.activeDraggable=null;},updateDrag:function(event){if(!this.activeDraggable)return;var pointer=[Event.pointerX(event),Event.pointerY(event)];if(this._lastPointer&&(this._lastPointer.inspect()==pointer.inspect()))return;this._lastPointer=pointer;this.activeDraggable.updateDrag(event,pointer);},endDrag:function(event){if(this._timeout){clearTimeout(this._timeout);this._timeout=null;}
if(!this.activeDraggable)return;this._lastPointer=null;this.activeDraggable.endDrag(event);this.activeDraggable=null;},keyPress:function(event){if(this.activeDraggable)
this.activeDraggable.keyPress(event);},addObserver:function(observer){this.observers.push(observer);this._cacheObserverCallbacks();},removeObserver:function(element){this.observers=this.observers.reject(function(o){return o.element==element});this._cacheObserverCallbacks();},notify:function(eventName,draggable,event){if(this[eventName+'Count']>0)
this.observers.each(function(o){if(o[eventName])o[eventName](eventName,draggable,event);});if(draggable.options[eventName])draggable.options[eventName](draggable,event);},_cacheObserverCallbacks:function(){['onStart','onEnd','onDrag'].each(function(eventName){Draggables[eventName+'Count']=Draggables.observers.select(function(o){return o[eventName];}).length;});}};var Draggable=Class.create({initialize:function(element){var defaults={handle:false,reverteffect:function(element,top_offset,left_offset){var dur=Math.sqrt(Math.abs(top_offset^2)+Math.abs(left_offset^2))*0.02;new Effect.Move(element,{x:-left_offset,y:-top_offset,duration:dur,queue:{scope:'_draggable',position:'end'}});},endeffect:function(element){var toOpacity=Object.isNumber(element._opacity)?element._opacity:1.0;new Effect.Opacity(element,{duration:0.0,from:1.0,to:toOpacity,queue:{scope:'_draggable',position:'end'},afterFinish:function(){Draggable._dragging[element]=false}});},zindex:2,revert:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,snap:false,delay:0};if(!arguments[1]||Object.isUndefined(arguments[1].endeffect))
Object.extend(defaults,{starteffect:function(element){element._opacity=Element.getOpacity(element);Draggable._dragging[element]=true;}});var options=Object.extend(defaults,arguments[1]||{});this.element=$(element);if(options.handle&&Object.isString(options.handle))
this.handle=this.element.down('.'+options.handle,0);if(!this.handle)this.handle=$(options.handle);if(!this.handle)this.handle=this.element;if(options.scroll&&!options.scroll.scrollTo&&!options.scroll.outerHTML){options.scroll=$(options.scroll);this._isScrollChild=Element.childOf(this.element,options.scroll);}
if(element.tagName!='TR')
Element.makePositioned(this.element);this.options=options;this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this);},destroy:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);Draggables.unregister(this);},currentDelta:function(){return([parseInt(Element.getStyle(this.element,'left')||'0'),parseInt(Element.getStyle(this.element,'top')||'0')]);},initDrag:function(event){if(!Object.isUndefined(Draggable._dragging[this.element])&&Draggable._dragging[this.element])return;if(Event.isLeftClick(event)){var src=Event.element(event);if((tag_name=src.tagName.toUpperCase())&&(tag_name=='INPUT'||tag_name=='SELECT'||tag_name=='OPTION'||tag_name=='BUTTON'||tag_name=='TEXTAREA'))return;var pointer=[Event.pointerX(event),Event.pointerY(event)];var pos=this.element.cumulativeOffset();this.offset=[0,1].map(function(i){return(pointer[i]-pos[i])});this.startpointer=pointer;Draggables.activate(this);Event.stop(event);}},startDrag:function(event){if(this.element.hasClassName('mk_nodrag'))return;$K.yg_startDragging(this,this.options.ghosting);$K.log("IN Startdrag",$K.Log.DEBUG);this.dragging=true;if(!this.delta)this.delta=this.currentDelta();if(this.options.zindex){this.originalZ=parseInt(Element.getStyle(this.element,'z-index')||0);this.element.style.zIndex=this.options.zindex;}
this.element._originalParent=this.element.parentNode;if(this.options.scroll){if(this.options.scroll==window){var where=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=where.left;this.originalScrollTop=where.top;}else{this.originalScrollLeft=this.options.scroll.scrollLeft;this.originalScrollTop=this.options.scroll.scrollTop;}}
Draggables.notify('onStart',this,event);if(this.options.starteffect)this.options.starteffect(this.element);},updateDrag:function(event,pointer){var pointer=[Event.pointerX(event),Event.pointerY(event)];if(this.startpointer&&((pointer[0]==this.startpointer[0])||(pointer[1]==this.startpointer[1]))){return;}else{this.startpointer=false;}
$K.log("IN Updatedrag",$K.Log.DEBUG);$K.log(this.dragging,$K.Log.DEBUG);if(!this.dragging)this.startDrag(event);if(!this.options.quiet){Position.prepare();Droppables.show(pointer,this.element);}
Draggables.notify('onDrag',this,event);this.draw(pointer);if(this.options.change)this.options.change(this);if(this.options.scroll){this.stopScrolling();var p;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){p=[left,top,left+width,top+height];}}else{p=Position.page(this.options.scroll).toArray();p[0]+=this.options.scroll.scrollLeft+Position.deltaX;p[1]+=this.options.scroll.scrollTop+Position.deltaY;p.push(p[0]+this.options.scroll.offsetWidth);p.push(p[1]+this.options.scroll.offsetHeight);}
var speed=[0,0];if(pointer[0]<(p[0]+this.options.scrollSensitivity))speed[0]=pointer[0]-(p[0]+this.options.scrollSensitivity);if(pointer[1]<(p[1]+this.options.scrollSensitivity))speed[1]=pointer[1]-(p[1]+this.options.scrollSensitivity);if(pointer[0]>(p[2]-this.options.scrollSensitivity))speed[0]=pointer[0]-(p[2]-this.options.scrollSensitivity);if(pointer[1]>(p[3]-this.options.scrollSensitivity))speed[1]=pointer[1]-(p[3]-this.options.scrollSensitivity);this.startScrolling(speed);}
if(Prototype.Browser.WebKit)window.scrollBy(0,0);Event.stop(event);},finishDrag:function(event,success){if($('$treeNeedle'))$('$treeNeedle').setStyle({display:'none'});document.body.removeClassName('drag');this.dragging=false;$K.yg_activeDragInfo.dragging=false;if((!$K.yg_activeDragInfo.dropAllowed)&&((!Sortable._marker)||(!Sortable._marker.hoverOverMarker))){success=false;}
if(this.options.quiet){Position.prepare();var pointer=[Event.pointerX(event),Event.pointerY(event)];Droppables.show(pointer,this.element);}
if(this.options.ghosting){if(success){var tempvar=this.element.down('.listitempage');if(tempvar!=undefined){if(typeof(tempvar.onclick)=='function'){tempvar.onclick();}}}else{Draggables.notify('onEnd',this,event);if(this.options.zIndex)this.element.style.zIndex=this.originalZ;Draggables.deactivate(this);Droppables.reset();}}
if(this.element.tagName!='TR')this.element.style.display='block';var dropped=false;$('yg_ddGhost').setStyle({display:'none'});if(this.options.yg_clone){var clone=new Element(this.element.tagName);$K.log('this.element: ',this.element,$K.Log.DEBUG);$A(this.element.attributes).each(function(attribute){if((attribute.name!='style')&&(attribute.name!='id')){clone[attribute.name]=attribute.value;clone.setAttribute(attribute.name,attribute.value);}});clone.id='clone%%'+this.element.id;clone.style.display='none';var cl_innerHTML=this.element.innerHTML+'';clone=$(clone);cl_innerHTML=cl_innerHTML.replace(/_dummy/g,'');if(Prototype.Browser.IE){cl_innerHTML=cl_innerHTML.replace(/ id=/g,' id=clone%%');}else{cl_innerHTML=cl_innerHTML.replace(/ id="/g,' id="clone%%');}
clone=Element.update(clone,cl_innerHTML);$K.yg_activeDragInfo.element=clone;$K.yg_activeDragInfo.origElement=this.element;}
if($K.yg_activeDragInfo.reordering&&success){dropped=Droppables.fire(event,this.element);if($K.yg_activeDragInfo.target!=undefined){if($K.yg_currentdragobj.length>0){$K.yg_currentdragobj.each(function(item){var listItem=item.up('li');$K.log('Item is:',item,$K.Log.INFO);if($K.yg_activeDragInfo.position=='before'){$K.yg_activeDragInfo.target.parentNode.insertBefore(listItem,$K.yg_activeDragInfo.before);}else if($K.yg_activeDragInfo.position=='into'){$K.yg_activeDragInfo.target.insertBefore(listItem,$K.yg_activeDragInfo.before);}else{if($K.yg_activeDragInfo.before!=listItem){$K.yg_activeDragInfo.target.parentNode.insertBefore(listItem,$K.yg_activeDragInfo.before);}}});}
if($K.yg_activeDragInfo.element)$K.yg_activeDragInfo.element.disabled='';}}
if(dropped&&this.options.onDropped)this.options.onDropped(this.element);if(this.options.zindex)
this.element.style.zIndex=this.originalZ;Draggables.notify('onEnd',this,event);var revert=this.options.revert;if(revert&&Object.isFunction(revert))revert=revert(this.element);var d=this.currentDelta();if(revert&&this.options.reverteffect){if(dropped==0||revert!='failure')
this.options.reverteffect(this.element,d[1]-this.delta[1],d[0]-this.delta[0]);}else{this.delta=d;}
if(this.options.endeffect)
this.options.endeffect(this.element);Draggables.deactivate(this);Droppables.reset();if(this.options.yg_clone&&$K.yg_activeDragInfo){if(typeof Sortable.sortables[this.element.up().id].onUpdate=='function'){Sortable.sortables[this.element.up().id].onUpdate(this.element.up());}}},keyPress:function(event){if(event.keyCode!=Event.KEY_ESC)return;this.finishDrag(event,false);Event.stop(event);},endDrag:function(event){$K.log('EndDrag',$K.Log.DEBUG);if(!this.dragging)return;this.stopScrolling();this.finishDrag(event,$K.yg_activeDragInfo.dropAllowed);this.dragging=false;$K.yg_clearDragSession();Event.stop(event);},draw:function(point){var target_tree=Sortable.sortables[$K.yg_currentHover];if(!target_tree&&$K.yg_currentHover&&$K.yg_currentHover.id&&$K.yg_currentHover.id.endsWith('_list')){target_tree=Sortable.sortables[$K.yg_currentHover.id];}
if($('yg_ddGhost'))$('yg_ddGhost')._originalParent=this.element._originalParent;if($('yg_ddGhost')){if($K.yg_activeDragInfo.dropAllowed){$K.yg_showNoDropMarker(false);$K.log('Painting a tag...',$K.Log.DEBUG);}else{if(Sortable._marker){if(!Sortable._marker.hoverOverMarker){Sortable._marker.hide();}
if($('placeHolder')){if(!$('placeHolder').hoverOverMarker){$('placeHolder').remove();}}}
$K.yg_showNoDropMarker(true);}}
var pos=this.element.cumulativeOffset();if(this.options.ghosting){var r=Position.realOffset(this.element);pos[0]+=r[0]-Position.deltaX;pos[1]+=r[1]-Position.deltaY;}
var d=this.currentDelta();pos[0]-=d[0];pos[1]-=d[1];if(this.options.scroll&&(this.options.scroll!=window&&this._isScrollChild)){pos[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft;pos[1]-=this.options.scroll.scrollTop-this.originalScrollTop;}
var p=[0,1].map(function(i){return(point[i]-pos[i]-this.offset[i])}.bind(this));if(this.options.snap){if(Object.isFunction(this.options.snap)){p=this.options.snap(p[0],p[1],this);}else{if(Object.isArray(this.options.snap)){p=p.map(function(v,i){return(v/this.options.snap[i]).round()*this.options.snap[i]}.bind(this));}else{p=p.map(function(v){return(v/this.options.snap).round()*this.options.snap}.bind(this));}}}
var drawAllowed=(this.element.readAttribute('yg_draggable')=="true");if(drawAllowed){var style=this.element.style;if((!this.options.constraint)||(this.options.constraint=='horizontal'))
style.left=p[0]+"px";if((!this.options.constraint)||(this.options.constraint=='vertical'))
style.top=p[1]+"px";if(style.visibility=="hidden")style.visibility="";}
if($('yg_ddGhost')){var yg_ddGhost=$('yg_ddGhost');if((!this.options.constraint)||(this.options.constraint=='horizontal'))
yg_ddGhost.setStyle({left:(point[0]+18)+'px'});if((!this.options.constraint)||(this.options.constraint=='vertical'))
yg_ddGhost.setStyle({top:(point[1]+2)+'px'});}},stopScrolling:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);this.scrollInterval=null;Draggables._lastScrollPointer=null;}},startScrolling:function(speed){if(!(speed[0]||speed[1]))return;this.scrollSpeed=[speed[0]*this.options.scrollSpeed,speed[1]*this.options.scrollSpeed];this.lastScrolled=new Date();this.scrollInterval=setInterval(this.scroll.bind(this),10);},scroll:function(){var current=new Date();var delta=current-this.lastScrolled;this.lastScrolled=current;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){if(this.scrollSpeed[0]||this.scrollSpeed[1]){var d=delta/1000;this.options.scroll.scrollTo(left+d*this.scrollSpeed[0],top+d*this.scrollSpeed[1]);}}}else{this.options.scroll.scrollLeft+=this.scrollSpeed[0]*delta/1000;this.options.scroll.scrollTop+=this.scrollSpeed[1]*delta/1000;}
Position.prepare();Droppables.show(Draggables._lastPointer,this.element);Draggables.notify('onDrag',this);if(this._isScrollChild){Draggables._lastScrollPointer=Draggables._lastScrollPointer||$A(Draggables._lastPointer);Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*delta/1000;Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*delta/1000;if(Draggables._lastScrollPointer[0]<0)
Draggables._lastScrollPointer[0]=0;if(Draggables._lastScrollPointer[1]<0)
Draggables._lastScrollPointer[1]=0;this.draw(Draggables._lastScrollPointer);}
if(this.options.change)this.options.change(this);},_getWindowScroll:function(w){var T,L,W,H;with(w.document){if(w.document.documentElement&&documentElement.scrollTop){T=documentElement.scrollTop;L=documentElement.scrollLeft;}else if(w.document.body){T=body.scrollTop;L=body.scrollLeft;}
if(w.innerWidth){W=w.innerWidth;H=w.innerHeight;}else if(w.document.documentElement&&documentElement.clientWidth){W=documentElement.clientWidth;H=documentElement.clientHeight;}else{W=body.offsetWidth;H=body.offsetHeight;}}
return{top:T,left:L,width:W,height:H};}});Draggable._dragging={};var SortableObserver=Class.create({initialize:function(element,observer){this.element=$(element);this.observer=observer;this.lastValue=Sortable.serialize(this.element);},onStart:function(){this.lastValue=Sortable.serialize(this.element);},onEnd:function(){Sortable.unmark();if(this.lastValue!=Sortable.serialize(this.element))
this.observer(this.element)}});var Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(element){while(element.tagName.toUpperCase()!="BODY"){if(element.id&&Sortable.sortables[element.id])return element;element=element.parentNode;}},options:function(element){element=Sortable._findRootElement($(element));if(!element)return;return Sortable.sortables[element.id];},destroy:function(element){element=$(element);var s=Sortable.sortables[element.id];if(s){Draggables.removeObserver(s.element);s.droppables.each(function(d){Droppables.remove(d)});s.draggables.invoke('destroy');delete Sortable.sortables[s.element.id];}},create:function(element){element=$(element);var options=Object.extend({element:element,tag:'li',dropOnEmpty:false,tree:false,treeTag:'ul',overlap:'vertical',constraint:'vertical',containment:element,handle:false,only:false,delay:0,hoverclass:null,ghosting:false,quiet:false,scroll:false,yg_clone:false,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:false,handles:false,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},arguments[1]||{});this.destroy(element);var options_for_draggable={revert:true,quiet:options.quiet,scroll:options.scroll,scrollSpeed:options.scrollSpeed,scrollSensitivity:options.scrollSensitivity,yg_clone:options.yg_clone,delay:options.delay,ghosting:options.ghosting,constraint:options.constraint,handle:options.handle};if(options.starteffect)
options_for_draggable.starteffect=options.starteffect;if(options.reverteffect)
options_for_draggable.reverteffect=options.reverteffect;else
if(options.ghosting)options_for_draggable.reverteffect=function(element){element.style.top=0;element.style.left=0;};if(options.endeffect)
options_for_draggable.endeffect=options.endeffect;if(options.zindex)
options_for_draggable.zindex=options.zindex;var options_for_droppable={overlap:options.overlap,containment:options.containment,tree:options.tree,yg_clone:options.yg_clone,hoverclass:options.hoverclass,onHover:Sortable.onHover};var options_for_tree={onHover:Sortable.onEmptyHover,overlap:options.overlap,containment:options.containment,yg_clone:options.yg_clone,hoverclass:options.hoverclass};Element.cleanWhitespace(element);options.draggables=[];options.droppables=[];if(options.dropOnEmpty||options.tree){Droppables.add(element,options_for_tree);options.droppables.push(element);}
(options.elements||this.findElements(element,options)||[]).each(function(e,i){var handle=options.handles?$(options.handles[i]):(options.handle?$(e).select('.'+options.handle)[0]:e);options.draggables.push(new Draggable(e,Object.extend(options_for_draggable,{handle:handle})));Droppables.add(e,options_for_droppable);if(options.tree)e.treeNode=element;options.droppables.push(e);});if(options.tree){(Sortable.findTreeElements(element,options)||[]).each(function(e){Droppables.add(e,options_for_tree);e.treeNode=element;options.droppables.push(e);});}
this.sortables[element.identify()]=options;Draggables.addObserver(new SortableObserver(element,options.onUpdate));},findElements:function(element,options){return Element.findChildren(element,options.only,options.tree?true:false,options.tag);},findTreeElements:function(element,options){return Element.findChildren(element,options.only,options.tree?true:false,options.treeTag);},onHover:function(element,dropon,overlap){$K.log('in onHover',$K.Log.DEBUG);if(Element.isParent(dropon,element))return;if(!Position.within(dropon.parentNode.parentNode,Draggables._lastPointer[0],Draggables._lastPointer[1])){if(dropon.parentNode.parentNode.parentNode){if(typeof dropon.parentNode.parentNode.parentNode.onmouseout=='function'){dropon.parentNode.parentNode.parentNode.onmouseout();return;}}}
$K.yg_activeDragInfo.hoverOverSortable=true;if(overlap>0.5){if(!$K.yg_activeDragInfo.hoverOverTree&&($($K.yg_currentHover).yg_reordering!="false")){if(element.next()!=dropon){Sortable.mark(dropon,'before');}}else{if(Sortable._marker)Sortable._marker.hide();}
if(element.next()!=dropon){var oldParentNode=element.parentNode;$K.yg_activeDragInfo.position='before';$K.yg_activeDragInfo.element=element;$K.yg_activeDragInfo.target=dropon;$K.yg_activeDragInfo.before=dropon;if((dropon.parentNode!=oldParentNode)&&(Sortable.options(oldParentNode)))Sortable.options(oldParentNode).onChange(element);Sortable.options(dropon.parentNode).onChange(element);}}else{if(!$K.yg_activeDragInfo.hoverOverTree&&($($K.yg_currentHover).yg_reordering!="false")){if(element.previous()!=dropon){Sortable.mark(dropon,'after');}}
var nextElement=dropon.nextSibling||null;if(nextElement!=element){var oldParentNode=element.parentNode;$K.yg_activeDragInfo.position='after';$K.yg_activeDragInfo.element=element;$K.yg_activeDragInfo.target=dropon;$K.yg_activeDragInfo.before=nextElement;if((dropon.parentNode!=oldParentNode)&&Sortable.options(oldParentNode))Sortable.options(oldParentNode).onChange(element);Sortable.options(dropon.parentNode).onChange(element);}}},onEmptyHover:function(element,dropon,overlap){$K.log("in onEmptyhover",$K.Log.DEBUG);if(!Sortable._marker)_createSortableMarker();var oldTopOffset=Sortable._marker.getStyle('top');var offsets=Position.cumulativeOffset(dropon);Sortable._marker.setStyle({left:offsets[0]+'px',top:offsets[1]+'px'});Sortable._marker.setStyle({top:(offsets[1]+dropon.clientHeight)+'px'});var ywindowRef=dropon.up('.ywindow').id;if($($K.windows[ywindowRef].id+'_scrollbar_v').getStyle('visibility')=='hidden'){Sortable._marker.setStyle({width:($K.windows[ywindowRef].boxwidth-37)+'px'});}else{Sortable._marker.setStyle({width:($K.windows[ywindowRef].boxwidth-(37+$K.yg_scrollObjAttr.scrollBtnVWidth))+'px'});}
var sortable=Sortable.options(dropon);if(sortable.element.id.indexOf('_scp_')!=-1){var topMargin=6;var chldElements=$(dropon).childElements();if((chldElements.length!=0)){if(chldElements.length==1){topMargin+=(dropon.firstDescendant().getHeight());}else{$K.log('$actDragInfo:',$K.yg_activeDragInfo,$K.Log.DEBUG);var offsetTop=($K.yg_mouseCoords.Y-offsets[1]);var offsetBottom=(dropon.getHeight()-offsetTop);if((offsetBottom<15)){topMargin+=(dropon.getHeight()-10);}}}
$K.yg_setSortableMarkerIndex(ywindowRef);Sortable._marker.setStyle({left:offsets[0]+'px',top:(offsets[1]+topMargin)+'px'});}
var leftoffset=(parseInt(dropon.up('.innercontent').getStyle('left').replace(/px/g,''))||0);if(leftoffset<0){var oldoffset=(parseInt(Sortable._marker.getStyle('left').replace(/px/g,''))||0);Sortable._marker.setStyle({left:(oldoffset-leftoffset)+'px'});}
var oldParentNode=element.parentNode;var droponOptions=Sortable.options(dropon);Sortable._marker.show();if(dropon.id){if((dropon.tagName=='UL')){if(element._originalParent){if(dropon.id!=element._originalParent.id){if($('placeHolder')){$('placeHolder').remove();}
if((Sortable._marker)&&(sortable.element.id.indexOf('_scp_')==-1)){Sortable._marker.hide();}
if(dropon.id.indexOf('_scp_')==-1){var newPH=document.createElement('div');newPH.className='dropmarker';newPH.style.position='relative';newPH.style.top='-1px';newPH.style.left='0px';newPH.placeHolder=true;newPH.id='placeHolder';newPH.onmouseover=function(){if($('placeHolder')){$('placeHolder').hoverOverMarker=true;$K.yg_setDropAllowed(true);$('placeHolder').show();}}
newPH.onmouseout=function(){if($('placeHolder')){$('placeHolder').hoverOverMarker=false;}}
if(!(Prototype.Browser.IE&&element.hasClassName('mk_formfield'))){dropon.appendChild(newPH);}}}}}}
if(!Element.isParent(dropon,element)){var index;var children=Sortable.findElements(dropon,{tag:droponOptions.tag,only:droponOptions.only});var child=null;if(children){var offset=Element.offsetSize(dropon,droponOptions.overlap)*(1.0-overlap);for(index=0;index<children.length;index+=1){if(offset-Element.offsetSize(children[index],droponOptions.overlap)>=0){offset-=Element.offsetSize(children[index],droponOptions.overlap);}else if(offset-(Element.offsetSize(children[index],droponOptions.overlap)/2)>=0){child=index+1<children.length?children[index+1]:null;break;}else{child=children[index];break;}}}
$K.yg_activeDragInfo.position='into';$K.yg_activeDragInfo.element=element;$K.yg_activeDragInfo.target=dropon;$K.yg_activeDragInfo.before=child;if(Sortable.options(oldParentNode))Sortable.options(oldParentNode).onChange(element);droponOptions.onChange(element);}},unmark:function(){if(Sortable._marker){Sortable._marker.hide();}
if(Sortable._guide&&Sortable._guide.parentNode){Sortable._guide.parentNode.removeChild(Sortable._guide);}
if(Sortable._emptyPlaceMarker)
Element.hide(Sortable._emptyPlaceMarker);},mark:function(dropon,position){$K.log('Entering "MARK"',$K.Log.DEBUG);if(!$K.yg_activeDragInfo.dropAllowed)return;if($K.yg_activeDragInfo.hoverOverFormfield)return;var win_prefix=dropon.up('.ywindow').id;var topoffset=dropon.positionedOffset();topoffset=topoffset[1];var scrolled=parseInt($(win_prefix+'_innercontent').style.top.replace(/px/g,''));var hght=$(win_prefix+'_innercontent').up().clientHeight;if(position=='after')topoffset=topoffset+dropon.clientHeight;if(dropon.id.indexOf('subpage')!=-1){scrolled=0;}
if((hght-(topoffset+scrolled))<0){$K.yg_setDropAllowed(false);return;}
$K.log('Drawing marks on ',dropon,$K.Log.DEBUG);var sortable=Sortable.options(dropon.parentNode);if(sortable&&!sortable.ghosting)return;if(!Sortable._marker)
_createSortableMarker();var offsets=dropon.cumulativeOffset();var droponParent=dropon.parentNode;if((sortable.element.id.indexOf('_scp_')==-1)){if(position=='after'){if((dropon.offsetTop+droponParent.offsetTop+dropon.offsetHeight)<0){return;}
if((dropon.offsetTop+droponParent.offsetTop+dropon.offsetHeight)<0){return;}}else{if((dropon.offsetTop+droponParent.offsetTop)>(sortable.element.parentNode.offsetHeight+30)){return;}
if((dropon.offsetTop+droponParent.offsetTop)<0){return;}}}
$K.yg_setSortableMarkerIndex(dropon.up('.ywindow').id);Sortable._marker.setStyle({left:offsets[0]+'px',top:(offsets[1]-1)+'px'});if(position=='after')
if(sortable.overlap=='horizontal')
Sortable._marker.setStyle({left:(offsets[0]+dropon.getWidth())+'px'});else
Sortable._marker.setStyle({top:(offsets[1]+dropon.getHeight()-1)+'px'});if(sortable.element.id.indexOf('_scp_')==-1){var marker_top=parseInt(Sortable._marker.style.top.replace(/px/g,''))+1;var sortable_top=parseInt(dropon.up(2).cumulativeOffset().top);var sortable_bottom=sortable_top+parseInt(dropon.up(2).getHeight());$K.log('MK_TOP: ',marker_top,'SRT_TOP: ',sortable_top,'SRT_BOT: ',sortable_bottom,$K.Log.DEBUG);if((marker_top<sortable_top)||(marker_top>sortable_bottom)){$K.log('Out of Bounds...',$K.Log.INFO);Sortable._marker.hide();return;}}
if(dropon.up('.entries_list')){var containerRef=dropon.up('.entries_list');var baseId=containerRef.identify();}else{var containerRef=dropon.up('.ywindowinnerie');var baseId=dropon.up('.ywindow').identify();}
Sortable._marker.setStyle({width:(containerRef.getWidth()-4+$K.yg_scrollObjAttr.scrollBtnVWidth)+'px'});if(sortable.element.id.indexOf('_scp_')!=-1){if(position=='after'){$K.log('After',$K.Log.DEBUG);Sortable._marker.setStyle({top:(offsets[1]+dropon.clientHeight+5)+'px'});}else{$K.log('Before',$K.Log.DEBUG);Sortable._marker.setStyle({left:offsets[0]+'px',top:(offsets[1]+5)+'px'});}}
var leftoffset=(parseInt(dropon.up('.innercontent').getStyle('left').replace(/px/g,''))||0);if(leftoffset<0){var oldoffset=(parseInt(Sortable._marker.getStyle('left').replace(/px/g,''))||0);Sortable._marker.setStyle({left:(oldoffset-leftoffset)+'px'});}
Sortable._marker.show();var nextItem=dropon.next();if(nextItem){if((nextItem.id!='placeHolder')&&(!nextItem.isClone)){if($('placeHolder')){if(!$('placeHolder').hoverOverMarker){$('placeHolder').remove();}}}else{if(position=='before'){if($('placeHolder')){if(!$('placeHolder').hoverOverMarker){$('placeHolder').remove();}}}}}},_tree:function(element,options,parent){var children=Sortable.findElements(element,options)||[];for(var i=0;i<children.length;++i){var match=children[i].id.match(options.format);if(!match)continue;var child={id:encodeURIComponent(match?match[1]:null),element:element,parent:parent,children:[],position:parent.children.length,container:$(children[i]).down(options.treeTag)};if(child.container)
this._tree(child.container,options,child);parent.children.push(child);}
return parent;},tree:function(element){element=$(element);var sortableOptions=this.options(element);var options=Object.extend({tag:sortableOptions.tag,treeTag:sortableOptions.treeTag,only:sortableOptions.only,name:element.id,format:sortableOptions.format},arguments[1]||{});var root={id:null,parent:null,children:[],container:element,position:0};return Sortable._tree(element,options,root);},_constructIndex:function(node){var index='';do{if(node.id)index='['+node.position+']'+index;}while((node=node.parent)!=null);return index;},sequence:function(element){element=$(element);var options=Object.extend(this.options(element),arguments[1]||{});return $(this.findElements(element,options)||[]).map(function(item){return item.id.match(options.format)?item.id.match(options.format)[1]:'';});},setSequence:function(element,new_sequence){element=$(element);var options=Object.extend(this.options(element),arguments[2]||{});var nodeMap={};this.findElements(element,options).each(function(n){if(n.id.match(options.format))
nodeMap[n.id.match(options.format)[1]]=[n,n.parentNode];n.parentNode.removeChild(n);});new_sequence.each(function(ident){var n=nodeMap[ident];if(n){n[1].appendChild(n[0]);delete nodeMap[ident];}});},serialize:function(element){element=$(element);var options=Object.extend(Sortable.options(element),arguments[1]||{});var name=encodeURIComponent((arguments[1]&&arguments[1].name)?arguments[1].name:element.id);if(options.tree){return Sortable.tree(element,arguments[1]).children.map(function(item){return[name+Sortable._constructIndex(item)+"[id]="+
encodeURIComponent(item.id)].concat(item.children.map(arguments.callee));}).flatten().join('&');}else{return Sortable.sequence(element,arguments[1]).map(function(item){return name+"[]="+encodeURIComponent(item);}).join('&');}},createGuide:function(element){if(!Sortable._guide){Sortable._guide=$('_guide')||document.createElement('DIV');Sortable._guide.style.position='relative';Sortable._guide.style.width='1px';Sortable._guide.style.height='0px';Sortable._guide.style.cssFloat='left';Sortable._guide.id='guide';document.getElementsByTagName("body").item(0).appendChild(Sortable._guide);}},markEmptyPlace:function(element){if(!Sortable._emptyPlaceMarker){Sortable._emptyPlaceMarker=$('emptyPlaceMarker')||document.createElement('DIV');Element.hide(Sortable._emptyPlaceMarker);Element.addClassName(Sortable._emptyPlaceMarker,'emptyPlaceMarker');Sortable._emptyPlaceMarker.style.position='absolute';document.getElementsByTagName("body").item(0).appendChild(Sortable._emptyPlaceMarker);}
var pos=Position.cumulativeOffset(Sortable._guide);Sortable._emptyPlaceMarker.style.left=(pos[0]+5)+'px';Sortable._emptyPlaceMarker.style.top=(pos[1]+5)+'px';var dim={};dim.width=(Element.getDimensions(element).width-5)+'px';dim.height=(Element.getDimensions(element).height-5)+'px';Sortable._emptyPlaceMarker.setStyle(dim);var mg=Element.getStyle(element,'margin');if(mg&&mg!=''){Sortable._emptyPlaceMarker.setStyle({margin:mg});}else{Sortable._emptyPlaceMarker.setStyle({margin:''});}
Element.show(Sortable._emptyPlaceMarker);}};Element.isParent=function(child,element){if(!child.parentNode||child==element)return false;if(child.parentNode==element)return true;return Element.isParent(child.parentNode,element);};Element.findChildren=function(element,only,recursive,tagName){if(!element.hasChildNodes())return null;tagName=tagName.toUpperCase();if(only)only=[only].flatten();var elements=[];$A(element.childNodes).each(function(e){if(e.tagName&&e.tagName.toUpperCase()==tagName&&(!only||(Element.classNames(e).detect(function(v){return only.include(v)}))))
elements.push(e);if(recursive){var grandchildren=Element.findChildren(e,only,recursive,tagName);if(grandchildren)elements.push(grandchildren);}});return(elements.length>0?elements.flatten():[]);};Element.offsetSize=function(element,type){return element['offset'+((type=='vertical'||type=='height')?'Height':'Width')];};function _createSortableMarker(){Sortable._marker=($('dropmarker')||Element.extend(document.createElement('DIV'))).hide().addClassName('dropmarker').setStyle({position:'absolute'});Sortable._marker.onmouseover=function(){Sortable._marker.hoverOverMarker=true;this.show();$K.yg_setDropAllowed(true);}
Sortable._marker.onmouseout=function(){Sortable._marker.hoverOverMarker=false;}
Sortable._marker.onmouseup=function(){if($K.yg_activeDragInfo.target&&$K.yg_activeDragInfo.target.parentNode){var x=$K.yg_activeDragInfo.target.parentNode.id;$K.yg_customSortableOnDrop(x);}}
document.getElementsByTagName("body").item(0).appendChild(Sortable._marker);};
;if(typeof Effect=='undefined')
throw("controls.js requires including script.aculo.us' effects.js library");var Autocompleter={};Autocompleter.Base=Class.create({baseInitialize:function(element,update,options){element=$(element);this.element=element;this.update=$(update);this.hasFocus=false;this.changed=false;this.active=false;this.index=0;this.entryCount=0;this.oldElementValue=this.element.value;if(this.setOptions)
this.setOptions(options);else
this.options=options||{};this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||function(element,update){if(!update.style.position||update.style.position=='absolute'){update.style.position='absolute';Position.clone(element,update,{setHeight:false,offsetTop:element.offsetHeight});}
Effect.Appear(update,{duration:0.15});};this.options.onHide=this.options.onHide||function(element,update){new Effect.Fade(update,{duration:0.15})};if(typeof(this.options.tokens)=='string')
this.options.tokens=new Array(this.options.tokens);if(!this.options.tokens.include('\n'))
this.options.tokens.push('\n');this.observer=null;this.element.setAttribute('autocomplete','off');Element.hide(this.update);Event.observe(this.element,'blur',this.onBlur.bindAsEventListener(this));Event.observe(this.element,'keydown',this.onKeyPress.bindAsEventListener(this));},show:function(){if(Element.getStyle(this.update,'display')=='none')this.options.onShow(this.element,this.update);if(!this.iefix&&(Prototype.Browser.IE)&&(Element.getStyle(this.update,'position')=='absolute')){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" '+'style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+'_iefix');}
if(this.iefix)setTimeout(this.fixIEOverlapping.bind(this),50);},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:(!this.update.style.height)});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix);},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,'display')!='none')this.options.onHide(this.element,this.update);if(this.iefix)Element.hide(this.iefix);},startIndicator:function(){if(this.options.indicator)Element.show(this.options.indicator);},stopIndicator:function(){if(this.options.indicator)Element.hide(this.options.indicator);},onKeyPress:function(event){if(this.active)
switch(event.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();Event.stop(event);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(event);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(event);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(event);return;}
else
if(event.keyCode==Event.KEY_TAB||event.keyCode==Event.KEY_RETURN||(Prototype.Browser.WebKit>0&&event.keyCode==0))return;this.changed=true;this.hasFocus=true;if(this.observer)clearTimeout(this.observer);this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000);},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices();},onHover:function(event){var element=Event.findElement(event,'LI');if(this.index!=element.autocompleteIndex)
{this.index=element.autocompleteIndex;this.render();}
Event.stop(event);},onClick:function(event){var element=Event.findElement(event,'LI');this.index=element.autocompleteIndex;this.selectEntry();this.hide();},onBlur:function(event){setTimeout(this.hide.bind(this),250);this.hasFocus=false;this.active=false;},render:function(){if(this.entryCount>0){for(var i=0;i<this.entryCount;i++)
this.index==i?Element.addClassName(this.getEntry(i),"selected"):Element.removeClassName(this.getEntry(i),"selected");if(this.hasFocus){this.show();this.active=true;}}else{this.active=false;this.hide();}},markPrevious:function(){if(this.index>0)this.index--;else this.index=this.entryCount-1;this.getEntry(this.index).scrollIntoView(true);},markNext:function(){if(this.index<this.entryCount-1)this.index++;else this.index=0;this.getEntry(this.index).scrollIntoView(false);},getEntry:function(index){return this.update.firstChild.childNodes[index];},getCurrentEntry:function(){return this.getEntry(this.index);},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry());},updateElement:function(selectedElement){if(this.options.updateElement){this.options.updateElement(selectedElement);return;}
var value='';if(this.options.select){var nodes=$(selectedElement).select('.'+this.options.select)||[];if(nodes.length>0)value=Element.collectTextNodes(nodes[0],this.options.select);}else
value=Element.collectTextNodesIgnoreClass(selectedElement,'informal');var bounds=this.getTokenBounds();if(bounds[0]!=-1){var newValue=this.element.value.substr(0,bounds[0]);var whitespace=this.element.value.substr(bounds[0]).match(/^\s+/);if(whitespace)
newValue+=whitespace[0];this.element.value=newValue+value+this.element.value.substr(bounds[1]);}else{this.element.value=value;}
this.oldElementValue=this.element.value;this.element.focus();if(this.options.afterUpdateElement)
this.options.afterUpdateElement(this.element,selectedElement);},updateChoices:function(choices){if(!this.changed&&this.hasFocus){this.update.innerHTML=choices;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var i=0;i<this.entryCount;i++){var entry=this.getEntry(i);entry.autocompleteIndex=i;this.addObservers(entry);}}else{this.entryCount=0;}
this.stopIndicator();this.index=0;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide();}else{this.render();}}},addObservers:function(element){Event.observe(element,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(element,"click",this.onClick.bindAsEventListener(this));},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(this.getToken().length>=this.options.minChars){this.getUpdatedChoices();}else{this.active=false;this.hide();}
this.oldElementValue=this.element.value;},getToken:function(){var bounds=this.getTokenBounds();return this.element.value.substring(bounds[0],bounds[1]).strip();},getTokenBounds:function(){if(null!=this.tokenBounds)return this.tokenBounds;var value=this.element.value;if(value.strip().empty())return[-1,0];var diff=arguments.callee.getFirstDifferencePos(value,this.oldElementValue);var offset=(diff==this.oldElementValue.length?1:0);var prevTokenPos=-1,nextTokenPos=value.length;var tp;for(var index=0,l=this.options.tokens.length;index<l;++index){tp=value.lastIndexOf(this.options.tokens[index],diff+offset-1);if(tp>prevTokenPos)prevTokenPos=tp;tp=value.indexOf(this.options.tokens[index],diff+offset);if(-1!=tp&&tp<nextTokenPos)nextTokenPos=tp;}
return(this.tokenBounds=[prevTokenPos+1,nextTokenPos]);}});Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(newS,oldS){var boundary=Math.min(newS.length,oldS.length);for(var index=0;index<boundary;++index)
if(newS[index]!=oldS[index])
return index;return boundary;};Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(element,update,url,options){this.baseInitialize(element,update,options);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=url;},getUpdatedChoices:function(){this.startIndicator();var entry=encodeURIComponent(this.options.paramName)+'='+
encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,entry):entry;if(this.options.defaultParams)
this.options.parameters+='&'+this.options.defaultParams;new Ajax.Request(this.url,this.options);},onComplete:function(request){this.updateChoices(request.responseText);}});Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(element,update,array,options){this.baseInitialize(element,update,options);this.options.array=array;},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this));},setOptions:function(options){this.options=Object.extend({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(instance){var ret=[];var partial=[];var entry=instance.getToken();var count=0;for(var i=0;i<instance.options.array.length&&ret.length<instance.options.choices;i++){var elem=instance.options.array[i];var foundPos=instance.options.ignoreCase?elem.toLowerCase().indexOf(entry.toLowerCase()):elem.indexOf(entry);while(foundPos!=-1){if(foundPos==0&&elem.length!=entry.length){ret.push("<li><strong>"+elem.substr(0,entry.length)+"</strong>"+
elem.substr(entry.length)+"</li>");break;}else if(entry.length>=instance.options.partialChars&&instance.options.partialSearch&&foundPos!=-1){if(instance.options.fullSearch||/\s/.test(elem.substr(foundPos-1,1))){partial.push("<li>"+elem.substr(0,foundPos)+"<strong>"+
elem.substr(foundPos,entry.length)+"</strong>"+elem.substr(foundPos+entry.length)+"</li>");break;}}
foundPos=instance.options.ignoreCase?elem.toLowerCase().indexOf(entry.toLowerCase(),foundPos+1):elem.indexOf(entry,foundPos+1);}}
if(partial.length)
ret=ret.concat(partial.slice(0,instance.options.choices-ret.length));return"<ul>"+ret.join('')+"</ul>";}},options||{});}});Field.scrollFreeActivate=function(field){setTimeout(function(){Field.activate(field);},1);};Ajax.InPlaceEditor=Class.create({initialize:function(element,url,options){this.url=url;this.element=element=$(element);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(options);Object.extend(this.options,options||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+'-inplaceeditor';if($(this.options.formId))
this.options.formId='';}
if(this.options.externalControl)
this.options.externalControl=$(this.options.externalControl);if(!this.options.externalControl)
this.options.externalControlOnly=false;this._originalBackground=this.element.getStyle('background-color')||'transparent';this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this.registerListeners();},checkForEscapeOrReturn:function(e){if(!this._editing||e.ctrlKey||e.altKey||e.shiftKey)return;if(Event.KEY_ESC==e.keyCode)
this.handleFormCancellation(e);else if(Event.KEY_RETURN==e.keyCode)
this.handleFormSubmission(e);},createControl:function(mode,handler,extraClasses){var control=this.options[mode+'Control'];var text=this.options[mode+'Text'];if('button'==control){var btn=document.createElement('input');btn.type='submit';btn.value=text;btn.className='editor_'+mode+'_button';if('cancel'==mode)
btn.onclick=this._boundCancelHandler;this._form.appendChild(btn);this._controls[mode]=btn;}else if('link'==control){var link=document.createElement('a');link.href='#';link.appendChild(document.createTextNode(text));link.onclick='cancel'==mode?this._boundCancelHandler:this._boundSubmitHandler;link.className='editor_'+mode+'_link';if(extraClasses)
link.className+=' '+extraClasses;this._form.appendChild(link);this._controls[mode]=link;}},createEditField:function(){var text=(this.options.loadTextURL?this.options.loadingText:this.getText());var fld;if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){fld=document.createElement('input');fld.type='text';var size=this.options.size||this.options.cols||0;if(0<size)fld.size=size;}else{fld=document.createElement('textarea');fld.rows=(1>=this.options.rows?this.options.autoRows:this.options.rows);fld.cols=this.options.cols||40;}
fld.name=this.options.paramName;fld.value=text;fld.className='editor_field';if(this.options.submitOnBlur)
fld.onblur=this._boundSubmitHandler;this._controls.editor=fld;if(this.options.loadTextURL)
this.loadExternalText();this._form.appendChild(this._controls.editor);},createForm:function(){var ipe=this;function addText(mode,condition){var text=ipe.options['text'+mode+'Controls'];if(!text||condition===false)return;ipe._form.appendChild(document.createTextNode(text));};this._form=$(document.createElement('form'));this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();if('textarea'==this._controls.editor.tagName.toLowerCase())
this._form.appendChild(document.createElement('br'));if(this.options.onFormCustomization)
this.options.onFormCustomization(this,this._form);addText('Before',this.options.okControl||this.options.cancelControl);this.createControl('ok',this._boundSubmitHandler);addText('Between',this.options.okControl&&this.options.cancelControl);this.createControl('cancel',this._boundCancelHandler,'editor_cancel');addText('After',this.options.okControl||this.options.cancelControl);},destroy:function(){if(this._oldInnerHTML)
this.element.innerHTML=this._oldInnerHTML;this.leaveEditMode();this.unregisterListeners();},enterEditMode:function(e){if(this._saving||this._editing)return;this._editing=true;this.triggerCallback('onEnterEditMode');if(this.options.externalControl)
this.options.externalControl.hide();this.element.hide();this.createForm();this.element.parentNode.insertBefore(this._form,this.element);if(!this.options.loadTextURL)
this.postProcessEditField();if(e)Event.stop(e);},enterHover:function(e){if(this.options.hoverClassName)
this.element.addClassName(this.options.hoverClassName);if(this._saving)return;this.triggerCallback('onEnterHover');},getText:function(){return this.element.innerHTML.unescapeHTML();},handleAJAXFailure:function(transport){this.triggerCallback('onFailure',transport);if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML;this._oldInnerHTML=null;}},handleFormCancellation:function(e){this.wrapUp();if(e)Event.stop(e);},handleFormSubmission:function(e){var form=this._form;var value=$F(this._controls.editor);this.prepareSubmission();var params=this.options.callback(form,value)||'';if(Object.isString(params))
params=params.toQueryParams();params.editorId=this.element.id;if(this.options.htmlResponse){var options=Object.extend({evalScripts:true},this.options.ajaxOptions);Object.extend(options,{parameters:params,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Updater({success:this.element},this.url,options);}else{var options=Object.extend({method:'get'},this.options.ajaxOptions);Object.extend(options,{parameters:params,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Request(this.url,options);}
if(e)Event.stop(e);},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();if(this.options.externalControl)
this.options.externalControl.show();this._saving=false;this._editing=false;this._oldInnerHTML=null;this.triggerCallback('onLeaveEditMode');},leaveHover:function(e){if(this.options.hoverClassName)
this.element.removeClassName(this.options.hoverClassName);if(this._saving)return;this.triggerCallback('onLeaveHover');},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=true;var options=Object.extend({method:'get'},this.options.ajaxOptions);Object.extend(options,{parameters:'editorId='+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){this._form.removeClassName(this.options.loadingClassName);var text=transport.responseText;if(this.options.stripLoadedTextTags)
text=text.stripTags();this._controls.editor.value=text;this._controls.editor.disabled=false;this.postProcessEditField();}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,options);},postProcessEditField:function(){var fpc=this.options.fieldPostCreation;if(fpc)
$(this._controls.editor)['focus'==fpc?'focus':'activate']();},prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks);[this._extraDefaultOptions].flatten().compact().each(function(defs){Object.extend(this.options,defs);}.bind(this));},prepareSubmission:function(){this._saving=true;this.removeForm();this.leaveHover();this.showSaving();},registerListeners:function(){this._listeners={};var listener;$H(Ajax.InPlaceEditor.Listeners).each(function(pair){listener=this[pair.value].bind(this);this._listeners[pair.key]=listener;if(!this.options.externalControlOnly)
this.element.observe(pair.key,listener);if(this.options.externalControl)
this.options.externalControl.observe(pair.key,listener);}.bind(this));},removeForm:function(){if(!this._form)return;this._form.remove();this._form=null;this._controls={};},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show();},triggerCallback:function(cbName,arg){if('function'==typeof this.options[cbName]){this.options[cbName](this,arg);}},unregisterListeners:function(){$H(this._listeners).each(function(pair){if(!this.options.externalControlOnly)
this.element.stopObserving(pair.key,pair.value);if(this.options.externalControl)
this.options.externalControl.stopObserving(pair.key,pair.value);}.bind(this));},wrapUp:function(transport){this.leaveEditMode();this._boundComplete(transport,this.element);}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,element,url,options){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(element,url,options);},createEditField:function(){var list=document.createElement('select');list.name=this.options.paramName;list.size=1;this._controls.editor=list;this._collection=this.options.collection||[];if(this.options.loadCollectionURL)
this.loadCollection();else
this.checkForExternalText();this._form.appendChild(this._controls.editor);},loadCollection:function(){this._form.addClassName(this.options.loadingClassName);this.showLoadingText(this.options.loadingCollectionText);var options=Object.extend({method:'get'},this.options.ajaxOptions);Object.extend(options,{parameters:'editorId='+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){var js=transport.responseText.strip();if(!/^\[.*\]$/.test(js))
throw('Server returned an invalid collection representation.');this._collection=eval(js);this.checkForExternalText();}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,options);},showLoadingText:function(text){this._controls.editor.disabled=true;var tempOption=this._controls.editor.firstChild;if(!tempOption){tempOption=document.createElement('option');tempOption.value='';this._controls.editor.appendChild(tempOption);tempOption.selected=true;}
tempOption.update((text||'').stripScripts().stripTags());},checkForExternalText:function(){this._text=this.getText();if(this.options.loadTextURL)
this.loadExternalText();else
this.buildOptionList();},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var options=Object.extend({method:'get'},this.options.ajaxOptions);Object.extend(options,{parameters:'editorId='+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){this._text=transport.responseText.strip();this.buildOptionList();}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,options);},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(entry){return 2===entry.length?entry:[entry,entry].flatten();});var marker=('value'in this.options)?this.options.value:this._text;var textFound=this._collection.any(function(entry){return entry[0]==marker;}.bind(this));this._controls.editor.update('');var option;this._collection.each(function(entry,index){option=document.createElement('option');option.value=entry[0];option.selected=textFound?entry[0]==marker:0==index;option.appendChild(document.createTextNode(entry[1]));this._controls.editor.appendChild(option);}.bind(this));this._controls.editor.disabled=false;Field.scrollFreeActivate(this._controls.editor);}});Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(options){if(!options)return;function fallback(name,expr){if(name in options||expr===undefined)return;options[name]=expr;};fallback('cancelControl',(options.cancelLink?'link':(options.cancelButton?'button':options.cancelLink==options.cancelButton==false?false:undefined)));fallback('okControl',(options.okLink?'link':(options.okButton?'button':options.okLink==options.okButton==false?false:undefined)));fallback('highlightColor',options.highlightcolor);fallback('highlightEndColor',options.highlightendcolor);};Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:'link',cancelText:'cancel',clickToEditText:'Click to edit',externalControl:null,externalControlOnly:false,fieldPostCreation:'activate',formClassName:'inplaceeditor-form',formId:null,highlightColor:'#ffff99',highlightEndColor:'#ffffff',hoverClassName:'',htmlResponse:true,loadingClassName:'inplaceeditor-loading',loadingText:'Loading...',okControl:'button',okText:'ok',paramName:'value',rows:1,savingClassName:'inplaceeditor-saving',savingText:'Saving...',size:0,stripLoadedTextTags:false,submitOnBlur:false,textAfterControls:'',textBeforeControls:'',textBetweenControls:''},DefaultCallbacks:{callback:function(form){return Form.serialize(form);},onComplete:function(transport,element){new Effect.Highlight(element,{startcolor:this.options.highlightColor,keepBackgroundImage:true});},onEnterEditMode:null,onEnterHover:function(ipe){ipe.element.style.backgroundColor=ipe.options.highlightColor;if(ipe._effect)
ipe._effect.cancel();},onFailure:function(transport,ipe){alert('Error communication with the server: '+transport.responseText.stripTags());},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(ipe){ipe._effect=new Effect.Highlight(ipe.element,{startcolor:ipe.options.highlightColor,endcolor:ipe.options.highlightEndColor,restorecolor:ipe._originalBackground,keepBackgroundImage:true});}},Listeners:{click:'enterEditMode',keydown:'checkForEscapeOrReturn',mouseover:'enterHover',mouseout:'leaveHover'}});Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:'Loading options...'};Form.Element.DelayedObserver=Class.create({initialize:function(element,delay,callback){this.delay=delay||0.5;this.element=$(element);this.callback=callback;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,'keyup',this.delayedListener.bindAsEventListener(this));},delayedListener:function(event){if(this.lastValue==$F(this.element))return;if(this.timer)clearTimeout(this.timer);this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1000);this.lastValue=$F(this.element);},onTimerEvent:function(){this.timer=null;this.callback(this.element,$F(this.element));}});
;if(!Control)var Control={};Control.Slider=Class.create({initialize:function(handle,track,options){var slider=this;if(Object.isArray(handle)){this.handles=handle.collect(function(e){return $(e)});}else{this.handles=[$(handle)];}
this.track=$(track);this.options=options||{};this.axis=this.options.axis||'horizontal';this.increment=this.options.increment||1;this.step=parseInt(this.options.step||'1');this.range=this.options.range||$R(0,1);this.value=0;this.values=this.handles.map(function(){return 0});this.spans=this.options.spans?this.options.spans.map(function(s){return $(s)}):false;this.options.startSpan=$(this.options.startSpan||null);this.options.endSpan=$(this.options.endSpan||null);this.restricted=this.options.restricted||false;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||'0');this.alignY=parseInt(this.options.alignY||'0');this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?(this.handles[0].offsetHeight!=0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,"")):(this.handles[0].offsetWidth!=0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""));this.active=false;this.dragging=false;this.disabled=false;if(this.options.disabled)this.setDisabled();this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):false;if(this.allowedValues){this.minimum=this.allowedValues.min();this.maximum=this.allowedValues.max();}
this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);this.handles.each(function(h,i){i=slider.handles.length-1-i;slider.setValue(parseFloat((Object.isArray(slider.options.sliderValue)?slider.options.sliderValue[i]:slider.options.sliderValue)||slider.range.start),i);h.makePositioned().observe("mousedown",slider.eventMouseDown);});this.track.observe("mousedown",this.eventMouseDown);document.observe("mouseup",this.eventMouseUp);document.observe("mousemove",this.eventMouseMove);this.initialized=true;},dispose:function(){var slider=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown);Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);this.handles.each(function(h){Event.stopObserving(h,"mousedown",slider.eventMouseDown);});},setDisabled:function(){this.disabled=true;},setEnabled:function(){this.disabled=false;},getNearestValue:function(value){if(this.allowedValues){if(value>=this.allowedValues.max())return(this.allowedValues.max());if(value<=this.allowedValues.min())return(this.allowedValues.min());var offset=Math.abs(this.allowedValues[0]-value);var newValue=this.allowedValues[0];this.allowedValues.each(function(v){var currentOffset=Math.abs(v-value);if(currentOffset<=offset){newValue=v;offset=currentOffset;}});return newValue;}
if(value>this.range.end)return this.range.end;if(value<this.range.start)return this.range.start;return value;},setValue:function(sliderValue,handleIdx){if(!this.active){this.activeHandleIdx=handleIdx||0;this.activeHandle=this.handles[this.activeHandleIdx];this.updateStyles();}
handleIdx=handleIdx||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if((handleIdx>0)&&(sliderValue<this.values[handleIdx-1]))
sliderValue=this.values[handleIdx-1];if((handleIdx<(this.handles.length-1))&&(sliderValue>this.values[handleIdx+1]))
sliderValue=this.values[handleIdx+1];}
sliderValue=this.getNearestValue(sliderValue);this.values[handleIdx]=sliderValue;this.value=this.values[0];this.handles[handleIdx].style[this.isVertical()?'top':'left']=this.translateToPx(sliderValue);this.drawSpans();if(!this.dragging||!this.event)this.updateFinished();},setValueBy:function(delta,handleIdx){this.setValue(this.values[handleIdx||this.activeHandleIdx||0]+delta,handleIdx||this.activeHandleIdx||0);},translateToPx:function(value){return Math.round(((this.trackLength-this.handleLength)/(this.range.end-this.range.start))*(value-this.range.start))+"px";},translateToValue:function(offset){return((offset/(this.trackLength-this.handleLength)*(this.range.end-this.range.start))+this.range.start);},getRange:function(range){var v=this.values.sortBy(Prototype.K);range=range||0;return $R(v[range],v[range+1]);},minimumOffset:function(){return(this.isVertical()?this.alignY:this.alignX);},maximumOffset:function(){return(this.isVertical()?(this.track.offsetHeight!=0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!=0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignX);},isVertical:function(){return(this.axis=='vertical');},drawSpans:function(){var slider=this;if(this.spans)
$R(0,this.spans.length-1).each(function(r){slider.setSpan(slider.spans[r],slider.getRange(r))});if(this.options.startSpan)
this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value));if(this.options.endSpan)
this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum));},setSpan:function(span,range){if(this.isVertical()){span.style.top=this.translateToPx(range.start);span.style.height=this.translateToPx(range.end-range.start+this.range.start);}else{span.style.left=this.translateToPx(range.start);span.style.width=this.translateToPx(range.end-range.start+this.range.start);}},updateStyles:function(){this.handles.each(function(h){Element.removeClassName(h,'selected')});Element.addClassName(this.activeHandle,'selected');},startDrag:function(event){if(Event.isLeftClick(event)){if(!this.disabled){this.active=true;var handle=Event.element(event);var pointer=[Event.pointerX(event),Event.pointerY(event)];var track=handle;if(track==this.track){var offsets=this.track.cumulativeOffset();this.event=event;this.setValue(this.translateToValue((this.isVertical()?pointer[1]-offsets[1]:pointer[0]-offsets[0])-(this.handleLength/2)));var offsets=this.activeHandle.cumulativeOffset();this.offsetX=(pointer[0]-offsets[0]);this.offsetY=(pointer[1]-offsets[1]);}else{while((this.handles.indexOf(handle)==-1)&&handle.parentNode)
handle=handle.parentNode;if(this.handles.indexOf(handle)!=-1){this.activeHandle=handle;this.activeHandleIdx=this.handles.indexOf(this.activeHandle);this.updateStyles();var offsets=this.activeHandle.cumulativeOffset();this.offsetX=(pointer[0]-offsets[0]);this.offsetY=(pointer[1]-offsets[1]);}}}
Event.stop(event);}},update:function(event){if(this.active){if(!this.dragging)this.dragging=true;this.draw(event);if(Prototype.Browser.WebKit)window.scrollBy(0,0);Event.stop(event);}},draw:function(event){var pointer=[Event.pointerX(event),Event.pointerY(event)];var offsets=this.track.cumulativeOffset();pointer[0]-=this.offsetX+offsets[0];pointer[1]-=this.offsetY+offsets[1];this.event=event;this.setValue(this.translateToValue(this.isVertical()?pointer[1]:pointer[0]));if(this.initialized&&this.options.onSlide)
this.options.onSlide(this.values.length>1?this.values:this.value,this);},endDrag:function(event){if(this.active&&this.dragging){this.finishDrag(event,true);Event.stop(event);}
this.active=false;this.dragging=false;},finishDrag:function(event,success){this.active=false;this.dragging=false;this.updateFinished();},updateFinished:function(){if(this.initialized&&this.options.onChange)
this.options.onChange(this.values.length>1?this.values:this.value,this);this.event=null;}});
;Sound={tracks:{},_enabled:true,template:new Template('<embed style="height:0" id="sound_#{track}_#{id}" src="#{url}" loop="false" autostart="true" hidden="true"/>'),enable:function(){Sound._enabled=true;},disable:function(){Sound._enabled=false;},play:function(url){if(!Sound._enabled)return;var options=Object.extend({track:'global',url:url,replace:false},arguments[1]||{});if(options.replace&&this.tracks[options.track]){$R(0,this.tracks[options.track].id).each(function(id){var sound=$('sound_'+options.track+'_'+id);sound.Stop&&sound.Stop();sound.remove();});this.tracks[options.track]=null;}
if(!this.tracks[options.track])
this.tracks[options.track]={id:0};else
this.tracks[options.track].id++;options.id=this.tracks[options.track].id;$$('body')[0].insert(Prototype.Browser.IE?new Element('bgsound',{id:'sound_'+options.track+'_'+options.id,src:options.url,loop:1,autostart:true}):Sound.template.evaluate(options));}};if(Prototype.Browser.Gecko&&navigator.userAgent.indexOf("Win")>0){if(navigator.plugins&&$A(navigator.plugins).detect(function(p){return p.name.indexOf('QuickTime')!=-1}))
Sound.template=new Template('<object id="sound_#{track}_#{id}" width="0" height="0" type="audio/mpeg" data="#{url}"/>');else if(navigator.plugins&&$A(navigator.plugins).detect(function(p){return p.name.indexOf('Windows Media')!=-1}))
Sound.template=new Template('<object id="sound_#{track}_#{id}" type="application/x-mplayer2" data="#{url}"></object>');else if(navigator.plugins&&$A(navigator.plugins).detect(function(p){return p.name.indexOf('RealPlayer')!=-1}))
Sound.template=new Template('<embed type="audio/x-pn-realaudio-plugin" style="height:0" id="sound_#{track}_#{id}" src="#{url}" loop="false" autostart="true" hidden="true"/>');else
Sound.play=function(){};}
;var nlsTree=new Object();var nlsTreeIc=new Object();var _ua=window.navigator.userAgent;var nls_isIE=(_ua.indexOf("MSIE")>=0);var nls_isSafari=(_ua.indexOf("Safari")>=0);var nls_isOpera=(_ua.indexOf("Opera")>=0);if(nls_isOpera)nls_isIE=false;var NLSTREE=NlsTree.prototype;function NlsTree(tId){this.tId=tId;this.opt=new StdOpt();this.nLst={};this.ctxMenu=null;this.rt=null;this.selNd=null;this.defImgPath="";this.chUrl=null;this.treeParameters=null;this.selElm=null;this.tmId=null;this.liveNodeEditClicked=null;this.nCnt=0;this._fl=true;this.msNds={};this.rtm={};nlsTree[this.tId]=this;var asc=(document.getElementsByTagName?document.getElementsByTagName("SCRIPT"):document.scripts);for(var i=0;i<asc.length;i++){if(asc[i].src.toLowerCase().indexOf("nlstree.js")>=0){this.defImgPath=asc[i].src.replace(/nlstree.js/gi,"../../img/tree/");break;}}
this.useIconSet(new StdIco(this.defImgPath));this.renderer=new DefRenderer(tId);return this;};function NlsTreeUtil(){};function StdIco(path){this.toString=function(){return"Standard Icons"};return this;};function StdOpt(){this.enbScroll=false;this.height="300px";this.width="200px";this.trg="_self";this.stlprf="";this.sort="no";this.icon=true;this.check=false;this.editable=false;this.selRow=false;this.editKey=113;this.oneExp=false;this.enableCtx=true;this.oneClick=false;this.mntState=false;this.icAsSel=false;this.checkIncSub=true;this.checkParents=false;this.indent=true;this.hideRoot=false;this.showExpdr=false;this.checkOnLeaf=false;this.renderOnDemand=false;this.evDblClick=false;this.evCtxMenu=false;this.evMouseUp=false;this.evMouseDown=false;this.evMouseMove=false;this.evMouseOut=false;this.evMouseOver=false;return this;};function NlsNode(orgId,capt,url,ic,exp,chk,xtra,title,add,yg_id,yg_type,yg_property,pname){this.orgId=orgId;this.id="";this.capt=capt;this.url=null;this.ygurl=(url==null||url=="")?"":url;this.ic=null;this.exp=exp==null?false:exp;this.chk=(chk?chk:false);this.xtra=xtra==null?false:xtra;this.ctxMenu=null;this.cstStyle="";this.trg=null;this.custom=null;this.title=title==null?capt:title;this.editablity=true;this.checkbox=true;this.add=(add?add:null);this.yg_id=(yg_id?yg_id:null);this.yg_type=(yg_type?yg_type:null);this.yg_property=(yg_property?yg_property:null);this.pname=(pname?pname:null);this.setIcon=function(ic){var ac=(ic==null||ic=="")?null:ic.split(",");if(ac){for(var i=0;i<ac.length;i++)preloadIcon(ac[i]);};this.ic=ac;}
this.isCustomNode=function(){return this.custom==null;};this.nx=null;this.pv=null;this.fc=null;this.lc=null;this.pr=null;this.equals=function(nd){if(!nd)return false;else return(this.id==nd.id);};this.setIcon(ic);};NLSTREE.genIntId=function(id){return this.tId+id;};NLSTREE.genOrgId=function(intId){return intId.substr(this.tId.length);};NLSTREE.compareNode=function(aN,bN){var result=(aN.capt.toLowerCase()>=bN.capt.toLowerCase());if(aN.ic&&bN.ic&&(aN.ic[0].indexOf('ico_folder')!=-1)&&(bN.ic[0].indexOf('ico_folder')!=-1)){result=(aN.capt.toLowerCase()>bN.capt.toLowerCase());}else if(aN.ic&&aN.ic[0].indexOf('ico_folder')!=-1){result=false;}else if(bN.ic&&bN.ic[0].indexOf('ico_folder')!=-1){result=true;}
if(aN.ic&&aN.ic[0].indexOf('ico_trashcan')!=-1){result=true;}else if(bN.ic&&bN.ic[0].indexOf('ico_trashcan')!=-1){result=false;}
return result;};NLSTREE.add=function(id,prn,capt,url,ic,exp,chk,xtra,title,add,yg_id,yg_type,yg_property,pname){var nNd=new NlsNode(((id==null||String(id)=="")?("int"+(++this.nCnt)):id),capt,url,ic,exp,chk,xtra,title,add,yg_id,yg_type,yg_property,pname);nNd.id=this.genIntId(nNd.orgId);if(this.nLst[nNd.id]!=null){return;}
if(this.rt==null){this.rt=nNd;}else{var pnd=this.nLst[this.genIntId(prn)];if(pnd==null){return;}
nNd.pr=pnd;if(pnd.lc==null){pnd.fc=nNd;pnd.lc=nNd;}else{var t=pnd.fc;if(this.opt.sort!="no"){do{if(this.opt.sort=="asc"?this.compareNode(t,nNd):this.compareNode(nNd,t))break;t=t.nx;}while(t!=null);if(t!=null){if(t.pv==null){t.pv=nNd;pnd.fc=nNd;}else{nNd.pv=t.pv;t.pv.nx=nNd;t.pv=nNd;}
nNd.nx=t;}}
if(this.opt.sort=="no"||t==null){nNd.pv=pnd.lc;pnd.lc.nx=nNd;pnd.lc=nNd;}}}
this.nLst[nNd.id]=nNd;if(yg_id&&yg_type&&yg_property)
$K.yg_addLookup(yg_id,nNd);return nNd;};NLSTREE.addCustomNode=function(id,prn,custom){var nd=this.add(id,prn,"");nd.capt="";nd.custom=custom;return nd;};NLSTREE.addBefore=function(id,sib,capt,url,ic,exp,chk,xtra,title,add,yg_id,yg_type,yg_property,pname){var nd=this.getNodeById(sib);if(nd==null)return;var nNd=new NlsNode(((id==null||id=="")?("int"+(++this.nCnt)):id),capt,url,ic,exp,chk,xtra,title,add,yg_id,yg_type,yg_property,pname);nNd.id=this.genIntId(nNd.orgId);if(this.nLst[nNd.id]!=null){alert("Item with id "+id+" already exist");return;}
this.nLst[nNd.id]=nNd;nNd.pr=nd.pr;nNd.nx=nd;if(nd.pv==null){nd.pv=nNd;nd.pr.fc=nNd;}else{nNd.pv=nd.pv;nd.pv.nx=nNd;nd.pv=nNd;}
return nNd;};NLSTREE.addAfter=function(id,sib,capt,url,ic,exp,chk,xtra,title,add,yg_id,yg_type,yg_property,pname){var nd=this.getNodeById(sib);if(nd==null)return;var nNd=new NlsNode(((id==null||id=="")?("int"+(++this.nCnt)):id),capt,url,ic,exp,chk,xtra,title,add,yg_id,yg_type,yg_property,pname);nNd.id=this.genIntId(nNd.orgId);if(this.nLst[nNd.id]!=null){alert("Item with id "+id+" already exist");return;}
this.nLst[nNd.id]=nNd;nNd.pr=nd.pr;nNd.pv=nd;if(nd.nx==null){nd.nx=nNd;nd.pr.lc=nNd;}else{nNd.nx=nd.nx;nd.nx.pv=nNd;nd.nx=nNd;}
return nNd;};NLSTREE.append=function(id,prn,capt,url,ic,exp,chk,xtra,title,add,yg_id,yg_type,yg_property,pname){var nd=this.add(id,prn,capt,url,ic,exp,chk,xtra,title,add,yg_id,yg_type,yg_property,pname);this.reloadNode(prn);return nd;};NLSTREE.remove=function(id,reload){var rNd=(id!=null?this.nLst[this.genIntId(id)]:this.selNd);if(rNd!=null){if(this.rt.equals(rNd)){this.rt=null;this.nLst=new Object();this.selNd=null;this.selElm=null;return rNd};if(this.selNd&&rNd.equals(this.selNd)){this.selNd=null;this.selElm=null;}
var pr=rNd.pr;if(pr.lc.equals(rNd))pr.lc=rNd.pv;if(pr.fc.equals(rNd))pr.fc=rNd.nx;if(rNd.pv!=null)rNd.pv.nx=rNd.nx;if(rNd.nx!=null)rNd.nx.pv=rNd.pv;rNd.nx=null;rNd.pv=null;rNd.pr=null;var treeId=this.tId;this.loopTree(rNd,function(n){nlsTree[treeId].nLst[n.id]=null;});if(this.opt.multiSel){delete this.msNds[rNd.id];}
if(reload==null||reload)this.reloadNode(this.genOrgId(pr.id));}
return rNd;};NLSTREE.removeSelected=function(){var sNds=this.getSelNodes();for(var i=0;i<sNds.length;i++){this.remove(sNds[i].orgId);}}
NLSTREE.removeChilds=function(id,reload){var rNd=(id!=null?this.nLst[this.genIntId(id)]:this.selNd);if(rNd!=null){while(rNd.fc)this.remove(rNd.fc.orgId,false);if(reload==null||reload)this.reloadNode(id);}};NLSTREE.getSelNode=function(){return this.selNd;};NLSTREE.getSelNodes=function(){var a=[];if(this.opt.multiSel){for(var it in this.msNds){if(this.msNds[it]instanceof NlsNode)a[a.length]=this.msNds[it];}}else
if(this.selNd!=null){a[0]=this.selNd;}
return a;}
NLSTREE.isSelected=function(orgId){var nd=this.getNodeById(orgId);var sNds=this.getSelNodes();for(var i=0;i<sNds.length;i++){if(nd.id==sNds[i].id)return true;}
return false;}
NLSTREE.genTree=function(){return this.renderer.genTree();};NLSTREE.genAttrib=function(){var attr="<input id='ndedt"+this.tId+"' type='text' class='"+this.opt.stlprf+"nodeedit' style='display:none' value='' onblur='if (nlsTree."+this.tId+"._fl) nlsTree."+this.tId+".liveNodeWrite()'>";if(typeof(nlsctxmenu)!="undefined"){for(var it in nlsctxmenu){if(nlsctxmenu[it]instanceof NlsCtxMenu){if(!NlsGetElementById(it))attr+=nlsctxmenu[it].genMenu();}}}
return attr;}
NLSTREE.renderAttributes=function(plc){var oPl=(plc?NlsGetElementById(plc):null);if(oPl)oPl.innerHTML="";var attr=this.genAttrib();if(oPl)oPl.innerHTML=attr;else document.write(attr);};NLSTREE.render=function(plc){var dv=NlsGetElementById(this.tId+"$attr");if(!dv){dv=document.createElement("SPAN");dv.id=this.tId+"$attr";document.body.insertBefore(dv,document.body.childNodes[0]);}else{dv.innerHTML="";}
dv.innerHTML=this.genAttrib();if(this.opt.renderOnDemand)this.renderer.genNodes=DefRenderer.$genNodes;this.renderer.render(plc);this.initEvent();this.selNd=null;this.selElm=null;var sid=null;if(this.opt.mntState&&nls_getCookie){var sid=nls_getCookie(this.tId+"_selnd");nls_maintainNodeState(this.tId,true);}
if(sid&&sid!="")this.selectNodeById(sid);};NLSTREE.renderTo=function(id,incCh){var n=this.getNodeById(id),tmp=n,apt=[];if(incCh&&n.fc&&!NlsGetElementById(n.fc.id)){apt[apt.length]=n;}
while(tmp){if(NlsGetElementById(tmp.id))break;apt[apt.length]=tmp.pr;tmp=tmp.pr;}
for(var i=apt.length;i>0;i--){this.reloadNode(apt[i-1].orgId);}}
function DefRenderer(tId){var tr=nlsTree[tId];this.tr=tr;this.rat=new Object();this.rat_noclick=new Object();this.dsp=new Object();this.initRender=function(){var opt=tr.opt;var ico=tr.ico;var ev="onclick=\"if($K.yg_selectNode(this,event)) return nls_c2(event, '"+tId+"','@id')\" ";if(opt.evDblClick)ev+="ondblclick=\"return nls_c3(event, '"+tId+"', '@id')\" ";if(opt.evCtxMenu)ev+="oncontextmenu=\"return nls_c4(event, '"+tId+"', '@id')\" ";if(opt.evMouseUp)ev+="onmouseup=\"return nls_c5(event, '"+tId+"', '@id')\" ";if(opt.evMouseDown)ev+="onmousedown=\"return nls_c6(event, '"+tId+"', '@id')\" ";if(Prototype.Browser.IE)ev+="ondblclick=\"return nls_c2(event, '"+tId+"','@id')\" ";ev+="onmouseover=\"if ((this._onmouseover!=undefined)&&(typeof(this._onmouseover)=='function')) this._onmouseover(event); return nls_c7(event, '"+tId+"', '@id')\" ";var evho="onmouseover=\"if ((this._onmouseover!=undefined)&&(typeof(this._onmouseover)=='function')) this._onmouseover(event); return nls_c7(event, '"+tId+"', '@id')\" ";if(opt.evMouseOut)ev+="onmouseout=\"return nls_c8(event, '"+tId+"', '@id')\" ";if(opt.evMouseMove)ev+="onmousemove=\"return nls_c9(event, '"+tId+"', '@id')\" ";var cbev="onclick=\"nls_cb1(event, '"+tId+"','@id')\"";var ex=["<img src='@expdr' onclick=\"nls_c1(event, '"+tId+"', '@id')\" onmouseover=\"nls_c11(event, '"+tId+"', '@id')\" onmouseout=\"nls_c12(event, '"+tId+"', '@id')\">","<img src='@expdr'>","<img class=\"tree_ico\" src='@ic'>"];this.rat["cnt"]=["<div "+ev+" id='@id' class='"+opt.stlprf+"row' title=\"@title\">","<div id='@id' class='"+opt.stlprf+"row' title=\"@title\" style='display:none'>","</div><div style='display:block' id='ch_@id'>","</div><div style='display:none' id='ch_@id'>"];this.rat_noclick["cnt"]=["<div "+evho+" id='@id' class='"+opt.stlprf+"row noclick' title=\"@title\">","<div id='@id' class='"+opt.stlprf+"row' title=\"@title\" style='display:none'>","</div><div style='display:block' id='ch_@id'>","</div><div style='display:none' id='ch_@id'>"];this.rat["ex"]=[[[ex[1].replace(/@expdr/gi,ico.lnb),ex[1].replace(/@expdr/gi,ico.lb)],[ex[1].replace(/@expdr/gi,ico.lnb),ex[1].replace(/@expdr/gi,ico.lb)]],[[ex[0].replace(/@expdr/gi,ico.pnb),ex[0].replace(/@expdr/gi,ico.pb)],[ex[0].replace(/@expdr/gi,ico.mnb),ex[0].replace(/@expdr/gi,ico.mb)]]];this.rat["mn"]=["<table cellspacing=0 cellpadding=0 border=0><tr><td nowrap>","</td><td nowrap>","</td><td nowrap>","</td><td nowrap>","</td><td width='100%'>","</td></tr></table>"];this.rat["ics"]=ex[2];this.rat["ic"]=[[ex[2].replace(/@ic/gi,ico.chd),ex[2].replace(/@ic/gi,ico.chd)],[ex[2].replace(/@ic/gi,ico.clf),ex[2].replace(/@ic/gi,(tr.opt.icAsSel?ico.clf:ico.opf))]];this.rat["rt"]=[ex[2].replace(/@ic/gi,ico.rot),[ex[0].replace(/@expdr/gi,ico.pnl),ex[0].replace(/@expdr/gi,ico.mnl)]];this.rat["ln"]=["<img src=\""+ico.bln+"\">","<img src=\""+ico.lin+"\">"];this.rat["ac"]=["<a class=\"@nstyle\" style='display:block'>@capt</a>","<a style='display:block;' target='@trg' href=\""];this.rat["st"]=[opt.stlprf+"node",opt.stlprf+"prnnode"];this.rat["cb"]=["<input style='height:14px;margin:1px' type='checkbox' id='cb_@id' name='cb_@id' "+cbev+" >","<input style='height:14px;margin:1px' type='checkbox' checked id='cb_@id' name='cb_@id' "+cbev+" >"];this.rat["rd"]=["<input style='height:14px;margin:1px' type='radio' name='rd_@id'>","<input style='height:14px;margin:1px' type='radio' checked name='rd_@id'>"];};this.genANode=function(sNd){this.dsp["ln"]="";this.dsp["ic"]="";this.dsp["chk"]="";var n=sNd.pr;if(tr.opt.indent)while(true){if(!n||n.equals(tr.rt)&&!tr.opt.showExpdr||(tr.opt.hideRoot&&(n.equals(tr.rt)||(!tr.opt.showExpdr&&n.pr.equals(tr.rt)))))break;this.dsp["ln"]=this.rat["ln"][(n.nx!=null?1:0)]+this.dsp["ln"];n=n.pr;}
if(sNd.custom!=null){this.dsp["nd"]=sNd.custom;this.dsp["ip"]=this.rat["ln"][0];return this.rat["mn"][0]+this.dsp["ln"]+this.rat["mn"][1]+this.dsp["ip"]+this.dsp["ic"]+this.rat["mn"][2]+this.dsp["chk"]+this.rat["mn"][4]+this.dsp["nd"]+this.rat["mn"][5];}else{var fc=1,ex=0,nx=1,rt=0;if(!sNd.fc){fc=0;sNd.exp=false;};if(sNd.svrLoad&&sNd.loaded==0){fc=1;}if(sNd.exp)ex=1;if(!sNd.nx)nx=0;if(sNd.id==tr.rt.id)rt=1;this.dsp["ip"]=this.rat["ex"][fc][ex][nx];if(rt==1){this.dsp["ip"]=(tr.opt.showExpdr?this.rat["rt"][1][ex]:"");}else
if(tr.opt.hideRoot&&!tr.opt.showExpdr&&sNd.pr.id==tr.rt.id){this.dsp["ip"]="";}
if(tr.opt.icon||rt==1){if(sNd.ic!=null){this.dsp["ic"]=this.rat["ics"].replace(/@ic/gi,sNd.ic[(!tr.opt.icAsSel&&sNd.ic[ex]?ex:0)]);}
else{this.dsp["ic"]=this.rat["ic"][fc][ex];if(rt==1)this.dsp["ic"]=this.rat["rt"][0];}}
if(sNd.url){this.dsp["nd"]=this.rat["ac"][1].replace(/@trg/gi,(sNd.trg==null?tr.opt.trg:sNd.trg))+sNd.url+"\">"+sNd.capt+"</a>";}
else{this.dsp["nd"]=this.rat["ac"][0].replace(/@capt/gi,sNd.capt);}
if(sNd.cstStyle!=""){this.dsp["nd"]=this.dsp["nd"].replace(/@nstyle/gi,sNd.cstStyle);}else{this.dsp["nd"]=this.dsp["nd"].replace(/@nstyle/gi,this.rat["st"][fc]);}
if(tr.opt.check&&sNd.checkbox){var c=tr.opt.checkOnLeaf;if(!c||(c&&fc==0))this.dsp["chk"]=this.rat["cb"][(sNd.chk?1:0)];}
if(sNd.pr&&sNd.pr.rad){this.dsp["chk"]=this.rat["rd"][(sNd.chk?1:0)].replace(/@id/gi,sNd.pr.id);}
return this.rat["mn"][0]+this.dsp["ln"]+this.rat["mn"][1]+this.dsp["ip"]+this.dsp["ic"]+this.rat["mn"][2]+this.dsp["chk"]+this.rat["mn"][3]+this.dsp["nd"]+this.rat["mn"][5];}};this.genNodes=function(sNd,incpar,wrt){var s="";if(incpar){if(sNd.xtra=='noclick'){s=this.rat_noclick["cnt"][(tr.opt.hideRoot&&sNd.equals(tr.rt)?1:0)]+this.genANode(sNd)+this.rat["cnt"][(sNd.fc&&sNd.exp?2:3)];}else{s=this.rat["cnt"][(tr.opt.hideRoot&&sNd.equals(tr.rt)?1:0)]+this.genANode(sNd)+this.rat["cnt"][(sNd.fc&&sNd.exp?2:3)];}};s=s.replace(/@id/gi,sNd.id).replace(/@title/gi,sNd.title);if(wrt)document.write(s);if(sNd.fc!=null){var chNode=sNd.fc;do{if(wrt)this.genNodes(chNode,true,wrt);else s=s+this.genNodes(chNode,true,wrt);chNode=chNode.nx;}while(chNode!=null)}
if(wrt){if(incpar)document.write("</div>");return"";}else{s=incpar?(s+"</div>"):s;return s;}};this.genTree=function(){this.initRender();return this.genNodes(tr.rt,true,false);};this.render=function(plc){var sc="class='"+this.tr.opt.stlprf+"nlstree' ";if(this.tr.opt.enbScroll)sc+="style='overflow:auto;height:"+this.tr.opt.height+";width:"+this.tr.opt.width+";' onmousemove=\"return nls_c10(event, '"+tId+"')\"";if(plc&&plc!=""){NlsGetElementById(plc).innerHTML="<div id=\""+tId+"\" "+sc+" >"+this.genTree()+"</div>";}else{this.initRender();document.write("<div id=\""+tId+"\" "+sc+" >");this.genNodes(tr.rt,true,true);document.write("</div>");}};return this;};DefRenderer.$genNodes=function(sNd,incpar,wrt){var s="",tr=this.tr;if(incpar){s=this.rat["cnt"][(tr.opt.hideRoot&&sNd.equals(tr.rt)?1:0)]+this.genANode(sNd)+this.rat["cnt"][(sNd.fc&&sNd.exp?2:3)];};s=s.replace(/@id/gi,sNd.id).replace(/@title/gi,sNd.title);if(wrt)document.write(s);var chNode=sNd.fc,tmp="";while(chNode){if(chNode.exp){if(wrt)this.genNodes(chNode,true,wrt);else s=s+this.genNodes(chNode,true,wrt);}else{if(chNode.xtra=='noclick'){tmp=this.rat_noclick["cnt"][0]+this.genANode(chNode)+this.rat["cnt"][(chNode.fc&&chNode.exp?2:3)]+"</div>";}else{tmp=this.rat["cnt"][0]+this.genANode(chNode)+this.rat["cnt"][(chNode.fc&&chNode.exp?2:3)]+"</div>";}
tmp=tmp.replace(/@id/gi,chNode.id).replace(/@title/gi,chNode.title);if(wrt)document.write(tmp);else s=s+tmp;}
chNode=chNode.nx;}
if(wrt){if(incpar)document.write("</div>");return"";}else{s=incpar?(s+"</div>"):s;return s;}};function $getAnchor(nd){if(nd)return nd.childNodes[0].childNodes[0].childNodes[0].childNodes[3].childNodes[0]}
NLSTREE.initEvent=function(){var orgEvent=(nls_isIE?document.body.onkeydown:window.onkeydown);if(!orgEvent||orgEvent.toString().search(/orgEvent/gi)<0){var newEvent=function(e){if(nlsTree.selectedTree)nlsTree.selectedTree.liveNodePress(nls_isIE?event:e);if(orgEvent)return orgEvent();};if(nls_isIE)document.body.onkeydown=newEvent;else window.onkeydown=newEvent;}};NLSTREE.reloadNode=function(id,incChd){this.renderer.initRender();var intId=this.genIntId(id);var cNode=this.nLst[intId];var dvN=NlsGetElementById("ch_"+intId);if(incChd!=false){var s=this.renderer.genNodes(cNode,false);if(dvN){dvN.innerHTML=s;if(dvN.innerHTML=="")dvN.style.display="none";}}
if(cNode.exp==true&&cNode.fc!=null&&dvN)dvN.style.display="";dvN=NlsGetElementById(intId);if(dvN){dvN.innerHTML="";dvN.innerHTML=this.renderer.genANode(cNode).replace(/@id/gi,intId);dvN.setAttribute("title",cNode.title);}
if(this.selNd!=null){var sId=this.selNd.id;this.selNd=null;this.selElm=null;this.selectNode(sId,true);}};NLSTREE.selNToggle=function(id){this.toggleNode(id);if(!this.selNd||this.selNd.id!=id)this.selectNode(id);if(this.tmId!=null){clearTimeout(this.tmId);this.tmId=null;}};function $pbsHasChild(n){return(n.fc||(n.svrLoad&&n.loaded==0));};function nls_setStyle(tree,sNd,sElm,selected){var prf=(selected?"sel":"");if((tree.opt.selRow)&&(sElm!=null))sElm.className=tree.opt.stlprf+prf+"row";ac=$getAnchor(sElm);if(ac)ac.className=(sNd.cstStyle!=""?prf+sNd.cstStyle:tree.opt.stlprf+prf+($pbsHasChild(sNd)?"prnnode":"node"));};function nls_setNodeIcon(tree,sNd,sElm,selected){if(tree.opt.icon){ic=sElm.childNodes[0].childNodes[0].childNodes[0].childNodes[1];if(ic.childNodes.length==2){ic=ic.childNodes[1];}else{ic=ic.childNodes[0];}
if(selected){if(sNd.ic!=null){if(nlsTreeIc[sNd.ic[1]?sNd.ic[1]:sNd.ic[0]]){ic.src=nlsTreeIc[sNd.ic[1]?sNd.ic[1]:sNd.ic[0]].src}}else{ic.src=nlsTreeIc[(sNd.id==tree.rt.id?tree.ico.rot:($pbsHasChild(sNd)?tree.ico.opf:tree.ico.chd))].src;}
if(ic.fixpng)ic.fixpng();}else{if(sNd.ic!=null){ic.src=nlsTreeIc[sNd.ic[0]].src}else{ic.src=nlsTreeIc[(sNd.id==tree.rt.id?tree.ico.rot:($pbsHasChild(sNd)?tree.ico.clf:tree.ico.chd))].src;}
if(ic.fixpng)ic.fixpng();}}};NLSTREE.selectNode=function(id,noTimeOut){nlsTree.selectedTree=this;if(this.opt.editable){var sNd=this.selNd;if(!NlsTree._blockEdit){if(this.liveNodeEditClicked&&(this.liveNodeEditClicked==id)){this.liveNodeEditStart(id);}}
if(!noTimeOut){this.liveNodeEditClicked=id;setTimeout("nlsTree."+this.tId+".liveNodeEditClicked = null;",400);}else{this.liveNodeEditClicked=null;}
var edt=NlsGetElementById("ndedt"+this.tId);if(edt&&edt.style.display==""){edt.style.display="none";edt.disabled=true;}}
var ac=null;var ic=null;var sNd=this.selNd;var sElm=this.selElm;if(sElm!=null){nls_setStyle(this,sNd,sElm,false);if(this.opt.icAsSel)nls_setNodeIcon(this,sNd,sElm,false);}
sNd=this.nLst[id];if(this.opt.renderOnDemand){this.renderTo(sNd.orgId);}
this.selNd=sNd;this.selElm=NlsGetElementById(id);sElm=this.selElm;nls_setStyle(this,sNd,sElm,true);if(this.opt.icAsSel)nls_setNodeIcon(this,sNd,sElm,true);if(this.opt.mntState&&nls_setCookie&&sNd)nls_setCookie(this.tId+"_selnd",sNd.orgId);if(this.opt.multiSel){this.msRemoveAll();this.msAdd(sNd);}};NLSTREE.selectNodeById=function(id){var node=this.getNodeById(id);if(!node)return;var tmp=node.pr;while(tmp!=null){this.expandNode(tmp.orgId);tmp=tmp.pr;}
this.selectNode(node.id,true);};NLSTREE.unselectNodeById=function(id){var nd=this.getNodeById(id);if(this.selNd!=null&&this.selNd.equals(nd)){var oNode=NlsGetElementById(nd.id)
if(this.opt.icAsSel)nls_setNodeIcon(this,nd,oNode,false);if(this.opt.mntState&&nls_setCookie)nls_removeCookie(this.tId+"_selnd");this.selNd=null;this.selElm=null;nls_setStyle(this,nd,oNode,false);}};NLSTREE.isChild=function(c,p){var nd=this.getNodeById(c);if(!nd)return false;var tmp=nd.pr;while(tmp!=null){if(tmp.orgId==p)return true;tmp=tmp.pr;}
return false;};NLSTREE.hasChild=function(id){var nd=this.getNodeById(id);return(nd.fc!=null);};NLSTREE.expandNode=function(id){var sNd=this.getNodeById(id);if((!sNd.exp&&sNd.fc)||(sNd.svrLoad&&sNd.loaded==0))this.toggleNode(sNd.id);};NLSTREE.expandNodes=function(ids){for(var i=0;i<ids.length;i++){var sNd=this.getNodeById(ids[i]);if(!sNd.exp&&sNd.fc){this.toggleNode(sNd.id);}else if(sNd.svrLoad&&sNd.loaded==0){this.toggleNodes(ids);break;}}};NLSTREE.collapseNode=function(id){var sNd=this.nLst[this.genIntId(id)];if(sNd.exp&&sNd.fc)this.toggleNode(sNd.id);};NLSTREE.prepareToggle=function(id){var sNd=this.selNd;if(sNd==null){this.selectNode(id);return;}
if(sNd.id==id)return;while(sNd!=null&&sNd.id!=id){sNd=sNd.pr;}
if(sNd==null)return;if(sNd.id==id)this.selectNode(id);};NLSTREE.toggleNode=function(id){var sNd=this.nLst[id];if(sNd.svrLoad&&sNd.loaded==0){this.ajaxLoadChildNodes(sNd.orgId);return;};if(this.opt.renderOnDemand){this.renderTo(sNd.orgId,true);}
var nd=NlsGetElementById("ch_"+id),ip=null;if(id!=this.rt.id||(id==this.rt.id&&this.opt.showExpdr)){ip=NlsGetElementById(id).childNodes[0].childNodes[0].childNodes[0].childNodes[1].childNodes[0];}
if(this.opt.hideRoot&&!this.opt.showExpdr&&sNd.pr&&sNd.pr.equals(this.rt))ip=null;if(sNd.exp){sNd.exp=false;nd.style.display="none";if(ip!=null&&sNd.fc!=null)ip.src=(id==this.rt.id?this.ico.pnl:(sNd.nx?this.ico.pb:this.ico.pnb));if(!this.opt.icAsSel)nls_setNodeIcon(this,sNd,NlsGetElementById(id),false);if(this.opt.mntState&&nls_delExpandedId)nls_delExpandedId(this.tId+"_ndstate",sNd.orgId);this.treeOnCollapse(sNd.orgId);if(this.opt.renderOnDemand){nd.innerHTML='';}}else{if(this.opt.oneExp&&sNd.pr){var tNd=sNd.pr.fc;while(tNd){if(tNd.id!=id&&tNd.exp)this.collapseNode(tNd.orgId);tNd=tNd.nx;}}
sNd.exp=true;nd.style.display="block";if(ip!=null&&sNd.fc!=null)ip.src=(id==this.rt.id?this.ico.mnl:(sNd.nx?this.ico.mb:this.ico.mnb));if(!this.opt.icAsSel)nls_setNodeIcon(this,sNd,NlsGetElementById(id),true);if(this.opt.mntState&&nls_addExpandedId)nls_addExpandedId(this.tId+"_ndstate",sNd.orgId);this.treeOnExpand(sNd.orgId);}};NLSTREE.toggleNodes=function(ids){this.ajaxLoadChildNodesList(ids);return;};NLSTREE.expandAll=function(id){var treeId=this.tId;var startNode=(!id?this.rt:this.getNodeById(id));this.loopTree(startNode,function(n){nlsTree[treeId].expandNode(n.orgId);});};NLSTREE.collapseAll=function(incPr,id){var treeId=this.tId;var startNode=(!id?this.rt:this.getNodeById(id));this.loopTree(startNode,function(n){if(n.fc&&(!startNode.equals(n)||incPr))nlsTree[treeId].collapseNode(n.orgId);});};NLSTREE.checkNode=function(intId,chkOvr){var nd=NlsGetElementById("cb_"+intId);var sNd=this.nLst[intId];if(arguments.length>1)nd.checked=chkOvr;sNd.chk=nd.checked;if(this.opt.checkIncSub){if(nd.checked==true){this.loopTree(sNd,$nlsCheck);}else{this.loopTree(sNd,$nlsUnCheck);}}
if(this.opt.checkParents){var t=sNd;if(nd.checked==true){while(t){$nlsCheck(t);t=t.pr;};}else{var t2,fl=false;while(t){$nlsUnCheck(t);t2=t;if(t2.pr!=null)t2=t2.pr.fc;while(t2){if(t2.chk==true){fl=true;break;}t2=t2.nx;}
if(fl)break;t=t.pr;};}}};function $nlsCheck(sNd){$setCheck(sNd,true);}
function $nlsUnCheck(sNd){$setCheck(sNd,false);}
function $setCheck(sNd,f){if(!sNd.checkbox)return;var nd=NlsGetElementById("cb_"+sNd.id);if(nd)nd.checked=f;sNd.chk=f;}
NLSTREE.setNodeStyle=function(id,cls,rt){var nd=this.getNodeById(id);if(nd)nd.cstStyle=cls;if((rt)&&(nd)){var oNd=NlsGetElementById(nd.id);if(oNd){var ac=$getAnchor(oNd);ac.className=cls;}}};NLSTREE.setNodeCaption=function(id,capt){var intId=this.genIntId(id);var nd=$getAnchor(NlsGetElementById(intId));var sNd=this.nLst[intId];sNd.capt=capt;if(this.opt.sort=='no'){nd.innerHTML=capt;}else if(this.opt.sort=='asc'){var firstItem=sNd.pr.fc;var lastItem=sNd.pr.lc;var nodesArray=new Array();var currNode=firstItem;while(currNode!=lastItem){if(currNode.ic&&currNode.ic[0].indexOf('ico_folder')!=-1){nodesArray.push('__________'+currNode.capt.toLowerCase()+'<<<>>>'+currNode.orgId);}else{nodesArray.push(currNode.capt.toLowerCase()+'<<<>>>'+currNode.orgId);}
currNode=currNode.nx;}
if(lastItem.ic&&lastItem.ic[0].indexOf('ico_folder')!=-1){nodesArray.push('__________'+lastItem.capt.toLowerCase()+'<<<>>>'+lastItem.orgId);}else{nodesArray.push(lastItem.capt.toLowerCase()+'<<<>>>'+lastItem.orgId);}
nodesArray.sort();var newIdx=nodesArray.indexOf(sNd.capt.toLowerCase()+'<<<>>>'+sNd.orgId);if(newIdx==-1){newIdx=nodesArray.indexOf('__________'+sNd.capt.toLowerCase()+'<<<>>>'+sNd.orgId);}
if((nodesArray.length==1)||((newIdx==0)&&(sNd==firstItem))){nd.innerHTML=capt;}else if(newIdx==0){this.ctx_moveChild([sNd],firstItem,2);this.selectNode(intId,true);}else if(nodesArray.length>1){var prevNodeId=nodesArray[newIdx-1].split('<<<>>>')[1];var prevNodeIdInt=this.genIntId(prevNodeId);var prevNode=this.nLst[prevNodeIdInt];this.ctx_moveChild([sNd],prevNode,3);this.selectNode(intId,true);}}else if(this.opt.sort=='desc'){}};NLSTREE.getNodeById=function(id){return this.nLst[this.genIntId(id)]};NLSTREE.setGlobalCtxMenu=function(ctx){this.opt.evCtxMenu=true;this.ctxMenu=ctx;ctx.container=this;};NLSTREE.setNodeCtxMenu=function(id,ctx){this.opt.evCtxMenu=true;var nd=this.nLst[this.genIntId(id)];nd.ctxMenu=ctx;if(ctx.mId)ctx.container=this;};NLSTREE.setNodeTarget=function(id,trg){var nd=this.nLst[this.genIntId(id)];nd.trg=trg;};NLSTREE.setEditablity=function(id,v){var nd=this.nLst[this.genIntId(id)];nd.editablity=v;};NLSTREE.enableCheckbox=function(id,v){var nd=this.nLst[this.genIntId(id)];nd.checkbox=v;};NLSTREE.useIconSet=function(icSet){this.ico=icSet;preloadIcon(icSet.pnb,icSet.pb,icSet.pnl,icSet.mnb,icSet.mb,icSet.mnl,icSet.opf,icSet.clf,icSet.chd,icSet.rot,icSet.lnb,icSet.lb,icSet.lin,icSet.bln,icSet.lod);};NLSTREE.contextMenu=function(ev,id){if(!this.opt.enableCtx)return false;var sNd=this.nLst[id];var ctx=null;if(sNd.ctxMenu&&sNd.ctxMenu.mId)ctx=sNd.ctxMenu;else
if(sNd.ctxMenu=="DEFAULT")ctx=null;else
if(sNd.ctxMenu=="NONE")return false;else ctx=this.ctxMenu;if(!ctx)return true;if(this.opt.multiSel&&this.isSelected(sNd.orgId)){var sNds=this.getSelNodes();for(var i=0;i<sNds.length;i++){var t=(sNds[i].ctxMenu==null?this.ctxMenu:sNds[i].ctxMenu);if(t!=null&&t.mId!=ctx.mId){this.selectNode(id);break;}}}else{this.selectNode(id);}
if(this.tmId)clearTimeout(this.tmId);ctx.container=this;ctx.showMenu(ev.clientX,ev.clientY);return false;};NLSTREE.loopTree=function(sNd,act){act(sNd);if(sNd.fc!=null){var chNode=sNd.fc;do{this.loopTree(chNode,act);chNode=chNode.nx;}while(chNode!=null)}};NLSTREE.liveNodeEditStart=function(id){this.tmId=setTimeout("nlsTree."+this.tId+".liveNodeEdit('"+id+"')",0)};NLSTREE.liveNodeEdit=function(id){if(!this.nLst[id].editablity){this.tmId=null;return;}
if(this.tmId!=null){var edt=NlsGetElementById("ndedt"+this.tId);var ac=$getAnchor(NlsGetElementById(id));var x=0,y=0,elm=ac;while(elm){x+=elm.offsetLeft;y+=elm.offsetTop;elm=elm.offsetParent;}
elm=NlsGetElementById(this.tId);if(elm){y-=elm.scrollTop;x-=elm.scrollLeft;}
edt.disabled=false;var posAdj=this.editBoxPosAdj();edt.style.top=y+posAdj[1]+"px";edt.style.left=x+posAdj[0]+"px";edt.style.display="block";edt.focus();edt.value=this.nLst[id].capt;this.tmId=null;this.$editing=true;}};NLSTREE.liveNodeWrite=function(){var edt=NlsGetElementById("ndedt"+this.tId);if(edt.style.display=="none")return;var ac=$getAnchor(NlsGetElementById(this.selNd.id));if(edt.value!=""&&edt.value!=this.selNd.capt){if(this.treeOnBeforeNodeChange(this.selNd.orgId,this.tId)){var oldSelNd=this.selNd;this.setNodeCaption(this.selNd.orgId,edt.value);this.selNd=oldSelNd;this.treeOnNodeChange(this.selNd.orgId,this.tId);this.selectNodeById(this.selNd.orgId);}else{return;}}
edt.style.display="none";edt.disabled=true;this.$editing=false;};NLSTREE.liveNodePress=function(e){if(!this.opt.editable)return;if(e.keyCode==13){this._fl=false;this.liveNodeWrite();this._fl=true;}else if(e.keyCode==27){var edt=NlsGetElementById("ndedt"+this.tId);edt.style.display="none";edt.disabled=true;}else if(e.keyCode==this.opt.editKey){this.tmId=setTimeout("nlsTree."+this.tId+".liveNodeEdit('"+this.selNd.id+"')",10);}};NLSTREE.editBoxPosAdj=function(){return[0,0];};function nls_c1(e,tId,nId){Event.stop(e);nlsTree[tId].toggleNode(nId);};function nls_c2(e,tId,nId){var t=nlsTree[tId];var nd=t.nLst[nId];if(e&&(e.ctrlKey||e.metaKey)&&e.altKey){if(e.stopPropagation){e.stopPropagation();}else{e.cancelBubble=true};return t.contextMenu(e,nId);}
if(t.opt.multiSel){if(!nls_msTreeOnClick(e,tId,nId))return false;}
if((t.opt.oneClick||(t.opt.hideRoot&&t.rt.equals(nd.pr)))&&t.nLst[nId].fc){t.selNToggle(nId);}else{t.selectNode(nId);}
return t.treeOnClick(e,t.genOrgId(nId));};function nls_c3(e,tId,nId){var t=nlsTree[tId];if(t.nLst[nId].fc)t.selNToggle(nId);return t.treeOnDblClick(e,t.genOrgId(nId));};function nls_c4(e,tId,nId){var t=nlsTree[tId];return t.contextMenu(e,nId);};function nls_c5(e,tId,nId){var t=nlsTree[tId];return t.treeOnMouseUp(e,t.genOrgId(nId));};function nls_c6(e,tId,nId){target=(e.target)?(e.target):(e.srcElement);if((target.tagName=='IMG')&&(target.className!='tree_ico'))return;var t=nlsTree[tId];return t.treeOnMouseDown(e,t.genOrgId(nId));};function nls_c7(e,tId,nId){var t=nlsTree[tId];return t.treeOnMouseOver(e,t.genOrgId(nId));};function nls_c8(e,tId,nId){var t=nlsTree[tId];return t.treeOnMouseOut(e,t.genOrgId(nId));};function nls_c9(e,tId,nId){var t=nlsTree[tId];return t.treeOnMouseMove(e,t.genOrgId(nId));};function nls_c10(e,tId){var t=nlsTree[tId];return t.$treeMove(e);};function nls_c11(e,tId,nId){var t=nlsTree[tId];t.$expdrMove(e,t.genOrgId(nId));};function nls_c12(e,tId,nId){var t=nlsTree[tId];t.$expdrOut(e,t.genOrgId(nId));};function nls_cb1(e,tId,nId){var t=nlsTree[tId];t.checkNode(nId);t.treeOnCheck(t.genOrgId(nId));};NLSTREE.$expdrMove=function(e,id){}
NLSTREE.$expdrOut=function(e,id){}
NLSTREE.$treeMove=function(e){};NLSTREE.treeOnClick=function(e,id){return true;};NLSTREE.treeOnDblClick=function(e,id){};NLSTREE.treeOnMouseOver=function(e,id){};NLSTREE.treeOnMouseMove=function(e,id){};NLSTREE.treeOnMouseOut=function(e,id){};NLSTREE.treeOnMouseDown=function(e,id){};NLSTREE.treeOnMouseUp=function(e,id){};NLSTREE.treeOnCheck=function(id){};NLSTREE.treeOnExpand=function(id){};NLSTREE.treeOnCollapse=function(id){};NLSTREE.treeOnNodeChange=function(id){};NLSTREE.treeOnBeforeNodeChange=function(id){return true;};function preloadIcon(){var arg=preloadIcon.arguments,ic;for(var i=0;i<arg.length;i++){if(!arg[i])continue;ic=nlsTreeIc[arg[i]]
if(!ic){ic=new Image();ic.src=arg[i];nlsTreeIc[arg[i]]=ic;}}};function NlsGetElementById(id){if(document.all){return document.all(id);}else
if(document.getElementById){return document.getElementById(id);}};NlsTree.isEquals=function(a,b){if(!a||!b)return false;return(a.id==b.id);}
;var nlsctxmenu=new Object();function NlsCtxMenuItem(key,capt,url,ico,enb){this.key=key;this.intKey="";this.capt=capt;this.url=(!url||url==""?"":url);this.ico=ico;this.enable=(enb==null?true:enb);this.target="";return this;}
function NlsCtxMenu(mId){this.lsItm=null;this.genMenu=genMenu;this.reloadMenu=reloadMenu;this.mId=mId;this.items=new Object();this.container=null;this.count=0;this.stlprf="";this.active=false;this.target="";this.absWidth=0;this.add=addItem;this.addSeparator=addSeparator;this.enableItem=enableItem;this.setItemTarget=setItemTarget;this.itemClick=itemClick;this.showMenu=showMenu;this.hideMenu=hideMenu;this.menuOnClick=menuOnClick;this.menuOnShow=menuOnShow;this.menuOnHide=menuOnHide;nlsctxmenu[mId]=this;return this;}
function itemClick(itemID){if(!this.items[itemID].enable)return;this.hideMenu();var ids=itemID.split("_");return this.menuOnClick(this.container.selNd,ids[0],ids[1]);}
function genMenu(){var smenu="";var trg="";for(it in this.items){if(!(this.items[it]instanceof NlsCtxMenuItem))continue;if(this.items[it].capt=="-"){smenu+="<tr><td class=\""+this.stlprf+"ctxsidebar\" align=\"center\" style=\"font-size:3px\">&nbsp;</td><td style=\"height:7px;vertical-align:middle;padding-top:3px\"><div class=\"ctxseparator\">&nbsp;</div></td></tr>";}else{trg=this.items[it].target;if(trg=="")trg=this.target;smenu+="<tr id=\""+it+"\" onmouseover=\"ctxItemOver('"+it+"')\" onclick=\"return nlsctxmenu."+this.mId+".itemClick('"+it+"');\">"+"<td class=\""+this.stlprf+"ctxsidebar\" align=\"center\" nowrap>"+(this.items[it].ico?"<img src='"+this.items[it].ico+"' valign=middle>":"&nbsp;")+"</td>"+"<td class=\""+this.stlprf+"ctxitem\" nowrap><a style='display:block;' class=\""+this.stlprf+"ctxtext"+(this.items[it].enable?"":"disable")+"\" "+(this.items[it].url==""?"":"href=\""+this.items[it].url+"\" "+(trg!=""?"target=\""+trg+"\" ":""))+">"+this.items[it].capt+"</a></td></tr>";}}
smenu="<table border=0 cellpadding=0 cellspacing=0 "+(this.absWidth==0?"":"width='"+this.absWidth+"'")+">"+smenu+"</table>";if(arguments[0]&&arguments[0]=="content")return smenu;smenu="<div id='"+this.mId+"' class='"+this.stlprf+"ctxmenu' style='display:none'>"+smenu+"</div>";var isIE=(window.navigator.userAgent.indexOf("MSIE")>=0);var orgEvent=(isIE?document.body.onclick:window.onclick)
if(!orgEvent||orgEvent.toString().search(/orgEvent/gi)<0){var newEvent=function(){if(orgEvent)orgEvent();hideAllMenu();}
if(isIE)document.body.onclick=newEvent;else window.onclick=newEvent;}
return smenu;}
function reloadMenu(){var m=NlsGetElementById(this.mId);m.innerHTML=this.genMenu("content");}
function addItem(key,capt,url,ico,enb){var intKey=this.mId+"_"+key;var it=new NlsCtxMenuItem(key,capt,url,ico,enb);it.intKey=intKey;this.items[intKey]=it;this.count++;}
function addSeparator(){this.add("auto"+this.count,"-","","");}
function setItemTarget(key,target){var intKey=this.mId+"_"+key;this.items[intKey].target=target;}
function showMenu(x,y){hideAllMenu();if(this.lsItm!=null){setStyle(this.lsItm,"N");this.lsItm=null;}
var flag=this.menuOnShow(this.container.selNd);if(flag==false)return;var ctx=NlsGetElementById(this.mId);ctx.style.left=-500+"px";ctx.style.visibility="hidden";ctx.style.display="";var scrOffX=window.scrollX?window.scrollX:(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft);var scrOffY=window.scrollY?window.scrollY:(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop);var cW=(window.innerWidth?window.innerWidth:document.body.clientWidth);var cH=(window.innerHeight?window.innerHeight:document.body.clientHeight);var mW=ctx.childNodes[0].offsetWidth,mH=ctx.childNodes[0].offsetHeight;if(x+mW+5>cW){if(x>=mW){ctx.style.left=x-mW+scrOffX+"px";}else{ctx.style.left=cW-mW-5+scrOffX+"px";}}else{ctx.style.left=x+scrOffX+"px";}
if(y+mH+5>cH){if(y>=mH){ctx.style.top=y-mH+scrOffY+"px";}else{ctx.style.top=cH-mH-5+scrOffY+"px";}}else{ctx.style.top=y+scrOffY+"px";}
ctx.style.visibility="visible";this.active=true;}
function showMenuAbs(x,y){hideAllMenu();var ctx=NlsGetElementById(this.mId);ctx.style.top=y+"px";ctx.style.left=y+"px";ctx.style.display="";this.active=true;}
function hideMenu(){var ctx=NlsGetElementById(this.mId);ctx.style.display="none";this.active=false;if(this.lsItm!=null){setStyle(this.lsItm,"N");this.lsItm=null;}
this.menuOnHide();}
function hideAllMenu(){for(it in nlsctxmenu){if(nlsctxmenu[it].active)nlsctxmenu[it].hideMenu();}}
function enableItem(key,b){var intKey=this.mId+"_"+key;this.items[intKey].enable=b;setStyle(NlsGetElementById(intKey),(b?"N":"D"))}
function setStyle(it,s){var suff=(s=="O"?"over":"");it.cells[0].className="ctxsidebar"+suff;it.cells[1].className="ctxitem"+suff;it.cells[1].childNodes[0].className="ctxtext"+(s=="D"?"disable":(s=="OD"?"overdisable":suff));}
function ctxItemOver(it){var m=it.split("_");var oIt=NlsGetElementById(it);var li=nlsctxmenu[m[0]].lsItm;if(li!=null&&li.intKey==it)return;if(li!=null)setStyle(li,(nlsctxmenu[m[0]].items[li.id].enable?"N":"D"));setStyle(oIt,(nlsctxmenu[m[0]].items[it].enable?"O":"OD"));nlsctxmenu[m[0]].lsItm=oIt;}
NlsCtxMenu.prototype.setCaption=function(key,capt){var intKey=this.mId+"_"+key;this.items[intKey].capt=capt;var tr=NlsGetElementById(intKey);if(!tr)return;tr.cells[1].childNodes[0].innerHTML=capt;}
function menuOnClick(selNode,menuId,itemID){}
function menuOnShow(selNode){}
function menuOnHide(){}
;var nlsClipboard=new NlsClipboard();function NlsClipboard(act,cnt){this.clAction=act;this.clContent=cnt;this.consume=function(){this.clAction=null;this.clContent=null;}
return this;}
function isInClipboard(id){return _isInArray(id,nlsClipboard.clContent);}
function _isInArray(id,arr){if(arr==null)return false;for(var i=0;i<arr.length;i++){if(arr[i].id==id)return true;}
return false;}
function cut(nd){nlsClipboard.clAction="CUT";nlsClipboard.clContent=nd;}
function copy(nd){nlsClipboard.clAction="COPY";nlsClipboard.clContent=[];for(var i=0;i<nd.length;i++){var newNd=new NlsNode("",nd[i].capt,nd[i].url);newNd.ic=nd[i].ic;newNd.xtra=nd[i].xtra;newNd.chk=nd[i].chk;newNd.ctxMenu=nd[i].CtxMenu;nlsClipboard.clContent[i]=newNd;}}
function insertBefore(tree,nd){if(!nlsClipboard||!nlsClipboard.clAction)return;var clCnt=nlsClipboard.clContent;switch(nlsClipboard.clAction){case"CUT":var rNd=tree.ctx_moveChild(clCnt,nd,2);if(rNd){if(rNd.length==1){tree.selectNode(rNd[0].id);};nlsClipboard.consume();}
break;case"COPY":var newNd=tree.ctx_appendChild(clCnt,nd,2);break;}}
function insertAfter(tree,nd){if(!nlsClipboard||!nlsClipboard.clAction)return;var clCnt=nlsClipboard.clContent;switch(nlsClipboard.clAction){case"CUT":var rNd=tree.ctx_moveChild(clCnt,nd,3);if(rNd){if(rNd.length==1){tree.selectNode(rNd[0].id);};nlsClipboard.consume();}
break;case"COPY":var newNd=tree.ctx_appendChild(clCnt,nd,3);break;}}
function insertAsChild(tree,nd){if(!nlsClipboard||!nlsClipboard.clAction)return;var clCnt=nlsClipboard.clContent;switch(nlsClipboard.clAction){case"CUT":var rNd=tree.ctx_moveChild(clCnt,nd,1);if(rNd){if(rNd.length==1){tree.selectNode(rNd[0].id);};nlsClipboard.consume();}
break;case"COPY":var newNd=tree.ctx_appendChild(clCnt,nd,1);tree.expandNode(nd.orgId);break;}}
NLSTREE.ctx_liveAdd=function(prId){var selNode=this.nLst[this.genIntId(prId)];var newNode=this.append("",selNode.orgId,"New Node","","",false);this.expandNode(selNode.orgId);this.selectNode(newNode.id);this.liveNodeEditStart(newNode.id);}
NLSTREE.ctx_unloadChild=function(src){var pr=src.pr;if(pr.lc.equals(src))pr.lc=src.pv;if(pr.fc.equals(src))pr.fc=src.nx;if(src.pv!=null)src.pv.nx=src.nx;if(src.nx!=null)src.nx.pv=src.pv;src.nx=null;src.pv=null;src.pr=null;if(this.selNd){this.selNd=null;this.selElm=null;}
if(this.opt.multiSel){this.msRemove(src.orgId);}}
NLSTREE.ctx_appendChild=function(srcs,dest,type){if(!srcs||!dest||srcs.length==0)return;var newNd=null;var src=null;for(var i=0;i<srcs.length;i++){src=srcs[i];switch(type){case 1:newNd=this.append(src.orgId,dest.orgId,src.capt,src.url,(src.ic?src.ic.join(","):""),src.exp,src.chk,src.xtra);if(src.ctxMenu)this.setNodeCtxMenu(newNd.orgId,src.ctxMenu);break;case 2:if(dest.equals(this.rt))return;var newNd=new NlsNode("int"+(++this.nCnt),src.capt,src.url,(src.ic?src.ic.join(","):""),src.exp,src.chk,src.xtra);newNd.id=this.genIntId(newNd.orgId);this.nLst[newNd.id]=newNd;newNd.pr=dest.pr;if(dest.pv==null){dest.pv=newNd;dest.pr.fc=newNd;}else{newNd.pv=dest.pv;dest.pv.nx=newNd;dest.pv=newNd;}newNd.nx=dest;this.reloadNode(dest.pr.orgId);break;case 3:if(dest.equals(this.rt))return;var newNd=new NlsNode("int"+(++this.nCnt),src.capt,src.url,(src.ic?src.ic.join(","):""),src.exp,src.chk,src.xtra);newNd.id=this.genIntId(newNd.orgId);this.nLst[newNd.id]=newNd;newNd.pr=dest.pr;if(dest.nx==null){dest.nx=newNd;dest.pr.lc=newNd;}else{newNd.nx=dest.nx;dest.nx.pv=newNd;dest.nx=newNd;}newNd.pv=dest;this.reloadNode(dest.pr.orgId);break;}}
return newNd;}
NLSTREE.ctx_moveChild=function(src,dest,type){if(!src||!dest||src.length==0)return;if(isInClipboard(dest.id))return;switch(type){case 1:if(isInClipboard(this.rt.id))return;for(var i=0;i<src.length;i++){if(dest.equals(src[i].pr))return false;}
var tmp=dest;while(tmp.pr){if(isInClipboard(tmp.id))return;tmp=tmp.pr;}
for(var i=0;i<src.length;i++){var srcPr=src[i].pr;this.ctx_unloadChild(src[i]);this.reloadNode(srcPr.orgId);src[i].pr=dest;if(dest.lc==null){dest.fc=src[i];dest.lc=src[i];}else{var t=dest.fc;if(this.opt.sort!="no"){do{if(this.opt.sort=="asc"?this.compareNode(t,src[i]):this.compareNode(src[i],t))break;t=t.nx;}while(t!=null);if(t!=null){if(t.pv==null){t.pv=src[i];dest.fc=src[i];}else{src[i].pv=t.pv;t.pv.nx=src[i];t.pv=src[i];}src[i].nx=t;}}
if(this.opt.sort=="no"||t==null){src[i].pv=dest.lc;dest.lc.nx=src[i];dest.lc=src[i];}}}
this.reloadNode(dest.orgId);this.expandNode(dest.orgId);break;case 2:case 3:var sCh="pv";var dCh="nx";var ch="lc";if(type==2){sCh="nx";dCh="pv";ch="fc";}
if(dest.equals(this.rt))return;for(var i=0;i<src.length;i++){if(src[i][sCh]&&dest.equals(src[i][sCh]))return;}
for(var i=0;i<src.length;i++){var srcPr=src[i].pr;this.ctx_unloadChild(src[i]);this.reloadNode(srcPr.orgId);src[i].pr=dest.pr;if(dest[dCh]==null){dest[dCh]=src[i];dest.pr[ch]=src[i];}else{src[i][dCh]=dest[dCh];dest[dCh][sCh]=src[i];dest[dCh]=src[i];}src[i][sCh]=dest;}
this.reloadNode(dest.pr.orgId);break;}
return src;}
;var nlsddSession=null;function NlsDDAction(){}
NlsDDAction.DD_INSERT="I";NlsDDAction.DD_APPEND="A";function NlsDDSession(sObj,sDt){this.srcObj=sObj;this.srcData=sDt;this.destObj=null;this.destData=null;this.action=null;this.consume=function(){this.srcObj=null;this.srcData=null;this.destObj=null;this.destData=null;this.action=null;}}
function I18N(){this.notAllowed="Not allowed!";}
function NlsTreeDD(treeId){this.tId=treeId;this.shiftToReorder=true;this.rtm={};var tr=nlsTree[treeId];tr.opt.evMouseUp=true;tr.opt.evMouseDown=true;tr.opt.evMouseOver=true;tr.opt.evMouseOut=true;tr.treeOnMouseUp=ddMouseUp;tr.treeOnMouseDown=ddMouseDown;tr.treeOnMouseOver=ddMouseOver;tr.treeOnMouseOut=ddMouseOut;tr.$treeMove=ddTreeMove;tr.$expdrMove=ddExpdrMove;tr.$expdrOut=ddExpdrOut;tr.ddHandler=this;this.tree=tr;this.startDrag=startDrag;this.endDrag=endDrag;this.ic=[new Image()];this.ic[0].src=$K.yg_cachedImages['blank'].src;this.i18n=new I18N();this.onNodeDrag=onNodeDrag;this.onNodeDrop=onNodeDrop;this.canDrag=canDragNode;this.canDrop=canDropNode;this.setTm=function(id,f,d){if(!this.rtm[id]){this.rtm[id]=setTimeout(f,d);}}
this.clearTm=function(id){if(this.rtm[id]){clearTimeout(this.rtm[id]);this.rtm[id]=null;}}
return this;}
function startDrag(e){var distX=(Event.pointerX(e)-window.ddMouseDownCoords.x);var distY=(Event.pointerY(e)-window.ddMouseDownCoords.y);if(distX<0)distX=-distX;if(distY<0)distY=-distY;if((distX<4)&&(distY<4))return;document.body.addClassName('drag');$K.yg_activeDragInfo.dragging=true;var ddPic=null;$K.log('DRAWING!! '+$K.yg_activeDragInfo.dropAllowed,$K.Log.DEBUG);if($('yg_ddGhost')){$('yg_ddGhost')._originalParent=undefined;if($K.yg_currentHover){var coords=new Array(e.clientX,e.clientY);target=e.target;if(Object.isUndefined(e.target))
target=e.srcElement;if(e.target&&e.target.hasClassName('noselection')&&e.target.up('.mk_contentarea'))
target=e.target.up('.mk_contentarea').down('ul');if((target.nodeName=='UL')&&(target.hasClassName('page_contentarea'))){if($('placeHolder'))
$('placeHolder').remove();if(Sortable._marker)
Sortable._marker.hide();var newPH=document.createElement('div');newPH.className='dropmarker';newPH.style.position='relative';newPH.style.top='-1px';newPH.style.left='0px';newPH.placeHolder=true;newPH.id='placeHolder';newPH.onmouseover=function(){if($('placeHolder')){$('placeHolder').hoverOverMarker=true;}}
newPH.onmouseout=function(){if($('placeHolder')){$('placeHolder').hoverOverMarker=false;}}
var dont_append=false;if(target.hasClassName('page_contentarea')){$(newPH).setStyle({width:(target.getWidth()+5)+'px',top:'5px'});if(target.childElements().length>1){dont_append=true;}}
if(!dont_append){target.appendChild(newPH);}
$K.yg_activeDragInfo.target=target;$K.yg_activeDragInfo.position='into';}else{(e.target)?e.target.id:e.srcElement.id;if(Prototype.Browser.IE){if(e.srcElement&&(e.srcElement.nodeName!='LI')&&$(e.srcElement).up('li')){var target=$(e.srcElement).up('li');}else if(e.srcElement){var target=e.srcElement;}else{var target=false;}}else{if(e.target&&(e.target.nodeName!='LI')&&$(e.target).up('li')){var target=$(e.target).up('li');}else if(e.target){var target=e.target;}else{var target=false;}}
if(target&&(target.nodeName=='LI')&&!target.hasClassName('mk_cblock')&&target.up('li.mk_cblock')){target=target.up('li.mk_cblock');}
if(!$K.yg_activeDragInfo.hoverOverTree){if(target&&(target.hasClassName('mk_cblock')||target.hasClassName('listitem'))){$K.yg_drawNeedles(coords,target);}}else{if(!Sortable._marker){_createSortableMarker();}
Sortable._marker.hide();}
if(e.target&&e.target.hasClassName('selectionmarker')&&(e.target.up().hasClassName('cntblockadd')))$K.yg_drawTopborder(e.target.up(0));if(e.target&&e.target.hasClassName('cntblockadd'))$K.yg_drawTopborder(e.target);}}else{if($('placeHolder'))$('placeHolder').remove();if(!$K.yg_activeDragInfo.dropAllowed)$K.yg_showNoDropMarker(true);}
var isSameLevel=false;if($K.yg_currentHover&&(this.tree.opt.nosamelevel=='true')&&$K.yg_activeDragInfo.hoverOverTree){var targetNode=this.tree.nLst[$K.yg_currentHover.id];var sourceNode=nlsddSession.srcData[0];if(targetNode&&targetNode.pr&&sourceNode.pr&&NlsTree.isEquals(targetNode.pr,sourceNode.pr)){var isSameLevel=true;$K.yg_setDropAllowed(false);}else{$K.yg_setDropAllowed(true);}}
if(nlsddSession.srcData[0].ic!=undefined){var customIcon=nlsddSession.srcData[0].ic[0];}else{var customIcon=nlsddSession.srcObj.ico.clf;}
if($('yg_ddGhost').down('img').src!=customIcon){$('yg_ddGhost').down('img').src=customIcon;}
if($('yg_ddGhostTree')){if($('yg_ddGhostTree').down('img')){if($('yg_ddGhostTree').down('img').src!=customIcon){$('yg_ddGhostTree').down('img').src=customIcon;}}}
if($K.yg_activeDragInfo.dropAllowed){if(Object.isUndefined(e.target))
e.target=e.srcElement;if(nlsddSession.action!=NlsDDAction.DD_APPEND){if(e.target.nodeName!='DIV'){var target=$(e.target).up('div');}else{var target=e.target;}
if(nlsddSession.srcObj){if((!e.target.hasClassName('cntblockadd'))&&(nlsddSession.srcObj.tId.startsWith('tags_'))){$K.yg_drawTopborder(null,true);}else if($K.yg_activeDragInfo.hoverOverTree){$K.yg_drawTopborder(target);}}}
if($('yg_ddGhostTree')){if($('yg_ddGhostTree').down('img')){if($('yg_ddGhostTree').down('img').src!=customIcon){$K.yg_showNoDropMarker(false);}}}}else{$K.log('Remove needle!',$K.yg_activeDragInfo.overNeedle,$K.Log.DEBUG);if(!$K.yg_activeDragInfo.overNeedle){$K.yg_drawTopborder(null,true);}
if(Sortable._marker){if(!Sortable._marker.hoverOverMarker){Sortable._marker.hide();if($('placeHolder')){if(!$('placeHolder').hoverOverMarker){$('placeHolder').remove();}}
$K.yg_showNoDropMarker(true);}}}}
var g=NlsGetElementById('yg_ddGhostTree');var w=window,d=document.body,de=document.documentElement;var scrOffX=w.scrollX||d.scrollLeft||de.scrollLeft;var scrOffY=w.scrollY||d.scrollTop||de.scrollTop;g.style.left=e.clientX+scrOffX+5+"px";g.style.top=e.clientY+scrOffY+5+"px";if(g.style.display=="none"){var d=nlsddSession.srcData;for(var i=0;i<d.length;i++){var elm=NlsGetElementById(d[i].id).childNodes[0].childNodes[0].childNodes[0].childNodes[1];var imgEl=null;if(nlsddSession.srcObj.opt.icon){imgEl=elm.childNodes[(elm.childNodes.length>1?1:0)];}
var ddPic=imgEl.src;if(imgEl&&$('yg_ddGhostTree').down('img')){ddPic=$('yg_ddGhostTree').down('img').src;}}
$('yg_ddGhostTree').down('img').src=ddPic;if(i==1){$('yg_ddGhostTree').down('.node').innerHTML=d[0].capt;}else{$('yg_ddGhostTree').down('.node').innerHTML="("+i+" "+$K.TXT('TXT_OBJECTS')+")";}
$('yg_ddGhostTree').setStyle({display:'block'});}
this.onNodeDrag(e);}
function endDrag(e){document.body.removeClassName('drag');$K.yg_drawTopborder(null,true);var g=NlsGetElementById('yg_ddGhostTree');g.style.display="none";if(Sortable._marker){Sortable._marker.hide();if($('placeHolder')){if(!$('placeHolder').hoverOverMarker){$('placeHolder').remove();}}
$('yg_ddGhost').down('img').src=$K.yg_cachedImages['blank'].src;}
$K.yg_activeDragInfo.target=null;$K.yg_activeDragInfo.position=null;$K.yg_activeDragInfo.dragging=false;document.onmousemove=null;document.onmouseup=null;document.onmousedown=function(){return true;}
document.onselectstart=function(){return true;}
document.ondragstart=function(){return true;}
this.clearTm("tmExp");if(this.tree.rtm.tmSc){clearInterval(this.tree.rtm.tmSc);this.tree.rtm.tmSc=null;}}
function getTargetId(t,e,id){if(nls_isIE){var nd=t.nLst[e.srcElement.parentElement.parentElement.parentElement.parentElement.parentElement.id];if(nd){return nd.orgId;}else{return id;}}else{return id;}}
function ddMouseUp(e,id){var nd=this.getNodeById(getTargetId(this,e,id));if($('yg_ddGhost')){if($('yg_ddGhost').style.display!='none'){nlsddSession=new NlsDDSession(this,nd);nlsddSession.destObj=this;nlsddSession.destData=nd;this.ddHandler.endDrag(e);this.ddHandler.onNodeDrop(e);nlsddSession=null;}}
if(!nlsddSession)return false;if(!this.ddHandler.canDrop(nd.orgId))return false;nlsddSession.destObj=this;nlsddSession.destData=nd;this.ddHandler.endDrag(e);this.ddHandler.onNodeDrop(e);}
function ddMouseDown(e,id){window.ddMouseDownCoords={x:Event.pointerX(e),y:Event.pointerY(e)};if(this.$editing)return;var ddHd=this.ddHandler,cNd=this.getNodeById(id),intId=cNd.id,sNd=this.selNd;NlsTree._blockEdit=false;if(this.opt.multiSel){if(!this.isSelected(id)&&!e.ctrlKey&&!e.metaKey){if(!e.shiftKey||!sNd||!NlsTree.isEquals(cNd.pr,sNd.pr)){NlsTree._blockEdit=true;this.selectNode(intId);}}}else{if(this.selNd==null||this.selNd.id!=intId){this.selectNode(intId);NlsTree._blockEdit=true;}}
if(!this.isSelected(id))return;var nd=this.getSelNodes();if(ddHd.canDrag(id)){nlsddSession=new NlsDDSession(this,nd);document.onmousemove=function(ev){ddHd.startDrag((ev?ev:event));}
document.onmouseup=function(ev){nlsddSession.action=null;ddHd.endDrag((ev?ev:event));}
document.onselectstart=function(){return false;}
document.onmousedown=function(){return false;}
document.ondragstart=function(){return false;}}}
function ddMouseOver(e,id){if(!$K.yg_activeDragInfo.dragging)return;if(this.tId.endsWith('_tree')){var target_tree=$(this.tId).up(1);}else{var target_tree=$(this.tId);}
if($('yg_ddGhost')&&$('yg_ddGhost').srcReference){var yg_ddGhost=$('yg_ddGhost');if(yg_ddGhost.srcReference.element.parentNode){if(yg_ddGhost._originalParent!=undefined){var source_tree=Sortable.sortables[yg_ddGhost._originalParent.id];}}}
if(source_tree&&target_tree.accepts){var treeNode=$(this.tId+id);var treeNodeLink=treeNode.down('a');if((target_tree.accepts.split(',').indexOf(source_tree.objectType)!=-1)&&!treeNodeLink.hasClassName('nodrop')&&(!((source_tree.objectType=='file')&&id.endsWith('root_1')))){$K.yg_setDropAllowed(true);$K.yg_activeDragInfo.target=target_tree;$K.yg_activeDragInfo.hoverOverTree=true;$K.yg_activeDragInfo.overTreeNode=true;}else{$K.yg_setDropAllowed(false);$K.yg_activeDragInfo.dropAllowed=false;$K.yg_activeDragInfo.overTreeNode=false;}}
if(Sortable._marker)Sortable._marker.hide();if($('placeHolder'))$('placeHolder').remove();if((nlsddSession==null)||(document.onmousemove==null))return;var ddHd=this.ddHandler;var trgId=getTargetId(this,e,id);if(nlsddSession.srcObj.tId.endsWith('_tree')){var source_tree=$(nlsddSession.srcObj.tId).up(1);}else{var source_tree=$(nlsddSession.srcObj.tId);}
$K.log('TARGET: IsType: '+target_tree.yg_type+', '+'Accepting: '+target_tree.accepts,$K.Log.DEBUG);$K.log('SOURCE: IsType: '+source_tree.yg_type+', '+'Accepting: '+source_tree.accepts,$K.Log.DEBUG);var treeNode=$(this.tId+id);var treeNodeLink=treeNode.down('a');if(target_tree.accepts&&(target_tree.accepts.split(',').indexOf(source_tree.yg_type)!=-1)&&!treeNodeLink.hasClassName('nodrop')){nlsddSession.destObj=this;$K.yg_setDropAllowed(true);$K.yg_activeDragInfo.overTreeNode=true;$K.yg_activeDragInfo.treeNodeLink=treeNodeLink;}else{$K.log('_NOT_ ACCEPTED!!!',$K.Log.WARN);$K.yg_setDropAllowed(false);$K.yg_activeDragInfo.dropAllowed=false;$K.yg_activeDragInfo.overTreeNode=true;$K.yg_activeDragInfo.treeNodeLink=treeNodeLink;}
$K.yg_activeDragInfo.hoverOverTree=true;if(!ddHd.canDrop(trgId)){var g=NlsGetElementById('yg_ddGhostTree');g.style.display="block";$K.yg_clearPlaceHolder();}
var me=this;ddHd.setTm("tmExp",function(){me.expandNode(id)},1000);};function ddExpdrMove(e,id){if(nlsddSession!=null&&document.onmousemove!=null){}else{return;}
var me=this;this.ddHandler.setTm("tmExp",function(){me.expandNode(id)},1000);};function ddExpdrOut(e,id){this.ddHandler.clearTm("tmExp");};function ddMouseOut(e,id){$K.yg_activeDragInfo.hoverOverTree=false;$K.yg_activeDragInfo.dropAllowed=false;$K.yg_activeDragInfo.overTreeNode=false;if(nlsddSession!=null&&document.onmousemove!=null){}else{return;}
var g=NlsGetElementById('yg_ddGhostTree');g.style.display="none";var ddHd=this.ddHandler;ddHd.clearTm("tmExp");};function ddTreeMove(e){if(nlsddSession!=null&&document.onmousemove!=null){}else{return;}
if(!this.rtm.tDom)this.rtm.tDom=NlsGetElementById(this.tId);var tD=this.rtm.tDom;if(!this.rtm.tH){this.rtm.tH=tD.offsetHeight;}
var p=$getPos(tD);var d=document,de=d.documentElement;var scY=de.scrollTop||d.body.scrollTop||window.scrollY||0;if(e.clientY+scY-p.y>this.rtm.tH-30){if(!this.rtm.tmSc)this.rtm.tmSc=setInterval(function(){$scrollTree(tD,20)},100);}else
if(e.clientY+scY-p.y<30){if(!this.rtm.tmSc)this.rtm.tmSc=setInterval(function(){$scrollTree(tD,-20)},100);}else{clearInterval(this.rtm.tmSc);this.rtm.tmSc=null;}};function $scrollTree(tDom,v){tDom.scrollTop=parseInt(tDom.scrollTop,10)+v;}
function $getPos(o){var t=o,x=0,y=0;while(t){x+=t.offsetLeft;y+=t.offsetTop;t=t.offsetParent;}
return{"x":x,"y":y};};function onNodeDrag(e){if(this.shiftToReorder){nlsddSession.action=(e.shiftKey?NlsDDAction.DD_INSERT:NlsDDAction.DD_APPEND);if(e.shiftKey){if($K.yg_activeDragInfo.dropAllowed){if(e.target.nodeName!='DIV'){var target=$(e.target).up('div');}else{var target=e.target;}
$K.yg_drawTopborder(null,true);}}}else{nlsddSession.action=(e.shiftKey?NlsDDAction.DD_APPEND:NlsDDAction.DD_INSERT);if(e.shiftKey){$K.yg_drawTopborder(null,true);}}}
function onNodeDrop(e){if(!nlsddSession)return;var sData,dData,sObj,dObj;with(nlsddSession){if(!action)return;sData=srcData;sObj=srcObj;dData=destData;dObj=destObj;}
if(sObj.tId==dObj.tId){switch(nlsddSession.action){case NlsDDAction.DD_INSERT:sObj.moveChild(sData,dData,2);break;case NlsDDAction.DD_APPEND:sObj.moveChild(sData,dData,1);break;}}else{switch(nlsddSession.action){case NlsDDAction.DD_INSERT:for(i=0;i<sData.length;i++){with(sData[i]){var nNd=dObj.addBefore(null,dData.orgId,capt,url,(ic?ic.join(","):ic),exp,chk,xtra,title);if(fc)duplicateNode(fc,nNd);}}
dObj.reloadNode(dData.pr.orgId);break;case NlsDDAction.DD_APPEND:for(i=0;i<sData.length;i++){with(sData[i]){var nNd=dObj.append(null,dData.orgId,capt,url,(ic?ic.join(","):ic),exp,chk,xtra,title);if(fc)duplicateNode(fc,nNd);}}
dObj.reloadNode(nNd.orgId);dObj.expandNode(dData.orgId);break;}}}
function duplicateNode(n,newNd){do{var cN=nlsddSession.destObj.add(null,newNd.orgId,n.capt,n.url,(n.ic?n.ic.join(","):n.ic),n.exp,n.chk,n.xtra,n.title);if(n.fc){duplicateNode(n.fc,cN);}
n=n.nx;}while(n);}
function canDragNode(id){if(this.tree.opt.multiSel){var sNds=this.tree.getSelNodes();for(var i=0;i<sNds.length;i++){if(sNds[i].allowDrag==false)return false;}}else{if(this.tree.getNodeById(id).allowDrag==false)return false;}
return true;}
function canDropNode(id){var dest=this.tree.getNodeById(id);var src=nlsddSession.srcData;if(!nlsddSession.srcObj)return;var inTree=(nlsddSession.srcObj.tId==this.tree.tId);if(!nlsddSession)return false;if(!nlsddSession.action)return false;if(!src||!dest||src.length==0)return false;if(inTree){if(this.tree.isSelected(dest.orgId))return false;var tmp=dest;while(tmp.pr){if(this.tree.isSelected(tmp.orgId))return false;tmp=tmp.pr;}
switch(nlsddSession.action){case NlsDDAction.DD_INSERT:if(dest.equals(this.tree.rt))return false;for(var i=0;i<src.length;i++){if(src[i].nx&&dest.equals(src[i].nx))return false;}
break;case NlsDDAction.DD_APPEND:if(this.tree.isSelected(this.tree.rt.orgId))return false;for(var i=0;i<src.length;i++){if(dest.equals(src[i].pr))return false;}
break;}}else{switch(nlsddSession.action){case NlsDDAction.DD_INSERT:if(dest.equals(this.tree.rt))return false;case NlsDDAction.DD_APPEND:break;}}
return true;};NlsTree._allowEdit=false;NLSTREE.ddHandler=null;NLSTREE.unloadChild=function(src){var pr=src.pr;if(pr.lc.equals(src))pr.lc=src.pv;if(pr.fc.equals(src))pr.fc=src.nx;if(src.pv!=null)src.pv.nx=src.nx;if(src.nx!=null)src.nx.pv=src.pv;src.nx=null;src.pv=null;src.pr=null;if(this.selNd){this.selNd=null;this.selElm=null;}
if(this.opt.multiSel){this.msRemove(src.orgId);}}
NLSTREE.moveChild=function(src,dest,type){if(!src||!dest||src.length==0)return;if(this.isSelected(dest.orgId))return;var tmp=dest;while(tmp.pr){if(this.isSelected(tmp.orgId))return;tmp=tmp.pr;}
switch(type){case 1:if(this.isSelected(this.rt.orgId))return;for(var i=0;i<src.length;i++){if(dest.equals(src[i].pr))false;}
for(var i=0;i<src.length;i++){var srcPr=src[i].pr;this.unloadChild(src[i]);this.reloadNode(srcPr.orgId);src[i].pr=dest;if(dest.lc==null){dest.fc=src[i];dest.lc=src[i];}else{var t=dest.fc;if(this.opt.sort!="no"){do{if(this.opt.sort=="asc"?this.compareNode(t,src[i]):this.compareNode(src[i],t))break;t=t.nx;}while(t!=null);if(t!=null){if(t.pv==null){t.pv=src[i];dest.fc=src[i];}else{src[i].pv=t.pv;t.pv.nx=src[i];t.pv=src[i];}src[i].nx=t;}}
if(this.opt.sort=="no"||t==null){src[i].pv=dest.lc;dest.lc.nx=src[i];dest.lc=src[i];}}}
this.reloadNode(dest.orgId);this.expandNode(dest.orgId);break;case 2:case 3:var sCh="pv";var dCh="nx";var ch="lc";if(type==2){sCh="nx";dCh="pv";ch="fc";}
if(dest.equals(this.rt))return;for(var i=0;i<src.length;i++){if(src[i][sCh]&&dest.equals(src[i][sCh]))return;}
for(var i=0;i<src.length;i++){var srcPr=src[i].pr;this.unloadChild(src[i]);this.reloadNode(srcPr.orgId);src[i].pr=dest.pr;if(dest[dCh]==null){dest[dCh]=src[i];dest.pr[ch]=src[i];}else{src[i][dCh]=dest[dCh];dest[dCh][sCh]=src[i];dest[dCh]=src[i];}src[i][sCh]=dest;}
this.reloadNode(dest.pr.orgId);break;}}
function nls_setNodeDnD(t,id,prop,v,incSub){if(incSub==true){t.loopTree(t.getNodeById(id),function(nd){nd[prop]=v;});}else{t.getNodeById(id)[prop]=v;}}
NLSTREE.setDrag=function(id,v,incSub){nls_setNodeDnD(this,id,"allowDrag",v,incSub);};NLSTREE.setDrop=function(id,v,incSub){nls_setNodeDnD(this,id,"allowDrop",v,incSub);};NlsNode.prototype.allowDrag=true;NlsNode.prototype.allowDrop=true;
;StdOpt.prototype.multiSel=true;NLSTREE.treeOnSelectionAdd=function(id){return true;};NLSTREE.msToggle=function(nd){if(this.msNds[nd.id]!=null||(this.selNd!=null&&this.selNd.equals(nd))){this.msRemove(nd.orgId);}else{this.msAdd(nd);}};NLSTREE.msAdd=function(nd){if(nd==null)return;if(!this.treeOnSelectionAdd(nd.orgId)){return;}
if(this.getSelNodes().length==0){this.selNd=nd;this.selElm=NlsGetElementById(nd.id);}
var tmp=null;for(it in this.msNds){if(!(this.msNds[it]instanceof NlsNode))continue;tmp=this.msNds[it].pr;while(tmp!=null){if(tmp.equals(nd)){this.msRemove(this.msNds[it].orgId);break;}tmp=tmp.pr;}}
tmp=nd.pr;while(tmp!=null){if(this.isSelected(tmp.orgId))this.msRemove(tmp.orgId);tmp=tmp.pr;}
this.msNds[nd.id]=nd;nls_setStyle(this,nd,NlsGetElementById(nd.id),true);};NLSTREE.msRemove=function(orgId){var nd=this.getNodeById(orgId);if(this.selNd!=null&&this.selNd.equals(nd)){if(this.opt.icAsSel)nls_setNodeIcon(this,nd,NlsGetElementById(nd.id),false);if(this.opt.mntState&&nls_setCookie)nls_removeCookie(this.tId+"_selnd");this.selNd=null;this.selElm=null;}
nls_setStyle(this,nd,NlsGetElementById(nd.id),false);delete this.msNds[nd.id];};NLSTREE.msRemoveAll=function(){var nd=null;for(var it in this.msNds){nd=this.msNds[it];if(!(nd instanceof NlsNode))continue;if(this.selNd==null||!this.selNd.equals(nd)){nls_setStyle(this,nd,NlsGetElementById(nd.id),false);delete this.msNds[it];}}
if(this.selNd!=null)this.msRemove(this.selNd.orgId);};function nlsStopEvent(e){if(e.cancelBubble)e.cancelBubble=false;if(e.stopPropagation)e.stopPropagation();}
function nls_msTreeOnClick(e,tId,nId){var t=nlsTree[tId];var nd=t.nLst[nId];if(e&&(e.ctrlKey||e.metaKey)){t.msToggle(nd);nlsStopEvent(e);return false;}
if(e&&e.shiftKey){nlsStopEvent(e);var sp=t.getSelNode();var sps=t.getSelNodes();if(sps.length==1){sp=sps[0];}
if(sp&&sp.pr&&nd.pr&&nd.pr.equals(sp.pr)&&!nd.equals(sp)){t.msRemoveAll();var tmp=sp.pr.fc;var flag=false;while(tmp){if(tmp.equals(sp)||tmp.equals(nd)){t.msAdd(tmp);flag=!flag;}
if(flag)t.msAdd(tmp);tmp=tmp.nx;}}
return false;}
return true;}
;NlsTree.AJAX={};NlsNode.prototype.xmlOpn=function(){if(this.custom){return"<customnode id=\""+this.orgId+"\">"+this.custom+"</customnode>";}else{return"<node id=\""+this.orgId+"\" caption=\""+this.capt+"\" url=\""+this.url+"\" ic=\""+(this.ic==null?"":this.ic)+"\" exp=\""+this.exp+"\" chk=\""+this.chk+"\" cststyle=\""+this.cstStyle+"\" target=\""+this.trg+"\" title=\""+this.title+"\">";}};NlsNode.prototype.xmlCls=function(){return"</node>";};StdOpt.$prop=["enbScroll","height","width","trg","stlprf","sort","icon","check","editable","selRow","editKey","oneExp","enableCtx","oneClick","mntState","icAsSel","checkIncSub","checkOnLeaf","hideRoot","indent","evDblClick","evCtxMenu","evMouseUp","evMouseDown","evMouseMove","evMouseOut","evMouseOver"];StdOpt.prototype.toXML=function(){var s=[],j=0,pr=StdOpt.$prop;s[j++]="<options>\n";for(var i=0;i<pr.length;i++){s[j++]="  <opt name=\""+(pr[i]=="trg"?"target":pr[i].toLowerCase())+"\" value=\""+this[pr[i]]+"\"></opt>\n";}
s[j++]="</options>\n";return s.join("");};StdIco.$prop=["pnb","pb","pnl","mnb","mb","mnl","opf","clf","chd","rot","lnb","lb","lin","bln","lod"];StdIco.prototype.toXML=function(){var s=[],j=0,pr=StdIco.$prop;s[j++]="<icons>\n";for(var i=0;i<pr.length;i++){s[j++]="  <ico name=\""+pr[i]+"\" value=\""+this[pr[i]]+"\"></ico>\n";}
s[j++]="</icons>\n";return s.join("");};NLSTREE.nodeXML=function(sNd){sNd=(sNd==null?this.rt:sNd);var n=sNd;var spc="";while(n!=null&&!n.equals(this.rt)){spc+="  ";n=n.pr;}
var s=(spc+sNd.xmlOpn()+"\n");if(sNd.fc!=null){var chNode=sNd.fc;do{s+=this.nodeXML(chNode);chNode=chNode.nx;}while(chNode!=null)}
s+=(spc+sNd.xmlCls()+"\n");return s;};NLSTREE.toXML=function(){return"<tree id=\""+this.tId+"\">\n"+this.opt.toXML()+this.ico.toXML()+this.nodeXML(this.rt)+"</tree>";};function nls_addNodeXML(tree,prnId,xnd){for(var i=0;i<xnd.childNodes.length;i++){var nd=xnd.childNodes[i];if(nd.nodeType!=1)continue;if(nd.nodeName.toUpperCase()=="CUSTOMNODE"){tree.addCustomNode(nd.getAttribute("id"),prnId,nd.childNodes[0].nodeValue);continue;}
var newNd=tree.add(nd.getAttribute("id"),prnId,nd.getAttribute("caption"),nd.getAttribute("url"),nd.getAttribute("ic"),nd.getAttribute("exp")=="true",nd.getAttribute("chk")=="true",nd.getAttribute("xtra"),nd.getAttribute("title"),null,nd.getAttribute("yg_id"),nd.getAttribute("yg_type"),nd.getAttribute("yg_property"),nd.getAttribute("pname"));if(newNd){newNd.cstStyle=nd.getAttribute("cststyle");newNd.trg=nd.getAttribute("target");}
if(nd.getAttribute("svrload")=="true"){tree.setServerLoad(nd.getAttribute("id"),(nd.getAttribute("churl")=="null"?null:nd.getAttribute("churl")));}
if((newNd.cstStyle.indexOf('nosub')!=-1)&&(newNd.yg_type!='page')){tree.setDrop(nd.getAttribute("id"),false,false);}else{if(!tree.opt.sortable){tree.setDrop(nd.getAttribute("id"),false,false);}}
if(newNd.cstStyle.indexOf('nowrite')!=-1){tree.setEditablity(nd.getAttribute("id"),false);}else if(tree.opt.editable){tree.setEditablity(nd.getAttribute("id"),true);}
if(nd.getAttribute("dnd")=='false'){nls_setNodeDnD(tree,nd.getAttribute("id"),"allowDrag",false,false);}
if(nd.firstChild!=null)nls_addNodeXML(tree,newNd.orgId,nd);}};NLSTREE.addNodesXML=function(prn,rn,reload){if(rn==null)return;if(rn.nodeName.toUpperCase()=="CUSTOMNODE"){this.addCustomNode(rn.getAttribute("id"),prn,rn.childNodes[0].nodeValue);}else{nls_addNodeXML(this,prn,rn);}
if(reload){this.reloadNode(prn);}};NLSTREE.addNodesXMLString=function(prn,xml,reload){var xmlDom=nls_parseXML(xml);if(xmlDom)this.addNodesXML(prn,xmlDom.documentElement,reload);};NLSTREE.addChildNodesXML=function(rn,reload,updateParent){if(rn==null)return;if(updateParent){var nd=this.getNodeById(rn.getAttribute("id"));nd.capt=rn.getAttribute("caption");nd.url=rn.getAttribute("url");nd.ic=rn.getAttribute("ic")==""?null:rn.getAttribute("ic").split(",");nd.exp=rn.getAttribute("exp")=="true";nd.chk=rn.getAttribute("chk")=="true";nd.cstStyle=rn.getAttribute("cststyle");nd.trg=rn.getAttribute("target")=="null"?null:rn.getAttribute("target");nd.title=rn.getAttribute("title");nd.yg_id=rn.getAttribute("yg_id");nd.yg_type=rn.getAttribute("yg_type");nd.yg_property=rn.getAttribute("yg_property");nd.pname=rn.getAttribute("pname");if(rn.getAttribute("dnd")=='false'){nls_setNodeDnD(this,rn.getAttribute("id"),"allowDrag",false,false);}
$K.yg_addLookup(nd.yg_id,nd);}
nls_addNodeXML(this,rn.getAttribute("id"),rn);if(reload){this.reloadNode(rn.getAttribute("id"));}};NLSTREE.addChildNodesXMLString=function(xml,reload,updateParent){var xmlDom=nls_parseXML(xml);if(xmlDom)this.addChildNodesXML(xmlDom.documentElement,reload,updateParent);};NLSTREE.setOptionsByXML=function(xopt){var o=this.opt;for(var i=0;i<xopt.childNodes.length;i++){var n=xopt.childNodes[i];if(n.nodeType!=1)continue;var v=n.getAttribute("value");switch(n.getAttribute("name")){case"trg":case"target":o.trg=v;break;case"enbscroll":o.enbScroll=(v=="true");break;case"height":o.height=v;break;case"width":o.width=v;break;case"stlprf":o.stlprf=v;break;case"sort":o.sort=v;break;case"icon":o.icon=(v=="true");break;case"check":o.check=(v=="true");break;case"editable":o.editable=(v=="true");break;case"selrow":o.selRow=(v=="true");break;case"editkey":o.editKey=v;break;case"oneexp":o.oneExp=(v=="true");break;case"enablectx":o.enableCtx=(v=="true");break;case"oneclick":o.oneClick=(v=="true");break;case"mntstate":o.mnState=(v=="true");break;case"icassel":o.icAsSel=(v=="true");break;case"checkincsub":o.checkIncSub=(v=="true");break;case"checkparents":o.checkParents=(v=="true");break;case"checkonleaf":o.checkOnLeaf=(v=="true");break;case"hideroot":o.hideRoot=(v=="true");break;case"indent":o.indent=(v=="true");break;case"showexpdr":o.showExpdr=(v=="true");break;case"renderondemand":o.renderOnDemand=(v=="true");break;case"evdblclick":o.evDblClick=(v=="true");break;case"evctxmenu":o.evCtxMenu=(v=="true");break;case"evmouseup":o.evMouseUp=(v=="true");break;case"evmousedown":o.evMouseDown=(v=="true");break;case"evmousemove":o.evMouseMove=(v=="true");break;case"evmouseout":o.evMouseOut=(v=="true");break;case"evmouseover":o.evMouseOver=(v=="true");break;}}};NLSTREE.setIconsByXML=function(xico){var c=this.ico;for(var i=0;i<xico.childNodes.length;i++){var n=xico.childNodes[i];if(n.nodeType!=1)continue;c[n.getAttribute("name")]=n.getAttribute("value");}
this.useIconSet(c);};NLSTREE.loadFromXML=function(xml){var rt=xml;for(var i=0;i<rt.childNodes.length;i++){var n=rt.childNodes[i];if(n.nodeType==1){if(n.nodeName=="options"){this.setOptionsByXML(n);}else
if(n.nodeName=="icons"){this.setIconsByXML(n);}else
if(n.nodeName=="node"){this.addNodesXML("root",n,false);}}}};NLSTREE.loadFromXMLString=function(sXML){var txml=nls_parseXML(sXML);this.loadFromXML(txml.documentElement);};NLSTREE.loadFromXMLFile=function(fName){var me=this;var req=NlsTree.AJAX.createRequest();req.open("get",fName,false);req.send(null);this.loadFromXML(req.responseXML.documentElement);};function nls_parseXML(sXml){var xmlDom=null;if(typeof(DOMParser)!="undefined"){var parser=new DOMParser();xmlDom=parser.parseFromString(sXml,"text/xml");}else{xmlDom=nls_createXMLDoc();xmlDom.loadXML(sXml);}
return xmlDom;};function nls_createXMLDoc(){var ieXML=["MSXML2.DOMDocument.5.0","MSXML2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","Microsoft.XmlDom"];var xmlDom=null;if(nls_isIE){for(var i=0;i<ieXML.length;i++){try{xmlDom=new ActiveXObject(ieXML[i]);break;}catch(e){}}}else{xmlDom=document.implementation.createDocument("","",null);}
return xmlDom;};NlsTree.AJAX.createRequest=function(){if(typeof XMLHttpRequest!="undefined"){return(new XMLHttpRequest());}else{var arrObj=["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMHttp"];var req=null;for(var i=0;i<arrObj.length;i++){try{req=new ActiveXObject(arrObj[i]);return req;}catch(e){}}}};
;function nls_setCookie(key,value,expire){if(value==null)return;var v=value;if(v!="")v=escape(v);document.cookie=escape(key)+"="+v+(expire?"; expires="+expire:"");}
function nls_getCookie(key){if(document.cookie){var cp=document.cookie.split(";");var c=null;for(var i=0;i<cp.length;i++){c=cp[i].split("=");if(unescape(c[0].replace(/\s*/gi,""))==key){return(c.length>1?unescape(c[1]):"");}}}
return"";}
function nls_removeCookie(key){nls_setCookie(key,"-1","Fri, 31 Dec 1999 23:59:59 GMT;");}
function nls_addExpandedId(key,nId){var v=nls_getCookie(key);if(v==""){v="/"+nId+"/";}else{if(v.indexOf("/"+nId+"/")==-1)v=v+nId+"/";}
nls_setCookie(key,v);}
function nls_delExpandedId(key,nId){var v=nls_getCookie(key);var idx=v.indexOf("/"+nId+"/");var rgx=new RegExp("/"+nId,"gi");if(idx>-1){v=v.replace(rgx,"");if(v=="/")v="";}
nls_setCookie(key,v);}
function nls_maintainNodeState(tId,rt){var t=nlsTree[tId];var exps=nls_getCookie(tId+"_ndstate");if(exps!=""){var aexp=exps.split("/");var nd=null;for(var i=0;i<aexp.length;i++){if(aexp[i]!=""){nd=t.getNodeById(aexp[i]);if(nd){if(rt){t.expandNode(aexp[i]);}else{nd.exp=true;}}}}}}
NlsTree.prototype.resetState=function(){nls_removeCookie(this.tId+"_ndstate");nls_removeCookie(this.tId+"_selnd");}
;NLSTREE.ajaxLoadChildNodes=function(id){var nd=this.getNodeById(id);var req=NlsTree.AJAX.createRequest();var params=(nd.chUrl?nd.chUrl:this.chUrl);for(var element in this.treeParameters){params+='&'+element+'='+this.treeParameters[element];}
params=params.toQueryParams();Object.extend(params,{nid:id,site:nd.yg_id.split('-')[1]})
params=Object.toQueryString(params);var url=(nd.chUrl?nd.chUrl:this.chUrl).split('?')[0]+'?'+params;var me=this;req.open("get",url,true);req.onreadystatechange=function(){if(req.readyState==4){if(req.status==200||req.status==304){var de=req.responseXML.documentElement;if(!de||de.childNodes.length==0){}else{me.removeChilds(id);me.addChildNodesXML(de,true);me.expandNode(id);if(me.selectAfterAjax){me.selectNodeById(me.selectAfterAjax);me.selectAfterAjax=undefined;}}
nd.loaded=2;}}};var oNd=$getAnchor(NlsGetElementById(nd.id));oNd.innerHTML=$K.TXT('TXT_LOADING')+"...";oNd.className=this.opt.stlprf+'prnnode';nd.loaded=1;req.send(null);};NLSTREE.ajaxLoadChildNodesList=function(ids){if(ids.length==0){return;}
var id=ids[0];var nd=this.getNodeById(id);var req=NlsTree.AJAX.createRequest();var url=$nlsAddParam((nd.chUrl?nd.chUrl:this.chUrl),"nid="+id);var me=this;req.open("get",url,true);req.onreadystatechange=function(){if(req.readyState==4){if(req.status==200||req.status==304){var de=req.responseXML.documentElement;nd.loaded=2;if(!de||de.childNodes.length==0){}else{me.removeChilds(id);me.addChildNodesXML(de,true);me.expandNode(id);if(ids.length==1){me.selectNodeById(id);}}
ids.shift();me.ajaxLoadChildNodesList(ids);}}};var oNd=$getAnchor(NlsGetElementById(nd.id));oNd.innerHTML=$K.TXT('TXT_LOADING')+"...";oNd.className=this.opt.stlprf+'prnnode';nd.loaded=1;req.send(null);};NLSTREE.setServerLoad=function(id,url){n=this.getNodeById(id);n.svrLoad=true;n.loaded=0;n.chUrl=url;};NlsNode.prototype.loaded=0;NlsNode.prototype.chUrl=null;function $nlsAddParam(url,par){var s=(url.indexOf("?")!=-1?"&":"?");return url+s+par;};
;function getAnchorPosition(anchorname){var useWindow=false;var coordinates=new Object();var x=0,y=0;var use_gebi=false,use_css=false,use_layers=false;if(document.getElementById){use_gebi=true;}else if(document.all){use_css=true;}else if(document.layers){use_layers=true;}
if(use_gebi){var o=document.getElementById(anchorname);x=AnchorPosition_getPageOffsetLeft(o);y=AnchorPosition_getPageOffsetTop(o);}else if(use_css){x=AnchorPosition_getPageOffsetLeft(document.all[anchorname]);y=AnchorPosition_getPageOffsetTop(document.all[anchorname]);}else if(use_layers){var found=0;for(var i=0;i<document.anchors.length;i++){if(document.anchors[i].name==anchorname){found=1;break;}}
if(found==0){coordinates.x=0;coordinates.y=0;return coordinates;}
x=document.anchors[i].x;y=document.anchors[i].y;}else{coordinates.x=0;coordinates.y=0;return coordinates;}
coordinates.x=x+6;coordinates.y=y-34;if(navigator.appVersion.indexOf("MSIE")!=-1&&navigator.appVersion.indexOf("Windows")>-1){coordinates.x=x+295;coordinates.y=y-10;};return coordinates;}
function getAnchorWindowPosition(anchorname){var coordinates=getAnchorPosition(anchorname);var x=0;var y=0;if(document.getElementById){if(isNaN(window.screenX)){x=coordinates.x-document.body.scrollLeft+window.screenLeft;y=coordinates.y-document.body.scrollTop+window.screenTop;}else{x=coordinates.x+window.screenX+(window.outerWidth-window.innerWidth)-window.pageXOffset;y=coordinates.y+window.screenY+(window.outerHeight-24-window.innerHeight)-window.pageYOffset;}}else if(document.all){x=coordinates.x-document.body.scrollLeft+window.screenLeft;y=coordinates.y-document.body.scrollTop+window.screenTop;}else if(document.layers){x=coordinates.x+window.screenX+(window.outerWidth-window.innerWidth)-window.pageXOffset;y=coordinates.y+window.screenY+(window.outerHeight-24-window.innerHeight)-window.pageYOffset;}
coordinates.x=x;coordinates.y=y;return coordinates;}
function AnchorPosition_getPageOffsetLeft(el){var ol=el.offsetLeft;while((el=el.offsetParent)!=null){ol+=el.offsetLeft;}
return ol;}
function AnchorPosition_getWindowOffsetLeft(el){return AnchorPosition_getPageOffsetLeft(el)-document.body.scrollLeft;}
function AnchorPosition_getPageOffsetTop(el){var ot=el.offsetTop;while((el=el.offsetParent)!=null){ot+=el.offsetTop;}
return ot;}
function AnchorPosition_getWindowOffsetTop(el){return AnchorPosition_getPageOffsetTop(el)-document.body.scrollTop;}
var MONTH_NAMES=new Array('January','February','March','April','May','June','July','August','September','October','November','December','Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec');var DAY_NAMES=new Array('Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sun','Mon','Tue','Wed','Thu','Fri','Sat');function LZ(x){return(x<0||x>9?"":"0")+x}
function isDate(val,format){var date=getDateFromFormat(val,format);if(date==0){return false;}
return true;}
function compareDates(date1,dateformat1,date2,dateformat2){var d1=getDateFromFormat(date1,dateformat1);var d2=getDateFromFormat(date2,dateformat2);if(d1==0||d2==0){return-1;}else if(d1>d2){return 1;}
return 0;}
function formatDate(date,format){format=format+"";var result="";var i_format=0;var c="";var token="";var y=date.getYear()+"";var M=date.getMonth()+1;var d=date.getDate();var E=date.getDay();var H=date.getHours();var m=date.getMinutes();var s=date.getSeconds();var yyyy,yy,MMM,MM,dd,hh,h,mm,ss,ampm,HH,H,KK,K,kk,k;var value=new Object();if(y.length<4){y=""+(y-0+1900);}
value["y"]=""+y;value["yyyy"]=y;value["yy"]=y.substring(2,4);value["M"]=M;value["MM"]=LZ(M);value["MMM"]=MONTH_NAMES[M-1];value["NNN"]=MONTH_NAMES[M+11];value["d"]=d;value["dd"]=LZ(d);value["E"]=DAY_NAMES[E+7];value["EE"]=DAY_NAMES[E];value["H"]=H;value["HH"]=LZ(H);if(H==0){value["h"]=12;}else if(H>12){value["h"]=H-12;}else{value["h"]=H;}
value["hh"]=LZ(value["h"]);if(H>11){value["K"]=H-12;}else{value["K"]=H;}
value["k"]=H+1;value["KK"]=LZ(value["K"]);value["kk"]=LZ(value["k"]);if(H>11){value["a"]="PM";}else{value["a"]="AM";}
value["m"]=m;value["mm"]=LZ(m);value["s"]=s;value["ss"]=LZ(s);while(i_format<format.length){c=format.charAt(i_format);token="";while((format.charAt(i_format)==c)&&(i_format<format.length)){token+=format.charAt(i_format++);}
if(value[token]!=null){result=result+value[token];}else{result=result+token;}}
return result;}
function _isInteger(val){var digits="1234567890";for(var i=0;i<val.length;i++){if(digits.indexOf(val.charAt(i))==-1){return false;}}
return true;}
function _getInt(str,i,minlength,maxlength){for(var x=maxlength;x>=minlength;x--){var token=str.substring(i,i+x);if(token.length<minlength){return null;}
if(_isInteger(token)){return token;}}
return null;}
function getDateFromFormat(val,format){val=val+"";format=format+"";var i_val=0;var i_format=0;var c="";var token="";var token2="";var x,y;var now=new Date();var year=now.getYear();var month=now.getMonth()+1;var date=1;var hh=now.getHours();var mm=now.getMinutes();var ss=now.getSeconds();var ampm="";while(i_format<format.length){c=format.charAt(i_format);token="";while((format.charAt(i_format)==c)&&(i_format<format.length)){token+=format.charAt(i_format++);}
if(token=="yyyy"||token=="yy"||token=="y"){if(token=="yyyy"){x=4;y=4;}
if(token=="yy"){x=2;y=2;}
if(token=="y"){x=2;y=4;}
year=_getInt(val,i_val,x,y);if(year==null){return 0;}
i_val+=year.length;if(year.length==2){if(year>70){year=1900+(year-0);}else{year=2000+(year-0);}}}else if(token=="MMM"||token=="NNN"){month=0;for(var i=0;i<MONTH_NAMES.length;i++){var month_name=MONTH_NAMES[i];if(val.substring(i_val,i_val+month_name.length).toLowerCase()==month_name.toLowerCase()){if(token=="MMM"||(token=="NNN"&&i>11)){month=i+1;if(month>12){month-=12;}
i_val+=month_name.length;break;}}}
if((month<1)||(month>12)){return 0;}}else if(token=="EE"||token=="E"){for(var i=0;i<DAY_NAMES.length;i++){var day_name=DAY_NAMES[i];if(val.substring(i_val,i_val+day_name.length).toLowerCase()==day_name.toLowerCase()){i_val+=day_name.length;break;}}}else if(token=="MM"||token=="M"){month=_getInt(val,i_val,token.length,2);if(month==null||(month<1)||(month>12)){return 0;}
i_val+=month.length;}else if(token=="dd"||token=="d"){date=_getInt(val,i_val,token.length,2);if(date==null||(date<1)||(date>31)){return 0;}
i_val+=date.length;}else if(token=="hh"||token=="h"){hh=_getInt(val,i_val,token.length,2);if(hh==null||(hh<1)||(hh>12)){return 0;}
i_val+=hh.length;}else if(token=="HH"||token=="H"){hh=_getInt(val,i_val,token.length,2);if(hh==null||(hh<0)||(hh>23)){return 0;}
i_val+=hh.length;}else if(token=="KK"||token=="K"){hh=_getInt(val,i_val,token.length,2);if(hh==null||(hh<0)||(hh>11)){return 0;}
i_val+=hh.length;}else if(token=="kk"||token=="k"){hh=_getInt(val,i_val,token.length,2);if(hh==null||(hh<1)||(hh>24)){return 0;}
i_val+=hh.length;hh--;}else if(token=="mm"||token=="m"){mm=_getInt(val,i_val,token.length,2);if(mm==null||(mm<0)||(mm>59)){return 0;}
i_val+=mm.length;}else if(token=="ss"||token=="s"){ss=_getInt(val,i_val,token.length,2);if(ss==null||(ss<0)||(ss>59)){return 0;}
i_val+=ss.length;}else if(token=="a"){if(val.substring(i_val,i_val+2).toLowerCase()=="am"){ampm="AM";}else if(val.substring(i_val,i_val+2).toLowerCase()=="pm"){ampm="PM";}else{return 0;}
i_val+=2;}else{if(val.substring(i_val,i_val+token.length)!=token){return 0;}else{i_val+=token.length;}}}
if(i_val!=val.length){return 0;}
if(month==2){if(((year%4==0)&&(year%100!=0))||(year%400==0)){if(date>29){return 0;}}else{if(date>28){return 0;}}}
if((month==4)||(month==6)||(month==9)||(month==11)){if(date>30){return 0;}}
if(hh<12&&ampm=="PM"){hh=hh-0+12;}else if(hh>11&&ampm=="AM"){hh-=12;}
var newdate=new Date(year,month-1,date,hh,mm,ss);return newdate.getTime();}
function parseDate(val){var preferEuro=(arguments.length==2)?arguments[1]:false;generalFormats=new Array('y-M-d','MMM d, y','MMM d,y','y-MMM-d','d-MMM-y','MMM d');monthFirst=new Array('M/d/y','M-d-y','M.d.y','MMM-d','M/d','M-d');dateFirst=new Array('d/M/y','d-M-y','d.M.y','d-MMM','d/M','d-M');var checkList=new Array('generalFormats',preferEuro?'dateFirst':'monthFirst',preferEuro?'monthFirst':'dateFirst');var d=null;for(var i=0;i<checkList.length;i++){var l=window[checkList[i]];for(var j=0;j<l.length;j++){d=getDateFromFormat(val,l[j]);if(d!=0){return new Date(d);}}}
return null;}
function PopupWindow_getXYPosition(anchorname){var coordinates;if(this.type=="WINDOW"){coordinates=getAnchorWindowPosition(anchorname);}else{coordinates=getAnchorPosition(anchorname);}
this.x=coordinates.x;this.y=coordinates.y;}
function PopupWindow_setSize(width,height){this.width=width;this.height=height;}
function PopupWindow_populate(contents){this.contents=contents;this.populated=false;}
function PopupWindow_setUrl(url){this.url=url;}
function PopupWindow_setWindowProperties(props){this.windowProperties=props;}
function PopupWindow_refresh(){if($K.inDropdownSelect){$K.callStack=this.refresh.bind(this);return;}
$K.warn('PopupWindow_refresh: IN',$K.Log.INFO);if(this.divName!=null){if(this.use_gebi){document.getElementById(this.divName).innerHTML=this.contents;}else if(this.use_css){document.all[this.divName].innerHTML=this.contents;}else if(this.use_layers){var d=document.layers[this.divName];d.document.open();d.document.writeln(this.contents);d.document.close();}}else{if(this.popupWindow!=null&&!this.popupWindow.closed){if(this.url!=""){this.popupWindow.location.href=this.url;}else{$K.log('FNF',$K.Log.INFO);this.popupWindow.document.open();this.popupWindow.document.writeln(this.contents);this.popupWindow.document.close();}
this.popupWindow.focus();}}
$K.warn('PopupWindow_refresh: OUT',$K.Log.INFO);}
function PopupWindow_showPopup(anchorname){this.getXYPosition(anchorname);this.x+=this.offsetX;this.y+=this.offsetY;if(!this.populated&&(this.contents!="")){this.populated=true;this.refresh();}
if(this.divName!=null){if(this.use_gebi){document.getElementById(this.divName).style.left=this.x+"px";document.getElementById(this.divName).style.top=this.y+"px";document.getElementById(this.divName).style.visibility="visible";document.getElementById(this.divName).style.display="block";}else if(this.use_css){document.all[this.divName].style.left=this.x;document.all[this.divName].style.top=this.y;document.all[this.divName].style.visibility="visible";document.all[this.divName].style.display="block";}else if(this.use_layers){document.layers[this.divName].left=this.x;document.layers[this.divName].top=this.y;document.layers[this.divName].visibility="visible";document.layers[this.divName].visibility="block";}}else{if(this.popupWindow==null||this.popupWindow.closed){if(this.x<0){this.x=0;}
if(this.y<0){this.y=0;}
if(screen&&screen.availHeight){if((this.y+this.height)>screen.availHeight){this.y=screen.availHeight-this.height;}}
if(screen&&screen.availWidth){if((this.x+this.width)>screen.availWidth){this.x=screen.availWidth-this.width;}}
var avoidAboutBlank=window.opera||(document.layers&&!navigator.mimeTypes['*'])||navigator.vendor=='KDE'||(document.childNodes&&!document.all&&!navigator.taintEnabled);this.popupWindow=window.open(avoidAboutBlank?"":"about:blank","window_"+anchorname,this.windowProperties+",width="+this.width+",height="+this.height+",screenX="+this.x+",left="+this.x+",screenY="+this.y+",top="+this.y+"");}
this.refresh();}}
function PopupWindow_hidePopup(){if(this.divName!=null){if(this.use_gebi){if(document.getElementById(this.divName)){document.getElementById(this.divName).style.visibility="hidden";document.getElementById(this.divName).style.display="none";}}else if(this.use_css){document.all[this.divName].style.visibility="hidden";document.all[this.divName].style.display="none";}else if(this.use_layers){document.layers[this.divName].visibility="hidden";document.layers[this.divName].display="none";}}else{if(this.popupWindow&&!this.popupWindow.closed){this.popupWindow.close();this.popupWindow=null;}}}
function PopupWindow_isClicked(e){if(this.divName!=null){if(this.use_layers){var clickX=e.pageX;var clickY=e.pageY;var t=document.layers[this.divName];if((clickX>t.left)&&(clickX<t.left+t.clip.width)&&(clickY>t.top)&&(clickY<t.top+t.clip.height)){return true;}else{return false;}}else if(document.all){var t=window.event.srcElement;while(t.parentElement!=null){if(t.id==this.divName){return true;}
t=t.parentElement;}
return false;}else if(this.use_gebi&&e){var t=e.originalTarget;try{while(t.parentNode!=null){if(t.id==this.divName){return true;}
t=t.parentNode;}}catch(e){}
return false;}
return false;}
return false;}
function PopupWindow_hideIfNotClicked(e){var target;if(!e.target){target=$(e.srcElement);}else{target=e.target;}
if($(target).descendantOf(this.divName)){return;}
if(this.autoHideEnabled&&!this.isClicked(e)){this.hidePopup();}}
function PopupWindow_autoHide(){this.autoHideEnabled=true;}
function PopupWindow_hidePopupWindows(e){for(var i=0;i<popupWindowObjects.length;i++){if(popupWindowObjects[i]!=null){var p=popupWindowObjects[i];p.hideIfNotClicked(e);}}}
function PopupWindow_attachListener(){if(document.layers){document.captureEvents(Event.MOUSEUP);}
Event.observe(document,'mouseup',function(e){var clickedElement=Event.findElement(e);if(!clickedElement.up('#yg_caldiv_dropdownboxmonths_ddlist')&&!clickedElement.up('#yg_caldiv_dropdownboxyears_ddlist')){PopupWindow_hidePopupWindows(e);}});}
function PopupWindow(){if(!window.popupWindowIndex){window.popupWindowIndex=0;}
if(!window.popupWindowObjects){window.popupWindowObjects=new Array();}
if(!window.listenerAttached){window.listenerAttached=true;PopupWindow_attachListener();}
this.index=popupWindowIndex++;popupWindowObjects[this.index]=this;this.divName=null;this.popupWindow=null;this.width=0;this.height=0;this.populated=false;this.visible=false;this.autoHideEnabled=false;this.contents="";this.url="";this.windowProperties="toolbar=no,location=no,status=no,menubar=no,scrollbars=auto,resizable,alwaysRaised,dependent,titlebar=no";if(arguments.length>0){this.type="DIV";this.divName=arguments[0];}else{this.type="WINDOW";}
this.use_gebi=false;this.use_css=false;this.use_layers=false;if(document.getElementById){this.use_gebi=true;}else if(document.all){this.use_css=true;}else if(document.layers){this.use_layers=true;}else{this.type="WINDOW";}
this.offsetX=0;this.offsetY=0;this.getXYPosition=PopupWindow_getXYPosition;this.populate=PopupWindow_populate;this.setUrl=PopupWindow_setUrl;this.setWindowProperties=PopupWindow_setWindowProperties;this.refresh=PopupWindow_refresh;this.showPopup=PopupWindow_showPopup;this.hidePopup=PopupWindow_hidePopup;this.setSize=PopupWindow_setSize;this.isClicked=PopupWindow_isClicked;this.autoHide=PopupWindow_autoHide;this.hideIfNotClicked=PopupWindow_hideIfNotClicked;}
function CalendarPopup(){var c;if(arguments.length>0){c=new PopupWindow(arguments[0]);}else{c=new PopupWindow();c.setSize(150,175);}
c.offsetX=-152;c.offsetY=25;c.autoHide();c.monthNames=new Array("January","February","March","April","May","June","July","August","September","October","November","December");c.monthAbbreviations=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");c.dayHeaders=new Array("S","M","T","W","T","F","S");c.returnFunction="CP_tmpReturnFunction";c.returnMonthFunction="CP_tmpReturnMonthFunction";c.returnQuarterFunction="CP_tmpReturnQuarterFunction";c.returnYearFunction="CP_tmpReturnYearFunction";c.weekStartDay=0;c.isShowYearNavigation=false;c.displayType="date";c.disabledWeekDays=new Object();c.disabledDatesExpression="";c.yearSelectStartOffset=2;c.currentDate=null;c.todayText="Today";c.cssPrefix="";c.isShowNavigationDropdowns=false;c.isShowYearNavigationInput=false;window.CP_calendarObject=null;window.CP_targetInput=null;window.CP_dateFormat="MM/dd/yyyy";c.copyMonthNamesToWindow=CP_copyMonthNamesToWindow;c.setReturnFunction=CP_setReturnFunction;c.setReturnMonthFunction=CP_setReturnMonthFunction;c.setReturnQuarterFunction=CP_setReturnQuarterFunction;c.setReturnYearFunction=CP_setReturnYearFunction;c.setMonthNames=CP_setMonthNames;c.setMonthAbbreviations=CP_setMonthAbbreviations;c.setDayHeaders=CP_setDayHeaders;c.setWeekStartDay=CP_setWeekStartDay;c.setDisplayType=CP_setDisplayType;c.setDisabledWeekDays=CP_setDisabledWeekDays;c.addDisabledDates=CP_addDisabledDates;c.setYearSelectStartOffset=CP_setYearSelectStartOffset;c.setTodayText=CP_setTodayText;c.showYearNavigation=CP_showYearNavigation;c.showCalendar=CP_showCalendar;c.hideCalendar=CP_hideCalendar;c.getStyles=getCalendarStyles;c.refreshCalendar=CP_refreshCalendar;c.getCalendar=CP_getCalendar;c.select=CP_select;c.setCssPrefix=CP_setCssPrefix;c.showNavigationDropdowns=CP_showNavigationDropdowns;c.showYearNavigationInput=CP_showYearNavigationInput;c.copyMonthNamesToWindow();return c;}
function CP_copyMonthNamesToWindow(){if(typeof(window.MONTH_NAMES)!="undefined"&&window.MONTH_NAMES!=null){window.MONTH_NAMES=new Array();for(var i=0;i<this.monthNames.length;i++){window.MONTH_NAMES[window.MONTH_NAMES.length]=this.monthNames[i];}
for(var i=0;i<this.monthAbbreviations.length;i++){window.MONTH_NAMES[window.MONTH_NAMES.length]=this.monthAbbreviations[i];}}}
function CP_tmpReturnFunction(y,m,d){if(window.CP_targetInput!=null){var dt=new Date(y,m-1,d,0,0,0);if(window.CP_calendarObject!=null){window.CP_calendarObject.copyMonthNamesToWindow();}
window.CP_targetInput.value=formatDate(dt,window.CP_dateFormat);if(typeof window.CP_targetInput.onchange=='function')window.CP_targetInput.onchange();}else{alert('Use setReturnFunction() to define which function will get the clicked results!');}}
function CP_tmpReturnMonthFunction(y,m){alert('Use setReturnMonthFunction() to define which function will get the clicked results!\nYou clicked: year='+y+' , month='+m);}
function CP_tmpReturnQuarterFunction(y,q){alert('Use setReturnQuarterFunction() to define which function will get the clicked results!\nYou clicked: year='+y+' , quarter='+q);}
function CP_tmpReturnYearFunction(y){alert('Use setReturnYearFunction() to define which function will get the clicked results!\nYou clicked: year='+y);}
function CP_setReturnFunction(name){this.returnFunction=name;}
function CP_setReturnMonthFunction(name){this.returnMonthFunction=name;}
function CP_setReturnQuarterFunction(name){this.returnQuarterFunction=name;}
function CP_setReturnYearFunction(name){this.returnYearFunction=name;}
function CP_setMonthNames(){for(var i=0;i<arguments.length;i++){this.monthNames[i]=arguments[i];}
this.copyMonthNamesToWindow();}
function CP_setMonthAbbreviations(){for(var i=0;i<arguments.length;i++){this.monthAbbreviations[i]=arguments[i];}
this.copyMonthNamesToWindow();}
function CP_setDayHeaders(){for(var i=0;i<arguments.length;i++){this.dayHeaders[i]=arguments[i];}}
function CP_setWeekStartDay(day){this.weekStartDay=day;}
function CP_showYearNavigation(){this.isShowYearNavigation=(arguments.length>0)?arguments[0]:true;}
function CP_setDisplayType(type){if(type!="date"&&type!="week-end"&&type!="month"&&type!="quarter"&&type!="year"){alert("Invalid display type! Must be one of: date,week-end,month,quarter,year");return false;}
this.displayType=type;}
function CP_setYearSelectStartOffset(num){this.yearSelectStartOffset=num;}
function CP_setDisabledWeekDays(){this.disabledWeekDays=new Object();for(var i=0;i<arguments.length;i++){this.disabledWeekDays[arguments[i]]=true;}}
function CP_addDisabledDates(start,end){if(arguments.length==1){end=start;}
if(start==null&&end==null){return;}
if(this.disabledDatesExpression!=""){this.disabledDatesExpression+="||";}
if(start!=null){start=parseDate(start);start=""+start.getFullYear()+LZ(start.getMonth()+1)+LZ(start.getDate());}
if(end!=null){end=parseDate(end);end=""+end.getFullYear()+LZ(end.getMonth()+1)+LZ(end.getDate());}
if(start==null){this.disabledDatesExpression+="(ds<="+end+")";}else if(end==null){this.disabledDatesExpression+="(ds>="+start+")";}else{this.disabledDatesExpression+="(ds>="+start+"&&ds<="+end+")";}}
function CP_setTodayText(text){this.todayText=text;}
function CP_setCssPrefix(val){this.cssPrefix=val;}
function CP_showNavigationDropdowns(){this.isShowNavigationDropdowns=(arguments.length>0)?arguments[0]:true;}
function CP_showYearNavigationInput(){this.isShowYearNavigationInput=(arguments.length>0)?arguments[0]:true;}
function CP_hideCalendar(){if(arguments.length>0){window.popupWindowObjects[arguments[0]].hidePopup();}else{this.hidePopup();}}
function CP_refreshCalendar(index){var calObject=window.popupWindowObjects[index];if(arguments.length>1){calObject.populate(calObject.getCalendar(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]));}else{calObject.populate(calObject.getCalendar());}
calObject.refresh();window.setTimeout((function(){$K.yg_customAttributeHandler($('yg_caldiv'));}),100);}
function CP_showCalendar(anchorname){if(arguments.length>1){if(arguments[1]==null||arguments[1]==""){this.currentDate=new Date();}else{this.currentDate=new Date(parseDate(arguments[1]));}}
this.populate(this.getCalendar());this.showPopup(anchorname);$K.yg_customAttributeHandler($('yg_caldiv'));}
function CP_select(inputobj,linkname,format){var selectedDate=(arguments.length>3)?arguments[3]:null;if(!window.getDateFromFormat){alert("calendar.select: To use this method you must also include 'date.js' for date formatting");return;}
if(this.displayType!="date"&&this.displayType!="week-end"){alert("calendar.select: This function can only be used with displayType 'date' or 'week-end'");return;}
if(inputobj.type!="text"&&inputobj.type!="hidden"&&inputobj.type!="textarea"){alert("calendar.select: Input object passed is not a valid form input object");window.CP_targetInput=null;return;}
if(inputobj.disabled){return;}
window.CP_targetInput=inputobj;window.CP_calendarObject=this;this.currentDate=null;var time=0;if(selectedDate!=null){time=getDateFromFormat(selectedDate,format)}else if(inputobj.value!=""){time=getDateFromFormat(inputobj.value,format);}
if(selectedDate!=null||inputobj.value!=""){if(time==0){this.currentDate=null;}else{this.currentDate=new Date(time);}}
window.CP_dateFormat=format;this.showCalendar(linkname);}
function getCalendarStyles(){var result="";var p="";if(this!=null&&typeof(this.cssPrefix)!="undefined"&&this.cssPrefix!=null&&this.cssPrefix!=""){p=this.cssPrefix;}
result+="<STYLE>\n";result+="."+p+"cpYearNavigation,."+p+"cpMonthNavigation{background-color:#C0C0C0;text-align:center;text-decoration:none;color:#000000;font-weight:bold;}\n";result+="."+p+"cpDayColumnHeader, ."+p+"cpYearNavigation,."+p+"cpMonthNavigation,."+p+"cpCurrentMonthDate,."+p+"cpCurrentMonthDateDisabled,."+p+"cpOtherMonthDate,."+p+"cpOtherMonthDateDisabled,."+p+"cpCurrentDate,."+p+"cpCurrentDateDisabled,."+p+"cpTodayText,."+p+"cpTodayTextDisabled,."+p+"cpText{font-family:arial;font-size:8pt;}\n";result+="TD."+p+"cpDayColumnHeader{text-align:right;border:solid thin #C0C0C0;border-width:0px 0px 1px 0px;}\n";result+="."+p+"cpCurrentMonthDate, ."+p+"cpOtherMonthDate, ."+p+"cpCurrentDate{text-align:right;text-decoration:none;}\n";result+="."+p+"cpCurrentMonthDateDisabled, ."+p+"cpOtherMonthDateDisabled, ."+p+"cpCurrentDateDisabled{color:#D0D0D0;text-align:right;text-decoration:line-through;}\n";result+="."+p+"cpCurrentMonthDate, .cpCurrentDate{color:#000000;}\n";result+="."+p+"cpOtherMonthDate{color:#808080;}\n";result+="TD."+p+"cpCurrentDate{color:white;background-color: #C0C0C0;border-width:1px;border:solid thin #800000;}\n";result+="TD."+p+"cpCurrentDateDisabled{border-width:1px;border:solid thin #FFAAAA;}\n";result+="TD."+p+"cpTodayText, TD."+p+"cpTodayTextDisabled{border:solid thin #C0C0C0;border-width:1px 0px 0px 0px;}\n";result+="A."+p+"cpTodayText, SPAN."+p+"cpTodayTextDisabled{height:20px;}\n";result+="A."+p+"cpTodayText{color:black;}\n";result+="."+p+"cpTodayTextDisabled{color:#D0D0D0;}\n";result+="."+p+"cpBorder{border:solid thin #808080;}\n";result+="</STYLE>\n";return result;}
function cal_change_month(value,decoy,element){var index=element.readAttribute('cal_index');var year=element.readAttribute('cal_year');$K.log('cal_change_month',index,value,year,$K.Log.INFO);CP_refreshCalendar(index,value,year);}
function cal_change_year(value,decoy,element){var index=element.readAttribute('cal_index');var month=element.readAttribute('cal_month');$K.log('cal_change_year',index,month,value,$K.Log.INFO);CP_refreshCalendar(index,month,value);}
function CP_getCalendar(){var now=new Date();if(this.type=="WINDOW"){var windowref="window.opener.";}else{var windowref="";}
var result="";if(this.type=="WINDOW"){result+="<HTML><HEAD><TITLE>Calendar</TITLE>"+this.getStyles()+"</HEAD><BODY MARGINWIDTH=0 MARGINHEIGHT=0 TOPMARGIN=0 RIGHTMARGIN=0 LEFTMARGIN=0>\n";result+='<CENTER><TABLE WIDTH=100% BORDER=0 BORDERWIDTH=0 CELLSPACING=0 CELLPADDING=0>\n';}else{result+='<TABLE CLASS="'+this.cssPrefix+'cpBorder" WIDTH=200 BORDER=0 BORDERWIDTH=1 CELLSPACING=0 CELLPADDING=1>\n';result+='<TR><TD ALIGN=CENTER>\n';result+='<CENTER>\n';}
if(this.displayType=="date"||this.displayType=="week-end"){if(this.currentDate==null){this.currentDate=now;}
if(arguments.length>0){var month=arguments[0];}else{var month=this.currentDate.getMonth()+1;}
if(arguments.length>1&&arguments[1]>0&&arguments[1]-0==arguments[1]){var year=arguments[1];}else{var year=this.currentDate.getFullYear();}
var daysinmonth=new Array(0,31,28,31,30,31,30,31,31,30,31,30,31);if(((year%4==0)&&(year%100!=0))||(year%400==0)){daysinmonth[2]=29;}
var current_month=new Date(year,month-1,1);var display_year=year;var display_month=month;var display_date=1;var weekday=current_month.getDay();var offset=0;offset=(weekday>=this.weekStartDay)?weekday-this.weekStartDay:7-this.weekStartDay+weekday;if(offset>0){display_month--;if(display_month<1){display_month=12;display_year--;}
display_date=daysinmonth[display_month]-offset+1;}
var next_month=month+1;var next_month_year=year;if(next_month>12){next_month=1;next_month_year++;}
var last_month=month-1;var last_month_year=year;if(last_month<1){last_month=12;last_month_year--;}
var date_class;if(this.type!="WINDOW"){result+='<div class="headline1">'+$K.TXT('TXT_PICKDATE')+'</div>';result+="<TABLE WIDTH=200 HEIGHT=33 BORDER=0 BORDERWIDTH=0 CELLSPACING=0 CELLPADDING=0>";}
result+='<TR>\n';var refresh=windowref+'CP_refreshCalendar';var refreshLink='javascript:'+refresh;if(this.isShowNavigationDropdowns){result+='<TD align="left" CLASS="'+this.cssPrefix+'cpMonthNavigation" width="102" COLSPAN="3">';result+='<div id="yg_caldiv_dropdownboxmonths" yg_form="dropdown" class="dropdownbox">';result+=' <div class="dropdown">';result+='  <div class="dropdowninner">';result+='   <input tabindex="1" type="text" yg_onchange="cal_change_month" cal_index="'+this.index+'" cal_month="'+month+'" cal_year="'+year+'" onchange="$K.yg_setEdited(this);" value="'+this.monthNames[month-1]+'">';result+='  </div>';result+=' </div>';result+=' <div class="dropdownlistcontainer">';result+='  <div class="dropdownlist">';for(var monthCounter=1;monthCounter<=12;monthCounter++){var selected=(monthCounter==month)?'CLASS="selected"':'';result+='<div value="'+monthCounter+'" '+selected+' onmouseup="Event.stop(event);" onclick="Event.stop(event);">'+this.monthNames[monthCounter-1]+'</div>';}
result+='  </div>';result+='  <div class="mk_scrollbars"></div>';result+=' </div>';result+=' <input type="hidden" name="cpMonth">';result+='</div>';result+='</TD>';result+='<TD align="left" CLASS="'+this.cssPrefix+'cpYearNavigation" WIDTH="70" COLSPAN="3">';result+='<div id="yg_caldiv_dropdownboxyears" yg_form="dropdown" class="dropdownbox">';result+=' <div class="dropdown">';result+='  <div class="dropdowninner">';result+='   <input tabindex="1" type="text" yg_onchange="cal_change_year" cal_index="'+this.index+'" cal_month="'+month+'" cal_year="'+year+'" onchange="$K.yg_setEdited(this);" value="'+year+'">';result+='  </div>';result+=' </div>';result+=' <div class="dropdownlistcontainer">';result+='  <div class="dropdownlist">';for(var yearCounter=year-this.yearSelectStartOffset;yearCounter<=parseInt(year)+this.yearSelectStartOffset;yearCounter++){var disabled=false;if(this.disabledDatesExpression!=''){var ds=''+(yearCounter+1)+LZ(0)+LZ(0);eval("disabled=("+this.disabledDatesExpression+")");}
if(!disabled){var selected=(yearCounter==year)?'CLASS="selected"':'';result+='<div value="'+yearCounter+'" '+selected+' onmouseup="Event.stop(event);" onclick="Event.stop(event);">'+yearCounter+'</div>';}}
result+='  </div>';result+='  <div class="mk_scrollbars"></div>';result+=' </div>';result+=' <input type="hidden" name="cpYear">';result+='</div>';result+='</TD>';}else{if(this.isShowYearNavigation){result+='<TD CLASS="'+this.cssPrefix+'cpMonthNavigation" WIDTH="10"><A CLASS="'+this.cssPrefix+'cpMonthNavigation" HREF="'+refreshLink+'('+this.index+','+last_month+','+last_month_year+');">&lt;</A></TD>';result+='<TD CLASS="'+this.cssPrefix+'cpMonthNavigation" WIDTH="58"><SPAN CLASS="'+this.cssPrefix+'cpMonthNavigation">'+this.monthNames[month-1]+'</SPAN></TD>';result+='<TD CLASS="'+this.cssPrefix+'cpMonthNavigation" WIDTH="10"><A CLASS="'+this.cssPrefix+'cpMonthNavigation" HREF="'+refreshLink+'('+this.index+','+next_month+','+next_month_year+');">&gt;</A></TD>';result+='<TD CLASS="'+this.cssPrefix+'cpMonthNavigation" WIDTH="10">&nbsp;</TD>';result+='<TD CLASS="'+this.cssPrefix+'cpYearNavigation" WIDTH="10"><A CLASS="'+this.cssPrefix+'cpYearNavigation" HREF="'+refreshLink+'('+this.index+','+month+','+(year-1)+');">&lt;</A></TD>';if(this.isShowYearNavigationInput){result+='<TD CLASS="'+this.cssPrefix+'cpYearNavigation" WIDTH="36"><INPUT NAME="cpYear" CLASS="'+this.cssPrefix+'cpYearNavigation" SIZE="4" MAXLENGTH="4" VALUE="'+year+'" onBlur="'+refresh+'('+this.index+','+month+',this.value-0);"></TD>';}else{result+='<TD CLASS="'+this.cssPrefix+'cpYearNavigation" WIDTH="36"><SPAN CLASS="'+this.cssPrefix+'cpYearNavigation">'+year+'</SPAN></TD>';}
result+='<TD CLASS="'+this.cssPrefix+'cpYearNavigation" WIDTH="10"><A CLASS="'+this.cssPrefix+'cpYearNavigation" HREF="'+refreshLink+'('+this.index+','+month+','+(year+1)+');">&gt;</A></TD>';}else{result+='<TD CLASS="'+this.cssPrefix+'cpMonthNavigation" WIDTH="22"><A CLASS="'+this.cssPrefix+'cpMonthNavigation" HREF="'+refreshLink+'('+this.index+','+last_month+','+last_month_year+');">&lt;&lt;</A></TD>\n';result+='<TD CLASS="'+this.cssPrefix+'cpMonthNavigation" WIDTH="100"><SPAN CLASS="'+this.cssPrefix+'cpMonthNavigation">'+this.monthNames[month-1]+' '+year+'</SPAN></TD>\n';result+='<TD CLASS="'+this.cssPrefix+'cpMonthNavigation" WIDTH="22"><A CLASS="'+this.cssPrefix+'cpMonthNavigation" HREF="'+refreshLink+'('+this.index+','+next_month+','+next_month_year+');">&gt;&gt;</A></TD>\n';}}
result+='</TR></TABLE>\n';result+='<TABLE WIDTH=194 HEIGHT=120 BORDER=0 CELLSPACING=0 CELLPADDING=1 ALIGN=LEFT CLASS=\"monthtable\"">\n';result+='<TR>\n';for(var j=0;j<7;j++){result+='<TD CLASS="'+this.cssPrefix+'cpDayColumnHeader" WIDTH="14%"><SPAN CLASS="'+this.cssPrefix+'cpDayColumnHeader">'+this.dayHeaders[(this.weekStartDay+j)%7]+'</TD>\n';}
result+='</TR>\n';for(var row=1;row<=6;row++){result+='<TR>\n';for(var col=1;col<=7;col++){var disabled=false;if(this.disabledDatesExpression!=""){var ds=""+display_year+LZ(display_month)+LZ(display_date);eval("disabled=("+this.disabledDatesExpression+")");}
var dateClass="";if((display_month==this.currentDate.getMonth()+1)&&(display_date==this.currentDate.getDate())&&(display_year==this.currentDate.getFullYear())){dateClass="cpCurrentDate";}else if(display_month==month){dateClass="cpCurrentMonthDate";}else{dateClass="cpOtherMonthDate";}
if(disabled||this.disabledWeekDays[col-1]){result+=' <TD CLASS="'+this.cssPrefix+dateClass+'"><SPAN CLASS="'+this.cssPrefix+dateClass+'Disabled">'+display_date+'</SPAN></TD>\n';}else{var selected_date=display_date;var selected_month=display_month;var selected_year=display_year;if(this.displayType=="week-end"){var d=new Date(selected_year,selected_month-1,selected_date,0,0,0,0);d.setDate(d.getDate()+(7-col));selected_year=d.getYear();if(selected_year<1000){selected_year+=1900;}
selected_month=d.getMonth()+1;selected_date=d.getDate();}
result+=' <TD CLASS="'+this.cssPrefix+dateClass+'"><A HREF="javascript:'+windowref+this.returnFunction+'('+selected_year+','+selected_month+','+selected_date+');'+windowref+'CP_hideCalendar(\''+this.index+'\');" CLASS="'+this.cssPrefix+dateClass+'">'+display_date+'</A></TD>\n';}
display_date++;if(display_date>daysinmonth[display_month]){display_date=1;display_month++;}
if(display_month>12){display_month=1;display_year++;}}
result+='</TR>';}
var current_weekday=now.getDay()-this.weekStartDay;if(current_weekday<0){current_weekday+=7;}
result+='<TR>\n';result+=' <TD COLSPAN=7 ALIGN=CENTER CLASS="'+this.cssPrefix+'cpTodayText">\n';if(this.disabledDatesExpression!=""){var ds=""+now.getFullYear()+LZ(now.getMonth()+1)+LZ(now.getDate());eval("disabled=("+this.disabledDatesExpression+")");}
if(disabled||this.disabledWeekDays[current_weekday+1]){result+='  <SPAN CLASS="'+this.cssPrefix+'cpTodayTextDisabled">'+this.todayText+'</SPAN>\n';}else{result+='  <A CLASS="'+this.cssPrefix+'cpTodayText" HREF="javascript:'+windowref+this.returnFunction+'(\''+now.getFullYear()+'\',\''+(now.getMonth()+1)+'\',\''+now.getDate()+'\');'+windowref+'CP_hideCalendar(\''+this.index+'\');">'+this.todayText+'</A>\n';}
result+='  <BR>\n';result+=' </TD></TR></TABLE></CENTER></TD></TR></TABLE>\n';}
if(this.displayType=="month"||this.displayType=="quarter"||this.displayType=="year"){if(arguments.length>0){var year=arguments[0];}else{if(this.displayType=="year"){var year=now.getFullYear()-this.yearSelectStartOffset;}else{var year=now.getFullYear();}}
if(this.displayType!="year"&&this.isShowYearNavigation){result+="<TABLE WIDTH=172 BORDER=0 BORDERWIDTH=0 CELLSPACING=0 CELLPADDING=0>";result+='<TR>\n';result+=' <TD CLASS="'+this.cssPrefix+'cpYearNavigation" WIDTH="22"><A CLASS="'+this.cssPrefix+'cpYearNavigation" HREF="javascript:'+windowref+'CP_refreshCalendar('+this.index+','+(year-1)+');">&lt;&lt;</A></TD>\n';result+=' <TD CLASS="'+this.cssPrefix+'cpYearNavigation" WIDTH="100">'+year+'</TD>\n';result+=' <TD CLASS="'+this.cssPrefix+'cpYearNavigation" WIDTH="22"><A CLASS="'+this.cssPrefix+'cpYearNavigation" HREF="javascript:'+windowref+'CP_refreshCalendar('+this.index+','+(year+1)+');">&gt;&gt;</A></TD>\n';result+='</TR></TABLE>\n';}}
if(this.displayType=="month"){result+='<TABLE WIDTH=156 HEIGHT=120 BORDER=0 CELLSPACING=1 CELLPADDING=0 ALIGN=LEFT STYLE="margin-left:4px;">\n';for(var i=0;i<4;i++){result+='<TR>';for(var j=0;j<3;j++){var monthindex=((i*3)+j);result+='<TD WIDTH=33% ALIGN=CENTER><A CLASS="'+this.cssPrefix+'cpText" HREF="javascript:'+windowref+this.returnMonthFunction+'('+year+','+(monthindex+1)+');'+windowref+'CP_hideCalendar(\''+this.index+'\');" CLASS="'+date_class+'">'+this.monthAbbreviations[monthindex]+'</A></TD>';}
result+='</TR>';}
result+='</TABLE></CENTER></TD></TR></TABLE>\n';}
if(this.displayType=="quarter"){result+='<BR><TABLE WIDTH=156 HEIGHT=120 BORDER=1 CELLSPACING=0 CELLPADDING=0 ALIGN=LEFT STYLE="margin-left:4px;">\n';for(var i=0;i<2;i++){result+='<TR>';for(var j=0;j<2;j++){var quarter=((i*2)+j+1);result+='<TD WIDTH=50% ALIGN=CENTER><BR><A CLASS="'+this.cssPrefix+'cpText" HREF="javascript:'+windowref+this.returnQuarterFunction+'('+year+','+quarter+');'+windowref+'CP_hideCalendar(\''+this.index+'\');" CLASS="'+date_class+'">Q'+quarter+'</A><BR><BR></TD>';}
result+='</TR>';}
result+='</TABLE></CENTER></TD></TR></TABLE>\n';}
if(this.displayType=="year"){var yearColumnSize=4;result+="<TABLE WIDTH=172 BORDER=0 BORDERWIDTH=0 CELLSPACING=0 CELLPADDING=0>";result+='<TR>\n';result+=' <TD CLASS="'+this.cssPrefix+'cpYearNavigation" WIDTH="50%"><A CLASS="'+this.cssPrefix+'cpYearNavigation" HREF="javascript:'+windowref+'CP_refreshCalendar('+this.index+','+(year-(yearColumnSize*2))+');">&lt;&lt;</A></TD>\n';result+=' <TD CLASS="'+this.cssPrefix+'cpYearNavigation" WIDTH="50%"><A CLASS="'+this.cssPrefix+'cpYearNavigation" HREF="javascript:'+windowref+'CP_refreshCalendar('+this.index+','+(year+(yearColumnSize*2))+');">&gt;&gt;</A></TD>\n';result+='</TR></TABLE>\n';result+='<TABLE WIDTH=156 HEIGHT=120 BORDER=0 CELLSPACING=1 CELLPADDING=0 ALIGN=LEFT STYLE="margin-left:4px;">\n';for(var i=0;i<yearColumnSize;i++){for(var j=0;j<2;j++){var currentyear=year+(j*yearColumnSize)+i;result+='<TD WIDTH=50% ALIGN=CENTER><A CLASS="'+this.cssPrefix+'cpText" HREF="javascript:'+windowref+this.returnYearFunction+'('+currentyear+');'+windowref+'CP_hideCalendar(\''+this.index+'\');" CLASS="'+date_class+'">'+currentyear+'</A></TD>';}
result+='</TR>';}
result+='</TABLE></CENTER></TD></TR></TABLE>\n';}
if(this.type=="WINDOW"){result+="</BODY></HTML>\n";}
return result;}
;var CropDraggable=Class.create(Draggable,{initialize:function(element){this.options=Object.extend({drawMethod:function(){}},arguments[1]||{});this.element=$(element);this.handle=this.element;this.delta=this.currentDelta();this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this);},draw:function(point){var pos=Element.cumulativeOffset(this.element),d=this.currentDelta();pos[0]-=d[0];pos[1]-=d[1];var p=[0,1].map(function(i){return(point[i]-pos[i]-this.offset[i]);}.bind(this));this.options.drawMethod(p);}});var Cropper={};Cropper.Img=Class.create({initialize:function(element,options){this.options=Object.extend({ratioDim:{x:0,y:0},maxRatioDim:{x:0,y:0},minWidth:0,minHeight:0,displayOnInit:false,onEndCrop:Prototype.emptyFunction,captureKeys:true,onloadCoords:null,maxWidth:0,maxHeight:0,autoIncludeCSS:true},options||{});this.img=$(element);this.clickCoords={x:0,y:0};this.dragging=false;this.resizing=false;this.isWebKit=/Konqueror|Safari|KHTML/.test(navigator.userAgent);this.isIE=/MSIE/.test(navigator.userAgent);this.isOpera8=/Opera\s[1-8]/.test(navigator.userAgent);this.ratioX=0;this.ratioY=0;this.maxRatioX=0;this.maxRatioY=0;this.attached=false;this.fixedWidth=(this.options.maxWidth>0&&(this.options.minWidth>=this.options.maxWidth));this.fixedHeight=(this.options.maxHeight>0&&(this.options.minHeight>=this.options.maxHeight));if(typeof this.img=='undefined'){return;}
if(this.options.autoIncludeCSS){$$('script').each(function(s){if(s.src.match(/\/cropper([^\/]*)\.js/)){var path=s.src.replace(/\/cropper([^\/]*)\.js.*/,''),style=document.createElement('link');style.rel='stylesheet';style.type='text/css';style.href='';style.media='screen';document.getElementsByTagName('head')[0].appendChild(style);}});}
if(this.options.ratioDim.x>0&&this.options.ratioDim.y>0){var gcd=this.getGCD(this.options.ratioDim.x,this.options.ratioDim.y);this.ratioX=this.options.ratioDim.x/gcd;this.ratioY=this.options.ratioDim.y/gcd;}
if(this.options.maxRatioDim.x>0&&this.options.maxRatioDim.y>0){var gcd=this.getGCD(this.options.maxRatioDim.x,this.options.maxRatioDim.y);this.maxRatioX=this.options.maxRatioDim.x/gcd;this.maxRatioY=this.options.maxRatioDim.y/gcd;}
this.subInitialize();if(this.img.complete||this.isWebKit){this.onLoad();}else{Event.observe(this.img,'load',this.onLoad.bindAsEventListener(this));}},getGCD:function(a,b){if(b===0){return a;}
return this.getGCD(b,a%b);},onLoad:function(){var cNamePrefix='imgCrop_';var insertPoint=this.img.parentNode;var fixOperaClass='';if(this.isOpera8){fixOperaClass=' opera8';}
this.imgWrap=new Element('div',{'class':cNamePrefix+'wrap'+fixOperaClass});this.north=new Element('div',{'class':cNamePrefix+'overlay '+cNamePrefix+'north'}).insert(new Element('span'));this.east=new Element('div',{'class':cNamePrefix+'overlay '+cNamePrefix+'east'}).insert(new Element('span'));this.south=new Element('div',{'class':cNamePrefix+'overlay '+cNamePrefix+'south'}).insert(new Element('span'));this.west=new Element('div',{'class':cNamePrefix+'overlay '+cNamePrefix+'west'}).insert(new Element('span'));var overlays=[this.north,this.east,this.south,this.west];this.dragArea=new Element('div',{'class':cNamePrefix+'dragArea'});overlays.each(function(o){this.dragArea.insert(o);},this);this.handleN=new Element('div',{'class':cNamePrefix+'handle '+cNamePrefix+'handleN'});this.handleNE=new Element('div',{'class':cNamePrefix+'handle '+cNamePrefix+'handleNE'});this.handleE=new Element('div',{'class':cNamePrefix+'handle '+cNamePrefix+'handleE'});this.handleSE=new Element('div',{'class':cNamePrefix+'handle '+cNamePrefix+'handleSE'});this.handleS=new Element('div',{'class':cNamePrefix+'handle '+cNamePrefix+'handleS'});this.handleSW=new Element('div',{'class':cNamePrefix+'handle '+cNamePrefix+'handleSW'});this.handleW=new Element('div',{'class':cNamePrefix+'handle '+cNamePrefix+'handleW'});this.handleNW=new Element('div',{'class':cNamePrefix+'handle '+cNamePrefix+'handleNW'});this.selArea=new Element('div',{'class':cNamePrefix+'selArea'});[new Element('div',{'class':cNamePrefix+'marqueeHoriz '+cNamePrefix+'marqueeNorth'}).insert(new Element('span')),new Element('div',{'class':cNamePrefix+'marqueeVert '+cNamePrefix+'marqueeEast'}).insert(new Element('span')),new Element('div',{'class':cNamePrefix+'marqueeHoriz '+cNamePrefix+'marqueeSouth'}).insert(new Element('span')),new Element('div',{'class':cNamePrefix+'marqueeVert '+cNamePrefix+'marqueeWest'}).insert(new Element('span')),this.handleN,this.handleNE,this.handleE,this.handleSE,this.handleS,this.handleSW,this.handleW,this.handleNW,new Element('div',{'class':cNamePrefix+'clickArea'})].each(function(o){this.selArea.insert(o);},this);this.imgWrap.appendChild(this.img);this.imgWrap.appendChild(this.dragArea);this.dragArea.appendChild(this.selArea);this.dragArea.appendChild(new Element('div',{'class':cNamePrefix+'clickArea'}));insertPoint.appendChild(this.imgWrap);this.startDragBind=this.startDrag.bindAsEventListener(this);Event.observe(this.dragArea,'mousedown',this.startDragBind);this.onDragBind=this.onDrag.bindAsEventListener(this);Event.observe(document,'mousemove',this.onDragBind);this.endCropBind=this.endCrop.bindAsEventListener(this);Event.observe(document,'mouseup',this.endCropBind);this.resizeBind=this.startResize.bindAsEventListener(this);this.handles=[this.handleN,this.handleNE,this.handleE,this.handleSE,this.handleS,this.handleSW,this.handleW,this.handleNW];this.registerHandles(true);if(this.options.captureKeys){this.keysBind=this.handleKeys.bindAsEventListener(this);Event.observe(document,'keypress',this.keysBind);}
var x=new CropDraggable(this.selArea,{drawMethod:this.moveArea.bindAsEventListener(this)});this.setParams();},registerHandles:function(registration){for(var i=0;i<this.handles.length;i++){var handle=$(this.handles[i]);if(registration){var hideHandle=false;if(this.fixedWidth&&this.fixedHeight){hideHandle=true;}else if(this.fixedWidth||this.fixedHeight){var isCornerHandle=handle.className.match(/([S|N][E|W])$/),isWidthHandle=handle.className.match(/(E|W)$/),isHeightHandle=handle.className.match(/(N|S)$/);if(isCornerHandle||(this.fixedWidth&&isWidthHandle)||(this.fixedHeight&&isHeightHandle)){hideHandle=true;}}
if(hideHandle){handle.hide();}else{Event.observe(handle,'mousedown',this.resizeBind);}}else{handle.show();Event.stopObserving(handle,'mousedown',this.resizeBind);}}},setParams:function(){this.imgW=this.img.width;this.imgH=this.img.height;$(this.north).setStyle({height:0});$(this.east).setStyle({width:0,height:0});$(this.south).setStyle({height:0});$(this.west).setStyle({width:0,height:0});$(this.imgWrap).setStyle({'width':this.imgW+'px','height':this.imgH+'px'});$(this.selArea).hide();var startCoords={x1:0,y1:0,x2:0,y2:0},validCoordsSet=false;if(this.options.onloadCoords!==null){startCoords=this.cloneCoords(this.options.onloadCoords);validCoordsSet=true;}else if(this.options.ratioDim.x>0&&this.options.ratioDim.y>0){startCoords.x1=Math.ceil((this.imgW-this.options.ratioDim.x)/2);startCoords.y1=Math.ceil((this.imgH-this.options.ratioDim.y)/2);startCoords.x2=startCoords.x1+this.options.ratioDim.x;startCoords.y2=startCoords.y1+this.options.ratioDim.y;validCoordsSet=true;}
this.setAreaCoords(startCoords,false,false,1);if(this.options.displayOnInit&&validCoordsSet){this.selArea.show();this.drawArea();this.endCrop();}
this.attached=true;},remove:function(){if(this.attached){this.attached=false;this.imgWrap.parentNode.insertBefore(this.img,this.imgWrap);this.imgWrap.parentNode.removeChild(this.imgWrap);Event.stopObserving(this.dragArea,'mousedown',this.startDragBind);Event.stopObserving(document,'mousemove',this.onDragBind);Event.stopObserving(document,'mouseup',this.endCropBind);this.registerHandles(false);if(this.options.captureKeys){Event.stopObserving(document,'keypress',this.keysBind);}}},reset:function(){if(!this.attached){this.onLoad();}else{this.setParams();}
this.endCrop();},handleKeys:function(e){var dir={x:0,y:0};if(!this.dragging){switch(e.keyCode){case(37):dir.x=-1;break;case(38):dir.y=-1;break;case(39):dir.x=1;break;case(40):dir.y=1;break;}
if(dir.x!==0||dir.y!==0){if(e.shiftKey){dir.x*=10;dir.y*=10;}
this.moveArea([this.areaCoords.x1+dir.x,this.areaCoords.y1+dir.y]);this.endCrop();Event.stop(e);}}},calcW:function(){return(this.areaCoords.x2-this.areaCoords.x1);},calcH:function(){return(this.areaCoords.y2-this.areaCoords.y1);},moveArea:function(point){this.setAreaCoords({x1:point[0],y1:point[1],x2:point[0]+this.calcW(),y2:point[1]+this.calcH()},true,false);this.drawArea();},cloneCoords:function(coords){return{x1:coords.x1,y1:coords.y1,x2:coords.x2,y2:coords.y2};},setAreaCoords:function(coords,moving,square,direction,resizeHandle){if(moving){var targW=coords.x2-coords.x1,targH=coords.y2-coords.y1;if(coords.x1<0){coords.x1=0;coords.x2=targW;}
if(coords.y1<0){coords.y1=0;coords.y2=targH;}
if(coords.x2>this.imgW){coords.x2=this.imgW;coords.x1=this.imgW-targW;}
if(coords.y2>this.imgH){coords.y2=this.imgH;coords.y1=this.imgH-targH;}}else{if(coords.x1<0){coords.x1=0;}
if(coords.y1<0){coords.y1=0;}
if(coords.x2>this.imgW){coords.x2=this.imgW;}
if(coords.y2>this.imgH){coords.y2=this.imgH;}
if(direction!==null){if(this.ratioX>0){this.applyRatio(coords,{x:this.ratioX,y:this.ratioY},direction,resizeHandle);}else if(square){this.applyRatio(coords,{x:1,y:1},direction,resizeHandle);}
if(this.maxRatioX>0){this.applyMaxRatio(coords,{x:this.maxRatioX,y:this.maxRatioY},direction,resizeHandle);}
var mins=[this.options.minWidth,this.options.minHeight],maxs=[this.options.maxWidth,this.options.maxHeight];if(mins[0]>0||mins[1]>0||maxs[0]>0||maxs[1]>0){var coordsTransX={a1:coords.x1,a2:coords.x2},coordsTransY={a1:coords.y1,a2:coords.y2},boundsX={min:0,max:this.imgW},boundsY={min:0,max:this.imgH};if((mins[0]!==0||mins[1]!==0)&&square){if(mins[0]>0){mins[1]=mins[0];}else if(mins[1]>0){mins[0]=mins[1];}}
if((maxs[0]!==0||maxs[0]!==0)&&square){if(maxs[0]>0&&maxs[0]<=maxs[1]){maxs[1]=maxs[0];}else if(maxs[1]>0&&maxs[1]<=maxs[0]){maxs[0]=maxs[1];}}
if(mins[0]>0){this.applyDimRestriction(coordsTransX,mins[0],direction.x,boundsX,'min');}
if(mins[1]>1){this.applyDimRestriction(coordsTransY,mins[1],direction.y,boundsY,'min');}
if(maxs[0]>0){this.applyDimRestriction(coordsTransX,maxs[0],direction.x,boundsX,'max');}
if(maxs[1]>1){this.applyDimRestriction(coordsTransY,maxs[1],direction.y,boundsY,'max');}
coords={x1:coordsTransX.a1,y1:coordsTransY.a1,x2:coordsTransX.a2,y2:coordsTransY.a2};}}}
this.areaCoords=coords;},applyDimRestriction:function(coords,val,direction,bounds,type){var check;if(type=='min'){check=((coords.a2-coords.a1)<val);}
else{check=((coords.a2-coords.a1)>val);}
if(check){if(direction==1){coords.a2=coords.a1+val;}
else{coords.a1=coords.a2-val;}
if(coords.a1<bounds.min){coords.a1=bounds.min;coords.a2=val;}else if(coords.a2>bounds.max){coords.a1=bounds.max-val;coords.a2=bounds.max;}}},applyRatio:function(coords,ratio,direction,resizeHandle){var newCoords;if(resizeHandle=='N'||resizeHandle=='S'){newCoords=this.applyRatioToAxis({a1:coords.y1,b1:coords.x1,a2:coords.y2,b2:coords.x2},{a:ratio.y,b:ratio.x},{a:direction.y,b:direction.x},{min:0,max:this.imgW});coords.x1=newCoords.b1;coords.y1=newCoords.a1;coords.x2=newCoords.b2;coords.y2=newCoords.a2;}else{newCoords=this.applyRatioToAxis({a1:coords.x1,b1:coords.y1,a2:coords.x2,b2:coords.y2},{a:ratio.x,b:ratio.y},{a:direction.x,b:direction.y},{min:0,max:this.imgH});coords.x1=newCoords.a1;coords.y1=newCoords.b1;coords.x2=newCoords.a2;coords.y2=newCoords.b2;}},applyMaxRatio:function(coords,ratio,direction,resizeHandle){var newCoords;if(((coords.x2-coords.x1)/(coords.y2-coords.y1))<(ratio.x/ratio.y)){if(resizeHandle=='N'||resizeHandle=='S'){newCoords=this.applyRatioToAxis({a1:coords.y1,b1:coords.x1,a2:coords.y2,b2:coords.x2},{a:ratio.y,b:ratio.x},{a:direction.y,b:direction.x},{min:0,max:this.imgW});coords.x1=newCoords.b1;coords.y1=newCoords.a1;coords.x2=newCoords.b2;coords.y2=newCoords.a2;}else{newCoords=this.applyRatioToAxis({a1:coords.x1,b1:coords.y1,a2:coords.x2,b2:coords.y2},{a:ratio.x,b:ratio.y},{a:direction.x,b:direction.y},{min:0,max:this.imgH});coords.x1=newCoords.a1;coords.y1=newCoords.b1;coords.x2=newCoords.a2;coords.y2=newCoords.b2;}}},applyRatioToAxis:function(coords,ratio,direction,bounds){var newCoords=Object.extend(coords,{}),calcDimA=newCoords.a2-newCoords.a1,targDimB=Math.floor(calcDimA*ratio.b/ratio.a),targB=null,targDimA=null,calcDimB=null;if(direction.b==1){targB=newCoords.b1+targDimB;if(targB>bounds.max){targB=bounds.max;calcDimB=targB-newCoords.b1;}
newCoords.b2=targB;}else{targB=newCoords.b2-targDimB;if(targB<bounds.min){targB=bounds.min;calcDimB=targB+newCoords.b2;}
newCoords.b1=targB;}
if(calcDimB!==null){targDimA=Math.floor(calcDimB*ratio.a/ratio.b);if(direction.a==1){newCoords.a2=newCoords.a1+targDimA;}
else{newCoords.a1=newCoords.a1=newCoords.a2-targDimA;}}
return newCoords;},drawArea:function(){var areaWidth=this.calcW(),areaHeight=this.calcH();var px='px',params=[this.areaCoords.x1+px,this.areaCoords.y1+px,areaWidth+px,areaHeight+px,this.areaCoords.x2+px,this.areaCoords.y2+px,(this.img.width-this.areaCoords.x2)+px,(this.img.height-this.areaCoords.y2)+px];var areaStyle=this.selArea.style;areaStyle.left=params[0];areaStyle.top=params[1];areaStyle.width=params[2];areaStyle.height=params[3];var horizHandlePos=Math.ceil((areaWidth-6)/2)+px,vertHandlePos=Math.ceil((areaHeight-6)/2)+px;this.handleN.style.left=horizHandlePos;this.handleE.style.top=vertHandlePos;this.handleS.style.left=horizHandlePos;this.handleW.style.top=vertHandlePos;this.north.style.height=params[1];var eastStyle=this.east.style;eastStyle.top=params[1];eastStyle.height=params[3];eastStyle.left=params[4];eastStyle.width=params[6];var southStyle=this.south.style;southStyle.top=params[5];southStyle.height=params[7];var westStyle=this.west.style;westStyle.top=params[1];westStyle.height=params[3];westStyle.width=params[0];this.subDrawArea();this.forceReRender();},forceReRender:function(){if(this.isIE||this.isWebKit){var n=document.createTextNode(' ');var d,el,fixEL,i;if(this.isIE){fixEl=this.selArea;}
else if(this.isWebKit){fixEl=document.getElementsByClassName('imgCrop_marqueeSouth',this.imgWrap)[0];d=new Element('div');d.style.visibility='hidden';var classList=['SE','S','SW'];for(i=0;i<classList.length;i++){el=document.getElementsByClassName('imgCrop_handle'+classList[i],this.selArea)[0];if(el.childNodes.length){el.removeChild(el.childNodes[0]);}
el.appendChild(d);}}
fixEl.appendChild(n);fixEl.removeChild(n);}},startResize:function(e){this.startCoords=this.cloneCoords(this.areaCoords);this.resizing=true;this.resizeHandle=Event.element(e).classNames().toString().replace(/([^N|NE|E|SE|S|SW|W|NW])+/,'');Event.stop(e);},startDrag:function(e){this.selArea.show();this.clickCoords=this.getCurPos(e);this.setAreaCoords({x1:this.clickCoords.x,y1:this.clickCoords.y,x2:this.clickCoords.x,y2:this.clickCoords.y},false,false,null);this.dragging=true;this.onDrag(e);Event.stop(e);},getCurPos:function(e){var el=this.imgWrap,wrapOffsets=Element.cumulativeOffset(el);while(el.nodeName!='BODY'){wrapOffsets[1]-=el.scrollTop||0;wrapOffsets[0]-=el.scrollLeft||0;el=el.parentNode;}
return{x:Event.pointerX(e)-wrapOffsets[0],y:Event.pointerY(e)-wrapOffsets[1]};},onDrag:function(e){if(this.dragging||this.resizing){var resizeHandle=null,curPos=this.getCurPos(e),newCoords=this.cloneCoords(this.areaCoords),direction={x:1,y:1};if(this.dragging){if(curPos.x<this.clickCoords.x){direction.x=-1;}
if(curPos.y<this.clickCoords.y){direction.y=-1;}
this.transformCoords(curPos.x,this.clickCoords.x,newCoords,'x');this.transformCoords(curPos.y,this.clickCoords.y,newCoords,'y');}else if(this.resizing){resizeHandle=this.resizeHandle;if(resizeHandle.match(/E/)){this.transformCoords(curPos.x,this.startCoords.x1,newCoords,'x');if(curPos.x<this.startCoords.x1){direction.x=-1;}}else if(resizeHandle.match(/W/)){this.transformCoords(curPos.x,this.startCoords.x2,newCoords,'x');if(curPos.x<this.startCoords.x2){direction.x=-1;}}
if(resizeHandle.match(/N/)){this.transformCoords(curPos.y,this.startCoords.y2,newCoords,'y');if(curPos.y<this.startCoords.y2){direction.y=-1;}}else if(resizeHandle.match(/S/)){this.transformCoords(curPos.y,this.startCoords.y1,newCoords,'y');if(curPos.y<this.startCoords.y1){direction.y=-1;}}}
this.setAreaCoords(newCoords,false,e.shiftKey,direction,resizeHandle);this.drawArea();Event.stop(e);}},transformCoords:function(curVal,baseVal,coords,axis){var newVals=[curVal,baseVal];if(curVal>baseVal){newVals.reverse();}
coords[axis+'1']=newVals[0];coords[axis+'2']=newVals[1];},endCrop:function(){this.dragging=false;this.resizing=false;this.options.onEndCrop(this.areaCoords,{width:this.calcW(),height:this.calcH()});},subInitialize:function(){},subDrawArea:function(){}});Cropper.ImgWithPreview=Class.create(Cropper.Img,{subInitialize:function(){this.hasPreviewImg=false;if(typeof(this.options.previewWrap)!='undefined'&&this.options.minWidth>0&&this.options.minHeight>0){this.previewWrap=$(this.options.previewWrap);this.previewImg=this.img.cloneNode(false);this.previewImg.id='imgCrop_'+this.previewImg.id;this.options.displayOnInit=true;this.hasPreviewImg=true;this.previewWrap.addClassName('imgCrop_previewWrap');this.previewWrap.setStyle({width:this.options.previewWidth+'px',height:this.options.previewHeight+'px'});this.previewWrap.appendChild(this.previewImg);}},subDrawArea:function(){if(this.hasPreviewImg){var calcWidth=this.calcW(),calcHeight=this.calcH();var dimRatio={x:this.imgW/calcWidth,y:this.imgH/calcHeight};var posRatio={x:calcWidth/this.options.previewWidth,y:calcHeight/this.options.previewHeight};var calcPos={w:Math.ceil(this.options.previewWidth*dimRatio.x)+'px',h:Math.ceil(this.options.previewHeight*dimRatio.y)+'px',x:'-'+Math.ceil(this.areaCoords.x1/posRatio.x)+'px',y:'-'+Math.ceil(this.areaCoords.y1/posRatio.y)+'px'};var previewStyle=this.previewImg.style;previewStyle.width=calcPos.w;previewStyle.height=calcPos.h;previewStyle.left=calcPos.x;previewStyle.top=calcPos.y;}}});
;var TableKit=Class.create();TableKit.prototype={initialize:function(elm,options){var table=$(elm);if(table.tagName!=="TABLE"){return;}
TableKit.register(table,Object.extend(TableKit.options,options||{}));this.id=table.id;var op=TableKit.option('sortable resizable editable',this.id);if(op.sortable){TableKit.Sortable.init(table);}
if(op.resizable){TableKit.Resizable.init(table);}
if(op.editable){TableKit.Editable.init(table);}},sort:function(column,order){TableKit.Sortable.sort(this.id,column,order);},resizeColumn:function(column,w){TableKit.Resizable.resize(this.id,column,w);},editCell:function(row,column){TableKit.Editable.editCell(this.id,row,column);}};Object.extend(TableKit,{getBodyRows:function(table,force){table=$(table);var id=table.id;if(force||!TableKit.tables[id].dom.rows){TableKit.tables[id].dom.rows=(table.tHead&&table.tHead.rows.length>0)?$A(table.tBodies[0].rows):$A(table.rows).without(table.rows[0]);}
return TableKit.tables[id].dom.rows;},getHeaderCells:function(table,cell){if(!table){table=$(cell).up('table');}
var id=table.id;if(!TableKit.tables[id].dom.head){TableKit.tables[id].dom.head=$A((table.tHead&&table.tHead.rows.length>0)?table.tHead.rows[table.tHead.rows.length-1].cells:table.rows[0].cells);}
return TableKit.tables[id].dom.head;},getCellIndex:function(cell){return $A(cell.parentNode.cells).indexOf(cell);},getRowIndex:function(row){return $A(row.parentNode.rows).indexOf(row);},getCellText:function(cell,refresh){if(!cell){return"";}
var data=TableKit.getCellData(cell);if(refresh||data.refresh||!data.textContent){data.textContent=cell.textContent?cell.textContent:cell.innerText;data.refresh=false;}
if(data.textContent){data.textContent=data.textContent.strip();}
return data.textContent;},getCellData:function(cell){var t=null;if(!cell.id){t=$(cell).up('table');cell.id=t.id+"-cell-"+TableKit._getc();}
var tblid=t?t.id:cell.id.match(/(.*)-cell.*/)[1];if(!TableKit.tables[tblid].dom.cells[cell.id]){TableKit.tables[tblid].dom.cells[cell.id]={textContent:'',htmlContent:'',active:false};}
return TableKit.tables[tblid].dom.cells[cell.id];},register:function(table,options){if(!table.id){table.id="tablekit-table-"+TableKit._getc();}
var id=table.id;TableKit.tables[id]=TableKit.tables[id]?Object.extend(TableKit.tables[id],options||{}):Object.extend({dom:{head:null,rows:null,cells:{}},sortable:false,resizable:false,editable:false},options||{});},notify:function(eventName,table,event){if(TableKit.tables[table.id]&&TableKit.tables[table.id].observers&&TableKit.tables[table.id].observers[eventName]){TableKit.tables[table.id].observers[eventName](table,event);}
TableKit.options.observers[eventName](table,event)();},isSortable:function(table){return TableKit.tables[table.id]?TableKit.tables[table.id].sortable:false;},isResizable:function(table){return TableKit.tables[table.id]?TableKit.tables[table.id].resizable:false;},isEditable:function(table){return TableKit.tables[table.id]?TableKit.tables[table.id].editable:false;},setup:function(o){Object.extend(TableKit.options,o||{});},option:function(s,id,o1,o2){o1=o1||TableKit.options;o2=o2||(id?(TableKit.tables[id]?TableKit.tables[id]:{}):{});var key=id+s;if(!TableKit._opcache[key]){TableKit._opcache[key]=$A($w(s)).inject([],function(a,v){a.push(a[v]=o2[v]||o1[v]);return a;});}
return TableKit._opcache[key];},e:function(event){return event||window.event;},tables:{},_opcache:{},options:{autoLoad:true,stripe:false,sortable:true,resizable:true,editable:true,rowEvenClass:'roweven',rowOddClass:'rowodd',sortableSelector:['table.sortable'],columnClass:'sortcol',descendingClass:'sortdesc',ascendingClass:'sortasc',defaultSortDirection:1,noSortClass:'nosort',sortFirstAscendingClass:'sortfirstasc',sortFirstDecendingClass:'sortfirstdesc',resizableSelector:['table.resizable'],minWidth:10,showHandle:true,resizeOnHandleClass:'resize-handle-active',editableSelector:['table.editable'],formClassName:'editable-cell-form',noEditClass:'noedit',editAjaxURI:'/',editAjaxOptions:{},observers:{'onSortStart':function(){},'onSort':function(){},'onSortEnd':function(){},'onResizeStart':function(){},'onResize':function(){},'onResizeEnd':function(){},'onEditStart':function(){},'onEdit':function(){},'onEditEnd':function(){}}},_c:0,_getc:function(){return TableKit._c+=1;},unloadTable:function(table){table=$(table);if((!table)||(!TableKit.tables[table.id])){return;}
var cells=TableKit.getHeaderCells(table);var op=TableKit.option('sortable resizable editable noSortClass descendingClass ascendingClass columnClass sortFirstAscendingClass sortFirstDecendingClass',table.id);cells.each(function(c){c=$(c);if(op.sortable){if(!c.hasClassName(op.noSortClass)){Event.stopObserving(c,'click',TableKit.Sortable._sort);c.removeClassName(op.columnClass);c.removeClassName(op.sortFirstAscendingClass);c.removeClassName(op.sortFirstDecendingClass);if(c.hasClassName(op.ascendingClass)){c.removeClassName(op.ascendingClass);c.addClassName(op.sortFirstAscendingClass)}else if(c.hasClassName(op.descendingClass)){c.removeClassName(op.descendingClass);c.addClassName(op.sortFirstDecendingClass)}}}
if(op.resizable){Event.stopObserving(c,'mouseover',TableKit.Resizable.initDetect);Event.stopObserving(c,'mouseout',TableKit.Resizable.killDetect);}});if(op.editable){Event.stopObserving(table.tBodies[0],'click',TableKit.Editable._editCell);for(var c in TableKit.tables[table.id].dom.cells){if(TableKit.tables[table.id].dom.cells[c].active){var cell=$(c);var editor=TableKit.Editable.getCellEditor(cell);editor.cancel(cell);}}}
TableKit.tables[table.id].dom={head:null,rows:null,cells:{}};},reloadTable:function(table){table=$(table);TableKit.unloadTable(table);if(!(table))return;var op=TableKit.option('sortable resizable editable',table.id);if(op.sortable){TableKit.Sortable.init(table);}
if(op.resizable){TableKit.Resizable.init(table);}
if(op.editable){TableKit.Editable.init(table);}},reload:function(){for(var k in TableKit.tables){TableKit.reloadTable(k);}},load:function(){if(TableKit.options.autoLoad){if(TableKit.options.sortable){$A(TableKit.options.sortableSelector).each(function(s){$$(s).each(function(t){TableKit.Sortable.init(t);});});}
if(TableKit.options.resizable){$A(TableKit.options.resizableSelector).each(function(s){$$(s).each(function(t){TableKit.Resizable.init(t);});});}
if(TableKit.options.editable){$A(TableKit.options.editableSelector).each(function(s){$$(s).each(function(t){TableKit.Editable.init(t);});});}}}});TableKit.Rows={stripe:function(table){var rows=TableKit.getBodyRows(table);rows.each(function(r,i){TableKit.Rows.addStripeClass(table,r,i);});},addStripeClass:function(t,r,i){t=t||r.up('table');var op=TableKit.option('rowEvenClass rowOddClass',t.id);var css=((i+1)%2===0?op[0]:op[1]);var cn=r.className.split(/\s+/);var newCn=[];for(var x=0,l=cn.length;x<l;x+=1){if(cn[x]!==op[0]&&cn[x]!==op[1]){newCn.push(cn[x]);}}
newCn.push(css);r.className=newCn.join(" ");}};TableKit.Sortable={init:function(elm,options){var table=$(elm);if((!table)||(table.tagName!=="TABLE")){return;}
TableKit.register(table,Object.extend(options||{},{sortable:true}));var sortFirst;var cells=TableKit.getHeaderCells(table);var op=TableKit.option('noSortClass columnClass sortFirstAscendingClass sortFirstDecendingClass',table.id);cells.each(function(c){c=$(c);if(!c.hasClassName(op.noSortClass)){Event.observe(c,'click',TableKit.Sortable._sort);c.addClassName(op.columnClass);if(c.hasClassName(op.sortFirstAscendingClass)||c.hasClassName(op.sortFirstDecendingClass)){sortFirst=c;}}});if(sortFirst){if(sortFirst.hasClassName(op.sortFirstAscendingClass)){TableKit.Sortable.sort(table,sortFirst,1);}else{TableKit.Sortable.sort(table,sortFirst,-1);}}else{}},reload:function(table){table=$(table);var cells=TableKit.getHeaderCells(table);var op=TableKit.option('noSortClass columnClass',table.id);cells.each(function(c){c=$(c);if(!c.hasClassName(op.noSortClass)){Event.stopObserving(c,'click',TableKit.Sortable._sort);c.removeClassName(op.columnClass);}});TableKit.Sortable.init(table);},_sort:function(e){if(TableKit.Resizable._onHandle){return;}
e=TableKit.e(e);Event.stop(e);var cell=Event.element(e);while(!(cell.tagName&&cell.tagName.match(/td|th/gi))){cell=cell.parentNode;}
TableKit.Sortable.sort(null,cell);},sort:function(table,index,order){var cell;if(typeof index==='number'){if(table.tagName&&table.tagName!=="TABLE"){return;}
table=$(table);if(!table){return;}
index=Math.min(table.rows[0].cells.length,index);index=Math.max(1,index);index-=1;cell=(table.tHead&&table.tHead.rows.length>0)?$(table.tHead.rows[table.tHead.rows.length-1].cells[index]):$(table.rows[0].cells[index]);}else{if($(index)){cell=$(index);table=table?$(table):cell.up('table');index=TableKit.getCellIndex(cell);}else{table=$(table);if(!table){return;}
for(var i=0;i<table.rows[0].cells.length;i++){if(table.rows[0].cells[i].readAttribute('yg_colindex')==index){cell=table.rows[0].cells[i];index=i;break;}}}}
var op=TableKit.option('noSortClass descendingClass ascendingClass defaultSortDirection',table.id);if((!cell)||cell.hasClassName(op.noSortClass)){return;}
order=order?order:op.defaultSortDirection;var rows=TableKit.getBodyRows(table,true);if(cell.hasClassName(op.ascendingClass)||cell.hasClassName(op.descendingClass)){rows.reverse();order=cell.hasClassName(op.descendingClass)?1:-1;var datatype=TableKit.Sortable.getDataType(cell,index,table);var tkst=TableKit.Sortable.types;rows.sort(function(a,b){return order*tkst[datatype].compare(TableKit.getCellText(a.cells[index]),TableKit.getCellText(b.cells[index]));});}else{var datatype=TableKit.Sortable.getDataType(cell,index,table);var tkst=TableKit.Sortable.types;rows.sort(function(a,b){return order*tkst[datatype].compare(TableKit.getCellText(a.cells[index]),TableKit.getCellText(b.cells[index]));});}
var tb=table.tBodies[0];var tkr=TableKit.Rows;rows.each(function(r,i){tb.appendChild(r);});var hcells=TableKit.getHeaderCells(null,cell);$A(hcells).each(function(c,i){c=$(c);c.removeClassName(op.ascendingClass);c.removeClassName(op.descendingClass);if(index===i){if(order===1){c.addClassName(op.ascendingClass);}else{c.addClassName(op.descendingClass);}}});},types:{},detectors:[],addSortType:function(){$A(arguments).each(function(o){TableKit.Sortable.types[o.name]=o;});},getDataType:function(cell,index,table){cell=$(cell);index=(index||index===0)?index:TableKit.getCellIndex(cell);var colcache=TableKit.Sortable._coltypecache;var cache=colcache[table.id]?colcache[table.id]:(colcache[table.id]={});if(!cache[index]){var t=false;if(cell.id&&TableKit.Sortable.types[cell.id]){t=cell.id}
if(!t){t=$w(cell.className).detect(function(n){return(TableKit.Sortable.types[n])?true:false;});}
if(!t){var rows=TableKit.getBodyRows(table);if(rows[0]!=undefined){cell=rows[0].cells[index];t=TableKit.Sortable.detectors.detect(function(d){return TableKit.Sortable.types[d].detect(TableKit.getCellText(cell));});}}
cache[index]=t;}
return cache[index];},_coltypecache:{}};TableKit.Sortable.detectors=$A($w('date-iso date date-eu date-au time currency datasize number casesensitivetext text'));TableKit.Sortable.Type=Class.create();TableKit.Sortable.Type.prototype={initialize:function(name,options){this.name=name;options=Object.extend({normal:function(v){return v;},pattern:/.*/},options||{});this.normal=options.normal;this.pattern=options.pattern;if(options.compare){this.compare=options.compare;}
if(options.detect){this.detect=options.detect;}},compare:function(a,b){return TableKit.Sortable.Type.compare(this.normal(a),this.normal(b));},detect:function(v){return this.pattern.test(v);}};TableKit.Sortable.Type.compare=function(a,b){return a<b?-1:a===b?0:1;};TableKit.Sortable.addSortType(new TableKit.Sortable.Type('number',{pattern:/^[-+]?[\d]*\.?[\d]+(?:[eE][-+]?[\d]+)?/,normal:function(v){v=parseFloat(v.replace(/^.*?([-+]?[\d]*\.?[\d]+(?:[eE][-+]?[\d]+)?).*$/,"$1"));return isNaN(v)?0:v;}}),new TableKit.Sortable.Type('text',{normal:function(v){return v?v.toLowerCase():'';}}),new TableKit.Sortable.Type('casesensitivetext',{pattern:/^[A-Z]+$/}),new TableKit.Sortable.Type('datasize',{pattern:/^[-+]?[\d]*\.?[\d]+(?:[eE][-+]?[\d]+)?\s?[k|m|g|t]b$/i,normal:function(v){var r=v.match(/^([-+]?[\d]*\.?[\d]+([eE][-+]?[\d]+)?)\s?([k|m|g|t]?b)?/i);var b=r[1]?Number(r[1]).valueOf():0;var m=r[3]?r[3].substr(0,1).toLowerCase():'';var result=b;switch(m){case'k':result=b*1024;break;case'm':result=b*1024*1024;break;case'g':result=b*1024*1024*1024;break;case't':result=b*1024*1024*1024*1024;break;}
return result;}}),new TableKit.Sortable.Type('date-au',{pattern:/^\d{2}\/\d{2}\/\d{4}\s?(?:\d{1,2}\:\d{2}(?:\:\d{2})?\s?[a|p]?m?)?/i,normal:function(v){if(!this.pattern.test(v)){return 0;}
var r=v.match(/^(\d{2})\/(\d{2})\/(\d{4})\s?(?:(\d{1,2})\:(\d{2})(?:\:(\d{2}))?\s?([a|p]?m?))?/i);var yr_num=r[3];var mo_num=parseInt(r[2],10)-1;var day_num=r[1];var hr_num=r[4]?r[4]:0;if(r[7]){var chr=parseInt(r[4],10);if(r[7].toLowerCase().indexOf('p')!==-1){hr_num=chr<12?chr+12:chr;}else if(r[7].toLowerCase().indexOf('a')!==-1){hr_num=chr<12?chr:0;}}
var min_num=r[5]?r[5]:0;var sec_num=r[6]?r[6]:0;return new Date(yr_num,mo_num,day_num,hr_num,min_num,sec_num,0).valueOf();}}),new TableKit.Sortable.Type('date-us',{pattern:/^\d{2}\/\d{2}\/\d{4}\s?(?:\d{1,2}\:\d{2}(?:\:\d{2})?\s?[a|p]?m?)?/i,normal:function(v){if(!this.pattern.test(v)){return 0;}
var r=v.match(/^(\d{2})\/(\d{2})\/(\d{4})\s?(?:(\d{1,2})\:(\d{2})(?:\:(\d{2}))?\s?([a|p]?m?))?/i);var yr_num=r[3];var mo_num=parseInt(r[1],10)-1;var day_num=r[2];var hr_num=r[4]?r[4]:0;if(r[7]){var chr=parseInt(r[4],10);if(r[7].toLowerCase().indexOf('p')!==-1){hr_num=chr<12?chr+12:chr;}else if(r[7].toLowerCase().indexOf('a')!==-1){hr_num=chr<12?chr:0;}}
var min_num=r[5]?r[5]:0;var sec_num=r[6]?r[6]:0;return new Date(yr_num,mo_num,day_num,hr_num,min_num,sec_num,0).valueOf();}}),new TableKit.Sortable.Type('date-eu',{pattern:/^\d{2}-\d{2}-\d{4}/i,normal:function(v){if(!this.pattern.test(v)){return 0;}
var r=v.match(/^(\d{2})-(\d{2})-(\d{4})/);var yr_num=r[3];var mo_num=parseInt(r[2],10)-1;var day_num=r[1];return new Date(yr_num,mo_num,day_num).valueOf();}}),new TableKit.Sortable.Type('date-iso',{pattern:/[\d]{4}-[\d]{2}-[\d]{2}(?:T[\d]{2}\:[\d]{2}(?:\:[\d]{2}(?:\.[\d]+)?)?(Z|([-+][\d]{2}:[\d]{2})?)?)?/,normal:function(v){if(!this.pattern.test(v)){return 0;}
var d=v.match(/([\d]{4})(-([\d]{2})(-([\d]{2})(T([\d]{2}):([\d]{2})(:([\d]{2})(\.([\d]+))?)?(Z|(([-+])([\d]{2}):([\d]{2})))?)?)?)?/);var offset=0;var date=new Date(d[1],0,1);if(d[3]){date.setMonth(d[3]-1);}
if(d[5]){date.setDate(d[5]);}
if(d[7]){date.setHours(d[7]);}
if(d[8]){date.setMinutes(d[8]);}
if(d[10]){date.setSeconds(d[10]);}
if(d[12]){date.setMilliseconds(Number("0."+d[12])*1000);}
if(d[14]){offset=(Number(d[16])*60)+Number(d[17]);offset*=((d[15]==='-')?1:-1);}
offset-=date.getTimezoneOffset();if(offset!==0){var time=(Number(date)+(offset*60*1000));date.setTime(Number(time));}
return date.valueOf();}}),new TableKit.Sortable.Type('date',{pattern:/^(?:sun|mon|tue|wed|thu|fri|sat)\,\s\d{1,2}\s(?:jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\s\d{4}(?:\s\d{2}\:\d{2}(?:\:\d{2})?(?:\sGMT(?:[+-]\d{4})?)?)?/i,compare:function(a,b){if(a&&b){return TableKit.Sortable.Type.compare(new Date(a),new Date(b));}else{return TableKit.Sortable.Type.compare(a?1:0,b?1:0);}}}),new TableKit.Sortable.Type('time',{pattern:/^\d{1,2}\:\d{2}(?:\:\d{2})?(?:\s[a|p]m)?$/i,compare:function(a,b){var d=new Date();var ds=d.getMonth()+"/"+d.getDate()+"/"+d.getFullYear()+" ";return TableKit.Sortable.Type.compare(new Date(ds+a),new Date(ds+b));}}),new TableKit.Sortable.Type('currency',{pattern:/^[$]/,normal:function(v){return v?parseFloat(v.replace(/[^-\d\.]/g,'')):0;}}));TableKit.Resizable={init:function(elm,options){var table=$(elm);if(table.tagName!=="TABLE"){return;}
TableKit.register(table,Object.extend(options||{},{resizable:true}));var cells=TableKit.getHeaderCells(table);cells.each(function(c){c=$(c);Event.observe(c,'mouseover',TableKit.Resizable.initDetect);Event.observe(c,'mouseout',TableKit.Resizable.killDetect);});},resize:function(table,index,w){var cell;if(typeof index==='number'){if(!table||(table.tagName&&table.tagName!=="TABLE")){return;}
table=$(table);index=Math.min(table.rows[0].cells.length,index);index=Math.max(1,index);index-=1;cell=(table.tHead&&table.tHead.rows.length>0)?$(table.tHead.rows[table.tHead.rows.length-1].cells[index]):$(table.rows[0].cells[index]);}else{cell=$(index);table=table?$(table):cell.up('table');index=TableKit.getCellIndex(cell);}
if(!(cell.minwidth))cell.minwidth=35;if(w){cell.setStyle({'width':w+'px'});}
maxrows=table.rows.length;for(var k=0;k<maxrows;k++){if(index>-1){if(w<cell.minwidth)w=cell.minwidth;if(w){$(table.rows[k].cells[index]).setStyle({'width':w+'px'});}}}},initDetect:function(e){e=TableKit.e(e);var cell=Event.element(e);Event.observe(cell,'mousemove',TableKit.Resizable.detectHandle);Event.observe(cell,'mousedown',TableKit.Resizable.startResize);},detectHandle:function(e){e=TableKit.e(e);var cell=Event.element(e);if(cell.hasClassName('mk_notresizable'))return;if((cell.hasClassName('sortcol')&&(TableKit.Resizable.pointerPos(cell,Event.pointerX(e),Event.pointerY(e))))){cell.addClassName(TableKit.option('resizeOnHandleClass',cell.up('table').id)[0]);TableKit.Resizable._onHandle=true;}else{cell.removeClassName(TableKit.option('resizeOnHandleClass',cell.up('table').id)[0]);TableKit.Resizable._onHandle=false;}},killDetect:function(e){e=TableKit.e(e);TableKit.Resizable._onHandle=false;var cell=Event.element(e);Event.stopObserving(cell,'mousemove',TableKit.Resizable.detectHandle);Event.stopObserving(cell,'mousedown',TableKit.Resizable.startResize);cell.removeClassName(TableKit.option('resizeOnHandleClass',cell.up('table').id)[0]);},startResize:function(e){e=TableKit.e(e);if(!TableKit.Resizable._onHandle){return;}
var cell=Event.element(e);Event.stopObserving(cell,'mousemove',TableKit.Resizable.detectHandle);Event.stopObserving(cell,'mousedown',TableKit.Resizable.startResize);Event.stopObserving(cell,'mouseout',TableKit.Resizable.killDetect);TableKit.Resizable._cell=cell;var table=cell.up('table');if(table.up('.ydialog')){table.handleheight=table.up('.outercontent').getHeight()-cell.getHeight()+34;cell.maxwidth=table.up('.outercontent').getWidth();}else{table.handleheight=table.up('.ywindowouter').getHeight()-cell.getHeight()+34;cell.maxwidth=table.up('.ywindowouter').getWidth();}
TableKit.Resizable._tbl=table;if(TableKit.option('showHandle',table.id)[0]){TableKit.Resizable._handle=$(document.createElement('div')).addClassName('resize-handle').setStyle({'top':cell.viewportOffset()[1]+'px','left':Event.pointerX(e)+'px','height':(table.handleheight)+'px'});document.body.appendChild(TableKit.Resizable._handle);TableKit.Resizable._cell.minwidth=$(TableKit.Resizable._cell).getStyle('min-width');if(TableKit.Resizable._cell.minwidth==undefined)TableKit.Resizable._cell.minwidth="50px";TableKit.Resizable._cell.minwidth=Math.round(TableKit.Resizable._cell.minwidth.substring(0,TableKit.Resizable._cell.minwidth.length-2));}
Event.observe(document,'mousemove',TableKit.Resizable.drag);Event.observe(document,'mouseup',TableKit.Resizable.endResize);Event.stop(e);},endResize:function(e){e=TableKit.e(e);var cell=TableKit.Resizable._cell;if(Event.pointerX(e)<(TableKit.Resizable._cell.viewportOffset()[0]+TableKit.Resizable._cell.minwidth)){var resizeto=TableKit.Resizable._cell.minwidth;}else if(Event.pointerX(e)>TableKit.Resizable._cell.viewportOffset()[0]+TableKit.Resizable._cell.maxwidth){var resizeto=TableKit.Resizable._cell.maxwidth;}else{var resizeto=Event.pointerX(e)-TableKit.Resizable._cell.viewportOffset()[0];}
if(TableKit.getCellIndex(cell)!=-1){TableKit.Resizable._tbl.setStyle({width:'auto'});var wndid=$(TableKit.Resizable._tbl).up('.ywindow').id;var styles=cell.className.split(" ");var colstyle=null;for(var i=0;i<styles.length;i++){if(styles[i].substring(1,5)=="col_"){colstyle=styles[i];}}
$K.yg_changeCSS('#'+wndid+' .'+colstyle,'width',resizeto+'px',true);if(cell.descendantOf(wndid+"_column2")){$K.windows[wndid].refresh("col2");}else{$K.windows[wndid].refresh("col1");}}
Event.stopObserving(document,'mousemove',TableKit.Resizable.drag);Event.stopObserving(document,'mouseup',TableKit.Resizable.endResize);if(TableKit.option('showHandle',TableKit.Resizable._tbl.id)[0]){$$('div.resize-handle').each(function(elm){document.body.removeChild(elm);});}
Event.observe(cell,'mouseout',TableKit.Resizable.killDetect);TableKit.Resizable.c=TableKit.Resizable._handle=TableKit.Resizable._cell=null;Event.stop(e);},drag:function(e){e=TableKit.e(e);if(TableKit.Resizable._handle===null){try{TableKit.Resizable.resize(TableKit.Resizable._tbl,TableKit.Resizable._cell,(Event.pointerX(e)-TableKit.Resizable._cell.viewportOffset()[0]));}catch(e){}}else{if(Event.pointerX(e)<(TableKit.Resizable._cell.viewportOffset()[0]+TableKit.Resizable._cell.minwidth)){var leftvar=TableKit.Resizable._cell.viewportOffset()[0]+TableKit.Resizable._cell.minwidth;}else if(Event.pointerX(e)>(TableKit.Resizable._cell.viewportOffset()[0]+TableKit.Resizable._cell.maxwidth)){var leftvar=TableKit.Resizable._cell.viewportOffset()[0]+TableKit.Resizable._cell.maxwidth;}else{var leftvar=Event.pointerX(e);}
TableKit.Resizable._handle.setStyle({'left':leftvar+'px'});}
return false;},pointerPos:function(element,x,y){var offset=$(element).viewportOffset();return(y>=offset[1]&&y<offset[1]+element.offsetHeight&&x>=offset[0]+element.offsetWidth-5&&x<offset[0]+element.offsetWidth);},_onHandle:false,_cell:null,_tbl:null,_handle:null};TableKit.Editable={init:function(elm,options){var table=$(elm);if(table.tagName!=="TABLE"){return;}
TableKit.register(table,Object.extend(options||{},{editable:true}));Event.observe(table.tBodies[0],'click',TableKit.Editable._editCell);},_editCell:function(e){e=TableKit.e(e);var cell=Event.findElement(e,'td');if(cell){TableKit.Editable.editCell(null,cell,null,e);}else{return false;}},editCell:function(table,index,cindex,event){var cell,row;if(typeof index==='number'){if(!table||(table.tagName&&table.tagName!=="TABLE")){return;}
table=$(table);index=Math.min(table.tBodies[0].rows.length,index);index=Math.max(1,index);index-=1;cindex=Math.min(table.rows[0].cells.length,cindex);cindex=Math.max(1,cindex);cindex-=1;row=$(table.tBodies[0].rows[index]);cell=$(row.cells[cindex]);}else{cell=$(event?Event.findElement(event,'td'):index);table=(table&&table.tagName&&table.tagName!=="TABLE")?$(table):cell.up('table');row=cell.up('tr');}
var op=TableKit.option('noEditClass',table.id);if(cell.hasClassName(op.noEditClass)){return;}
var head=$(TableKit.getHeaderCells(table,cell)[TableKit.getCellIndex(cell)]);if(head.hasClassName(op.noEditClass)){return;}
var data=TableKit.getCellData(cell);if(data.active){return;}
data.htmlContent=cell.innerHTML;var ftype=TableKit.Editable.getCellEditor(null,null,head);ftype.edit(cell,event);data.active=true;},getCellEditor:function(cell,table,head){var head=head?head:$(TableKit.getHeaderCells(table,cell)[TableKit.getCellIndex(cell)]);var ftype=TableKit.Editable.types['text-input'];if(head.id&&TableKit.Editable.types[head.id]){ftype=TableKit.Editable.types[head.id];}else{var n=$w(head.className).detect(function(n){return(TableKit.Editable.types[n])?true:false;});ftype=n?TableKit.Editable.types[n]:ftype;}
return ftype;},types:{},addCellEditor:function(o){if(o&&o.name){TableKit.Editable.types[o.name]=o;}}};TableKit.Editable.CellEditor=Class.create();TableKit.Editable.CellEditor.prototype={initialize:function(name,options){this.name=name;this.options=Object.extend({element:'input',attributes:{name:'value',type:'text'},selectOptions:[],showSubmit:true,submitText:'OK',showCancel:true,cancelText:'Cancel',ajaxURI:null,ajaxOptions:null},options||{});},edit:function(cell){cell=$(cell);var op=this.options;var table=cell.up('table');var form=$(document.createElement("form"));form.id=cell.id+'-form';form.addClassName(TableKit.option('formClassName',table.id)[0]);form.onsubmit=this._submit.bindAsEventListener(this);var field=document.createElement(op.element);$H(op.attributes).each(function(v){field[v.key]=v.value;});switch(op.element){case'input':case'textarea':field.value=TableKit.getCellText(cell);break;case'select':var txt=TableKit.getCellText(cell);$A(op.selectOptions).each(function(v){field.options[field.options.length]=new Option(v[0],v[1]);if(txt===v[1]){field.options[field.options.length-1].selected='selected';}});break;}
form.appendChild(field);if(op.element==='textarea'){form.appendChild(document.createElement("br"));}
if(op.showSubmit){var okButton=document.createElement("input");okButton.type="submit";okButton.value=op.submitText;okButton.className='editor_ok_button';form.appendChild(okButton);}
if(op.showCancel){var cancelLink=document.createElement("a");cancelLink.href="#";cancelLink.appendChild(document.createTextNode(op.cancelText));cancelLink.onclick=this._cancel.bindAsEventListener(this);cancelLink.className='editor_cancel';form.appendChild(cancelLink);}
cell.innerHTML='';cell.appendChild(form);},_submit:function(e){var cell=Event.findElement(e,'td');var form=Event.findElement(e,'form');Event.stop(e);this.submit(cell,form);},submit:function(cell,form){var op=this.options;form=form?form:cell.down('form');var head=$(TableKit.getHeaderCells(null,cell)[TableKit.getCellIndex(cell)]);var row=cell.up('tr');var table=cell.up('table');var s='&row='+(TableKit.getRowIndex(row)+1)+'&cell='+(TableKit.getCellIndex(cell)+1)+'&id='+row.id+'&field='+head.id+'&'+Form.serialize(form);this.ajax=new Ajax.Updater(cell,op.ajaxURI||TableKit.option('editAjaxURI',table.id)[0],Object.extend(op.ajaxOptions||TableKit.option('editAjaxOptions',table.id)[0],{postBody:s,onComplete:function(){var data=TableKit.getCellData(cell);data.active=false;data.refresh=true;}}));},_cancel:function(e){var cell=Event.findElement(e,'td');Event.stop(e);this.cancel(cell);},cancel:function(cell){this.ajax=null;var data=TableKit.getCellData(cell);cell.innerHTML=data.htmlContent;data.htmlContent='';data.active=false;},ajax:null};TableKit.Editable.textInput=function(n,attributes){TableKit.Editable.addCellEditor(new TableKit.Editable.CellEditor(n,{element:'input',attributes:Object.extend({name:'value',type:'text'},attributes||{})}));};TableKit.Editable.textInput('text-input');TableKit.Editable.multiLineInput=function(n,attributes){TableKit.Editable.addCellEditor(new TableKit.Editable.CellEditor(n,{element:'textarea',attributes:Object.extend({name:'value',rows:'5',cols:'20'},attributes||{})}));};TableKit.Editable.multiLineInput('multi-line-input');TableKit.Editable.selectInput=function(n,attributes,selectOptions){TableKit.Editable.addCellEditor(new TableKit.Editable.CellEditor(n,{element:'select',attributes:Object.extend({name:'value'},attributes||{}),'selectOptions':selectOptions}));};document.observe("dom:loaded",TableKit.load);
;TableKit.Sortable.addSortType(new TableKit.Sortable.Type('sort_filename',{pattern:/^[pattern_dummy]$/,normal:function(v){var cleaned=v.split(' ');cleaned.shift();cleaned=cleaned.join(' ').toLowerCase();return cleaned;}}));var dateSortFunc=function(v){if(v.indexOf('\n')!=-1){v=v.substring(0,v.indexOf('\n'));}
var cleaned=v.split(' ');if(v==''){return'1970-01-01 00:00';}
var isoDate;if((cleaned.length>0)&&cleaned[0].indexOf('.')!=-1){var dateField=cleaned[0].split('.');if(dateField.length>0){if(dateField[0].length<2){dateField[0].length='0'+dateField[0].length;}
if(dateField[1].length<2){dateField[1].length='0'+dateField[1].length;}
if(dateField[2].length==2){dateField[2]=(parseInt(dateField[2],10)+2000).toString();}
isoDate=dateField[2]+'-'+dateField[1]+'-'+dateField[0]+' ';}}else if((cleaned.length>0)&&cleaned[0].indexOf('/')!=-1){var dateField=cleaned[0].split('/');if(dateField.length>0){if(dateField[0].length<2){dateField[0]='0'+dateField[0].toString();}
if(dateField[1].length<2){dateField[1]='0'+dateField[1].toString();}
if(dateField[2].length==2){dateField[2]=(parseInt(dateField[2],10)+2000).toString();}
isoDate=dateField[2]+'-'+dateField[0]+'-'+dateField[1]+' ';}}
if((cleaned.length>2)&&((cleaned[2].indexOf('am')!=-1)||(cleaned[2].indexOf('pm')!=-1))){var timeField=cleaned[1];var isAmPm;if(cleaned[2].indexOf('am')!=-1){isAmPm='am';}
if(cleaned[2].indexOf('pm')!=-1){isAmPm='pm';}
timeField=timeField.split(':');if(timeField.length>0){if((isAmPm=='pm')&&(parseInt(timeField[0],10)==12)){timeField[0]=parseInt(timeField[0],10)-12;}else if((isAmPm=='pm')&&(parseInt(timeField[0],10)<12)){timeField[0]=parseInt(timeField[0],10)+12;}
if(timeField[0].length<2){timeField[0]='0'+timeField[0].toString();}
if(timeField[1].length<2){timeField[1]='0'+timeField[1].toString();}
isoDate+=timeField[0]+':'+timeField[1];}}else{var timeField=cleaned[1].split(':');if(timeField.length>0){if(timeField[0].length<2){timeField[0]='0'+timeField[0].toString();}
if(timeField[1].length<2){timeField[1]='0'+timeField[1].toString();}
isoDate+=timeField[0]+':'+timeField[1];}}
return isoDate;}
TableKit.Sortable.addSortType(new TableKit.Sortable.Type('sort_date',{pattern:/^[pattern_dummy]$/,normal:dateSortFunc}));TableKit.Sortable.addSortType(new TableKit.Sortable.Type('sort_termin',{pattern:/^[pattern_dummy]$/,normal:dateSortFunc}));TableKit.Sortable.addSortType(new TableKit.Sortable.Type('sort_filesize',{pattern:/^[-+]?[\d]*\.?[\d]+(?:[eE][-+]?[\d]+)?\s?[k|m|g|t]b$/i,normal:function(v){v=v.replace(/,/,'.');var r=v.match(/^([-+]?[\d]*\.?[\d]+([eE][-+]?[\d]+)?)\s?([k|m|g|t]?b)?/i);var b=r[1]?Number(r[1]).valueOf():0;var m=r[3]?r[3].substr(0,1).toLowerCase():'';var result=b;switch(m){case'k':result=b*1024;break;case'm':result=b*1024*1024;break;case'g':result=b*1024*1024*1024;break;case't':result=b*1024*1024*1024*1024;break;}
return result;}}));
;var FlashDetect=new function(){var self=this;self.installed=false;self.raw="";self.major=-1;self.minor=-1;self.revision=-1;self.revisionStr="";var activeXDetectRules=[{"name":"ShockwaveFlash.ShockwaveFlash.7","version":function(obj){return getActiveXVersion(obj);}},{"name":"ShockwaveFlash.ShockwaveFlash.6","version":function(obj){var version="6,0,21";try{obj.AllowScriptAccess="always";version=getActiveXVersion(obj);}catch(err){}
return version;}},{"name":"ShockwaveFlash.ShockwaveFlash","version":function(obj){return getActiveXVersion(obj);}}];var getActiveXVersion=function(activeXObj){var version=-1;try{version=activeXObj.GetVariable("$version");}catch(err){}
return version;};var getActiveXObject=function(name){var obj=-1;try{obj=new ActiveXObject(name);}catch(err){obj={activeXError:true};}
return obj;};var parseActiveXVersion=function(str){var versionArray=str.split(",");return{"raw":str,"major":parseInt(versionArray[0].split(" ")[1],10),"minor":parseInt(versionArray[1],10),"revision":parseInt(versionArray[2],10),"revisionStr":versionArray[2]};};var parseStandardVersion=function(str){var descParts=str.split(/ +/);var majorMinor=descParts[2].split(/\./);var revisionStr=descParts[3];return{"raw":str,"major":parseInt(majorMinor[0],10),"minor":parseInt(majorMinor[1],10),"revisionStr":revisionStr,"revision":parseRevisionStrToInt(revisionStr)};};var parseRevisionStrToInt=function(str){return parseInt(str.replace(/[a-zA-Z]/g,""),10)||self.revision;};self.majorAtLeast=function(version){return self.major>=version;};self.minorAtLeast=function(version){return self.minor>=version;};self.revisionAtLeast=function(version){return self.revision>=version;};self.versionAtLeast=function(major){var properties=[self.major,self.minor,self.revision];var len=Math.min(properties.length,arguments.length);for(i=0;i<len;i++){if(properties[i]>=arguments[i]){if(i+1<len&&properties[i]==arguments[i]){continue;}else{return true;}}else{return false;}}};self.FlashDetect=function(){if(navigator.plugins&&navigator.plugins.length>0){var type='application/x-shockwave-flash';var mimeTypes=navigator.mimeTypes;if(mimeTypes&&mimeTypes[type]&&mimeTypes[type].enabledPlugin&&mimeTypes[type].enabledPlugin.description){var version=mimeTypes[type].enabledPlugin.description;var versionObj=parseStandardVersion(version);self.raw=versionObj.raw;self.major=versionObj.major;self.minor=versionObj.minor;self.revisionStr=versionObj.revisionStr;self.revision=versionObj.revision;self.installed=true;}}else if(navigator.appVersion.indexOf("Mac")==-1&&window.execScript){var version=-1;for(var i=0;i<activeXDetectRules.length&&version==-1;i++){var obj=getActiveXObject(activeXDetectRules[i].name);if(!obj.activeXError){self.installed=true;version=activeXDetectRules[i].version(obj);if(version!=-1){var versionObj=parseActiveXVersion(version);self.raw=versionObj.raw;self.major=versionObj.major;self.minor=versionObj.minor;self.revision=versionObj.revision;self.revisionStr=versionObj.revisionStr;}}}}}();};FlashDetect.JS_RELEASE="1.0.4";
;var SWFUpload;if(SWFUpload==undefined){SWFUpload=function(settings){this.initSWFUpload(settings);};}
SWFUpload.prototype.initSWFUpload=function(settings){try{this.customSettings={};this.settings=settings;this.eventQueue=[];this.movieName="SWFUpload_"+SWFUpload.movieCount++;this.movieElement=null;SWFUpload.instances[this.movieName]=this;this.initSettings();this.loadFlash();this.displayDebugInfo();}catch(ex){delete SWFUpload.instances[this.movieName];throw ex;}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.2.0 2009-03-25";SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};SWFUpload.CURSOR={ARROW:-1,HAND:-2};SWFUpload.WINDOW_MODE={WINDOW:"transparent",TRANSPARENT:"transparent",OPAQUE:"opaque"};SWFUpload.completeURL=function(url){if(typeof(url)!=="string"||url.match(/^https?:\/\//i)||url.match(/^\//)){return url;}
var currentURL=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");var indexSlash=window.location.pathname.lastIndexOf("/");if(indexSlash<=0){path="/";}else{path=window.location.pathname.substr(0,indexSlash)+"/";}
return path+url;};SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(settingName,defaultValue){this.settings[settingName]=(this.settings[settingName]==undefined)?defaultValue:this.settings[settingName];};this.ensureDefault("upload_url","");this.ensureDefault("preserve_relative_urls",false);this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",false);this.ensureDefault("requeue_on_error",false);this.ensureDefault("http_success",[]);this.ensureDefault("assume_success_timeout",0);this.ensureDefault("file_types","*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("prevent_swf_caching",true);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",false);this.ensureDefault("button_placeholder_id","");this.ensureDefault("button_placeholder",null);this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW);this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW);this.ensureDefault("debug",false);this.settings.debug_enabled=this.settings.debug;this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("debug_handler",this.debugMessage);this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;if(!!this.settings.prevent_swf_caching){this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+new Date().getTime();}
if(!this.settings.preserve_relative_urls){this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url);this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url);}
delete this.ensureDefault;};SWFUpload.prototype.loadFlash=function(){var targetElement,tempParent;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";}
targetElement=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(targetElement==undefined){throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;}
tempParent=document.createElement("div");tempParent.innerHTML=this.getFlashHTML();targetElement.parentNode.replaceChild(tempParent.firstChild,targetElement);if(window[this.movieName]==undefined){window[this.movieName]=this.getMovieElement();}};SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />','</object>'].join("");};SWFUpload.prototype.getFlashVars=function(){var paramString=this.buildParamString();var httpSuccessString=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(httpSuccessString),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(paramString),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("");};SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==undefined){this.movieElement=document.getElementById(this.movieName);}
if(this.movieElement===null){throw"Could not find Flash element";}
return this.movieElement;};SWFUpload.prototype.buildParamString=function(){var postParams=this.settings.post_params;var paramStringPairs=[];if(typeof(postParams)==="object"){for(var name in postParams){if(postParams.hasOwnProperty(name)){paramStringPairs.push(encodeURIComponent(name.toString())+"="+encodeURIComponent(postParams[name].toString()));}}}
return paramStringPairs.join("&amp;");};SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,false);var movieElement=null;movieElement=this.getMovieElement();if(movieElement&&typeof(movieElement.CallFunction)==="unknown"){for(var i in movieElement){try{if(typeof(movieElement[i])==="function"){movieElement[i]=null;}}catch(ex1){}}
try{movieElement.parentNode.removeChild(movieElement);}catch(ex){}}
window[this.movieName]=null;SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];this.movieElement=null;this.settings=null;this.customSettings=null;this.eventQueue=null;this.movieName=null;return true;}catch(ex2){return false;}};SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","\t","upload_url:               ",this.settings.upload_url,"\n","\t","flash_url:                ",this.settings.flash_url,"\n","\t","use_query_string:         ",this.settings.use_query_string.toString(),"\n","\t","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","\t","http_success:             ",this.settings.http_success.join(", "),"\n","\t","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","\t","file_post_name:           ",this.settings.file_post_name,"\n","\t","post_params:              ",this.settings.post_params.toString(),"\n","\t","file_types:               ",this.settings.file_types,"\n","\t","file_types_description:   ",this.settings.file_types_description,"\n","\t","file_size_limit:          ",this.settings.file_size_limit,"\n","\t","file_upload_limit:        ",this.settings.file_upload_limit,"\n","\t","file_queue_limit:         ",this.settings.file_queue_limit,"\n","\t","debug:                    ",this.settings.debug.toString(),"\n","\t","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","\t","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","\t","button_placeholder:       ",(this.settings.button_placeholder?"Set":"Not Set"),"\n","\t","button_image_url:         ",this.settings.button_image_url.toString(),"\n","\t","button_width:             ",this.settings.button_width.toString(),"\n","\t","button_height:            ",this.settings.button_height.toString(),"\n","\t","button_text:              ",this.settings.button_text.toString(),"\n","\t","button_text_style:        ",this.settings.button_text_style.toString(),"\n","\t","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","\t","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","\t","button_action:            ",this.settings.button_action.toString(),"\n","\t","button_disabled:          ",this.settings.button_disabled.toString(),"\n","\t","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","\t","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n","\t","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n","\t","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n","\t","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n","\t","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler==="function").toString(),"\n","\t","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n","\t","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n","\t","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n","\t","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n","\t","debug_handler assigned:             ",(typeof this.settings.debug_handler==="function").toString(),"\n"].join(""));};SWFUpload.prototype.addSetting=function(name,value,default_value){if(value==undefined){return(this.settings[name]=default_value);}else{return(this.settings[name]=value);}};SWFUpload.prototype.getSetting=function(name){if(this.settings[name]!=undefined){return this.settings[name];}
return"";};SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement();var returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+'</invoke>');returnValue=eval(returnString);}catch(ex){throw"Call to "+functionName+" failed";}
if(returnValue!=undefined&&typeof returnValue.post==="object"){returnValue=this.unescapeFilePostParams(returnValue);}
return returnValue;};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile");};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles");};SWFUpload.prototype.startUpload=function(fileID){this.callFlash("StartUpload",[fileID]);};SWFUpload.prototype.cancelUpload=function(fileID,triggerErrorEvent){if(triggerErrorEvent!==false){triggerErrorEvent=true;}
this.callFlash("CancelUpload",[fileID,triggerErrorEvent]);};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload");};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats");};SWFUpload.prototype.setStats=function(statsObject){this.callFlash("SetStats",[statsObject]);};SWFUpload.prototype.getFile=function(fileID){if(typeof(fileID)==="number"){return this.callFlash("GetFileByIndex",[fileID]);}else{return this.callFlash("GetFile",[fileID]);}};SWFUpload.prototype.addFileParam=function(fileID,name,value){return this.callFlash("AddFileParam",[fileID,name,value]);};SWFUpload.prototype.removeFileParam=function(fileID,name){this.callFlash("RemoveFileParam",[fileID,name]);};SWFUpload.prototype.setUploadURL=function(url){this.settings.upload_url=url.toString();this.callFlash("SetUploadURL",[url]);};SWFUpload.prototype.setPostParams=function(paramsObject){this.settings.post_params=paramsObject;this.callFlash("SetPostParams",[paramsObject]);};SWFUpload.prototype.addPostParam=function(name,value){this.settings.post_params[name]=value;this.callFlash("SetPostParams",[this.settings.post_params]);};SWFUpload.prototype.removePostParam=function(name){delete this.settings.post_params[name];this.callFlash("SetPostParams",[this.settings.post_params]);};SWFUpload.prototype.setFileTypes=function(types,description){this.settings.file_types=types;this.settings.file_types_description=description;this.callFlash("SetFileTypes",[types,description]);};SWFUpload.prototype.setFileSizeLimit=function(fileSizeLimit){this.settings.file_size_limit=fileSizeLimit;this.callFlash("SetFileSizeLimit",[fileSizeLimit]);};SWFUpload.prototype.setFileUploadLimit=function(fileUploadLimit){this.settings.file_upload_limit=fileUploadLimit;this.callFlash("SetFileUploadLimit",[fileUploadLimit]);};SWFUpload.prototype.setFileQueueLimit=function(fileQueueLimit){this.settings.file_queue_limit=fileQueueLimit;this.callFlash("SetFileQueueLimit",[fileQueueLimit]);};SWFUpload.prototype.setFilePostName=function(filePostName){this.settings.file_post_name=filePostName;this.callFlash("SetFilePostName",[filePostName]);};SWFUpload.prototype.setUseQueryString=function(useQueryString){this.settings.use_query_string=useQueryString;this.callFlash("SetUseQueryString",[useQueryString]);};SWFUpload.prototype.setRequeueOnError=function(requeueOnError){this.settings.requeue_on_error=requeueOnError;this.callFlash("SetRequeueOnError",[requeueOnError]);};SWFUpload.prototype.setHTTPSuccess=function(http_status_codes){if(typeof http_status_codes==="string"){http_status_codes=http_status_codes.replace(" ","").split(",");}
this.settings.http_success=http_status_codes;this.callFlash("SetHTTPSuccess",[http_status_codes]);};SWFUpload.prototype.setAssumeSuccessTimeout=function(timeout_seconds){this.settings.assume_success_timeout=timeout_seconds;this.callFlash("SetAssumeSuccessTimeout",[timeout_seconds]);};SWFUpload.prototype.setDebugEnabled=function(debugEnabled){this.settings.debug_enabled=debugEnabled;this.callFlash("SetDebugEnabled",[debugEnabled]);};SWFUpload.prototype.setButtonImageURL=function(buttonImageURL){if(buttonImageURL==undefined){buttonImageURL="";}
this.settings.button_image_url=buttonImageURL;this.callFlash("SetButtonImageURL",[buttonImageURL]);};SWFUpload.prototype.setButtonDimensions=function(width,height){this.settings.button_width=width;this.settings.button_height=height;var movie=this.getMovieElement();if(movie!=undefined){movie.style.width=width+"px";movie.style.height=height+"px";}
this.callFlash("SetButtonDimensions",[width,height]);};SWFUpload.prototype.setButtonText=function(html){this.settings.button_text=html;this.callFlash("SetButtonText",[html]);};SWFUpload.prototype.setButtonTextPadding=function(left,top){this.settings.button_text_top_padding=top;this.settings.button_text_left_padding=left;this.callFlash("SetButtonTextPadding",[left,top]);};SWFUpload.prototype.setButtonTextStyle=function(css){this.settings.button_text_style=css;this.callFlash("SetButtonTextStyle",[css]);};SWFUpload.prototype.setButtonDisabled=function(isDisabled){this.settings.button_disabled=isDisabled;this.callFlash("SetButtonDisabled",[isDisabled]);};SWFUpload.prototype.setButtonAction=function(buttonAction){this.settings.button_action=buttonAction;this.callFlash("SetButtonAction",[buttonAction]);};SWFUpload.prototype.setButtonCursor=function(cursor){this.settings.button_cursor=cursor;this.callFlash("SetButtonCursor",[cursor]);};SWFUpload.prototype.queueEvent=function(handlerName,argumentArray){if(argumentArray==undefined){argumentArray=[];}else if(!(argumentArray instanceof Array)){argumentArray=[argumentArray];}
var self=this;if(typeof this.settings[handlerName]==="function"){this.eventQueue.push(function(){this.settings[handlerName].apply(this,argumentArray);});setTimeout(function(){self.executeNextEvent();},0);}else if(this.settings[handlerName]!==null){throw"Event handler "+handlerName+" is unknown or is not a function";}};SWFUpload.prototype.executeNextEvent=function(){var f=this.eventQueue?this.eventQueue.shift():null;if(typeof(f)==="function"){f.apply(this);}};SWFUpload.prototype.unescapeFilePostParams=function(file){var reg=/[$]([0-9a-f]{4})/i;var unescapedPost={};var uk;if(file!=undefined){for(var k in file.post){if(file.post.hasOwnProperty(k)){uk=k;var match;while((match=reg.exec(uk))!==null){uk=uk.replace(match[0],String.fromCharCode(parseInt("0x"+match[1],16)));}
unescapedPost[uk]=file.post[k];}}
file.post=unescapedPost;}
return file;};SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface");}catch(ex){return false;}};SWFUpload.prototype.flashReady=function(){var movieElement=this.getMovieElement();if(!movieElement){this.debug("Flash called back ready but the flash movie can't be found.");return;}
this.cleanUp(movieElement);this.queueEvent("swfupload_loaded_handler");};SWFUpload.prototype.cleanUp=function(movieElement){try{if(this.movieElement&&typeof(movieElement.CallFunction)==="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var key in movieElement){try{if(typeof(movieElement[key])==="function"){movieElement[key]=null;}}catch(ex){}}}}catch(ex1){}
window["__flash__removeCallback"]=function(instance,name){try{if(instance){instance[name]=null;}}catch(flashEx){}};};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler");};SWFUpload.prototype.fileQueued=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("file_queued_handler",file);};SWFUpload.prototype.fileQueueError=function(file,errorCode,message){file=this.unescapeFilePostParams(file);this.queueEvent("file_queue_error_handler",[file,errorCode,message]);};SWFUpload.prototype.fileDialogComplete=function(numFilesSelected,numFilesQueued,numFilesInQueue){this.queueEvent("file_dialog_complete_handler",[numFilesSelected,numFilesQueued,numFilesInQueue]);};SWFUpload.prototype.uploadStart=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("return_upload_start_handler",file);};SWFUpload.prototype.returnUploadStart=function(file){var returnValue;if(typeof this.settings.upload_start_handler==="function"){file=this.unescapeFilePostParams(file);returnValue=this.settings.upload_start_handler.call(this,file);}else if(this.settings.upload_start_handler!=undefined){throw"upload_start_handler must be a function";}
if(returnValue===undefined){returnValue=true;}
returnValue=!!returnValue;this.callFlash("ReturnUploadStart",[returnValue]);};SWFUpload.prototype.uploadProgress=function(file,bytesComplete,bytesTotal){file=this.unescapeFilePostParams(file);this.queueEvent("upload_progress_handler",[file,bytesComplete,bytesTotal]);};SWFUpload.prototype.uploadError=function(file,errorCode,message){file=this.unescapeFilePostParams(file);this.queueEvent("upload_error_handler",[file,errorCode,message]);};SWFUpload.prototype.uploadSuccess=function(file,serverData,responseReceived){file=this.unescapeFilePostParams(file);this.queueEvent("upload_success_handler",[file,serverData,responseReceived]);};SWFUpload.prototype.uploadComplete=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("upload_complete_handler",file);};SWFUpload.prototype.debug=function(message){this.queueEvent("debug_handler",message);};SWFUpload.prototype.debugMessage=function(message){if(this.settings.debug){var exceptionMessage,exceptionValues=[];if(typeof message==="object"&&typeof message.name==="string"&&typeof message.message==="string"){for(var key in message){if(message.hasOwnProperty(key)){exceptionValues.push(key+": "+message[key]);}}
exceptionMessage=exceptionValues.join("\n")||"";exceptionValues=exceptionMessage.split("\n");exceptionMessage="EXCEPTION: "+exceptionValues.join("\nEXCEPTION: ");SWFUpload.Console.writeLine(exceptionMessage);}else{SWFUpload.Console.writeLine(message);}}};SWFUpload.Console={};SWFUpload.Console.writeLine=function(message){var console,documentForm;try{console=document.getElementById("SWFUpload_Console");if(!console){documentForm=document.createElement("form");document.getElementsByTagName("body")[0].appendChild(documentForm);console=document.createElement("textarea");console.id="SWFUpload_Console";console.style.fontFamily="monospace";console.setAttribute("wrap","off");console.wrap="off";console.style.overflow="auto";console.style.width="700px";console.style.height="350px";console.style.margin="5px";documentForm.appendChild(console);}
console.value+=message+"\n";console.scrollTop=console.scrollHeight-console.clientHeight;}catch(ex){alert("Exception: "+ex.name+" Message: "+ex.message);}};
;$K.yg_SWFUploadQueue={};$K.yg_SWFUploadGlobalFileInfo={};$K.yg_SWFUploadQueueProcessing=false;$K.yg_SWFUploadGlobalDone=0;$K.yg_SWFUploadSettings={flash_url:'__REPLACEME__',upload_url:$K.appdir+'responder?handler=uploadFile',post_params:{'flashcookie':document.cookie},file_size_limit:$K.maxUploadSize.toUpperCase().replace(/MB/g,' MB'),file_types:"*.*",file_types_description:"All Files",file_upload_limit:100,file_queue_limit:0,custom_settings:{uploadButtonId:'__REPLACEME__',statusPanelTemplate:'__REPLACEME__'},debug:false,button_cursor:SWFUpload.CURSOR.HAND,button_width:"2000",button_height:"56",button_placeholder_id:"__REPLACEME__",button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_action:SWFUpload.BUTTON_ACTION.SELECT_FILES,file_queued_handler:fileQueued,file_queue_error_handler:fileQueueError,file_dialog_complete_handler:fileDialogComplete,upload_start_handler:uploadStart,upload_progress_handler:uploadProgress,upload_error_handler:uploadError,upload_success_handler:uploadSuccess,upload_complete_handler:uploadComplete,queue_complete_handler:queueComplete};$K.yg_SWFUploadProcessQueue=function(){$K.yg_SWFUploadQueueProcessing=true;var rest=0;for(uploadObject in $K.yg_SWFUploadQueue){rest++;$K.yg_SWFUploadObjects[uploadObject].startUpload();delete $K.yg_SWFUploadQueue[uploadObject];continue;}
if(rest==0){if($K.windows['wid_uploadprogress'])$K.windows['wid_uploadprogress'].setCaption($K.TXT('TXT_UPLOAD_STATUS')+' <strong>100 %</strong>');$K.yg_SWFUploadQueue={};$K.yg_SWFUploadGlobalFileInfo={};$K.yg_SWFUploadQueueProcessing=false;$K.yg_SWFUploadGlobalDone=0;}}
function fileQueued(file){try{if(!this.customSettings.autoUpload&&!this.customSettings.extensionDataUpload){var queueEntryTemplate=$(this.customSettings.statusPanelTemplate).innerHTML;queueEntryTemplate=queueEntryTemplate.replace(/__TEMPLATEID__/g,file.id);queueEntryTemplate=queueEntryTemplate.replace(/__TEMPLATEINDEX__/g,file.index);queueEntryTemplate=queueEntryTemplate.replace(/__TEMPLATENAME__/g,file.name);$(this.customSettings.statusPanelTemplate.replace(/_template/,'')).insert({bottom:queueEntryTemplate});$K.windows[$(this.customSettings.statusPanelTemplate).up('.ywindow').id].refresh("col1");}}catch(ex){this.debug(ex);}}
function fileQueueError(file,errorCode,message){try{if(errorCode===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED){alert("You have attempted to queue too many files.\n"+(message===0?"You have reached the upload limit.":"You may select "+(message>1?"up to "+message+" files.":"one file.")));return;}
switch(errorCode){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:this.debug("Error Code: File too big, File name: "+file.name+", File size: "+file.size+", Message: "+message);$K.yg_promptbox('',$K.TXT('TXT_UPLOAD_ERROR_FILE_TOO_BIG'),'alert');break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:this.debug("Error Code: Zero byte file, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:this.debug("Error Code: Invalid File Type, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;default:if(file!==null){}
this.debug("Error Code: "+errorCode+", File name: "+file.name+", File size: "+file.size+", Message: "+message);break;}}catch(ex){this.debug(ex);}}
function fileDialogComplete(numFilesSelected,numFilesQueued){try{if(numFilesSelected>0){if(this.customSettings.extensionDataUpload){var uploadStats=swfUploadFile=this.getStats();var swfUploadFile=this.getFile('!!!YG-ID!!!');$(this.movieName).up('.cntblockcontainer').down('.title_txt').update(swfUploadFile.name);var data=Array('noevent',{yg_property:'uploadFile',params:{fileID:this.customSettings.fileID,uploadID:swfUploadFile.id,filesQueued:uploadStats.files_queued,title:this.customSettings.uploadTitle,type:this.customSettings.uploadType,winID:this.customSettings.winID,timestamp:this.customSettings.timestamp}});this.addFileParam(swfUploadFile.id,'data',Object.toJSON(data));$K.yg_SWFUploadGlobalFileInfo[swfUploadFile.id]=swfUploadFile;if(!$K.yg_SWFUploadQueueProcessing){$K.yg_SWFUploadProcessQueue();}}
if(this.customSettings.autoUpload){$('wid_uploadprogress').show();$('wid_uploadprogress').style.zIndex=$K.yg_incrementTopZIndex();$K.windows['wid_uploadprogress'].init();var uploadStats=swfUploadFile=this.getStats();var uploadStatusPanel=$('wid_uploadprogress').down('.mk_uploadpanel');var uploadTemplateOrig=$('wid_uploadprogress').down('.mk_upload_templates').innerHTML;var swfUploadFile=this.getFile('!!!YG-ID!!!');var data=Array('noevent',{yg_property:'uploadFile',params:{fileID:this.customSettings.fileID,userID:this.customSettings.userID,uploadID:swfUploadFile.id,filesQueued:uploadStats.files_queued,title:this.customSettings.uploadTitle,type:this.customSettings.uploadType,winID:this.customSettings.winID,timestamp:this.customSettings.timestamp}});this.addFileParam(swfUploadFile.id,'data',Object.toJSON(data));if($('wid_'+this.customSettings.winID+'_previewchanged')&&(this.customSettings.uploadType=='templatePreview')){$('wid_'+this.customSettings.winID+'_previewchanged').value='true';}
if($('wid_'+this.customSettings.winID+'_templatechanged')&&(this.customSettings.uploadType=='template')){$('wid_'+this.customSettings.winID+'_templatechanged').value='true';}
uploadTemplate=uploadTemplateOrig;uploadTemplate=uploadTemplate.replace(/__TEMPLATEID__/g,swfUploadFile.id);uploadTemplate=uploadTemplate.replace(/__TEMPLATEINDEX__/g,swfUploadFile.index);uploadTemplate=uploadTemplate.replace(/__TEMPLATENAME__/g,swfUploadFile.name);uploadStatusPanel.insert({bottom:uploadTemplate});$K.yg_SWFUploadGlobalFileInfo[swfUploadFile.id]=swfUploadFile;$K.windows['wid_uploadprogress'].refresh();if(!$K.yg_SWFUploadQueueProcessing){$K.yg_SWFUploadProcessQueue();}
this.startUpload();}}}catch(ex){this.debug(ex);}}
function uploadStart(file){try{$('wid_uploadprogress').timeoutId=window.setTimeout($K.yg_onUploadTimeout,$K.uploadTimeout);}
catch(ex){}
return true;}
function uploadProgress(file,bytesLoaded,bytesTotal){try{var currentFile;var percent=Math.ceil((bytesLoaded/bytesTotal)*100);if(this.customSettings.extensionDataUpload){var uploadStatusPanel=$(this.customSettings.uploadWinId).down('.mk_uploadpanel');}else{var uploadStatusPanel=$('wid_uploadprogress').down('.mk_uploadpanel');}
uploadStatusPanel.select('li').each(function(item){if(item.readAttribute('yg_id').replace(/-file/,'')==file.id){currentFile=item;}});if(isNaN(percent)||!isFinite(percent)){percent=100;}
currentFile.addClassName('uploading');currentFile.down('.uploadpercent').update(percent+' %');currentFile.down('.uploadstatusbg').down().setStyle({width:percent+'%'});var globPercent=Math.ceil((($K.yg_SWFUploadGlobalDone+bytesLoaded)/$K.yg_calcSWFUploadGlobalFilesizes())*100);if(isNaN(globPercent)||!isFinite(globPercent)){globPercent=100;}
if($K.windows['wid_uploadprogress'])$K.windows['wid_uploadprogress'].setCaption($K.TXT('TXT_UPLOAD_STATUS')+' <strong>'+globPercent+' %</strong>');if($('wid_uploadprogress').timeoutId){window.clearTimeout($('wid_uploadprogress').timeoutId);$('wid_uploadprogress').timeoutId=window.setTimeout($K.yg_onUploadTimeout,$K.uploadTimeout);}}catch(ex){this.debug(ex);}}
function uploadSuccess(file,serverData){try{var currentFile;if(this.customSettings.extensionDataUpload){var uploadStatusPanel=$(this.customSettings.uploadWinId).down('.mk_uploadpanel');var backendFunction='processImportExtensionData';}else if(this.customSettings.userProfilePictureUpload){var uploadStatusPanel=$('wid_uploadprogress').down('.mk_uploadpanel');var backendFunction='processUserProfilePicture';}else{var uploadStatusPanel=$('wid_uploadprogress').down('.mk_uploadpanel');var backendFunction='processUpload';}
var uploadWinId=uploadStatusPanel.up('.ywindow').id;var openerWinId=this.customSettings.winID;uploadStatusPanel.select('li').each(function(item){if(item.readAttribute('yg_id').replace(/-file/,'')==file.id){currentFile=item;}});if(serverData){serverData.evalScripts();var controller=this;if(window.hadUploadError===true){currentFile.removeClassName('uploading');currentFile.addClassName('uploaderror');currentFile.down('.uploadpercent').update('ERROR');if(window.hadUploadErrorMsg){var errorMessage=window.hadUploadErrorMsg;currentFile.observe('mouseover',function(){$K.yg_showHelp(errorMessage);});}else{currentFile.observe('mouseover',function(){$K.yg_showHelp($K.TXT('TXT_FILE_UPLOAD_ERROR'));});}
currentFile.observe('mouseout',function(){$K.yg_showHelp(false);});window.hadUploadError=false;window.hadUploadErrorMsg=undefined;}else if(window.noprocessing){currentFile.removeClassName('uploading');currentFile.addClassName('uploaddone');currentFile.down('.uploadpercent').update('OK');window.noprocessing=false;}else{currentFile.removeClassName('uploading');currentFile.addClassName('uploadprocessing');currentFile.down('.uploadpercent').update('<div class="uploadprocessing"><!-- //--></div>');currentFile.srcWindow=this.customSettings.winID;currentFile.userID=this.customSettings.userID;var lastFile=false;var uploadingFiles=currentFile.up('ul').select('li.uploading');if(uploadingFiles.length==0){lastFile=true;}
if($('wid_uploadprogress').timeoutId){window.clearTimeout($('wid_uploadprogress').timeoutId);$('wid_uploadprogress').timeoutId=undefined;}
uploadStatusPanel.select('li').each(function(item){if(item.readAttribute('yg_id')==file.id+'-file'){var data=Array('noevent',{yg_property:backendFunction,params:{filePrefix:item.filePrefix,realFilename:file.name,userID:currentFile.userID,extensionId:item.extensionId,itemID:item.id,uploadWinId:uploadWinId,openerWinId:openerWinId,reUpload:item.reUpload,lastFile:lastFile}});$K.yg_AjaxCallback(data,backendFunction);}});}}}catch(ex){this.debug(ex);}}
function uploadError(file,errorCode,message){try{switch(errorCode){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:this.debug("Error Code: HTTP Error, File name: "+file.name+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:this.debug("Error Code: Upload Failed, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:this.debug("Error Code: IO Error, File name: "+file.name+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:this.debug("Error Code: Security Error, File name: "+file.name+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:this.debug("Error Code: Upload Limit Exceeded, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:this.debug("Error Code: File Validation Failed, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:if(this.getStats().files_queued===0){}
break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:break;default:this.debug("Error Code: "+errorCode+", File name: "+file.name+", File size: "+file.size+", Message: "+message);break;}}catch(ex){this.debug(ex);}}
function uploadComplete(file){if(this.getStats().files_queued===0){var winID=this.customSettings.uploadButtonId.replace(/_okbutton/,'');if(this.customSettings.extensionDataUpload){if($K.windows['wid_'+this.customSettings.winID]){$K.windows['wid_'+this.customSettings.winID].tabs.select(0,Koala.windows['wid_'+this.customSettings.winID].tabs.params);}}
if(!this.customSettings.autoUpload&&!this.customSettings.extensionDataUpload){$K.windows[winID].remove();$K.yg_SWFUploadObjects[winID].destroy();delete $K.yg_SWFUploadObjects[winID];if($K.yg_SWFUploadObjects[winID+'_2']){$K.yg_SWFUploadObjects[winID+'_2'].destroy();delete $K.yg_SWFUploadObjects[winID+'_2'];}}
$K.yg_SWFUploadProcessQueue();$K.yg_SWFUploadQueueProcessing=false;}else{$K.yg_SWFUploadGlobalDone+=file.size;if(this.customSettings.extensionDataUpload){var uploadStatusPanel=$(this.customSettings.uploadWinId).down('.mk_uploadpanel');}else{var uploadStatusPanel=$('wid_uploadprogress').down('.mk_uploadpanel');}
var currentFile;uploadStatusPanel.select('li').each(function(item){if(item.readAttribute('yg_id').replace(/-file/,'')==file.id){currentFile=item;}});if(currentFile.next()){currentFile.next().addClassName('uploading');}
this.startUpload();}}
function queueComplete(numFilesUploaded){var status=document.getElementById("divStatus");status.innerHTML=numFilesUploaded+" file"+(numFilesUploaded===1?"":"s")+" uploaded.";}
function SWFUploadFirebugHandler(message){try{if(window.console&&typeof(window.console.error)==="function"&&typeof(window.console.log)==="function"){if(typeof(message)==="object"&&typeof(message.name)==="string"&&typeof(message.message)==="string"){window.console.error(message);}else{window.console.log(message);}}}catch(ex){}
try{if(this.settings.debug){this.debugMessage(message);}}catch(ex1){}}
;(function(){var f=0,l=[],n={},j={},a={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},m=/[<>&\"\']/g,b,c=window.setTimeout,d={},e;function h(){this.returnValue=false}function k(){this.cancelBubble=true}(function(o){var p=o.split(/,/),q,s,r;for(q=0;q<p.length;q+=2){r=p[q+1].split(/ /);for(s=0;s<r.length;s++){j[r[s]]=p[q]}}})("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mpga mpega mp2 mp3,audio/x-wav,wav,audio/mp4,m4a,image/bmp,bmp,image/gif,gif,image/jpeg,jpeg jpg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/vnd.rn-realvideo,rv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe");var g={VERSION:"1.5.4",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:j,ua:(function(){var s=navigator,r=s.userAgent,t=s.vendor,p,o,q;p=/WebKit/.test(r);q=p&&t.indexOf("Apple")!==-1;o=window.opera&&window.opera.buildNumber;return{windows:navigator.platform.indexOf("Win")!==-1,ie:!p&&!o&&(/MSIE/gi).test(r)&&(/Explorer/gi).test(s.appName),webkit:p,gecko:!p&&/Gecko/.test(r),safari:q,opera:!!o}}()),typeOf:function(p){return({}).toString.call(p).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},extend:function(o){g.each(arguments,function(p,q){if(q>0){g.each(p,function(s,r){o[r]=s})}});return o},cleanName:function(o){var p,q;q=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(p=0;p<q.length;p+=2){o=o.replace(q[p],q[p+1])}o=o.replace(/\s+/g,"_");o=o.replace(/[^a-z0-9_\-\.]+/gi,"");return o},addRuntime:function(o,p){p.name=o;l[o]=p;l.push(p);return p},guid:function(){var o=new Date().getTime().toString(32),p;for(p=0;p<5;p++){o+=Math.floor(Math.random()*65535).toString(32)}return(g.guidPrefix||"p")+o+(f++).toString(32)},buildUrl:function(p,o){var q="";g.each(o,function(s,r){q+=(q?"&":"")+encodeURIComponent(r)+"="+encodeURIComponent(s)});if(q){p+=(p.indexOf("?")>0?"&":"?")+q}return p},each:function(r,s){var q,p,o;if(r){q=r.length;if(q===b){for(p in r){if(r.hasOwnProperty(p)){if(s(r[p],p)===false){return}}}}else{for(o=0;o<q;o++){if(s(r[o],o)===false){return}}}}},formatSize:function(o){if(o===b||/\D/.test(o)){return g.translate("N/A")}if(o>1073741824){return Math.round(o/1073741824,1)+" GB"}if(o>1048576){return Math.round(o/1048576,1)+" MB"}if(o>1024){return Math.round(o/1024,1)+" KB"}return o+" b"},getPos:function(p,t){var u=0,s=0,w,v=document,q,r;p=p;t=t||v.body;function o(C){var A,B,z=0,D=0;if(C){B=C.getBoundingClientRect();A=v.compatMode==="CSS1Compat"?v.documentElement:v.body;z=B.left+A.scrollLeft;D=B.top+A.scrollTop}return{x:z,y:D}}if(p&&p.getBoundingClientRect&&((navigator.userAgent.indexOf("MSIE")>0)&&(v.documentMode<8))){q=o(p);r=o(t);return{x:q.x-r.x,y:q.y-r.y}}w=p;while(w&&w!=t&&w.nodeType){u+=w.offsetLeft||0;s+=w.offsetTop||0;w=w.offsetParent}w=p.parentNode;while(w&&w!=t&&w.nodeType){u-=w.scrollLeft||0;s-=w.scrollTop||0;w=w.parentNode}return{x:u,y:s}},getSize:function(o){return{w:o.offsetWidth||o.clientWidth,h:o.offsetHeight||o.clientHeight}},parseSize:function(o){var p;if(typeof(o)=="string"){o=/^([0-9]+)([mgk]?)$/.exec(o.toLowerCase().replace(/[^0-9mkg]/g,""));p=o[2];o=+o[1];if(p=="g"){o*=1073741824}if(p=="m"){o*=1048576}if(p=="k"){o*=1024}}return o},xmlEncode:function(o){return o?(""+o).replace(m,function(p){return a[p]?"&"+a[p]+";":p}):o},toArray:function(q){var p,o=[];for(p=0;p<q.length;p++){o[p]=q[p]}return o},inArray:function(q,r){if(r){if(Array.prototype.indexOf){return Array.prototype.indexOf.call(r,q)}for(var o=0,p=r.length;o<p;o++){if(r[o]===q){return o}}}return-1},addI18n:function(o){return g.extend(n,o)},translate:function(o){return n[o]||o},isEmptyObj:function(o){if(o===b){return true}for(var p in o){return false}return true},hasClass:function(q,p){var o;if(q.className==""){return false}o=new RegExp("(^|\\s+)"+p+"(\\s+|$)");return o.test(q.className)},addClass:function(p,o){if(!g.hasClass(p,o)){p.className=p.className==""?o:p.className.replace(/\s+$/,"")+" "+o}},removeClass:function(q,p){var o=new RegExp("(^|\\s+)"+p+"(\\s+|$)");q.className=q.className.replace(o,function(s,r,t){return r===" "&&t===" "?" ":""})},getStyle:function(p,o){if(p.currentStyle){return p.currentStyle[o]}else{if(window.getComputedStyle){return window.getComputedStyle(p,null)[o]}}},addEvent:function(t,o,u){var s,r,q,p;p=arguments[3];o=o.toLowerCase();if(e===b){e="Plupload_"+g.guid()}if(t.addEventListener){s=u;t.addEventListener(o,s,false)}else{if(t.attachEvent){s=function(){var v=window.event;if(!v.target){v.target=v.srcElement}v.preventDefault=h;v.stopPropagation=k;u(v)};t.attachEvent("on"+o,s)}}if(t[e]===b){t[e]=g.guid()}if(!d.hasOwnProperty(t[e])){d[t[e]]={}}r=d[t[e]];if(!r.hasOwnProperty(o)){r[o]=[]}r[o].push({func:s,orig:u,key:p})},removeEvent:function(t,o){var r,u,q;if(typeof(arguments[2])=="function"){u=arguments[2]}else{q=arguments[2]}o=o.toLowerCase();if(t[e]&&d[t[e]]&&d[t[e]][o]){r=d[t[e]][o]}else{return}for(var p=r.length-1;p>=0;p--){if(r[p].key===q||r[p].orig===u){if(t.removeEventListener){t.removeEventListener(o,r[p].func,false)}else{if(t.detachEvent){t.detachEvent("on"+o,r[p].func)}}r[p].orig=null;r[p].func=null;r.splice(p,1);if(u!==b){break}}}if(!r.length){delete d[t[e]][o]}if(g.isEmptyObj(d[t[e]])){delete d[t[e]];try{delete t[e]}catch(s){t[e]=b}}},removeAllEvents:function(p){var o=arguments[1];if(p[e]===b||!p[e]){return}g.each(d[p[e]],function(r,q){g.removeEvent(p,q,o)})}};g.Uploader=function(s){var p={},v,u=[],r,q=false;v=new g.QueueProgress();s=g.extend({chunk_size:0,multipart:true,multi_selection:true,file_data_name:"file",filters:[]},s);function t(){var x,y=0,w;if(this.state==g.STARTED){for(w=0;w<u.length;w++){if(!x&&u[w].status==g.QUEUED){x=u[w];x.status=g.UPLOADING;if(this.trigger("BeforeUpload",x)){this.trigger("UploadFile",x)}}else{y++}}if(y==u.length){this.stop();this.trigger("UploadComplete",u)}}}function o(){var x,w;v.reset();for(x=0;x<u.length;x++){w=u[x];if(w.size!==b){v.size+=w.size;v.loaded+=w.loaded}else{v.size=b}if(w.status==g.DONE){v.uploaded++}else{if(w.status==g.FAILED){v.failed++}else{v.queued++}}}if(v.size===b){v.percent=u.length>0?Math.ceil(v.uploaded/u.length*100):0}else{v.bytesPerSec=Math.ceil(v.loaded/((+new Date()-r||1)/1000));v.percent=v.size>0?Math.ceil(v.loaded/v.size*100):0}}g.extend(this,{state:g.STOPPED,runtime:"",features:{},files:u,settings:s,total:v,id:g.guid(),init:function(){var B=this,C,y,x,A=0,z;if(typeof(s.preinit)=="function"){s.preinit(B)}else{g.each(s.preinit,function(E,D){B.bind(D,E)})}s.page_url=s.page_url||document.location.pathname.replace(/\/[^\/]+$/g,"/");if(!/^(\w+:\/\/|\/)/.test(s.url)){s.url=s.page_url+s.url}s.chunk_size=g.parseSize(s.chunk_size);s.max_file_size=g.parseSize(s.max_file_size);B.bind("FilesAdded",function(D,G){var F,E,I=0,J,H=s.filters;if(H&&H.length){J=[];g.each(H,function(K){g.each(K.extensions.split(/,/),function(L){if(/^\s*\*\s*$/.test(L)){J.push("\\.*")}else{J.push("\\."+L.replace(new RegExp("["+("/^$.*+?|()[]{}\\".replace(/./g,"\\$&"))+"]","g"),"\\$&"))}})});J=new RegExp(J.join("|")+"$","i")}for(F=0;F<G.length;F++){E=G[F];E.loaded=0;E.percent=0;E.status=g.QUEUED;if(J&&!J.test(E.name)){D.trigger("Error",{code:g.FILE_EXTENSION_ERROR,message:g.translate("File extension error."),file:E});continue}if(E.size!==b&&E.size>s.max_file_size){D.trigger("Error",{code:g.FILE_SIZE_ERROR,message:g.translate("File size error."),file:E});continue}u.push(E);I++}if(I){c(function(){B.trigger("QueueChanged");B.refresh()},1)}else{return false}});if(s.unique_names){B.bind("UploadFile",function(D,E){var G=E.name.match(/\.([^.]+)$/),F="tmp";if(G){F=G[1]}E.target_name=E.id+"."+F})}B.bind("UploadProgress",function(D,E){E.percent=E.size>0?Math.ceil(E.loaded/E.size*100):100;o()});B.bind("StateChanged",function(D){if(D.state==g.STARTED){r=(+new Date())}else{if(D.state==g.STOPPED){for(C=D.files.length-1;C>=0;C--){if(D.files[C].status==g.UPLOADING){D.files[C].status=g.QUEUED;o()}}}}});B.bind("QueueChanged",o);B.bind("Error",function(D,E){if(E.file){E.file.status=g.FAILED;o();if(D.state==g.STARTED){c(function(){t.call(B)},1)}}});B.bind("FileUploaded",function(D,E){E.status=g.DONE;E.loaded=E.size;D.trigger("UploadProgress",E);c(function(){t.call(B)},1)});if(s.runtimes){y=[];z=s.runtimes.split(/\s?,\s?/);for(C=0;C<z.length;C++){if(l[z[C]]){y.push(l[z[C]])}}}else{y=l}function w(){var G=y[A++],F,D,E;if(G){F=G.getFeatures();D=B.settings.required_features;if(D){D=D.split(",");for(E=0;E<D.length;E++){if(!F[D[E]]){w();return}}}G.init(B,function(H){if(H&&H.success){B.features=F;B.runtime=G.name;B.trigger("Init",{runtime:G.name});B.trigger("PostInit");B.refresh()}else{w()}})}else{B.trigger("Error",{code:g.INIT_ERROR,message:g.translate("Init error.")})}}w();if(typeof(s.init)=="function"){s.init(B)}else{g.each(s.init,function(E,D){B.bind(D,E)})}},refresh:function(){this.trigger("Refresh")},start:function(){if(u.length&&this.state!=g.STARTED){this.state=g.STARTED;this.trigger("StateChanged");t.call(this)}},stop:function(){if(this.state!=g.STOPPED){this.state=g.STOPPED;this.trigger("CancelUpload");this.trigger("StateChanged")}},disableBrowse:function(){q=arguments[0]!==b?arguments[0]:true;this.trigger("DisableBrowse",q)},getFile:function(x){var w;for(w=u.length-1;w>=0;w--){if(u[w].id===x){return u[w]}}},removeFile:function(x){var w;for(w=u.length-1;w>=0;w--){if(u[w].id===x.id){return this.splice(w,1)[0]}}},splice:function(y,w){var x;x=u.splice(y===b?0:y,w===b?u.length:w);this.trigger("FilesRemoved",x);this.trigger("QueueChanged");return x},trigger:function(x){var z=p[x.toLowerCase()],y,w;if(z){w=Array.prototype.slice.call(arguments);w[0]=this;for(y=0;y<z.length;y++){if(z[y].func.apply(z[y].scope,w)===false){return false}}}return true},hasEventListener:function(w){return!!p[w.toLowerCase()]},bind:function(w,y,x){var z;w=w.toLowerCase();z=p[w]||[];z.push({func:y,scope:x||this});p[w]=z},unbind:function(w){w=w.toLowerCase();var z=p[w],x,y=arguments[1];if(z){if(y!==b){for(x=z.length-1;x>=0;x--){if(z[x].func===y){z.splice(x,1);break}}}else{z=[]}if(!z.length){delete p[w]}}},unbindAll:function(){var w=this;g.each(p,function(y,x){w.unbind(x)})},destroy:function(){this.stop();this.trigger("Destroy");this.unbindAll()}})};g.File=function(r,p,q){var o=this;o.id=r;o.name=p;o.size=q;o.loaded=0;o.percent=0;o.status=0};g.Runtime=function(){this.getFeatures=function(){};this.init=function(o,p){}};g.QueueProgress=function(){var o=this;o.size=0;o.loaded=0;o.uploaded=0;o.failed=0;o.queued=0;o.percent=0;o.bytesPerSec=0;o.reset=function(){o.size=o.loaded=o.uploaded=o.failed=o.queued=o.percent=o.bytesPerSec=0}};g.runtimes={};window.plupload=g})();(function(){if(window.google&&google.gears){return}var a=null;if(typeof GearsFactory!="undefined"){a=new GearsFactory()}else{try{a=new ActiveXObject("Gears.Factory");if(a.getBuildInfo().indexOf("ie_mobile")!=-1){a.privateSetGlobalObject(this)}}catch(b){if((typeof navigator.mimeTypes!="undefined")&&navigator.mimeTypes["application/x-googlegears"]){a=document.createElement("object");a.style.display="none";a.width=0;a.height=0;a.type="application/x-googlegears";document.documentElement.appendChild(a)}}}if(!a){return}if(!window.google){window.google={}}if(!google.gears){google.gears={factory:a}}})();(function(e,b,c,d){var f={};function a(h,k,m){var g,j,l,o;j=google.gears.factory.create("beta.canvas");try{j.decode(h);if(!k.width){k.width=j.width}if(!k.height){k.height=j.height}o=Math.min(width/j.width,height/j.height);if(o<1||(o===1&&m==="image/jpeg")){j.resize(Math.round(j.width*o),Math.round(j.height*o));if(k.quality){return j.encode(m,{quality:k.quality/100})}return j.encode(m)}}catch(n){}return h}c.runtimes.Gears=c.addRuntime("gears",{getFeatures:function(){return{dragdrop:true,jpgresize:true,pngresize:true,chunks:true,progress:true,multipart:true,multi_selection:true}},init:function(l,n){var m,h,g=false;if(!e.google||!google.gears){return n({success:false})}try{m=google.gears.factory.create("beta.desktop")}catch(k){return n({success:false})}function j(q){var p,o,r=[],s;for(o=0;o<q.length;o++){p=q[o];s=c.guid();f[s]=p.blob;r.push(new c.File(s,p.name,p.blob.length))}l.trigger("FilesAdded",r)}l.bind("PostInit",function(){var p=l.settings,o=b.getElementById(p.drop_element);if(o){c.addEvent(o,"dragover",function(q){m.setDropEffect(q,"copy");q.preventDefault()},l.id);c.addEvent(o,"drop",function(r){var q=m.getDragData(r,"application/x-gears-files");if(q){j(q.files)}r.preventDefault()},l.id);o=0}c.addEvent(b.getElementById(p.browse_button),"click",function(u){var t=[],r,q,s;u.preventDefault();if(g){return}no_type_restriction:for(r=0;r<p.filters.length;r++){s=p.filters[r].extensions.split(",");for(q=0;q<s.length;q++){if(s[q]==="*"){t=[];break no_type_restriction}t.push("."+s[q])}}m.openFiles(j,{singleFile:!p.multi_selection,filter:t})},l.id)});l.bind("CancelUpload",function(){if(h.abort){h.abort()}});l.bind("UploadFile",function(u,r){var w=0,v,s,t=0,q=u.settings.resize,o;if(q&&/\.(png|jpg|jpeg)$/i.test(r.name)){f[r.id]=a(f[r.id],q,/\.png$/i.test(r.name)?"image/png":"image/jpeg")}r.size=f[r.id].length;s=u.settings.chunk_size;o=s>0;v=Math.ceil(r.size/s);if(!o){s=r.size;v=1}function p(){var C,y=u.settings.multipart,x=0,B={name:r.target_name||r.name},z=u.settings.url;function A(E){var D,J="----pluploadboundary"+c.guid(),G="--",I="\r\n",F,H;if(y){h.setRequestHeader("Content-Type","multipart/form-data; boundary="+J);D=google.gears.factory.create("beta.blobbuilder");c.each(c.extend(B,u.settings.multipart_params),function(L,K){D.append(G+J+I+'Content-Disposition: form-data; name="'+K+'"'+I+I);D.append(L+I)});H=c.mimeTypes[r.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream";D.append(G+J+I+'Content-Disposition: form-data; name="'+u.settings.file_data_name+'"; filename="'+r.name+'"'+I+"Content-Type: "+H+I+I);D.append(E);D.append(I+G+J+G+I);F=D.getAsBlob();x=F.length-E.length;E=F}h.send(E)}if(r.status==c.DONE||r.status==c.FAILED||u.state==c.STOPPED){return}if(o){B.chunk=w;B.chunks=v}C=Math.min(s,r.size-(w*s));if(!y){z=c.buildUrl(u.settings.url,B)}h=google.gears.factory.create("beta.httprequest");h.open("POST",z);if(!y){h.setRequestHeader("Content-Disposition",'attachment; filename="'+r.name+'"');h.setRequestHeader("Content-Type","application/octet-stream")}c.each(u.settings.headers,function(E,D){h.setRequestHeader(D,E)});h.upload.onprogress=function(D){r.loaded=t+D.loaded-x;u.trigger("UploadProgress",r)};h.onreadystatechange=function(){var D;if(h.readyState==4&&u.state!==c.STOPPED){if(h.status==200){D={chunk:w,chunks:v,response:h.responseText,status:h.status};u.trigger("ChunkUploaded",r,D);if(D.cancelled){r.status=c.FAILED;return}t+=C;if(++w>=v){r.status=c.DONE;u.trigger("FileUploaded",r,{response:h.responseText,status:h.status})}else{p()}}else{u.trigger("Error",{code:c.HTTP_ERROR,message:c.translate("HTTP Error."),file:r,chunk:w,chunks:v,status:h.status})}}};if(w<v){A(f[r.id].slice(w*s,C))}}p()});l.bind("DisableBrowse",function(o,p){g=p});l.bind("Destroy",function(o){var p,q,r={browseButton:o.settings.browse_button,dropElm:o.settings.drop_element};for(p in r){q=b.getElementById(r[p]);if(q){c.removeAllEvents(q,o.id)}}});n({success:true})}})})(window,document,plupload);(function(g,b,d,e){var a={},h={};function c(o){var n,m=typeof o,j,l,k;if(o===e||o===null){return"null"}if(m==="string"){n="\bb\tt\nn\ff\rr\"\"''\\\\";return'"'+o.replace(/([\u0080-\uFFFF\x00-\x1f\"])/g,function(r,q){var p=n.indexOf(q);if(p+1){return"\\"+n.charAt(p+1)}r=q.charCodeAt().toString(16);return"\\u"+"0000".substring(r.length)+r})+'"'}if(m=="object"){j=o.length!==e;n="";if(j){for(l=0;l<o.length;l++){if(n){n+=","}n+=c(o[l])}n="["+n+"]"}else{for(k in o){if(o.hasOwnProperty(k)){if(n){n+=","}n+=c(k)+":"+c(o[k])}}n="{"+n+"}"}return n}return""+o}function f(s){var v=false,j=null,o=null,k,l,m,u,n,q=0;try{try{o=new ActiveXObject("AgControl.AgControl");if(o.IsVersionSupported(s)){v=true}o=null}catch(r){var p=navigator.plugins["Silverlight Plug-In"];if(p){k=p.description;if(k==="1.0.30226.2"){k="2.0.30226.2"}l=k.split(".");while(l.length>3){l.pop()}while(l.length<4){l.push(0)}m=s.split(".");while(m.length>4){m.pop()}do{u=parseInt(m[q],10);n=parseInt(l[q],10);q++}while(q<m.length&&u===n);if(u<=n&&!isNaN(u)){v=true}}}}catch(t){v=false}return v}d.silverlight={trigger:function(n,k){var m=a[n],l,j;if(m){j=d.toArray(arguments).slice(1);j[0]="Silverlight:"+k;setTimeout(function(){m.trigger.apply(m,j)},0)}}};d.runtimes.Silverlight=d.addRuntime("silverlight",{getFeatures:function(){return{jpgresize:true,pngresize:true,chunks:true,progress:true,multipart:true,multi_selection:true}},init:function(p,q){var o,m="",n=p.settings.filters,l,k=b.body;if(!f("2.0.31005.0")||(g.opera&&g.opera.buildNumber)){q({success:false});return}h[p.id]=false;a[p.id]=p;o=b.createElement("div");o.id=p.id+"_silverlight_container";d.extend(o.style,{position:"absolute",top:"0px",background:p.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100px",height:"100px",overflow:"hidden",opacity:p.settings.shim_bgcolor||b.documentMode>8?"":0.01});o.className="plupload silverlight";if(p.settings.container){k=b.getElementById(p.settings.container);if(d.getStyle(k,"position")==="static"){k.style.position="relative"}}k.appendChild(o);for(l=0;l<n.length;l++){m+=(m!=""?"|":"")+n[l].title+" | *."+n[l].extensions.replace(/,/g,";*.")}o.innerHTML='<object id="'+p.id+'_silverlight" data="data:application/x-silverlight," type="application/x-silverlight-2" style="outline:none;" width="1024" height="1024"><param name="source" value="'+p.settings.silverlight_xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="id='+p.id+",filter="+m+",multiselect="+p.settings.multi_selection+'"/></object>';function j(){return b.getElementById(p.id+"_silverlight").content.Upload}p.bind("Silverlight:Init",function(){var r,s={};if(h[p.id]){return}h[p.id]=true;p.bind("Silverlight:StartSelectFiles",function(t){r=[]});p.bind("Silverlight:SelectFile",function(t,w,u,v){var x;x=d.guid();s[x]=w;s[w]=x;r.push(new d.File(x,u,v))});p.bind("Silverlight:SelectSuccessful",function(){if(r.length){p.trigger("FilesAdded",r)}});p.bind("Silverlight:UploadChunkError",function(t,w,u,x,v){p.trigger("Error",{code:d.IO_ERROR,message:"IO Error.",details:v,file:t.getFile(s[w])})});p.bind("Silverlight:UploadFileProgress",function(t,x,u,w){var v=t.getFile(s[x]);if(v.status!=d.FAILED){v.size=w;v.loaded=u;t.trigger("UploadProgress",v)}});p.bind("Refresh",function(t){var u,v,w;u=b.getElementById(t.settings.browse_button);if(u){v=d.getPos(u,b.getElementById(t.settings.container));w=d.getSize(u);d.extend(b.getElementById(t.id+"_silverlight_container").style,{top:v.y+"px",left:v.x+"px",width:w.w+"px",height:w.h+"px"})}});p.bind("Silverlight:UploadChunkSuccessful",function(t,w,u,z,y){var x,v=t.getFile(s[w]);x={chunk:u,chunks:z,response:y};t.trigger("ChunkUploaded",v,x);if(v.status!=d.FAILED&&t.state!==d.STOPPED){j().UploadNextChunk()}if(u==z-1){v.status=d.DONE;t.trigger("FileUploaded",v,{response:y})}});p.bind("Silverlight:UploadSuccessful",function(t,w,u){var v=t.getFile(s[w]);v.status=d.DONE;t.trigger("FileUploaded",v,{response:u})});p.bind("FilesRemoved",function(t,v){var u;for(u=0;u<v.length;u++){j().RemoveFile(s[v[u].id])}});p.bind("UploadFile",function(t,v){var w=t.settings,u=w.resize||{};j().UploadFile(s[v.id],t.settings.url,c({name:v.target_name||v.name,mime:d.mimeTypes[v.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:w.chunk_size,image_width:u.width,image_height:u.height,image_quality:u.quality||90,multipart:!!w.multipart,multipart_params:w.multipart_params||{},file_data_name:w.file_data_name,headers:w.headers}))});p.bind("CancelUpload",function(){j().CancelUpload()});p.bind("Silverlight:MouseEnter",function(t){var u,v;u=b.getElementById(p.settings.browse_button);v=t.settings.browse_button_hover;if(u&&v){d.addClass(u,v)}});p.bind("Silverlight:MouseLeave",function(t){var u,v;u=b.getElementById(p.settings.browse_button);v=t.settings.browse_button_hover;if(u&&v){d.removeClass(u,v)}});p.bind("Silverlight:MouseLeftButtonDown",function(t){var u,v;u=b.getElementById(p.settings.browse_button);v=t.settings.browse_button_active;if(u&&v){d.addClass(u,v);d.addEvent(b.body,"mouseup",function(){d.removeClass(u,v)})}});p.bind("Sliverlight:StartSelectFiles",function(t){var u,v;u=b.getElementById(p.settings.browse_button);v=t.settings.browse_button_active;if(u&&v){d.removeClass(u,v)}});p.bind("DisableBrowse",function(t,u){j().DisableBrowse(u)});p.bind("Destroy",function(t){var u;d.removeAllEvents(b.body,t.id);delete h[t.id];delete a[t.id];u=b.getElementById(t.id+"_silverlight_container");if(u){k.removeChild(u)}});q({success:true})})}})})(window,document,plupload);(function(f,b,d,e){var a={},g={};function c(){var h;try{h=navigator.plugins["Shockwave Flash"];h=h.description}catch(k){try{h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(j){h="0.0"}}h=h.match(/\d+/g);return parseFloat(h[0]+"."+h[1])}d.flash={trigger:function(k,h,j){setTimeout(function(){var n=a[k],m,l;if(n){n.trigger("Flash:"+h,j)}},0)}};d.runtimes.Flash=d.addRuntime("flash",{getFeatures:function(){return{jpgresize:true,pngresize:true,maxWidth:8091,maxHeight:8091,chunks:true,progress:true,multipart:true,multi_selection:true}},init:function(n,p){var l,m,h=0,j=b.body;if(c()<10){p({success:false});return}g[n.id]=false;a[n.id]=n;l=b.getElementById(n.settings.browse_button);m=b.createElement("div");m.id=n.id+"_flash_container";d.extend(m.style,{position:"absolute",top:"0px",background:n.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100%",height:"100%"});m.className="plupload flash";if(n.settings.container){j=b.getElementById(n.settings.container);if(d.getStyle(j,"position")==="static"){j.style.position="relative"}}j.appendChild(m);(function(){var q,r;q='<object id="'+n.id+'_flash" type="application/x-shockwave-flash" data="'+n.settings.flash_swf_url+'" ';if(d.ua.ie){q+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '}q+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+n.settings.flash_swf_url+'" /><param name="flashvars" value="id='+escape(n.id)+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';if(d.ua.ie){r=b.createElement("div");m.appendChild(r);r.outerHTML=q;r=null}else{m.innerHTML=q}}());function o(){return b.getElementById(n.id+"_flash")}function k(){if(h++>5000){p({success:false});return}if(g[n.id]===false){setTimeout(k,1)}}k();l=m=null;n.bind("Destroy",function(q){var r;d.removeAllEvents(b.body,q.id);delete g[q.id];delete a[q.id];r=b.getElementById(q.id+"_flash_container");if(r){j.removeChild(r)}});n.bind("Flash:Init",function(){var s={},r;try{o().setFileFilters(n.settings.filters,n.settings.multi_selection)}catch(q){p({success:false});return}if(g[n.id]){return}g[n.id]=true;n.bind("UploadFile",function(t,v){var w=t.settings,u=n.settings.resize||{};o().uploadFile(s[v.id],w.url,{name:v.target_name||v.name,mime:d.mimeTypes[v.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:w.chunk_size,width:u.width,height:u.height,quality:u.quality,multipart:w.multipart,multipart_params:w.multipart_params||{},file_data_name:w.file_data_name,format:/\.(jpg|jpeg)$/i.test(v.name)?"jpg":"png",headers:w.headers,urlstream_upload:w.urlstream_upload})});n.bind("CancelUpload",function(){o().cancelUpload()});n.bind("Flash:UploadProcess",function(u,t){var v=u.getFile(s[t.id]);if(v.status!=d.FAILED){v.loaded=t.loaded;v.size=t.size;u.trigger("UploadProgress",v)}});n.bind("Flash:UploadChunkComplete",function(t,v){var w,u=t.getFile(s[v.id]);w={chunk:v.chunk,chunks:v.chunks,response:v.text};t.trigger("ChunkUploaded",u,w);if(u.status!==d.FAILED&&t.state!==d.STOPPED){o().uploadNextChunk()}if(v.chunk==v.chunks-1){u.status=d.DONE;t.trigger("FileUploaded",u,{response:v.text})}});n.bind("Flash:SelectFiles",function(t,w){var v,u,x=[],y;for(u=0;u<w.length;u++){v=w[u];y=d.guid();s[y]=v.id;s[v.id]=y;x.push(new d.File(y,v.name,v.size))}if(x.length){n.trigger("FilesAdded",x)}});n.bind("Flash:SecurityError",function(t,u){n.trigger("Error",{code:d.SECURITY_ERROR,message:d.translate("Security error."),details:u.message,file:n.getFile(s[u.id])})});n.bind("Flash:GenericError",function(t,u){n.trigger("Error",{code:d.GENERIC_ERROR,message:d.translate("Generic error."),details:u.message,file:n.getFile(s[u.id])})});n.bind("Flash:IOError",function(t,u){n.trigger("Error",{code:d.IO_ERROR,message:d.translate("IO error."),details:u.message,file:n.getFile(s[u.id])})});n.bind("Flash:ImageError",function(t,u){n.trigger("Error",{code:parseInt(u.code,10),message:d.translate("Image error."),file:n.getFile(s[u.id])})});n.bind("Flash:StageEvent:rollOver",function(t){var u,v;u=b.getElementById(n.settings.browse_button);v=t.settings.browse_button_hover;if(u&&v){d.addClass(u,v)}});n.bind("Flash:StageEvent:rollOut",function(t){var u,v;u=b.getElementById(n.settings.browse_button);v=t.settings.browse_button_hover;if(u&&v){d.removeClass(u,v)}});n.bind("Flash:StageEvent:mouseDown",function(t){var u,v;u=b.getElementById(n.settings.browse_button);v=t.settings.browse_button_active;if(u&&v){d.addClass(u,v);d.addEvent(b.body,"mouseup",function(){d.removeClass(u,v)},t.id)}});n.bind("Flash:StageEvent:mouseUp",function(t){var u,v;u=b.getElementById(n.settings.browse_button);v=t.settings.browse_button_active;if(u&&v){d.removeClass(u,v)}});n.bind("Flash:ExifData",function(t,u){n.trigger("ExifData",n.getFile(s[u.id]),u.data)});n.bind("Flash:GpsData",function(t,u){n.trigger("GpsData",n.getFile(s[u.id]),u.data)});n.bind("QueueChanged",function(t){n.refresh()});n.bind("FilesRemoved",function(t,v){var u;for(u=0;u<v.length;u++){o().removeFile(s[v[u].id])}});n.bind("StateChanged",function(t){n.refresh()});n.bind("Refresh",function(t){var u,v,w;o().setFileFilters(n.settings.filters,n.settings.multi_selection);u=b.getElementById(t.settings.browse_button);if(u){v=d.getPos(u,b.getElementById(t.settings.container));w=d.getSize(u);d.extend(b.getElementById(t.id+"_flash_container").style,{top:v.y+"px",left:v.x+"px",width:w.w+"px",height:w.h+"px"})}});n.bind("DisableBrowse",function(t,u){o().disableBrowse(u)});p({success:true})})}})})(window,document,plupload);(function(a){a.runtimes.BrowserPlus=a.addRuntime("browserplus",{getFeatures:function(){return{dragdrop:true,jpgresize:true,pngresize:true,chunks:true,progress:true,multipart:true,multi_selection:true}},init:function(g,j){var e=window.BrowserPlus,h={},d=g.settings,c=d.resize;function f(o){var n,m,k=[],l,p;for(m=0;m<o.length;m++){l=o[m];p=a.guid();h[p]=l;k.push(new a.File(p,l.name,l.size))}if(m){g.trigger("FilesAdded",k)}}function b(){var k=false;g.bind("PostInit",function(){var o,m=d.drop_element,q=g.id+"_droptarget",l=document.getElementById(m),n;function r(t,s){e.DragAndDrop.AddDropTarget({id:t},function(u){e.DragAndDrop.AttachCallbacks({id:t,hover:function(v){if(!v&&s){s()}},drop:function(v){if(s){s()}f(v)}},function(){})})}function p(){document.getElementById(q).style.top="-1000px"}if(l){if(document.attachEvent&&(/MSIE/gi).test(navigator.userAgent)){o=document.createElement("div");o.setAttribute("id",q);a.extend(o.style,{position:"absolute",top:"-1000px",background:"red",filter:"alpha(opacity=0)",opacity:0});document.body.appendChild(o);a.addEvent(l,"dragenter",function(t){var s,u;s=document.getElementById(m);u=a.getPos(s);a.extend(document.getElementById(q).style,{top:u.y+"px",left:u.x+"px",width:s.offsetWidth+"px",height:s.offsetHeight+"px"})});r(q,p)}else{r(m)}}a.addEvent(document.getElementById(d.browse_button),"click",function(y){var s=[],u,t,x=d.filters,w,v;y.preventDefault();if(k){return}no_type_restriction:for(u=0;u<x.length;u++){w=x[u].extensions.split(",");for(t=0;t<w.length;t++){if(w[t]==="*"){s=[];break no_type_restriction}v=a.mimeTypes[w[t]];if(v&&a.inArray(v,s)===-1){s.push(a.mimeTypes[w[t]])}}}e.FileBrowse.OpenBrowseDialog({mimeTypes:s},function(z){if(z.success){f(z.value)}})});l=o=null});g.bind("CancelUpload",function(){e.Uploader.cancel({},function(){})});g.bind("DisableBrowse",function(l,m){k=m});g.bind("UploadFile",function(o,l){var n=h[l.id],t={},m=o.settings.chunk_size,p,q=[];function s(u,w){var v;if(l.status==a.FAILED){return}t.name=l.target_name||l.name;if(m){t.chunk=""+u;t.chunks=""+w}v=q.shift();e.Uploader.upload({url:o.settings.url,files:{file:v},cookies:document.cookies,postvars:a.extend(t,o.settings.multipart_params),progressCallback:function(z){var y,x=0;p[u]=parseInt(z.filePercent*v.size/100,10);for(y=0;y<p.length;y++){x+=p[y]}l.loaded=x;o.trigger("UploadProgress",l)}},function(y){var x,z;if(y.success){x=y.value.statusCode;if(m){o.trigger("ChunkUploaded",l,{chunk:u,chunks:w,response:y.value.body,status:x})}if(q.length>0){s(++u,w)}else{l.status=a.DONE;o.trigger("FileUploaded",l,{response:y.value.body,status:x});if(x>=400){o.trigger("Error",{code:a.HTTP_ERROR,message:a.translate("HTTP Error."),file:l,status:x})}}}else{o.trigger("Error",{code:a.GENERIC_ERROR,message:a.translate("Generic Error."),file:l,details:y.error})}})}function r(u){l.size=u.size;if(m){e.FileAccess.chunk({file:u,chunkSize:m},function(x){if(x.success){var y=x.value,v=y.length;p=Array(v);for(var w=0;w<v;w++){p[w]=0;q.push(y[w])}s(0,v)}})}else{p=Array(1);q.push(u);s(0,1)}}if(c&&/\.(png|jpg|jpeg)$/i.test(l.name)){BrowserPlus.ImageAlter.transform({file:n,quality:c.quality||90,actions:[{scale:{maxwidth:c.width,maxheight:c.height}}]},function(u){if(u.success){r(u.value.file)}})}else{r(n)}});j({success:true})}if(e){e.init(function(l){var k=[{service:"Uploader",version:"3"},{service:"DragAndDrop",version:"1"},{service:"FileBrowse",version:"1"},{service:"FileAccess",version:"2"}];if(c){k.push({service:"ImageAlter",version:"4"})}if(l.success){e.require({services:k},function(m){if(m.success){b()}else{j()}})}else{j()}})}else{j()}}})})(plupload);(function(h,k,j,e){var c={},g;function m(o,p){var n;if("FileReader"in h){n=new FileReader();n.readAsDataURL(o);n.onload=function(){p(n.result)}}else{return p(o.getAsDataURL())}}function l(o,p){var n;if("FileReader"in h){n=new FileReader();n.readAsBinaryString(o);n.onload=function(){p(n.result)}}else{return p(o.getAsBinary())}}function d(r,p,n,v){var q,o,u,s,t=this;m(c[r.id],function(w){q=k.createElement("canvas");q.style.display="none";k.body.appendChild(q);o=q.getContext("2d");u=new Image();u.onerror=u.onabort=function(){v({success:false})};u.onload=function(){var B,x,z,y,A;if(!p.width){p.width=u.width}if(!p.height){p.height=u.height}s=Math.min(p.width/u.width,p.height/u.height);if(s<1||(s===1&&n==="image/jpeg")){B=Math.round(u.width*s);x=Math.round(u.height*s);q.width=B;q.height=x;o.drawImage(u,0,0,B,x);if(n==="image/jpeg"){y=new f(atob(w.substring(w.indexOf("base64,")+7)));if(y.headers&&y.headers.length){A=new a();if(A.init(y.get("exif")[0])){A.setExif("PixelXDimension",B);A.setExif("PixelYDimension",x);y.set("exif",A.getBinary());if(t.hasEventListener("ExifData")){t.trigger("ExifData",r,A.EXIF())}if(t.hasEventListener("GpsData")){t.trigger("GpsData",r,A.GPS())}}}if(p.quality){try{w=q.toDataURL(n,p.quality/100)}catch(C){w=q.toDataURL(n)}}}else{w=q.toDataURL(n)}w=w.substring(w.indexOf("base64,")+7);w=atob(w);if(y&&y.headers&&y.headers.length){w=y.restore(w);y.purge()}q.parentNode.removeChild(q);v({success:true,data:w})}else{v({success:false})}};u.src=w})}j.runtimes.Html5=j.addRuntime("html5",{getFeatures:function(){var s,o,r,q,p,n;o=r=p=n=false;if(h.XMLHttpRequest){s=new XMLHttpRequest();r=!!s.upload;o=!!(s.sendAsBinary||s.upload)}if(o){q=!!(s.sendAsBinary||(h.Uint8Array&&h.ArrayBuffer));p=!!(File&&(File.prototype.getAsDataURL||h.FileReader)&&q);n=!!(File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice))}g=j.ua.safari&&j.ua.windows;return{html5:o,dragdrop:(function(){var t=k.createElement("div");return("draggable"in t)||("ondragstart"in t&&"ondrop"in t)}()),jpgresize:p,pngresize:p,multipart:p||!!h.FileReader||!!h.FormData,canSendBinary:q,cantSendBlobInFormData:!!(j.ua.gecko&&h.FormData&&h.FileReader&&!FileReader.prototype.readAsArrayBuffer),progress:r,chunks:n,multi_selection:!(j.ua.safari&&j.ua.windows),triggerDialog:(j.ua.gecko&&h.FormData||j.ua.webkit)}},init:function(p,r){var n,q;function o(w){var u,t,v=[],x,s={};for(t=0;t<w.length;t++){u=w[t];if(s[u.name]){continue}s[u.name]=true;x=j.guid();c[x]=u;v.push(new j.File(x,u.fileName||u.name,u.fileSize||u.size))}if(v.length){p.trigger("FilesAdded",v)}}n=this.getFeatures();if(!n.html5){r({success:false});return}p.bind("Init",function(w){var G,F,C=[],v,D,t=w.settings.filters,u,B,s=k.body,E;G=k.createElement("div");G.id=w.id+"_html5_container";j.extend(G.style,{position:"absolute",background:p.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:p.settings.shim_bgcolor?"":0});G.className="plupload html5";if(p.settings.container){s=k.getElementById(p.settings.container);if(j.getStyle(s,"position")==="static"){s.style.position="relative"}}s.appendChild(G);no_type_restriction:for(v=0;v<t.length;v++){u=t[v].extensions.split(/,/);for(D=0;D<u.length;D++){if(u[D]==="*"){C=[];break no_type_restriction}B=j.mimeTypes[u[D]];if(B&&j.inArray(B,C)===-1){C.push(B)}}}G.innerHTML='<input id="'+p.id+'_html5"  style="font-size:999px" type="file" accept="'+C.join(",")+'" '+(p.settings.multi_selection&&p.features.multi_selection?'multiple="multiple"':"")+" />";G.scrollTop=100;E=k.getElementById(p.id+"_html5");if(w.features.triggerDialog){j.extend(E.style,{position:"absolute",width:"100%",height:"100%"})}else{j.extend(E.style,{cssFloat:"right",styleFloat:"right"})}E.onchange=function(){o(this.files);this.value=""};F=k.getElementById(w.settings.browse_button);if(F){var z=w.settings.browse_button_hover,A=w.settings.browse_button_active,x=w.features.triggerDialog?F:G;if(z){j.addEvent(x,"mouseover",function(){j.addClass(F,z)},w.id);j.addEvent(x,"mouseout",function(){j.removeClass(F,z)},w.id)}if(A){j.addEvent(x,"mousedown",function(){j.addClass(F,A)},w.id);j.addEvent(k.body,"mouseup",function(){j.removeClass(F,A)},w.id)}if(w.features.triggerDialog){j.addEvent(F,"mouseup",function(H){var y=k.getElementById(w.id+"_html5");if(y&&!y.disabled){y.click()}H.preventDefault()},w.id)}}});p.bind("PostInit",function(){var s=k.getElementById(p.settings.drop_element);if(s){if(g){j.addEvent(s,"dragenter",function(w){var v,t,u;v=k.getElementById(p.id+"_drop");if(!v){v=k.createElement("input");v.setAttribute("type","file");v.setAttribute("id",p.id+"_drop");v.setAttribute("multiple","multiple");j.addEvent(v,"change",function(){o(this.files);j.removeEvent(v,"change",p.id);v.parentNode.removeChild(v)},p.id);s.appendChild(v)}t=j.getPos(s,k.getElementById(p.settings.container));u=j.getSize(s);if(j.getStyle(s,"position")==="static"){j.extend(s.style,{position:"relative"})}j.extend(v.style,{position:"absolute",display:"block",top:0,left:0,width:u.w+"px",height:u.h+"px",opacity:0})},p.id);return}j.addEvent(s,"dragover",function(t){t.preventDefault()},p.id);j.addEvent(s,"drop",function(u){var t=u.dataTransfer;if(t&&t.files){o(t.files)}u.preventDefault()},p.id)}});p.bind("Refresh",function(s){var t,u,v,x,w;t=k.getElementById(p.settings.browse_button);if(t){u=j.getPos(t,k.getElementById(s.settings.container));v=j.getSize(t);x=k.getElementById(p.id+"_html5_container");j.extend(x.style,{top:u.y+"px",left:u.x+"px",width:v.w+"px",height:v.h+"px"});if(p.features.triggerDialog){if(j.getStyle(t,"position")==="static"){j.extend(t.style,{position:"relative"})}w=parseInt(j.getStyle(t,"z-index"),10);if(isNaN(w)){w=0}j.extend(t.style,{zIndex:w});j.extend(x.style,{zIndex:w-1})}}});p.bind("DisableBrowse",function(s,u){var t=k.getElementById(s.id+"_html5");if(t){t.disabled=u}});p.bind("CancelUpload",function(){if(q&&q.abort){q.abort()}});p.bind("UploadFile",function(s,u){var v=s.settings,y,t;function x(A,D,z){var B;if(File.prototype.slice){try{A.slice();return A.slice(D,z)}catch(C){return A.slice(D,z-D)}}else{if(B=File.prototype.webkitSlice||File.prototype.mozSlice){return B.call(A,D,z)}else{return null}}}function w(A){var D=0,C=0,z=("FileReader"in h)?new FileReader:null;function B(){var I,M,K,L,H,J,F,E=s.settings.url;function G(V){var T=0,N="----pluploadboundary"+j.guid(),O,P="--",U="\r\n",R="";q=new XMLHttpRequest;if(q.upload){q.upload.onprogress=function(W){u.loaded=Math.min(u.size,C+W.loaded-T);s.trigger("UploadProgress",u)}}q.onreadystatechange=function(){var W,Y;if(q.readyState==4&&s.state!==j.STOPPED){try{W=q.status}catch(X){W=0}if(W>=400){s.trigger("Error",{code:j.HTTP_ERROR,message:j.translate("HTTP Error."),file:u,status:W})}else{if(K){Y={chunk:D,chunks:K,response:q.responseText,status:W};s.trigger("ChunkUploaded",u,Y);C+=J;if(Y.cancelled){u.status=j.FAILED;return}u.loaded=Math.min(u.size,(D+1)*H)}else{u.loaded=u.size}s.trigger("UploadProgress",u);V=I=O=R=null;if(!K||++D>=K){u.status=j.DONE;s.trigger("FileUploaded",u,{response:q.responseText,status:W})}else{B()}}}};if(s.settings.multipart&&n.multipart){L.name=u.target_name||u.name;q.open("post",E,true);j.each(s.settings.headers,function(X,W){q.setRequestHeader(W,X)});if(typeof(V)!=="string"&&!!h.FormData){O=new FormData();j.each(j.extend(L,s.settings.multipart_params),function(X,W){O.append(W,X)});O.append(s.settings.file_data_name,V);q.send(O);return}if(typeof(V)==="string"){q.setRequestHeader("Content-Type","multipart/form-data; boundary="+N);j.each(j.extend(L,s.settings.multipart_params),function(X,W){R+=P+N+U+'Content-Disposition: form-data; name="'+W+'"'+U+U;R+=unescape(encodeURIComponent(X))+U});F=j.mimeTypes[u.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream";R+=P+N+U+'Content-Disposition: form-data; name="'+s.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(u.name))+'"'+U+"Content-Type: "+F+U+U+V+U+P+N+P+U;T=R.length-V.length;V=R;if(q.sendAsBinary){q.sendAsBinary(V)}else{if(n.canSendBinary){var S=new Uint8Array(V.length);for(var Q=0;Q<V.length;Q++){S[Q]=(V.charCodeAt(Q)&255)}q.send(S.buffer)}}return}}E=j.buildUrl(s.settings.url,j.extend(L,s.settings.multipart_params));q.open("post",E,true);q.setRequestHeader("Content-Type","application/octet-stream");j.each(s.settings.headers,function(X,W){q.setRequestHeader(W,X)});q.send(V)}if(u.status==j.DONE||u.status==j.FAILED||s.state==j.STOPPED){return}L={name:u.target_name||u.name};if(v.chunk_size&&u.size>v.chunk_size&&(n.chunks||typeof(A)=="string")){H=v.chunk_size;K=Math.ceil(u.size/H);J=Math.min(H,u.size-(D*H));if(typeof(A)=="string"){I=A.substring(D*H,D*H+J)}else{I=x(A,D*H,D*H+J)}L.chunk=D;L.chunks=K}else{J=u.size;I=A}if(s.settings.multipart&&n.multipart&&typeof(I)!=="string"&&z&&n.cantSendBlobInFormData&&n.chunks&&s.settings.chunk_size){z.onload=function(){G(z.result)};z.readAsBinaryString(I)}else{G(I)}}B()}y=c[u.id];if(n.jpgresize&&s.settings.resize&&/\.(png|jpg|jpeg)$/i.test(u.name)){d.call(s,u,s.settings.resize,/\.png$/i.test(u.name)?"image/png":"image/jpeg",function(z){if(z.success){u.size=z.data.length;w(z.data)}else{if(n.chunks){w(y)}else{l(y,w)}}})}else{if(!n.chunks&&n.jpgresize){l(y,w)}else{w(y)}}});p.bind("Destroy",function(s){var u,v,t=k.body,w={inputContainer:s.id+"_html5_container",inputFile:s.id+"_html5",browseButton:s.settings.browse_button,dropElm:s.settings.drop_element};for(u in w){v=k.getElementById(w[u]);if(v){j.removeAllEvents(v,s.id)}}j.removeAllEvents(k.body,s.id);if(s.settings.container){t=k.getElementById(s.settings.container)}t.removeChild(k.getElementById(w.inputContainer))});r({success:true})}});function b(){var q=false,o;function r(t,v){var s=q?0:-8*(v-1),w=0,u;for(u=0;u<v;u++){w|=(o.charCodeAt(t+u)<<Math.abs(s+u*8))}return w}function n(u,s,t){var t=arguments.length===3?t:o.length-s-1;o=o.substr(0,s)+u+o.substr(t+s)}function p(t,u,w){var x="",s=q?0:-8*(w-1),v;for(v=0;v<w;v++){x+=String.fromCharCode((u>>Math.abs(s+v*8))&255)}n(x,t,w)}return{II:function(s){if(s===e){return q}else{q=s}},init:function(s){q=false;o=s},SEGMENT:function(s,u,t){switch(arguments.length){case 1:return o.substr(s,o.length-s-1);case 2:return o.substr(s,u);case 3:n(t,s,u);break;default:return o}},BYTE:function(s){return r(s,1)},SHORT:function(s){return r(s,2)},LONG:function(s,t){if(t===e){return r(s,4)}else{p(s,t,4)}},SLONG:function(s){var t=r(s,4);return(t>2147483647?t-4294967296:t)},STRING:function(s,t){var u="";for(t+=s;s<t;s++){u+=String.fromCharCode(r(s,1))}return u}}}function f(s){var u={65505:{app:"EXIF",name:"APP1",signature:"Exif\0"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\0"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\0"}},t=[],r,n,p=e,q=0,o;r=new b();r.init(s);if(r.SHORT(0)!==65496){return}n=2;o=Math.min(1048576,s.length);while(n<=o){p=r.SHORT(n);if(p>=65488&&p<=65495){n+=2;continue}if(p===65498||p===65497){break}q=r.SHORT(n+2)+2;if(u[p]&&r.STRING(n+4,u[p].signature.length)===u[p].signature){t.push({hex:p,app:u[p].app.toUpperCase(),name:u[p].name.toUpperCase(),start:n,length:q,segment:r.SEGMENT(n,q)})}n+=q}r.init(null);return{headers:t,restore:function(y){r.init(y);var w=new f(y);if(!w.headers){return false}for(var x=w.headers.length;x>0;x--){var z=w.headers[x-1];r.SEGMENT(z.start,z.length,"")}w.purge();n=r.SHORT(2)==65504?4+r.SHORT(4):2;for(var x=0,v=t.length;x<v;x++){r.SEGMENT(n,0,t[x].segment);n+=t[x].length}return r.SEGMENT()},get:function(x){var y=[];for(var w=0,v=t.length;w<v;w++){if(t[w].app===x.toUpperCase()){y.push(t[w].segment)}}return y},set:function(y,x){var z=[];if(typeof(x)==="string"){z.push(x)}else{z=x}for(var w=ii=0,v=t.length;w<v;w++){if(t[w].app===y.toUpperCase()){t[w].segment=z[ii];t[w].length=z[ii].length;ii++}if(ii>=z.length){break}}},purge:function(){t=[];r.init(null)}}}function a(){var q,n,o={},t;q=new b();n={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}};t={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};function p(u,C){var w=q.SHORT(u),z,F,G,B,A,v,x,D,E=[],y={};for(z=0;z<w;z++){x=v=u+12*z+2;G=C[q.SHORT(x)];if(G===e){continue}B=q.SHORT(x+=2);A=q.LONG(x+=2);x+=4;E=[];switch(B){case 1:case 7:if(A>4){x=q.LONG(x)+o.tiffHeader}for(F=0;F<A;F++){E[F]=q.BYTE(x+F)}break;case 2:if(A>4){x=q.LONG(x)+o.tiffHeader}y[G]=q.STRING(x,A-1);continue;case 3:if(A>2){x=q.LONG(x)+o.tiffHeader}for(F=0;F<A;F++){E[F]=q.SHORT(x+F*2)}break;case 4:if(A>1){x=q.LONG(x)+o.tiffHeader}for(F=0;F<A;F++){E[F]=q.LONG(x+F*4)}break;case 5:x=q.LONG(x)+o.tiffHeader;for(F=0;F<A;F++){E[F]=q.LONG(x+F*4)/q.LONG(x+F*4+4)}break;case 9:x=q.LONG(x)+o.tiffHeader;for(F=0;F<A;F++){E[F]=q.SLONG(x+F*4)}break;case 10:x=q.LONG(x)+o.tiffHeader;for(F=0;F<A;F++){E[F]=q.SLONG(x+F*4)/q.SLONG(x+F*4+4)}break;default:continue}D=(A==1?E[0]:E);if(t.hasOwnProperty(G)&&typeof D!="object"){y[G]=t[G][D]}else{y[G]=D}}return y}function s(){var v=e,u=o.tiffHeader;q.II(q.SHORT(u)==18761);if(q.SHORT(u+=2)!==42){return false}o.IFD0=o.tiffHeader+q.LONG(u+=2);v=p(o.IFD0,n.tiff);o.exifIFD=("ExifIFDPointer"in v?o.tiffHeader+v.ExifIFDPointer:e);o.gpsIFD=("GPSInfoIFDPointer"in v?o.tiffHeader+v.GPSInfoIFDPointer:e);return true}function r(w,u,z){var B,y,x,A=0;if(typeof(u)==="string"){var v=n[w.toLowerCase()];for(hex in v){if(v[hex]===u){u=hex;break}}}B=o[w.toLowerCase()+"IFD"];y=q.SHORT(B);for(i=0;i<y;i++){x=B+12*i+2;if(q.SHORT(x)==u){A=x+8;break}}if(!A){return false}q.LONG(A,z);return true}return{init:function(u){o={tiffHeader:10};if(u===e||!u.length){return false}q.init(u);if(q.SHORT(0)===65505&&q.STRING(4,5).toUpperCase()==="EXIF\0"){return s()}return false},EXIF:function(){var v;v=p(o.exifIFD,n.exif);if(v.ExifVersion&&j.typeOf(v.ExifVersion)==="array"){for(var w=0,u="";w<v.ExifVersion.length;w++){u+=String.fromCharCode(v.ExifVersion[w])}v.ExifVersion=u}return v},GPS:function(){var u;u=p(o.gpsIFD,n.gps);if(u.GPSVersionID){u.GPSVersionID=u.GPSVersionID.join(".")}return u},setExif:function(u,v){if(u!=="PixelXDimension"&&u!=="PixelYDimension"){return false}return r("exif",u,v)},getBinary:function(){return q.SEGMENT()}}}})(window,document,plupload);(function(d,a,b,c){function e(f){return a.getElementById(f)}b.runtimes.Html4=b.addRuntime("html4",{getFeatures:function(){return{multipart:true,triggerDialog:(b.ua.gecko&&d.FormData||b.ua.webkit)}},init:function(f,g){f.bind("Init",function(p){var j=a.body,n,h="javascript",k,x,q,z=[],r=/MSIE/.test(navigator.userAgent),t=[],m=p.settings.filters,o,l,s,w;no_type_restriction:for(o=0;o<m.length;o++){l=m[o].extensions.split(/,/);for(w=0;w<l.length;w++){if(l[w]==="*"){t=[];break no_type_restriction}s=b.mimeTypes[l[w]];if(s&&b.inArray(s,t)===-1){t.push(s)}}}t=t.join(",");function v(){var C,A,y,B;q=b.guid();z.push(q);C=a.createElement("form");C.setAttribute("id","form_"+q);C.setAttribute("method","post");C.setAttribute("enctype","multipart/form-data");C.setAttribute("encoding","multipart/form-data");C.setAttribute("target",p.id+"_iframe");C.style.position="absolute";A=a.createElement("input");A.setAttribute("id","input_"+q);A.setAttribute("type","file");A.setAttribute("accept",t);A.setAttribute("size",1);B=e(p.settings.browse_button);if(p.features.triggerDialog&&B){b.addEvent(e(p.settings.browse_button),"click",function(D){if(!A.disabled){A.click()}D.preventDefault()},p.id)}b.extend(A.style,{width:"100%",height:"100%",opacity:0,fontSize:"99px",cursor:"pointer"});b.extend(C.style,{overflow:"hidden"});y=p.settings.shim_bgcolor;if(y){C.style.background=y}if(r){b.extend(A.style,{filter:"alpha(opacity=0)"})}b.addEvent(A,"change",function(G){var E=G.target,D,F=[],H;if(E.value){e("form_"+q).style.top=-1048575+"px";D=E.value.replace(/\\/g,"/");D=D.substring(D.length,D.lastIndexOf("/")+1);F.push(new b.File(q,D));if(!p.features.triggerDialog){b.removeAllEvents(C,p.id)}else{b.removeEvent(B,"click",p.id)}b.removeEvent(A,"change",p.id);v();if(F.length){f.trigger("FilesAdded",F)}}},p.id);C.appendChild(A);j.appendChild(C);p.refresh()}function u(){var y=a.createElement("div");y.innerHTML='<iframe id="'+p.id+'_iframe" name="'+p.id+'_iframe" src="'+h+':&quot;&quot;" style="display:none"></iframe>';n=y.firstChild;j.appendChild(n);b.addEvent(n,"load",function(D){var E=D.target,C,A;if(!k){return}try{C=E.contentWindow.document||E.contentDocument||d.frames[E.id].document}catch(B){p.trigger("Error",{code:b.SECURITY_ERROR,message:b.translate("Security error."),file:k});return}if(Prototype.Browser.IE&&(BrowserDetect.version==8)){A=C.documentElement.innerHTML;}else{A=C.body.innerHTML;}if(A){k.status=b.DONE;k.loaded=1025;k.percent=100;p.trigger("UploadProgress",k);p.trigger("FileUploaded",k,{response:A})}},p.id)}if(p.settings.container){j=e(p.settings.container);if(b.getStyle(j,"position")==="static"){j.style.position="relative"}}p.bind("UploadFile",function(y,B){var C,A;if(B.status==b.DONE||B.status==b.FAILED||y.state==b.STOPPED){return}C=e("form_"+B.id);A=e("input_"+B.id);A.setAttribute("name",y.settings.file_data_name);C.setAttribute("action",y.settings.url);b.each(b.extend({name:B.target_name||B.name},y.settings.multipart_params),function(F,D){var E=a.createElement("input");b.extend(E,{type:"hidden",name:D,value:F});C.insertBefore(E,C.firstChild)});k=B;e("form_"+q).style.top=-1048575+"px";C.submit()});p.bind("FileUploaded",function(y){y.refresh()});p.bind("StateChanged",function(y){if(y.state==b.STARTED){u()}else{if(y.state==b.STOPPED){d.setTimeout(function(){b.removeEvent(n,"load",y.id);if(n.parentNode){n.parentNode.removeChild(n)}},0)}}b.each(y.files,function(B,A){if(B.status===b.DONE||B.status===b.FAILED){var C=e("form_"+B.id);if(C){C.parentNode.removeChild(C)}}})});p.bind("Refresh",function(A){var G,B,C,D,y,H,I,F,E;G=e(A.settings.browse_button);if(G){y=b.getPos(G,e(A.settings.container));H=b.getSize(G);I=e("form_"+q);F=e("input_"+q);b.extend(I.style,{top:y.y+"px",left:y.x+"px",width:H.w+"px",height:H.h+"px"});if(A.features.triggerDialog){if(b.getStyle(G,"position")==="static"){b.extend(G.style,{position:"relative"})}E=parseInt(G.style.zIndex,10);if(isNaN(E)){E=0}b.extend(G.style,{zIndex:E});b.extend(I.style,{zIndex:E-1})}C=A.settings.browse_button_hover;D=A.settings.browse_button_active;B=A.features.triggerDialog?G:I;if(C){b.addEvent(B,"mouseover",function(){b.addClass(G,C)},A.id);b.addEvent(B,"mouseout",function(){b.removeClass(G,C)},A.id)}if(D){b.addEvent(B,"mousedown",function(){b.addClass(G,D)},A.id);b.addEvent(a.body,"mouseup",function(){b.removeClass(G,D)},A.id)}}});f.bind("FilesRemoved",function(y,B){var A,C;for(A=0;A<B.length;A++){C=e("form_"+B[A].id);if(C){C.parentNode.removeChild(C)}}});f.bind("DisableBrowse",function(y,B){var A=a.getElementById("input_"+q);if(A){A.disabled=B}});f.bind("Destroy",function(y){var A,B,C,D={inputContainer:"form_"+q,inputFile:"input_"+q,browseButton:y.settings.browse_button};for(A in D){B=e(D[A]);if(B){b.removeAllEvents(B,y.id)}}b.removeAllEvents(a.body,y.id);b.each(z,function(F,E){C=e("form_"+F);if(C){j.removeChild(C)}})});v()});g({success:true})}})})(window,document,plupload);
;$K.yg_PLUploadQueue={};$K.yg_PLUploadGlobalFileInfo={};$K.yg_PLUploadQueueProcessing=false;$K.yg_PLUploadGlobalDone=0;$K.yg_PLUploadSettings={chunk_size:$K.maxUploadSize,runtimes:'html5,html4',browse_button:'__REPLACEME__',container:'__REPLACEME__',drop_element:'__REPLACEME__',max_file_size:'10000mb',multipart:true,multi_selection:true,url:$K.appdir+'responder?handler=uploadFile&flashcookie='+document.cookie,flash_swf_url:$K.jsdir+'3rd/plupload/js/plupload.flash.swf',silverlight_xap_url:$K.jsdir+'3rd/plupload/js/plupload.silverlight.xap',filters:[],dragdrop:true,custom_settings:{uploadButtonId:'__REPLACEME__',statusPanelTemplate:'__REPLACEME__'}};$K.yg_UploadInit=function(uploadID,panelID,panelWrapperID,additionalUploadParams,customSettings,filters,multiSelect,force){if(!$(panelID))return;var panel=$(panelID);if($K.yg_PLUploadObjects[uploadID]&&!force){var pluploadSettings=Object.clone($K.yg_PLUploadObjects[uploadID].settings);}else{var pluploadSettings=Object.clone($K.yg_PLUploadSettings);}
var panelID=panel.up().identify();if(!panelWrapperID){panelWrapperID=panel.up().up().identify();}
var uploadParams={flashcookie:document.cookie};Object.extend(uploadParams,additionalUploadParams);$(panelWrapperID).addClassName('mk_uploadpanel');if($(panelWrapperID).up(1).tagName!='FORM'){var formID=$(panelWrapperID).up(0).wrap('form',{method:'post',enctype:'multipart/form-data'}).identify();$(formID).name=formID;$(formID).writeAttribute('name',formID);}else{var formID=$(panelWrapperID).up(1).identify();}
pluploadSettings.form=formID;Object.extend(pluploadSettings,{url:$K.appdir+'responder?'+Object.toQueryString(uploadParams),baseUrl:$K.appdir+'responder?'+Object.toQueryString(uploadParams),browse_button:panelID,container:panelWrapperID,drop_element:panelWrapperID,multi_selection:multiSelect,filters:filters,custom_settings:customSettings});if($K.yg_PLUploadObjects[uploadID]&&!force){$K.yg_PLUploadObjects[uploadID].settings=pluploadSettings;}else{$K.yg_PLUploadObjects[uploadID]=new plupload.Uploader(pluploadSettings);$K.yg_PLUploadMapEventHandlers($K.yg_PLUploadObjects[uploadID]);try{$K.yg_PLUploadObjects[uploadID].init();if($K.yg_PLUploadObjects[uploadID].runtime=='html4'){$K.yg_onUploadTimeout=Prototype.emptyFunction;}}
catch(ex){}}}
$K.yg_PLUploadProcessQueue=function(){$K.yg_PLUploadQueueProcessing=true;var rest=0;for(uploadObject in $K.yg_PLUploadQueue){rest++;if(!$K.yg_PLUploadObjects[uploadObject].yg_started&&($K.yg_PLUploadObjects[uploadObject].files.length>0)){$K.yg_PLUploadObjects[uploadObject].start();$K.yg_PLUploadObjects[uploadObject].yg_started=true;}
delete $K.yg_PLUploadQueue[uploadObject];continue;}}
$K.yg_PLUploadEvUploadComplete=function(up,files){var uploadObjectsRest=0;for(currUploadObject in $K.yg_PLUploadObjects){uploadObjectsRest++;}
for(currUploadObject in $K.yg_PLUploadObjects){var fileRest=$K.yg_PLUploadObjects[currUploadObject].files.length;var filesToRemove=new Array();for(var j=0;j<$K.yg_PLUploadObjects[currUploadObject].files.length;j++){if($K.yg_PLUploadObjects[currUploadObject].files[j].status==plupload.DONE){filesToRemove.push($K.yg_PLUploadObjects[currUploadObject].files[j]);fileRest--;}}
filesToRemove.each(function(item){$K.yg_PLUploadObjects[currUploadObject].removeFile(item);});if(fileRest==0){uploadObjectsRest--;$K.yg_PLUploadObjects[currUploadObject].yg_started=false;}}
if(uploadObjectsRest==0){$K.yg_PLUploadQueue={};$K.yg_PLUploadGlobalFileInfo={};$K.yg_PLUploadQueueProcessing=false;$K.yg_PLUploadGlobalDone=0;}}
$K.yg_PLUploadMapEventHandlers=function(pluploadObject){pluploadObject.bind('Init',$K.yg_PLUploadEvInit);pluploadObject.bind('FilesAdded',$K.yg_PLUploadEvFilesAdded);pluploadObject.bind('UploadProgress',$K.yg_PLUploadEvUploadProgress);pluploadObject.bind('QueueChanged',$K.yg_PLUploadEvQueueChanged);pluploadObject.bind('FileUploaded',$K.yg_PLUploadEvFileUploaded);pluploadObject.bind('UploadFile',$K.yg_PLUploadEvUploadFile);pluploadObject.bind('UploadComplete',$K.yg_PLUploadEvUploadComplete);pluploadObject.bind('Error',function(up,err){var file=err.file,message;if(file){message=err.message;if(err.details){message+=" ("+err.details+")";}}});}
$K.yg_PLUploadEvInit=function(up,params){up.runtime=params.runtime;}
$K.yg_PLUploadEvUploadFile=function(up,file){var fileInfo=$K.yg_PLUploadGlobalFileInfo[file.id];up.settings.url=up.settings.baseUrl
if(fileInfo.addFileParam){up.settings.url=up.settings.baseUrl+'&'+fileInfo.addFileParam;}
if(typeof $('wid_uploadprogress').timeoutId!='object'){$('wid_uploadprogress').timeoutId={};}
$('wid_uploadprogress').timeoutId[file.id]=window.setTimeout($K.yg_onUploadTimeout,$K.uploadTimeout);}
$K.yg_PLUploadEvQueueChanged=function(up){if(up.settings.custom_settings.autoUpload){var needToStart=false;for(file in $K.yg_PLUploadGlobalFileInfo){var currFile=$K.yg_PLUploadGlobalFileInfo[file];if(!currFile.processed){needToStart=true;currFile.processed=true;}}
if(needToStart){up.start();}}}
$K.yg_PLUploadEvFilesAdded=function(up,files){if(!up.settings.multi_selection){up.removeFile(up.files[0]);}
var fileIndex=up.files.length;if(!up.settings.multi_selection&&(files.length>1)){var tmp=files[0];files=[tmp];}
files.each(function(file){if(file.size>up.settings.max_file_size){Koala.yg_promptbox($K.TXT('TXT_ERROR'),$K.TXT('TXT_FILE_UPLOAD_TOO_BIG'),'alert');return;}
fileIndex++;if(up.settings.custom_settings.extensionDataUpload){$(up.id+'_'+up.runtime).up('.cntblockcontainer').down('.title_txt').update(file.name);var data=Array('noevent',{yg_property:'uploadFile',params:{fileID:up.settings.custom_settings.fileID,uploadID:file.id,filesQueued:up.files.length+1,title:up.settings.custom_settings.uploadTitle,type:up.settings.custom_settings.uploadType,winID:up.settings.custom_settings.winID,timestamp:up.settings.custom_settings.timestamp}});var addFileParam=Object.toQueryString({data:Object.toJSON(data)});file.addFileParam=addFileParam;$K.yg_PLUploadGlobalFileInfo[file.id]=file;if(!$K.yg_PLUploadQueueProcessing){$K.yg_PLUploadProcessQueue();}}else if(up.settings.custom_settings.autoUpload){$('wid_uploadprogress').show();$('wid_uploadprogress').style.zIndex=$K.yg_incrementTopZIndex();$K.windows['wid_uploadprogress'].init();var uploadStatusPanel=$('wid_uploadprogress').down('.mk_uploadpanel');var uploadTemplateOrig=$('wid_uploadprogress').down('.mk_upload_templates').innerHTML;var data=Array('noevent',{yg_property:'uploadFile',params:{fileID:up.settings.custom_settings.fileID,userID:up.settings.custom_settings.userID,uploadID:file.id,filesQueued:up.files.length+1,title:up.settings.custom_settings.uploadTitle,type:up.settings.custom_settings.uploadType,winID:up.settings.custom_settings.winID,timestamp:up.settings.custom_settings.timestamp}});var addFileParam=Object.toQueryString({data:Object.toJSON(data)});file.addFileParam=addFileParam;if($('wid_'+up.settings.custom_settings.winID+'_previewchanged')&&(up.settings.custom_settings.uploadType=='templatePreview')){$('wid_'+up.settings.custom_settings.winID+'_previewchanged').value='true';}
if($('wid_'+up.settings.custom_settings.winID+'_templatechanged')&&(up.settings.custom_settings.uploadType=='template')){$('wid_'+up.settings.custom_settings.winID+'_templatechanged').value='true';}
uploadTemplate=uploadTemplateOrig;uploadTemplate=uploadTemplate.replace(/__TEMPLATEINDEX__/g,fileIndex);uploadTemplate=uploadTemplate.replace(/__TEMPLATEID__/g,file.id);uploadTemplate=uploadTemplate.replace(/__TEMPLATENAME__/g,file.name);uploadStatusPanel.insert({bottom:uploadTemplate});$K.yg_PLUploadGlobalFileInfo[file.id]=file;$K.windows['wid_uploadprogress'].refresh();if(!$K.yg_PLUploadQueueProcessing){$K.yg_PLUploadProcessQueue();}}else{$('wid_upload').show();$('wid_upload').style.zIndex=$K.yg_incrementTopZIndex();$K.windows['wid_upload'].init();$K.yg_centerWindow('wid_upload');$K.yg_PLUploadGlobalFileInfo[file.id]=file;var queueEntryTemplate=$(up.settings.custom_settings.statusPanelTemplate).innerHTML;queueEntryTemplate=queueEntryTemplate.replace(/__TEMPLATEINDEX__/g,fileIndex);queueEntryTemplate=queueEntryTemplate.replace(/__TEMPLATEID__/g,file.id);queueEntryTemplate=queueEntryTemplate.replace(/__TEMPLATENAME__/g,file.name);$(up.settings.custom_settings.statusPanelTemplate.replace(/_template/,'')).insert({bottom:queueEntryTemplate});$K.windows[$(up.settings.custom_settings.statusPanelTemplate).up('.ywindow').id].refresh("col1");}});}
$K.yg_PLUploadEvUploadProgress=function(up,file){var currentFile;if(up.settings.custom_settings.extensionDataUpload){var uploadStatusPanel=$(up.settings.custom_settings.uploadWinId).down('.mk_uploadpanel');}else{var uploadStatusPanel=$('wid_uploadprogress').down('.mk_uploadpanel');}
uploadStatusPanel.select('li').each(function(item){if(item.readAttribute('yg_id').replace(/-file/,'')==file.id){currentFile=item;}});if(isNaN(file.percent)||!isFinite(file.percent)){file.percent=100;}
if(currentFile&&!currentFile.hasClassName('uploadprocessing')&&!currentFile.hasClassName('uploaddone')&&!currentFile.hasClassName('uploaderror')){currentFile.addClassName('uploading');currentFile.down('.uploadpercent').update(file.percent+'%');currentFile.down('.uploadstatusbg').down().setStyle({width:file.percent+'%'});}
if($K.windows['wid_uploadprogress'])$K.windows['wid_uploadprogress'].setCaption($K.TXT('TXT_UPLOAD_STATUS')+' <strong>'+up.total.percent+' %</strong>');if((typeof $('wid_uploadprogress').timeoutId=='object')&&($('wid_uploadprogress').timeoutId[file.id])){window.clearTimeout($('wid_uploadprogress').timeoutId[file.id]);$('wid_uploadprogress').timeoutId[file.id]=window.setTimeout($K.yg_onUploadTimeout,$K.uploadTimeout);}}
$K.yg_PLUploadEvFileUploaded=function(up,file,response){var currentFile;if(up.settings.custom_settings.extensionDataUpload){var uploadStatusPanel=$(up.settings.custom_settings.uploadWinId).down('.mk_uploadpanel');var backendFunction='processImportExtensionData';}else if(up.settings.custom_settings.userProfilePictureUpload){var uploadStatusPanel=$('wid_uploadprogress').down('.mk_uploadpanel');var backendFunction='processUserProfilePicture';}else{var uploadStatusPanel=$('wid_uploadprogress').down('.mk_uploadpanel');var backendFunction='processUpload';}
var uploadWinId=uploadStatusPanel.up('.ywindow').id;var openerWinId=up.settings.custom_settings.winID;uploadStatusPanel.select('li').each(function(item){if(item.readAttribute('yg_id').replace(/-file/,'')==file.id){currentFile=item;}});var serverData=response.response;if(serverData&&currentFile){if(serverData.startsWith('<pre>')){serverData=serverData.stripTags().unescapeHTML();}
serverData.evalScripts();if(window.hadUploadError===true){currentFile.removeClassName('uploading');currentFile.addClassName('uploaderror');currentFile.down('.uploadpercent').update('ERROR');if(window.hadUploadErrorMsg){var errorMessage=window.hadUploadErrorMsg;currentFile.observe('mouseover',function(){$K.yg_showHelp(errorMessage);});}else{currentFile.observe('mouseover',function(){$K.yg_showHelp($K.TXT('TXT_FILE_UPLOAD_ERROR'));});}
currentFile.observe('mouseout',function(){$K.yg_showHelp(false);});window.hadUploadError=false;window.hadUploadErrorMsg=undefined;}else if(window.noprocessing){currentFile.removeClassName('uploading');currentFile.addClassName('uploaddone');currentFile.down('.uploadpercent').update('OK');window.noprocessing=false;}else{currentFile.removeClassName('uploading');currentFile.addClassName('uploadprocessing');currentFile.down('.uploadpercent').update('<div class="uploadprocessing"><!-- //--></div>');currentFile.srcWindow=up.settings.custom_settings.winID;currentFile.userID=up.settings.custom_settings.userID;var lastFile=false;var uploadingFiles=currentFile.up('ul').select('li.uploading');if(uploadingFiles.length==0){lastFile=true;if(Prototype.Browser.IE&&(BrowserDetect.version==8)){$K.windows['wid_uploadprogress'].setCaption($K.TXT('TXT_UPLOAD_STATUS')+' <strong>100 %</strong>');}}
uploadStatusPanel.select('li').each(function(item){if(item.readAttribute('yg_id')==file.id+'-file'){var data=Array('noevent',{yg_property:backendFunction,params:{filePrefix:item.filePrefix,realFilename:file.name,userID:currentFile.userID,extensionId:item.extensionId,itemID:item.id,uploadWinId:uploadWinId,openerWinId:openerWinId,reUpload:item.reUpload,lastFile:lastFile}});$K.yg_AjaxCallback(data,backendFunction);}});}
if((typeof $('wid_uploadprogress').timeoutId=='object')&&($('wid_uploadprogress').timeoutId[file.id])){window.clearTimeout($('wid_uploadprogress').timeoutId[file.id]);$('wid_uploadprogress').timeoutId[file.id]=undefined;}}
if(up.total.queued===0){var winID=up.settings.custom_settings.uploadButtonId.replace(/_okbutton/,'');if(up.settings.custom_settings.extensionDataUpload){if($K.windows['wid_'+up.settings.custom_settings.winID]){$K.windows['wid_'+up.settings.custom_settings.winID].tabs.select(0,Koala.windows['wid_'+up.settings.custom_settings.winID].tabs.params);}}
if(!up.settings.custom_settings.autoUpload&&!up.settings.custom_settings.extensionDataUpload){$K.windows[winID].remove();if($K.windows[winID].stayInBackground){$(winID+'_filetitle').value='';$K.yg_dropdownSelect($(winID+'_filetype'),false,'automatic',true);$(winID+'_filestoupload').update('');}else{delete $K.yg_PLUploadObjects[winID];if($K.yg_PLUploadObjects[winID+'_2']){delete $K.yg_PLUploadObjects[winID+'_2'];}
if($K.yg_PLUploadObjects[winID+'_3']){delete $K.yg_PLUploadObjects[winID+'_3'];}}}
$K.yg_PLUploadProcessQueue();$K.yg_PLUploadQueueProcessing=false;}else{$K.yg_PLUploadGlobalDone+=file.size;if(up.settings.custom_settings.extensionDataUpload){var uploadStatusPanel=$(up.settings.custom_settings.uploadWinId).down('.mk_uploadpanel');}else{var uploadStatusPanel=$('wid_uploadprogress').down('.mk_uploadpanel');}
var currentFile;uploadStatusPanel.select('li').each(function(item){if(item.readAttribute('yg_id').replace(/-file/,'')==file.id){currentFile=item;}});if(currentFile&&currentFile.next()){currentFile.next().addClassName('uploading');}}}
;$K.yg_startGUIUpdateTimer=function(){if($K.yg_guiUpdateTimer){window.clearInterval($K.yg_guiUpdateTimer);}
$K.yg_guiUpdateTimer=window.setInterval(function(){if(Ajax.activeRequestCount==0){var data=Array('noevent',{yg_property:'ping',params:{}});$K.yg_AjaxCallback(data,'ping');}},($K.guiSyncInterval*1000));}
$K.yg_getLastGuiSyncHistoryId=function(){return $K.currentGuiSyncHistoryId;}
$K.yg_lastExecutedGuiJSQueueId=0;$K.yg_executeGuiJSQueue=function(queueData){for(var queueIdx in queueData){if(queueData.hasOwnProperty(queueIdx)){if(parseInt(queueIdx,10)>$K.yg_lastExecutedGuiJSQueueId){new Function(queueData[queueIdx])();$K.yg_lastExecutedGuiJSQueueId=parseInt(queueIdx,10);}}}}
;var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS";},searchString:function(data){for(var i=0;i<data.length;i++){var dataString=data[i].string;var dataProp=data[i].prop;this.versionSearchString=data[i].versionSearch||data[i].identity;if(dataString){if(dataString.indexOf(data[i].subString)!=-1)
return data[i].identity;}
else if(dataProp)
return data[i].identity;}},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(index==-1)return;return parseFloat(dataString.substring(index+this.versionSearchString.length+1));},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};BrowserDetect.init();
;$K.tabs=function(parent,elements,id,wndobj){this.id=id+'tabs';this.elements=elements;this.baseid=id;this.wndobj=wndobj;this.marginright=45;$(parent).appendChild(base=document.createElement('div'));base.className='tabs';base.id=this.id;base.appendChild(tmpdiv=document.createElement('div'));tmpdiv.className='taboverflow';tmpdiv.id=this.id+'taboverflow';tmpdiv.appendChild(tmpdivcont=document.createElement('div'));tmpdivcont.className='tabcontainer';tmpdivcont.id=this.id+'tabcontainer';for(i=0;i<elements.length;i++){tmpdivcont.appendChild(tmpdiv=document.createElement('div'));if(elements[i]["WORKFLOW"]=="1"){tmpdiv.className='tabwf';}else{tmpdiv.className='tab';}
tmpdiv.appendChild(tmpa=document.createElement('a'));if(elements[i]["SELECTED"]=="1")tmpa.className='sel';$(tmpa).observe('click',(function(id,i){$K.windows[id].tabs.select(i);}).bind(tmpa,id,i));tmpa.id=this.id+"tabbt"+i;tmpa.appendChild(tmpnobr=document.createElement('nobr'));tmpnobr.appendChild(document.createTextNode(elements[i]["TITLE"]));this.elements[i]["WIDTH"]=$(tmpa).getWidth();}
base.appendChild(tmpdiv=document.createElement('div'));tmpdiv.className='tabdown';tmpdiv.id=this.id+'tabdown';tmpdiv.style.display='none';tmpdiv.appendChild(tmpa=document.createElement('a'));tmpa.setAttribute('href','javascript:$K.windows["'+id+'"].tabs.showContext();');tmpa.setAttribute('onfocus','this.blur();');base.appendChild(tmpdiv=document.createElement('div'));tmpdiv.className='tableft';tmpdiv.id=this.id+'tableft';tmpdiv.style.display='none';tmpdiv.appendChild(tmpa=document.createElement('a'));tmpa.setAttribute('href','javascript:$K.windows["'+id+'"].tabs.move("left");');tmpa.setAttribute('onfocus','this.blur();');base.appendChild(tmpdiv=document.createElement('div'));tmpdiv.className='tabright';tmpdiv.id=this.id+'tabright';tmpdiv.style.display='none';tmpdiv.appendChild(tmpa=document.createElement('a'));tmpa.setAttribute('onclick','$K.windows["'+id+'"].tabs.move("right");');tmpa.setAttribute('onfocus','this.blur();');base.appendChild(tmpdiv=document.createElement('div'));tmpdiv.className='tabroundleft';tmpdiv.id=this.id+'tabroundleft';base.appendChild(tmpdiv=document.createElement('div'));tmpdiv.className='tabroundright';tmpdiv.id=this.id+'tabroundright';base.appendChild(tmpdiv=document.createElement('div'));tmpdiv.className='tabnavnone';tmpdiv.id=this.id+'tabnavnone';$(parent).appendChild(tmpdiv=document.createElement('div'));tmpdiv.className='tabcontext';tmpdiv.id=this.id+'tabcontext';tmpdiv.onmouseup=function(){this.hide();}
for(var i=0;i<elements.length;i++){tmpdiv.appendChild(tmpa=document.createElement('a'));tmpa.setAttribute('onclick','$K.windows["'+id+'"].tabs.select('+i+');');tmpa.appendChild(document.createTextNode(elements[i]["TITLE"]));}
this.init();selvar=false;for(var i=0;i<this.elements.length;i++){if(this.elements[i]["SELECTED"]=="1"){this.select(i,null,true);selvar=true;}}
if(!selvar){this.select(0,null,true);}
if(elements.length==1){$(base.id).hide();}}
$K.tabs.prototype.init=function(){base=$(this.id);this.tabdown=$(this.id+'tabdown');this.tabright=$(this.id+'tabright');this.tableft=$(this.id+'tableft');this.tabroundright=$(this.id+'tabroundright');this.tabroundleft=$(this.id+'tabroundleft');this.tabnavnone=$(this.id+'tabnavnone');this.taboverflow=$(this.id+'taboverflow');this.tabcontext=$(this.id+'tabcontext');this.tabcontainer=$(this.id+'tabcontainer');this.ywindowouter=$(this.baseid+'_ywindowouter')
this.tabdown.hide();this.tabright.hide();this.tableft.hide();tabdivs=this.tabcontainer.immediateDescendants();numvisibletabs=0;for(var k=0;k<this.elements.length;k++){if(($K.windows[this.baseid])&&($K.windows[this.baseid].folderselected==1)){if((this.elements[k]["FOLDER"]=="0")||(this.elements[k]["TRASHCAN"])){tabdivs[k].setStyle({display:'none'});}else if(this.elements[k]["FOLDER"]=="2"){tabdivs[k].setStyle({display:'block'});numvisibletabs++;}else if(this.elements[k]["FOLDER"]=="1"){numvisibletabs++;}}else if(($K.windows[this.baseid])&&($K.windows[this.baseid].trashcanselected==1)){numvisibletabs=1;}else{if((this.elements[k]["FOLDER"]=="0")&&(!(this.elements[k]["TRASHCAN"]))){tabdivs[k].setStyle({display:'block'});numvisibletabs++;}else if((this.elements[k]["FOLDER"]=="2")||(this.elements[k]["TRASHCAN"])){tabdivs[k].setStyle({display:'none'});}else if((this.elements[k]["FOLDER"]=="1")&&(!(this.elements[k]["TRASHCAN"]))){numvisibletabs++;}}}
if(numvisibletabs<2){$(this.baseid).addClassName("hidetabs");}else if($K.windows[this.baseid]){$(this.baseid).removeClassName("hidetabs");}
rightpos=0;basewidth=this.wndobj.boxwidth;tabroundleftwidth=15;tabroundrightwidth=15;this.twidth=0;for(i=0;i<this.elements.length;i++){if(tabdivs[i].visible())this.twidth+=this.elements[i]["WIDTH"];}
this.twidth+=2;this.tabcontainer.setStyle({width:this.twidth+'px'});if(this.twidth>basewidth-this.marginright-tabroundleftwidth/2-tabroundrightwidth/2){tableftwidth=21;tabrightwidth=21;tabdownwidth=21;this.tabdown.show();downpos=basewidth-this.marginright-tabdownwidth;rightpos=downpos-tabrightwidth-1;leftpos=tableftwidth+tabroundleftwidth+1;leftroundpos=tableftwidth+1;rightroundpos=rightpos-tabroundrightwidth-1;this.overflowwidth=basewidth-this.marginright-tableftwidth/2-1-tabrightwidth/2-1-tabdownwidth-1-tabroundleftwidth-tabroundrightwidth-tableftwidth;this.tabright.setStyle({left:rightpos+'px'});this.tabdown.setStyle({left:downpos+'px'});this.tabnavnone.setStyle({display:'block'});this.tabnavnone.setStyle({left:'0px'});this.tableft.hide();this.tabright.show();}else{this.tabdown.hide();this.tabright.hide();this.tableft.hide();leftpos=tabroundleftwidth;leftroundpos=0;rightroundpos=this.twidth;this.overflowwidth=this.twidth-tabroundrightwidth;this.tabnavnone.setStyle({display:'none'});}
this.tabcontainer.setStyle({left:-8+'px'});this.tabroundleft.setStyle({left:leftroundpos+'px'});this.tabroundright.setStyle({left:rightroundpos+'px'});this.taboverflow.setStyle({left:leftpos+'px'});if(this.overflowwidth>0)this.taboverflow.setStyle({width:this.overflowwidth+'px'});this.tabcontext.setStyle({display:'none'});this.tabcontext.setStyle({top:'8px'});this.tabcontext.setStyle({left:(rightpos-142)+'px'});}
$K.tabs.prototype.showContext=function(){tabdivs=this.tabcontext.immediateDescendants();for(var k=0;k<this.elements.length;k++){if(($K.windows[this.baseid])&&($K.windows[this.baseid].folderselected==1)){if((this.elements[k]["FOLDER"]=="0")||(this.elements[k]["TRASHCAN"])){tabdivs[k].setStyle({display:'none'});}else if(this.elements[k]["FOLDER"]=="2"){tabdivs[k].setStyle({display:'block'});numvisibletabs++;}else if(this.elements[k]["FOLDER"]=="1"){numvisibletabs++;}}else if(($K.windows[this.baseid])&&($K.windows[this.baseid].trashcanselected==1)){numvisibletabs=1;}else{if((this.elements[k]["FOLDER"]=="0")&&(!(this.elements[k]["TRASHCAN"]))){tabdivs[k].setStyle({display:'block'});numvisibletabs++;}else if((this.elements[k]["FOLDER"]=="2")||(this.elements[k]["TRASHCAN"])){tabdivs[k].setStyle({display:'none'});}else if((this.elements[k]["FOLDER"]=="1")&&(!(this.elements[k]["TRASHCAN"]))){numvisibletabs++;}}}
this.tabcontext.setStyle({display:'block'});$K.bCloser[this.tabcontext.id]=$K.yg_clickCloser.bindAsEventListener(this.tabcontext);Event.observe(document,'click',$K.bCloser[this.tabcontext.id]);}
$K.tabs.prototype.move=function(dir){minpos=-8;maxpos=this.overflowwidth-this.twidth+2;tmpos=this.tabcontainer.positionedOffset();tmpos=tmpos[0];firstpos=false;if(tmpos==minpos){firstpos=0;}else{tmpwid=0;for(i=0;i<this.elements.length;i++){tmpwid+=this.elements[i]["WIDTH"];if((tmpwid*-1)==tmpos)firstpos=i+1;}
if(firstpos==false){tmpwid=0;for(i=(this.elements.length-1);i>-1;i--){tmpwid+=this.elements[i]["WIDTH"];if(tmpwid<this.overflowwidth)firstpos=i;}}}
atend=false;if(dir=="right"){newpos=tmpos-this.elements[firstpos]["WIDTH"];if(newpos<maxpos){newpos=maxpos;atend=true;}
firstpos++;this.tabcontainer.setStyle({left:newpos+'px'});}
if(dir=="left"){newpos=0;firstpos--;if(tmpos==maxpos)firstpos--;for(i=0;i<firstpos;i++){newpos-=this.elements[i]["WIDTH"];}
if(newpos==0)newpos=minpos;this.tabcontainer.setStyle({left:newpos+'px'});}
if(firstpos==0){this.tabnavnone.setStyle({display:'block'});this.tabnavnone.setStyle({left:'0px'});this.tableft.hide();this.tabright.show();}else if(atend==true){tmpos=$(this.id).getWidth()-this.marginright-this.tabdown.getWidth()-1-this.tabright.getWidth();this.tabnavnone.setStyle({display:'block'});this.tabnavnone.setStyle({left:tmpos+'px'});this.tableft.show();this.tabright.hide();}else{this.tabnavnone.setStyle({display:'none'});this.tableft.show();this.tabright.show();}}
$K.tabs.prototype.select=function(elem,params,initload,nolateonchange){var which=this;$K.yg_checkOpenWindows($K.windows[this.baseid].yg_id,$K.windows[this.baseid].yg_type,{onBeforeShow:Prototype.emptyFunction,onSuccess:function(){if(!nolateonchange){$K.yg_fireLateOnChange(false,$(which.baseid));}
var bgPosX=(which.ywindowouter.offsetWidth/2)-16;var bgPosY=(which.ywindowouter.offsetHeight/2)-16;if((bgPosX<=0)||(bgPosY<=0)){bgPosX=262;bgPosY=241;}
var act_timeout=1;window.activity_indicator=window.setTimeout("$('"+which.baseid+"_ywindowinner').addClassName('tab_loading');$('"+which.baseid+"_ywindowinner').setStyle({backgroundPosition:'"+bgPosX+"px "+bgPosY+"px'});",act_timeout);if($(which.id+'tabbt'+elem))$(which.id+'tabbt'+elem).addClassName('sel');bottomdiff=0;topdiff=0;for(i=0;i<which.elements.length;i++){tmpobj=$(which.id+"tabbt"+i);if(i!=elem)tmpobj.removeClassName('sel');if((i!=elem)&&(which.elements[i]["NAME"]!=undefined)){tmpobj=$(which.baseid+"_"+which.elements[i]["NAME"]);if(tmpobj){tmpobj.hide();tmpobj.removeClassName("mk_activetab");if(which.elements[i]["CACHE"]!=1)tmpobj.innerHTML="";}
tmphead=$(which.baseid+"_head_"+which.elements[i]["NAME"]);if(tmphead)tmphead.hide();tmppagedir=$(which.baseid+"_pagedir_"+which.elements[i]["NAME"]);if(tmppagedir)tmppagedir.hide();tmphead=$(which.baseid+"_column2head_"+which.elements[i]["NAME"]);if(tmphead)tmphead.hide();tmpbottom=$(which.baseid+"_bottom_"+which.elements[i]["NAME"]);if((tmpbottom)&&(tmpbottom.visible())){tmpbottom.hide();bottomdiff+=16;}
tmpbottom=$(which.baseid+"_column2bottom_"+which.elements[i]["NAME"]);if((tmpbottom)&&(tmpbottom.visible())){tmpbottom.hide();}
tmpspcbottom=$(which.baseid+"_spcbottom_"+which.elements[i]["NAME"]);if((tmpspcbottom)&&(tmpspcbottom.visible())){tmpspcbottom.hide();}
tmpfilter=$(which.baseid+"_filter_"+which.elements[i]["NAME"]);if((tmpfilter)&&(tmpfilter.visible())){tmpfilter.hide();}
tmpfilter=$(which.baseid+"_column2filter_"+which.elements[i]["NAME"]);if((tmpfilter)&&(tmpfilter.visible())){tmpfilter.hide();}}else if((i==elem)&&(which.elements[i]["NAME"]!=undefined)){tmpfilter=$(which.baseid+"_filter_"+which.elements[i]["NAME"]);if((tmpfilter)&&(tmpfilter.visible())){topdiff=tmpfilter.getHeight();}}}
if(bottomdiff==0)bottomdiff=16+$(which.baseid+"_bottom").getHeight();if((Prototype.Browser.IE)&&(bottomdiff==32))bottomdiff=16;tmphei=which.wndobj.boxheight-which.wndobj.topheight-bottomdiff-topdiff;$(which.baseid+'_container').setStyle({height:tmphei+'px'});$(which.baseid+'_ywindowinner').setStyle({height:tmphei+'px'});if($(which.baseid+'_column2')){$(which.baseid+'_column2innercontentinner').innerHTML="";which.wndobj.init();}else{which.wndobj.refresh("col1");}
if(which.elements[elem]&&which.elements[elem]["NAME"]!=undefined){tmpobj=$(which.baseid+"_"+which.elements[elem]["NAME"]);if(!(tmpobj)){$(which.baseid+"_innercontent").appendChild(tmpobj=$(document.createElement('div')));tmpobj.id=which.baseid+"_"+which.elements[elem]["NAME"];tmpobj.addClassName('tabcontent');if(which.elements[elem]["CLASS"]){tmpobj.addClassName(which.elements[elem]["CLASS"]);}}
tmpobj.show();which.load(tmpobj,elem,params,initload);}}});}
$K.tabs.prototype.load=function(targetdiv,elem,params,initload){var completed=function(){if(!$(this.baseid+"_"+this.elements[elem]["NAME"]))return;tmpheadid=this.baseid+"_head_"+this.elements[elem]["NAME"];tmphead=$(this.baseid+"_"+this.elements[elem]["NAME"]).down('.ywindowhead');if(tmphead){if((this.elements[elem]["LOADED"]!=true)||((this.elements[elem]["CACHE"]=="0")&&(this.elements[elem]["LOADED"]==true))){if($(tmpheadid))$(tmpheadid).remove();$(this.baseid+"_headers").appendChild(tmphead);tmphead.id=tmpheadid;}else{tmphead.remove();}}
if($(tmpheadid))$(tmpheadid).show();$K.yg_customAttributeHandler(tmphead);tmppagedirid=this.baseid+"_pagedir_"+this.elements[elem]["NAME"];tmppagedir=false;if($(this.baseid+"_"+this.elements[elem]["NAME"]))tmppagedir=$(this.baseid+"_"+this.elements[elem]["NAME"]).down('.ywindowpagedir');if(tmppagedir){if(this.elements[elem]["LOADED"]!=true){if($(tmppagedirid))$(tmppagedirid).remove();$(this.baseid+"_pagedirs").appendChild(tmppagedir);tmppagedir.id=tmppagedirid;}else{tmppagedir.remove();}}
if($(tmppagedirid)){$(tmppagedirid).show();$(this.baseid+"_"+this.elements[elem]["NAME"]).setStyle({paddingBottom:($(tmppagedirid).getHeight()-2)+'px'});}
$K.yg_customAttributeHandler(tmppagedir);if((this.wndobj.lockedByUser)&&(this.wndobj.locking)){this.wndobj.locked=true;$(this.wndobj.id).addClassName('mk_lock');$(this.wndobj.id+'_lock').writeAttribute('yg_id',this.wndobj.lockedByUser+'-user');$(this.wndobj.id+'_lock').onmouseover=function(){$K.yg_hoverUserHint(this);}
$(this.wndobj.id+'_lock').onmouseout=function(){$K.yg_hideUserHint();}
$(this.wndobj.id+'_lock').onclick=function(){$K.yg_hideUserHint();$K.yg_openUserInfo(this.readAttribute('yg_id').split('-')[0],this);}}else if(this.wndobj.locking){this.wndobj.locked=false;$(this.wndobj.id).removeClassName('mk_lock');}
tmpheadid=this.baseid+"_column2head_"+this.elements[elem]["NAME"];tmphead=$(this.baseid+"_"+this.elements[elem]["NAME"]).down('.ywindowheadcolumn2');if(tmphead!=undefined){if(this.elements[elem]["LOADED"]!=true){if($(tmpheadid))$(tmpheadid).remove();$(this.baseid+"_column2headers").appendChild(tmphead);tmphead.id=tmpheadid;}else{tmphead.remove();}}
if($(tmpheadid))$(tmpheadid).show();$K.yg_customAttributeHandler(tmphead);$K.windows[this.baseid].submit=this.elements[elem].submit;tmpbuttondiv=$(this.baseid+"_"+this.elements[elem]["NAME"]).down('.ywindowbuttons');if(tmpbuttondiv){curbuttons=$(this.baseid+"_buttons").immediateDescendants();for(var i=0;i<curbuttons.length;i++){if((i>1)&&(i!=(curbuttons.length-1))){curbuttons[i].remove();}}
tmpbuttons=tmpbuttondiv.down('tr').immediateDescendants();tmpbuttons.each(function(button){curbuttons[curbuttons.length-1].insert({'before':button});});tmpbuttondiv.remove();}
tmpbottomid=this.baseid+"_bottom_"+this.elements[elem]["NAME"];tmpbottom=$(this.baseid+"_"+this.elements[elem]["NAME"]).down('.ywindowbottom');if(tmpbottom!=undefined){if(!(tmpbottom.descendantOf(this.baseid+"_bottom"))&&!$(this.baseid).hasClassName('mk_noexec')){if($(tmpbottomid))$(tmpbottomid).remove();$(this.baseid+"_bottom").appendChild(tmpbottom);tmpbottom.id=tmpbottomid;}else{tmpbottom.remove();}}
if($(tmpbottomid))$(tmpbottomid).show();$K.yg_customAttributeHandler(tmpbottom);tmpbottomid=this.baseid+"_column2bottom_"+this.elements[elem]["NAME"];tmpbottom=$(this.baseid+"_"+this.elements[elem]["NAME"]).down('.ywindowbottomcolumn2');if(tmpbottom!=undefined){if(!(tmpbottom.descendantOf(this.baseid+"_column2bottom"))){if($(tmpbottomid))$(tmpbottomid).remove();$(this.baseid+"_column2bottom").appendChild(tmpbottom);tmpbottom.id=tmpbottomid;}else{tmpbottom.remove();}}
if($(tmpbottomid))$(tmpbottomid).show();$K.yg_customAttributeHandler(tmpbottom);tmpspcbottomid=this.baseid+"_spcbottom_"+this.elements[elem]["NAME"];tmpspcbottom=$(this.baseid+"_"+this.elements[elem]["NAME"]).down('.ywindowspecialbottom');if(tmpspcbottom!=undefined){if(!(tmpspcbottom.descendantOf(this.baseid+"_spcbottom"))){if($(tmpspcbottomid))$(tmpspcbottomid).remove();$(this.baseid+"_spcbottom").appendChild(tmpspcbottom);tmpspcbottom.id=tmpspcbottomid;}else{tmpspcbottom.remove();}
tmpspcbottom.show();}
if($(tmpspcbottomid))$(tmpspcbottomid).show();$K.yg_customAttributeHandler(tmpspcbottom);tmpfilterid=this.baseid+"_filter_"+this.elements[elem]["NAME"];tmpfilter=$(this.baseid+"_"+this.elements[elem]["NAME"]).down('.ywindowfilter');if(tmpfilter!=undefined){if(!(tmpfilter.descendantOf(this.baseid+"_filter"))){if($(tmpfilterid))$(tmpfilterid).remove();$(this.baseid+"_filter").appendChild(tmpfilter);tmpfilter.id=tmpfilterid;}}
if($(tmpfilterid))$(tmpfilterid).show();$K.yg_customAttributeHandler(tmpfilter);tmpfilterid=this.baseid+"_column2filter_"+this.elements[elem]["NAME"];tmpfilter=$(this.baseid+"_"+this.elements[elem]["NAME"]).down('.ywindowfiltercolumn2');if(tmpfilter!=undefined){if(!(tmpfilter.descendantOf(this.baseid+"_filtercolumn2"))){if($(tmpfilterid))$(tmpfilterid).remove();$(this.baseid+"_column2filter").appendChild(tmpfilter);tmpfilter.id=tmpfilterid;}}
if($(tmpfilterid))$(tmpfilterid).show();$K.yg_customAttributeHandler(tmpfilter);if(this.wndobj!=undefined){this.wndobj.tab=this.elements[elem]["NAME"];this.wndobj.init(this.wndobj.boxwidth,this.wndobj.boxheight,false,true);targetdiv.setStyle({visibility:''});}
$K.yg_customAttributeHandler($(this.baseid+"_"+this.elements[elem]["NAME"]));$K.yg_cleanLookupTable();if(window.activity_indicator){if(typeof(window.activity_indicator)=='number'){window.clearTimeout(window.activity_indicator);}
window.activity_indicator=undefined;}
$(this.baseid+"_ywindowinner").removeClassName('tab_loading');this.selected=elem;this.elements[elem]["LOADED"]=true;if(params&&(parseInt(params.refresh)==1)&&(typeof this.elements[elem].refresh=='function')){this.elements[elem].refresh();}else if(typeof this.elements[elem].init=='function'){this.elements[elem].init();}}
if((this.elements[elem]["LOADED"]!=true)||((this.elements[elem]["CACHE"]=="0")&&(this.elements[elem]["LOADED"]==true))){targetdiv.setStyle({visibility:'hidden'});winno=this.wndobj.num;var ygid='';var ygtype='';var wid='';if((this.wndobj)&&(this.wndobj.loadparams)){loadparams=this.wndobj.loadparams;}else{loadparams=new Array();}
if(this.wndobj!=undefined){if(!loadparams["yg_id"])ygid=this.wndobj.yg_id;if(!loadparams["yg_type"]){ygtype=this.wndobj.yg_type;}
wid=this.wndobj.id;}
if(ygid==undefined)ygid='';window.xxx_time=new Date();if(this.elements[elem]["LOADED"]==true){refreshvar=1;}else{refreshvar=0}
var parameters={win_no:winno,yg_id:ygid,yg_type:ygtype,wid:wid,refresh:refreshvar,initload:initload,us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()};if((this.wndobj)&&(this.wndobj.loadparams)){Object.extend(parameters,this.wndobj.loadparams);}
this.yg_id=ygid;$K.tab_loading=ygid;if(params!=undefined){Object.extend(parameters,params);}
new Ajax.Updater(targetdiv.id,$K.appdir+"tab_"+this.elements[elem]["NAME"],{asynchronous:true,evalScripts:true,method:'post',parameters:parameters,onComplete:(function(){window.setTimeout(completed.bind(this),10);}).bind(this),onSuccess:function(transport,wid){if(Ajax.currentRequests[wid+'_TAB_CONTENT'].transport.aborted)return;},onlyLatestOfClass:wid+'_TAB_CONTENT'});}else{(completed.bind(this))();}
if(this.wndobj.verticalsplit){if(!wid){wid=this.wndobj.id;}
$(this.baseid+"_column2innercontentinner").addClassName('tab_loading');var completed2=function(){$K.yg_customAttributeHandler($(wid+"_column2innercontentinner"));$K.yg_cleanLookupTable();$(this.baseid+"_column2innercontentinner").removeClassName('tab_loading');if(typeof this.elements[elem].initcontentright=='function')this.elements[elem].initcontentright();this.wndobj.refresh("col2");}
new Ajax.Updater($(wid+"_column2innercontentinner"),$K.appdir+"tab_"+this.elements[elem]["CONTENTRIGHT"],{asynchronous:true,evalScripts:true,method:'post',parameters:parameters,onComplete:completed2.bind(this),onSuccess:function(transport,wid){if(Ajax.currentRequests[wid+'_TAB_CONTENTRIGHT'].transport.aborted)return;},onlyLatestOfClass:wid+'_TAB_CONTENTRIGHT'});}}
;$K.yg_scrollObjs={};$K.yg_scrollObjAttr={};$K.yg_scrollObjAttr.speed=100;$K.yg_scrollObjAttr.slideDur=500;$K.yg_scrollObjAttr.activeArea=null;$K.yg_scrollObjAttr.sliding=false;$K.yg_scrollObjAttr.scrollBtnVWidth=9;$K.yg_scrollObjAttr.scrollBtnVHeight=13;$K.yg_scrollObjAttr.scrollBtnHWidth=13;$K.yg_scrollObjAttr.scrollBtnHHeight=9;$K.yg_scrollObj=function(boxId,wnId,lyrId,cntId,blankcorner,frameReference){this._=new Object;if(frameReference&&(frameReference.tagName=='IFRAME')){this._=frameReference;}else{this._.$=$;}
this.blank=blankcorner;this.id=boxId;this.boxid=boxId;this.wnid=wnId;$K.yg_scrollObjs[this.id]=this;this.animString="$K.yg_scrollObjs['"+this.id+"']";this.load(lyrId,cntId,blankcorner);if(cntId){$(cntId).onclick=function(){$K.yg_scrollObjAttr.activeArea=this.id;}.bind(this);}
$K.yg_scrollObjAttr.activeArea=this.id;};$K.yg_scroll_loadLayer=function(wnId,id,cntId){if($K.yg_scrollObjs[wnId])
$K.yg_scrollObjs[wnId].load(id,cntId);};$K.yg_scrollObj.prototype.load=function(lyrId,cntId){var wndo,lyr;if(this.lyrId){lyr=$(this.lyrId);lyr.style.visibility="hidden";}
lyr=$(lyrId);wndo=$(this.wnid);lyr.style.top=this.y=0;lyr.style.left=this.x=0;this.maxY=(lyr.offsetHeight-wndo.offsetHeight>0)?lyr.offsetHeight-wndo.offsetHeight:0;this.wd=cntId?$(cntId).offsetWidth:lyr.offsetWidth;this.maxX=(this.wd-wndo.offsetWidth>0)?(this.wd-wndo.offsetWidth):0;this.lyrId=lyrId;lyr.style.visibility="visible";this.on_load();this.ready=true;};$K.yg_scrollObj.prototype.on_load=function(){};$K.yg_scrollObj.prototype.shiftTo=function(lyr,x,y){if(!lyr.style)
return;lyr.style.left=(this.x=x)+"px";if($K.windows[this.boxid]){$K.windows[this.boxid].scrollh(x);}else{tmpid=this.boxid.split('_');tmpid=tmpid[0]+"_"+tmpid[1];if($K.windows[tmpid]){$K.windows[tmpid].scrollh(x,"col2");}}
focusfield=$K.yg_getActiveElement();if((focusfield)&&(focusfield!=undefined)){focusfield=focusfield.up(2);if((focusfield)&&(focusfield.id!=this.id)&&(focusfield.hasClassName('dropdownbox'))&&($(focusfield.id+"_ddlist"))){focusfield.insert($(focusfield.id+"_ddlist"));$(focusfield.id+"_ddlist").hide();}}
lyr.style.top=(this.y=y)+"px";};yg_scroll_GeckoTableBugFix=function(){var ua=navigator.userAgent;if(ua.indexOf("Gecko")>-1&&ua.indexOf("Firefox")==-1&&ua.indexOf("Safari")==-1&&ua.indexOf("Konqueror")==-1){$K.yg_scrollObj.hold=[];for(var i=0;arguments[i];i++){if($K.yg_scrollObjs[arguments[i]]){var wndo=$(arguments[i]);var holderId=wndo.parentNode.id;var holder=$(holderId);document.body.appendChild(holder.removeChild(wndo));wndo.style.zIndex=1000;var pos=$K.yg_scroll_getPageOffsets(holder);wndo.style.left=pos.x+"px";wndo.style.top=pos.y+"px";$K.yg_scrollObj.hold[i]=[arguments[i],holderId];}}
window.addEventListener("resize",$K.yg_scroll_rePositionGecko,true);}};$K.yg_scroll_rePositionGecko=function(){if($K.yg_scrollObj.hold){for(var i=0;$K.yg_scrollObj.hold[i];i++){var wndo=$($K.yg_scrollObj.hold[i][0]);var holder=$($K.yg_scrollObj.hold[i][1]);var pos=$K.yg_scroll_getPageOffsets(holder);wndo.style.left=pos.x+"px";wndo.style.top=pos.y+"px";}}};$K.yg_scroll_getPageOffsets=function(el){var left=el.offsetLeft;var top=el.offsetTop;if(el.offsetParent&&el.offsetParent.clientLeft||el.offsetParent.clientTop){left+=el.offsetParent.clientLeft;top+=el.offsetParent.clientTop;}
while(el=el.offsetParent){left+=el.offsetLeft;top+=el.offsetTop;}
return{x:left,y:top};};$K.yg_scroll_stopScroll=function(wnId){if($K.yg_scrollObjs[wnId])$K.yg_scrollObjs[wnId].endScroll();}
$K.yg_scroll_doubleSpeed=function(wnId){if($K.yg_scrollObjs[wnId])$K.yg_scrollObjs[wnId].speed*=2;}
$K.yg_scroll_resetSpeed=function(wnId){if($K.yg_scrollObjs[wnId])$K.yg_scrollObjs[wnId].speed/=2;}
$K.yg_scroll_initScroll=function(wnId,deg,sp){if($K.yg_scrollObjs[wnId]){var cosine,sine;if(typeof deg=="string"){switch(deg){case"up":deg=90;break;case"down":deg=270;break;case"left":deg=180;break;case"right":deg=0;break;default:$K.log("Direction of scroll in mouseover scroll links should be 'up', 'down', 'left', 'right' or number: 0 to 360.",$K.Log.WARN);}}
deg=deg%360;if(deg%90==0){cosine=(deg==0)?-1:(deg==180)?1:0;sine=(deg==90)?1:(deg==270)?-1:0;}else{var angle=deg*Math.PI/180;cosine=-Math.cos(angle);sine=Math.sin(angle);}
$K.yg_scrollObjs[wnId].fx=cosine/(Math.abs(cosine)+Math.abs(sine));$K.yg_scrollObjs[wnId].fy=sine/(Math.abs(cosine)+Math.abs(sine));$K.yg_scrollObjs[wnId].endX=(deg==90||deg==270)?$K.yg_scrollObjs[wnId].x:(deg<90||deg>270)?-$K.yg_scrollObjs[wnId].maxX:0;$K.yg_scrollObjs[wnId].endY=(deg==0||deg==180)?$K.yg_scrollObjs[wnId].y:(deg<180)?0:-$K.yg_scrollObjs[wnId].maxY;$K.yg_scrollObjs[wnId].startScroll(sp);}}
$K.yg_scroll_hoverScroll=function(wnId,deg,sp){if($K.yg_activeDragInfo.dragging)
$K.yg_scroll_initScroll(wnId,deg,sp);}
$K.yg_scroll_stopHoverScroll=function(wnId){if($K.yg_activeDragInfo.dragging)
$K.yg_scroll_stopScroll(wnId);}
$K.yg_scrollObj.prototype.startScroll=function(speed){if(!this.ready)return;if(this.timerId)clearInterval(this.timerId);this.speed=speed||$K.yg_scrollObjAttr.speed;this.lyr=$(this.lyrId);this.lastTime=(new Date()).getTime();this.on_scroll_start();this.timerId=setInterval(this.animString+".scroll();",10);}
$K.yg_scrollObj.prototype.scroll=function(){var now=(new Date()).getTime();var d=(now-this.lastTime)/1000*this.speed;if(d>0){var x=this.x+this.fx*d;var y=this.y+this.fy*d;if(this.fx==0||this.fy==0){if((this.fx==-1&&x>-this.maxX)||(this.fx==1&&x<0)||(this.fy==-1&&y>-this.maxY)||(this.fy==1&&y<0)){this.lastTime=now;this.shiftTo(this.lyr,x,y);this.on_scroll(x,y);}else{clearInterval(this.timerId);this.timerId=0;this.shiftTo(this.lyr,this.endX,this.endY);this.on_scroll_end(this.endX,this.endY);}}else{if((this.fx<0&&x>=-this.maxX&&this.fy<0&&y>=-this.maxY)||(this.fx>0&&x<=0&&this.fy>0&&y<=0)||(this.fx<0&&x>=-this.maxX&&this.fy>0&&y<=0)||(this.fx>0&&x<=0&&this.fy<0&&y>=-this.maxY)){this.lastTime=now;this.shiftTo(this.lyr,x,y);this.on_scroll(x,y);}else{clearInterval(this.timerId);this.timerId=0;this.on_scroll_end(this.x,this.y);}}}}
$K.yg_scrollObj.prototype.endScroll=function(){if(!this.ready)return;if(this.timerId)clearInterval(this.timerId);this.timerId=0;this.lyr=null;}
$K.yg_scrollObj.prototype.on_scroll=function(){}
$K.yg_scrollObj.prototype.on_scroll_start=function(){}
$K.yg_scrollObj.prototype.on_scroll_end=function(){}
$K.yg_scroll_scrollBy=function(wnId,x,y,dur){if($K.yg_scrollObjs[wnId]){if($K.yg_scrollObjs[wnId].hbar){if((x!=0)&&($K.yg_scrollObjs[wnId].hbar.getStyle("visibility")=="hidden"))x=0;}else{x=0;}
$K.yg_scrollObjs[wnId].glideBy(x,y,dur);}}
$K.yg_scroll_scrollTo=function(wnId,x,y,dur){if($K.yg_scrollObjs[wnId])$K.yg_scrollObjs[wnId].glideTo(x,y,dur);}
$K.yg_scrollObj.prototype.glideBy=function(dx,dy,dur){if(this.sliding)return;this.slideDur=dur||$K.yg_scrollObjAttr.slideDur;this.destX=this.destY=this.distX=this.distY=0;this.lyr=$(this.lyrId);this.startX=this.x;this.startY=this.y;if(dy<0)this.distY=(this.startY+dy>=-this.maxY)?dy:-(this.startY+this.maxY);else if(dy>0)this.distY=(this.startY+dy<=0)?dy:-this.startY;if(dx<0)this.distX=(this.startX+dx>=-this.maxX)?dx:-(this.startX+this.maxX);else if(dx>0)this.distX=(this.startX+dx<=0)?dx:-this.startX;this.destX=this.startX+this.distX;this.destY=this.startY+this.distY;this.slideTo(this.destX,this.destY);}
$K.yg_scrollObj.prototype.glideTo=function(destX,destY,dur){if(this.sliding)return;this.slideDur=dur||$K.yg_scrollObjAttr.slideDur;this.lyr=$(this.lyrId);this.startX=this.x;this.startY=this.y;this.destX=-Math.max(Math.min(destX,this.maxX),0);this.destY=-Math.max(Math.min(destY,this.maxY),0);this.distY=this.destY-this.startY;this.distX=this.destX-this.startX;this.slideTo(this.destX,this.destY);}
$K.yg_scrollObj.prototype.slideTo=function(destX,destY){this.per=Math.PI/(2*this.slideDur);this.sliding=true;$K.yg_scrollObjAttr.sliding=true;this.slideStart=(new Date()).getTime();this.aniTimer=setInterval(this.animString+'.doSlide();',10);this.on_slide_start(this.startX,this.startY);}
$K.yg_scrollObj.prototype.doSlide=function(){var elapsed=(new Date()).getTime()-this.slideStart;if(elapsed<this.slideDur){var x=this.startX+this.distX*Math.sin(this.per*elapsed);var y=this.startY+this.distY*Math.sin(this.per*elapsed);this.shiftTo(this.lyr,x,y);this.on_slide(x,y);}else{clearInterval(this.aniTimer);this.sliding=false;$K.yg_scrollObjAttr.sliding=false;this.shiftTo(this.lyr,this.destX,this.destY);this.lyr=null;this.on_slide_end(this.destX,this.destY);}}
$K.yg_scrollObj.prototype.on_slide_start=function(){}
$K.yg_scrollObj.prototype.on_slide=function(){}
$K.yg_scrollObj.prototype.on_slide_end=function(){}
$K.yg_slidebar={obj:null,slideDur:500,init:function(bar,track,axis,x,y){x=x||0;y=y||0;bar.style.left=x+"px";bar.style.top=y+"px";bar.axis=axis;track.bar=bar;bar.alignment=axis;if(axis=="h"){bar.trkWd=track.offsetWidth;bar.maxX=bar.trkWd-bar.offsetWidth-x;bar.minX=x;bar.maxY=y;bar.minY=y;}else{bar.trkHt=track.offsetHeight;bar.maxY=bar.trkHt-bar.offsetHeight-y;bar.maxX=x;bar.minX=x;bar.minY=y;}
bar.on_drag_start=bar.on_drag=bar.on_drag_end=bar.on_slide_start=bar.on_slide=bar.on_slide_end=function(){}
bar.onmousedown=this.startDrag;track.onmousedown=this.startSlide;bar.observe("click",function(e){Event.stop(e);});},startSlide:function(e){if($K.yg_slidebar.aniTimer)clearInterval($K.yg_slidebar.aniTimer);e=e?e:window.event;var bar=$K.yg_slidebar.obj=this.bar;e.offX=(typeof e.layerX!="undefined")?e.layerX:e.offsetX;e.offY=(typeof e.layerY!="undefined")?e.layerY:e.offsetY;bar.startX=parseInt(bar.style.left);bar.startY=parseInt(bar.style.top);if(bar.axis=="v"){bar.destX=bar.startX;bar.destY=(e.offY<bar.startY)?e.offY:e.offY-bar.offsetHeight;bar.destY=Math.min(Math.max(bar.destY,bar.minY),bar.maxY);}else{bar.destX=(e.offX<bar.startX)?e.offX:e.offX-bar.offsetWidth;bar.destX=Math.min(Math.max(bar.destX,bar.minX),bar.maxX);bar.destY=bar.startY;}
bar.distX=bar.destX-bar.startX;bar.distY=bar.destY-bar.startY;$K.yg_slidebar.per=Math.PI/(2*$K.yg_slidebar.slideDur);$K.yg_slidebar.slideStart=(new Date()).getTime();bar.on_slide_start(bar.startX,bar.startY);$K.yg_slidebar.aniTimer=setInterval("$K.yg_slidebar.doSlide()",10);},doSlide:function(){if(!$K.yg_slidebar.obj){clearInterval($K.yg_slidebar.aniTimer);return;}
var bar=$K.yg_slidebar.obj;var elapsed=(new Date()).getTime()-this.slideStart;if(elapsed<this.slideDur){var x=bar.startX+bar.distX*Math.sin(this.per*elapsed);var y=bar.startY+bar.distY*Math.sin(this.per*elapsed);bar.style.left=x+"px";bar.style.top=y+"px";bar.on_slide(x,y);}else{clearInterval(this.aniTimer);bar.style.left=bar.destX+"px";bar.style.top=bar.destY+"px";bar.on_slide_end(bar.destX,bar.destY);this.obj=null;}},startDrag:function(e){document.body.addClassName('drag');$K.yg_activeDragInfo.dragging=true;if(e&&e.preventDefault)
e.preventDefault();e=$K.yg_event.DOMit(e);if($K.yg_slidebar.aniTimer)clearInterval($K.yg_slidebar.aniTimer);var bar=$K.yg_slidebar.obj=this;bar.downX=e.clientX;bar.downY=e.clientY;bar.startX=parseInt(bar.style.left);bar.startY=parseInt(bar.style.top);bar.on_drag_start(bar.startX,bar.startY);$K.yg_event.add(document,"mousemove",$K.yg_slidebar.doDrag,true);$K.yg_event.add(document,"mouseup",$K.yg_slidebar.endDrag,true);e.stopPropagation();if(this.id)$K.yg_clickindropdown[this.id.substring(0,(this.id.length-10))]=true;},doDrag:function(e){e=e?e:window.event;if(!$K.yg_slidebar.obj)return;var bar=$K.yg_slidebar.obj;var nx=bar.startX+e.clientX-bar.downX;var ny=bar.startY+e.clientY-bar.downY;nx=Math.min(Math.max(bar.minX,nx),bar.maxX);ny=Math.min(Math.max(bar.minY,ny),bar.maxY);bar.style.left=nx+"px";bar.style.top=ny+"px";if((bar.id.indexOf('dropdownbox')!=-1)||(bar.id.indexOf('sortlist')!=-1)){bar.style.top=(ny-1)+"px";}
bar.on_drag(nx,ny);return false;},endDrag:function(){$K.yg_event.remove(document,"mousemove",$K.yg_slidebar.doDrag,true);$K.yg_event.remove(document,"mouseup",$K.yg_slidebar.endDrag,true);if(!$K.yg_slidebar.obj)return;$K.yg_slidebar.obj.on_drag_end(parseInt($K.yg_slidebar.obj.style.left),parseInt($K.yg_slidebar.obj.style.top));$K.yg_slidebar.obj=null;if(this.id)$K.yg_clickindropdown[this.id.substring(0,(this.id.length-10))]=false;document.body.removeClassName('drag');$K.yg_activeDragInfo.dragging=false;}}
$K.yg_scrollObj.prototype.bSizeDragBar=true;$K.yg_scrollObj.prototype.setUpScrollbar=function(id,trkId,axis,offx,offy,boxid){var bar=$(id);var trk=$(trkId);$K.yg_slidebar.init(bar,trk,axis,offx,offy);bar.wn=$K.yg_scrollObjs[this.id];if(axis=="v")this.vBarId=id;else this.hBarId=id;bar.on_drag_start=bar.on_slide_start=$K.yg_scroll_getWndoLyrRef;bar.on_drag_end=bar.on_slide_end=$K.yg_scroll_tossWndoLyrRef;bar.on_drag=bar.on_slide=yg_scroll_UpdateWndoLyrPos;$(id).onclick=function(){$K.yg_scrollObjAttr.activeArea=this;}.bind(boxid);$(trkId).onclick=function(){$K.yg_scrollObjAttr.activeArea=this;}.bind(boxid);this._.$(this.id+'_scrollup').onclick=function(){$K.yg_scrollObjAttr.activeArea=this;}.bind(boxid);this._.$(this.id+'_scrolldown').onclick=function(){$K.yg_scrollObjAttr.activeArea=this;}.bind(boxid);this._.$(this.id+'_scrollleft').onclick=function(){$K.yg_scrollObjAttr.activeArea=this;}.bind(boxid);this._.$(this.id+'_scrollright').onclick=function(){$K.yg_scrollObjAttr.activeArea=this;}.bind(boxid);}
$K.yg_scroll_getWndoLyrRef=function(){this.wnLyr=$(this.wn.lyrId);}
$K.yg_scroll_tossWndoLyrRef=function(){this.wnLyr=null;}
var yg_scroll_UpdateWndoLyrPos=function(x,y){var nx,ny;if(this.axis=="v"){nx=this.wn.x;ny=-(y-this.minY)*(this.wn.maxY/(this.maxY-this.minY))||0;}else{ny=this.wn.y;nx=-(x-this.minX)*(this.wn.maxX/(this.maxX-this.minX))||0;}
this.wn.shiftTo(this.wnLyr,nx,ny);}
$K.yg_scrollObj.prototype.updateScrollbar=function(x,y){var nx,ny;if(this.vBarId){if(!this.vbar)this.vbar=this.vBarId
if(this.maxY){ny=-(y*((this.vbar.maxY-this.vbar.minY)/this.maxY)-this.vbar.minY);ny=Math.min(Math.max(ny,this.vbar.minY),this.vbar.maxY);nx=parseInt(this.vbar.style.left);this.vbar.style.left=nx+"px";this.vbar.style.top=ny+"px";if((this.vbar.id.indexOf('dropdownbox')!=-1)||(this.vbar.id.indexOf('sortlist')!=-1)){this.vbar.style.top=(ny-1)+"px";}}}
if(this.hBarId){if(!this.hbar)this.hbar=this.hBarId
if(this.maxX){nx=-(x*((this.hbar.maxX-this.hbar.minX)/this.maxX)-this.hbar.minX);nx=Math.min(Math.max(nx,this.hbar.minX),this.hbar.maxX);ny=parseInt(this.hbar.style.top);this.hbar.style.left=nx+"px";this.hbar.style.top=ny+"px";}}}
$K.yg_scrollObj.prototype.restoreScrollbars=function(){var bar;if(this.vBarId){bar=$(this.vBarId);bar.style.left=bar.minX+"px";bar.style.top=bar.minY+"px";}
if(this.hBarId){bar=$(this.hBarId);bar.style.left=bar.minX+"px";bar.style.top=bar.minY+"px";}}
$K.yg_scrollObj.prototype.fixBar=function(){if((this.vBarId)&&(Prototype.Browser.IE)){$(this.vBarId).style.position='relative';$(this.vBarId).style.position='absolute';$(this.id+'_scrolldown').style.position='relative';$(this.id+'_scrolldown').style.position='absolute';}}
$K.yg_scrollObj.prototype.setBarSize=function(firstrun){var bar;var lyr=$(this.lyrId);var wn=$(this.wnid);var addMaxY=0;var addMaxX=0;var hShown=false;var vShown=false;if(!wn)return;if((firstrun==true)&&(Prototype.Browser.WebKit)){lyrwidth=$(this.lyrId).rightWidth;}else{lyrwidth=$(this.lyrId).offsetWidth;}
if((wn.clientWidth-lyrwidth)<0){var offsetX=lyr.offsetLeft;var gapX=(wn.clientWidth-lyrwidth-offsetX);if(gapX>0){var lyrOffsetLeft=lyr.offsetLeft;lyr.style.left=(lyrOffsetLeft+gapX)+'px';if($K.windows[this.boxid])$K.windows[this.boxid].scrollh(lyrOffsetLeft+gapX);this.x=(lyrOffsetLeft+gapX);this.updateScrollbar(this.x,this.y);}}
if((wn.clientHeight-lyr.clientHeight)<0){var offsetY=lyr.offsetTop;var gapY=(wn.clientHeight-lyr.clientHeight-offsetY);if(gapY>0){var lyrOffsetTop=lyr.offsetTop;lyr.style.top=(lyrOffsetTop+gapY)+'px';this.y=(lyrOffsetTop+gapY);this.updateScrollbar(this.x,this.y);}}
this.maxY=(lyr.offsetHeight-wn.offsetHeight>0)?(lyr.offsetHeight-wn.offsetHeight):0;this.maxX=(lyrwidth-wn.offsetWidth>0)?(lyrwidth-wn.offsetWidth):0;twoscroll=false;if(this.hBarId){bar=$(this.hBarId);bar.trkWd=wn.offsetWidth-($K.yg_scrollObjAttr.scrollBtnHWidth*2);bar.minX=bar.maxY=bar.minY=1;if((!isNaN(lyrwidth/wn.offsetWidth))&&((bar.trkWd/(lyrwidth/wn.offsetWidth))!=0)&&(bar.trkWd>0)){if(lyrwidth>wn.offsetWidth){bar.style.width=((bar.trkWd/(lyrwidth/wn.offsetWidth))+'px');}else{bar.style.width=(bar.trkWd-2*bar.minX+'px');}}
if(Prototype.Browser.IE){addMaxX=0;}
bar.maxX=bar.trkWd-bar.offsetWidth-bar.minX+addMaxX;if(this.vBarId){bar.maxX-=8;}
this.fixBar();if(!(lyrwidth>wn.offsetWidth)){if(this._.$(this.id+'_scrollbar_h'))this._.$(this.id+'_scrollbar_h').style.visibility='hidden';hShown=false;bar.style.left='0px';lyr.style.left='0px';if($K.windows[this.boxid]&&(typeof($K.windows[this.boxid].scrollh)=='function'))$K.windows[this.boxid].scrollh(0);this.x=0;if(this.vBarId){if(this._.$(this.id+'_scrollbar_v'))this._.$(this.id+'_scrollbar_v').style.bottom='0px';}}else{twoscroll=true;this._.$(this.id+'_scrollbar_h').style.visibility='visible';hShown=true;if(this.vBarId){this._.$(this.id+'_scrollbar_v').style.bottom='';}}}
if(this.vBarId){bar=$(this.vBarId);if(Prototype.Browser.WebKit){this._.$(this.id+'_track_v').style.height=(wn.offsetHeight-$K.yg_scrollObjAttr.scrollBtnVHeight)+'px';}
bar.trkHt=wn.offsetHeight-($K.yg_scrollObjAttr.scrollBtnVHeight*2);bar.maxX=bar.minX=bar.minY=1;if(!isNaN(lyr.offsetHeight/wn.offsetHeight)){if(lyr.offsetHeight>wn.offsetHeight){if((bar.trkHt/(lyr.offsetHeight/wn.offsetHeight))>0)bar.style.height=(bar.trkHt/(lyr.offsetHeight/wn.offsetHeight))+'px';}else{bar.style.height=(bar.trkHt-2*bar.minY+'px');}}
if(Prototype.Browser.IE){addMaxY=-4;}else{addMaxY=-5;}
bar.maxY=bar.trkHt-bar.offsetHeight-bar.minY+addMaxY;if(!(lyr.offsetHeight>wn.offsetHeight)){if(this._.$(this.id+'_scrollbar_v'))this._.$(this.id+'_scrollbar_v').style.visibility='hidden';vShown=false;bar.style.top='0px';lyr.style.top='0px';this.y=0;if(this.hBarId){if(this._.$(this.hBarId))this._.$(this.hBarId).maxX+=$K.yg_scrollObjAttr.scrollBtnHWidth;if(this._.$(this.id+'_scrollright'))this._.$(this.id+'_scrollright').style.right='0px';if(this._.$(this.id+'_track_h'))this._.$(this.id+'_track_h').style.right=$K.yg_scrollObjAttr.scrollBtnHWidth+'px';if(this.blank!=0)this.blank.style.display='none';}}else{this.maxX+=$K.yg_scrollObjAttr.scrollBtnVWidth;this._.$(this.id+'_scrollbar_v').style.visibility='visible';if(twoscroll)this.maxY+=$K.yg_scrollObjAttr.scrollBtnHHeight;vShown=true;if(this.hBarId){this._.$(this.id+'_scrollright').style.right='';this._.$(this.id+'_track_h').style.right='';if(twoscroll==true){if(this.blank!=0)this.blank.style.display='block';if(Prototype.Browser.WebKit){bar.maxY+=-1;}}else{if(this.blank!=0)this.blank.style.display='none';bar.maxY+=$K.yg_scrollObjAttr.scrollBtnVHeight-3;if(bar.id.indexOf('dropdownbox')!=-1){if(Prototype.Browser.Gecko||Prototype.Browser.IE)
bar.maxY-=6;else
bar.maxY-=5;}
if(bar.id.indexOf('sortlist')!=-1){if(Prototype.Browser.Gecko||Prototype.Browser.IE)
bar.maxY-=3;else
bar.maxY-=2;}
if(Prototype.Browser.WebKit){bar.maxY+=-1;}else if(Prototype.Browser.IE){bar.maxY+=-1;}}}}}
if(hShown&&!vShown){$(this.hBarId).maxX+=-$K.yg_scrollObjAttr.scrollBtnVWidth+5;}}
$K.yg_scrollObj.prototype.on_load=function(){this.restoreScrollbars();}
$K.yg_scrollObj.prototype.on_scroll=$K.yg_scrollObj.prototype.on_slide=function(x,y){this.updateScrollbar(x,y);}
$K.yg_scrollObj.prototype.on_scroll_start=$K.yg_scrollObj.prototype.on_slide_start=function(){if(this.vBarId)this.vbar=$(this.vBarId);if(this.hBarId)this.hbar=$(this.hBarId);}
$K.yg_scrollObj.prototype.on_scroll_end=$K.yg_scrollObj.prototype.on_slide_end=function(x,y){this.updateScrollbar(x,y);this.lyr=null;this.bar=null;}
$K.yg_renderScroll=function(obj,id,iframe){var obj_ref;var scrollcnt='';var parentDIV=obj.parentNode;var vScrollDIV=$(document.createElement('div'));vScrollDIV.id=id+'_scrollbar_v';vScrollDIV.className='scrollbar_v mceNonEditable';vScrollDIV.setStyle('display','none');vScrollDIV.onselectstart=function(){return false;};vScrollDIV.onmousedown=function(){return false;};vScrollDIV.onmouseup=function(){return false;};vScrollDIV.onclick=function(){return false;};vScrollDIV.contentEditable=false;obj_ref='';scrollcnt+="<div id=\""+id+"_scrollup\" class=\"scroll_up mceNonEditable\">";scrollcnt+="  <a onclick=\"Event.stop(event);\" onfocus=\"this.blur();\" onmousedown=\""+obj_ref+"$K.yg_scroll_initScroll('"+id+"','up');\" onmouseup=\""+obj_ref+"$K.yg_scroll_stopScroll('"+id+"');\" onmouseover=\""+obj_ref+"$K.yg_scroll_hoverScroll('"+id+"','up');\" onmouseout=\""+obj_ref+"$K.yg_scroll_stopHoverScroll('"+id+"');\"><img src=\""+$K.imgdir+"window/x.gif\" width=\"9\" height=\"13\" alt=\"\" border=\"0\" /></a>";scrollcnt+="</div>";scrollcnt+="<div id=\""+id+"_track_v\" class=\"track_v mceNonEditable\" onselectstart=\"return false;\" onclick=\"Event.stop(event);\" onmousedown=\"Event.stop(event);\">";scrollcnt+="  <div id=\""+id+"_dragbar_v\" class=\"dragbar_v mceNonEditable\"></div>";scrollcnt+="</div>";scrollcnt+="<div id=\""+id+"_scrolldown\" class=\"scroll_down mceNonEditable\" onselectstart=\"return false;\" onmousedown=\"return false;\" onmouseup=\"return false;\">";scrollcnt+="  <a onclick=\"Event.stop(event);\" onfocus=\"this.blur();\" onmousedown=\""+obj_ref+"$K.yg_scroll_initScroll('"+id+"','down')\" onmouseup=\""+obj_ref+"$K.yg_scroll_stopScroll('"+id+"');\" onmouseover=\""+obj_ref+"$K.yg_scroll_hoverScroll('"+id+"','down');\" onmouseout=\""+obj_ref+"$K.yg_scroll_stopHoverScroll('"+id+"');\"><img src=\""+$K.imgdir+"window/x.gif\" width=\"9\" height=\"13\" alt=\"\" border=\"0\" /></a>";scrollcnt+="</div>";vScrollDIV.innerHTML=scrollcnt;parentDIV.replaceChild(vScrollDIV,obj);var scrollcnt='';var hScrollDIV=$(document.createElement('div'));hScrollDIV.id=id+'_scrollbar_h';hScrollDIV.className='scrollbar_h mceNonEditable';vScrollDIV.setStyle('display','none');hScrollDIV.onselectstart=function(){return false;};hScrollDIV.onmousedown=function(){return false;};hScrollDIV.onmouseup=function(){return false;};hScrollDIV.contentEditable=false;scrollcnt+="<div id=\""+id+"_scrollleft\" class=\"scroll_left mceNonEditable\">";scrollcnt+="  <a onfocus=\"this.blur();\" onclick=\"return false\" onmousedown=\""+obj_ref+"$K.yg_scroll_initScroll('"+id+"','left')\" onmouseup=\""+obj_ref+"$K.yg_scroll_stopScroll('"+id+"');\" onmouseover=\""+obj_ref+"$K.yg_scroll_hoverScroll('"+id+"','left');\" onmouseout=\""+obj_ref+"$K.yg_scroll_stopHoverScroll('"+id+"');\"><img src=\""+$K.imgdir+"window/x.gif\" width=\"13\" height=\"9\" alt=\"\" border=\"0\" /></a>";scrollcnt+="</div>";scrollcnt+="<div id=\""+id+"_track_h\" class=\"track_h mceNonEditable\" onselectstart=\"return false;\" onmousedown=\"return false;\">";scrollcnt+="  <div id=\""+id+"_dragbar_h\" class=\"dragbar_h mceNonEditable\"></div>";scrollcnt+="</div>";scrollcnt+="<div id=\""+id+"_scrollright\" class=\"scroll_right mceNonEditable\" onselectstart=\"return false;\" onmousedown=\"return false;\">";scrollcnt+="  <a onclick=\"return false;\" onfocus=\"this.blur();\" onmousedown=\""+obj_ref+"$K.yg_scroll_initScroll('"+id+"','right')\" onmouseup=\""+obj_ref+"$K.yg_scroll_stopScroll('"+id+"');\" onmouseover=\""+obj_ref+"$K.yg_scroll_hoverScroll('"+id+"','right');\" onmouseout=\""+obj_ref+"$K.yg_scroll_stopHoverScroll('"+id+"');\"><img src=\""+$K.imgdir+"window/x.gif\" width=\"13\" height=\"9\" alt=\"\" border=\"0\" /></a>";scrollcnt+="</div>";hScrollDIV.innerHTML=scrollcnt;parentDIV.appendChild(hScrollDIV);}
$K.yg_initScrollbars=function(box,outer,inner,dragbarv,trackv,dragbarh,trackh,blank,frameReference){sobj=new $K.yg_scrollObj(box.id,outer,inner,inner,blank,frameReference);sobj.setUpScrollbar(dragbarv,trackv,"v",1,1,box.id);sobj.setUpScrollbar(dragbarh,trackh,"h",1,1,box.id);$K.yg_scrollObjAttr.speed=200;sobj.setBarSize();return sobj;}
$K.yg_mouseWheelHandle=function(delta,axis){if((delta<0)&&($K.yg_scrollObjAttr.activeArea!=null)){if(axis==1){$K.yg_scroll_scrollBy($K.yg_scrollObjAttr.activeArea,-30,0,1);}else{$K.yg_scroll_scrollBy($K.yg_scrollObjAttr.activeArea,0,-30,1);}}else if($K.yg_scrollObjAttr.activeArea!=null){if(axis==1){$K.yg_scroll_scrollBy($K.yg_scrollObjAttr.activeArea,+30,0,1);}else{$K.yg_scroll_scrollBy($K.yg_scrollObjAttr.activeArea,0,+30,1);}}}
$K.yg_wheel=function(event){var delta=0;if(!event)
event=window.event;if(event.wheelDelta){delta=event.wheelDelta/120;if(window.opera)delta=-delta;}else if(event.detail){delta=-event.detail/3;}
if(delta)$K.yg_mouseWheelHandle(delta,event.axis);if(event.preventDefault)event.preventDefault();event.returnValue=false;}
if(window.addEventListener){window.addEventListener('DOMMouseScroll',$K.yg_wheel,false);}
window.onmousewheel=document.onmousewheel=$K.yg_wheel;
;$K.yg_idlookuptable=new Object();$K.yg_calendars=new Object();$K.yg_SWFUploadObjects={};$K.yg_PLUploadObjects={};$K.yg_guiUpdateTimer=null;Ajax.Responders.register({onCreate:function(){if((Ajax.activeRequestCount==1)&&($('bottomline')))$('bottomline').addClassName('loadingsmall');},onInteractive:function(){$K.yg_startGUIUpdateTimer();Ajax.activeRequestCount--;if((Ajax.activeRequestCount<=0)&&($('bottomline'))){Ajax.activeRequestCount=0;$('bottomline').removeClassName('loadingsmall');}}});Ajax.Responders.register({onInteractive:function(response){var yeagerHeader=(response.getHeader('X-Yeager-Authenticated')||'');if(yeagerHeader=='false'){response.abort();$K.yg_loginbox();}}});$K._onDOMReady=new Array();$K._onLoad=new Array();$K.addOnDOMReady=function(autorun_func){$K._onDOMReady.push(autorun_func);};$K.addOnLoad=function(autorun_func){$K._onDOMReady.push(function(){window.setTimeout(function(){autorun_func()},0);});};Event.observe(document,'dom:loaded',function(event){$K.log('-> $K.onDOMReady()',$K.Log.DEBUG);$K._onDOMReady.each(function(item){if(typeof item=='function')
item(event);});delete $K._onDOMReady;});Event.observe(window,'load',function(event){$K.log('-> $K.onLoad()',$K.Log.DEBUG);$K._onLoad.each(function(item){if(typeof item=='function')
item(event);});delete $K._onLoad;});$K.yg_getAttributes=function(element){var nodeInfo=new Object();for(i=0;i<element.attributes.length;i++){var nn=element.attributes[i].nodeName;var nv=element.attributes[i].nodeValue;if((nn=='id')||(nn=='name')||(nn=='value')||(nn=='yg_type')||(nn=='yg_id')||(nn=='yg_property')){nodeInfo[nn]=nv;}}
if(element.value)nodeInfo['value']=$F(element);return nodeInfo;}
$K.yg_AjaxCallback=function(element,callback,no_auth,onlyLatestOfClass,onSuccess){var options={asynchronous:true,evalScripts:true,method:'post',requestHeaders:{'X-Yeager-Authentication':((no_auth)?('suppress'):('allow'))},parameters:{handler:$K.yg_trim(callback),us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId(),data:Object.toJSON(element)}};if(onlyLatestOfClass){options.onlyLatestOfClass=onlyLatestOfClass;}
if(onSuccess&&(typeof onSuccess=='function')){options.onSuccess=onSuccess;}
new Ajax.Updater('php_response',$K.appdir+'responder',options);}
$K.yg_trim=function(inputString){if(typeof inputString!='string'){return inputString;}
var retValue=inputString;var ch=retValue.substring(0,1);while(ch==' '){retValue=retValue.substring(1,retValue.length);ch=retValue.substring(0,1);}
ch=retValue.substring(retValue.length-1,retValue.length);while(ch==' '){retValue=retValue.substring(0,retValue.length-1);ch=retValue.substring(retValue.length-1,retValue.length);}
while(retValue.indexOf('  ')!=-1){retValue=retValue.substring(0,retValue.indexOf("  "))+retValue.substring(retValue.indexOf("  ")+1,retValue.length);}
return retValue;}
$K.yg_updatePreviewUrls=function(winID,url){type=$K.windows[winID].yg_type;if(type=="page"){page=$K.windows[winID].yg_id.split('-')[0];site=$K.windows[winID].yg_id.split('-')[1];if((url=="")||!url||(url.indexOf('//')>-1))url=$K.appdir+site+"/"+page+"/";var btn=$(winID+'_buttons').down('a.preview');if(btn){btn.stopObserving('click');btn.observe('click',function(ev){Event.stop(ev);$K.yg_preview({objecttype:'page',id:page,site:site,version:'live',url:url});});btn.href=url+"?version=live&nocache=true";}
var btn=$(winID+'_buttons').down('a.previewcurrent');if(btn){btn.stopObserving('click');btn.observe('click',function(ev){Event.stop(ev);$K.yg_preview({objecttype:'page',id:page,site:site,version:'working',url:url});});btn.href=url+"?version=working&nocache=true";}}
if(type=="file"){var btn=$(winID+'_buttons').down('a.download');btn.href=url;}}
$K.yg_filesize=function(fileSize){var unit='';fileSize=parseInt(fileSize);if(fileSize>=1000000000){fileSize=fileSize/(1024*1024*1024);unit='GB';}else if(fileSize>=1000000){fileSize=fileSize/(1024*1024);unit='MB';}else if(fileSize>=1000){fileSize=fileSize/1024;unit='KB';}
if((fileSize>=100)||(unit=='KB')){fileSize=Math.round(fileSize);}else if(unit!=''){fileSize=fileSize.toFixed(1).replace(/\./,',');}
if(unit==''){unit='Bytes';}
return(fileSize+' '+unit);}
$K.yg_toggleCollapseH=function(yg_object){yg_object=$(yg_object);if(yg_object.$K.yg_collapsed){yg_object.$K.yg_collapsed=false;yg_object.setStyle({width:yg_object.yg_oldwidth+'px',overflow:yg_object.yg_oldoverflow});$K.yg_event='uncollapse';}else{yg_object.$K.yg_collapsed=true;yg_object.yg_oldwidth=yg_object.clientWidth;yg_object.yg_oldoverflow=yg_object.getStyle('overflow');yg_object.setStyle({overflow:'hidden',width:$K.yg_panel_handle_width+'px'});$K.yg_event='collapse';}
if(yg_object.callback){if(yg_object.callback['collapse']){var data=Array($K.yg_event,$K.yg_getAttributes(yg_object));$K.yg_AjaxCallback(data,yg_object.callback[$K.yg_event]);}
if(yg_object.callback['uncollapse']){var data=Array($K.yg_event,$K.yg_getAttributes(yg_object));$K.yg_AjaxCallback(data,yg_object.callback[$K.yg_event]);}}}
$K.yg_event={add:function(obj,etype,fp,cap){cap=cap||false;if(obj.addEventListener)obj.addEventListener(etype,fp,cap);else if(obj.attachEvent)obj.attachEvent("on"+etype,fp);},remove:function(obj,etype,fp,cap){cap=cap||false;if(obj.removeEventListener)obj.removeEventListener(etype,fp,cap);else if(obj.detachEvent)obj.detachEvent("on"+etype,fp);},DOMit:function(e){e=e?e:window.event;e.tgt=e.srcElement?e.srcElement:e.target;if(!e.preventDefault)e.preventDefault=function(){return false;}
if(!e.stopPropagation)e.stopPropagation=function(){if(window.event)window.event.cancelBubble=true;}
return e;}}
$K.yg_toggleCollapseV=function(yg_object,yg_self_object){yg_self_object=$(yg_self_object);yg_object=$(yg_object);if(yg_object.$K.yg_collapsed){yg_object.$K.yg_collapsed=false;if(yg_self_object)
yg_self_object.setStyle({top:yg_self_object.yg_styletop});yg_object.setStyle({height:yg_object.yg_oldheight+'px',overflow:yg_object.yg_oldoverflow});$K.yg_event='uncollapse';}else{with(yg_object){$K.yg_collapsed=true;yg_oldheight=clientHeight;yg_oldoverflow=getStyle('overflow');setStyle({overflow:'hidden',height:$K.yg_panel_handle_width+'px'});}
if(yg_self_object){with(yg_self_object){yg_styletop=getStyle('top');setStyle({top:'0px'});}}
$K.yg_event='collapse';}
if(yg_object.callback){if(yg_object.callback['collapse']){var data=Array($K.yg_event,$K.yg_getAttributes(yg_object));$K.yg_AjaxCallback(data,yg_object.callback[$K.yg_event]);}
if(yg_object.callback['uncollapse']){var data=Array($K.yg_event,$K.yg_getAttributes(yg_object));$K.yg_AjaxCallback(data,yg_object.callback[$K.yg_event]);}}}
$K.yg_makeTemplate=function(data){return new Template(data.replace(/<</g,'{').replace(/>>/g,'}'));}
$K.yg_setEdited=function(which){which=$(which);which.addClassName('changed');if(which.hasClassName('error'))which.removeClassName('error');}
function yg_generateRandomID(length){if(!length)
var length=10;var chars='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890';var rnd_output='';for(x=0;x<length;x++){i=Math.floor(Math.random()*62);rnd_output+=chars.charAt(i);}
return rnd_output;}
$K.yg_pause=function(milliseconds){var now=new Date();var exitTime=now.getTime()+milliseconds;while(true){now=new Date();if(now.getTime()>exitTime)return;}}
$K.yg_bindWindows=function(){tmparrx=$('maincontainer').childElements();tmparrwins=new Array();for(var k=0;k<tmparrx.length;k++){if(tmparrx[k].getStyle('display')!='none')tmparrwins.push(tmparrx[k]);}
if(tmparrwins.length>1){$K.windows[tmparrwins[0].id].boundWindow=tmparrwins[1].id;$K.windows[tmparrwins[1].id].boundWindow=tmparrwins[0].id;}}
var yg_updateTagTreeScrolls=yg_updateTemplateTreeScrolls=yg_updateContentblockTreeScrolls=yg_updatePagesextraTreeScrolls=yg_updateEntrymaskTreeScrolls=function(which){$K.windows[$(which).up('.ywindow').id].init();}
$K.yg_fireAction=function(actionFunc,obj,e){obj=$(obj);var isKeyboardEvent=false;if(e==46){isKeyboardEvent=true;}else{if(e)Event.stop(e);}
if(obj.up('.ywindow').down('.wdgt_tree')){if(isKeyboardEvent){var winRef=$K.windows[obj.up('.ywindow').id];var winId=winRef.id.replace(/wid_/g,'');var treeId=winRef.yg_type+'s_tree'+winId+'_tree';if(nlsTree[treeId]&&nlsTree[treeId].selElm&&obj.up(2).reference){obj.up(2).reference=nlsTree[treeId].selElm;}}
if(obj.up('.ywindow').hasClassName('mk_multiselect')){actionFunc(obj,true);}else{actionFunc(obj);}}else{$K.actionhover=false;var multiaction=false;var focusobjs=$K.yg_getFocusObj(obj.up('.mk_contentgroup'));if(focusobjs.length>1){for(var k=0;k<focusobjs.length;k++){if((focusobjs[k].up(0)==obj)||(focusobjs[k].up(1)==obj)||(focusobjs[k]==obj)||(focusobjs[k].down(0)==obj)){multiaction=true;}}
if(multiaction==true){if(focusobjs[0].up('li')&&(!obj.up('.mk_thumbcontainer'))){tmparr=focusobjs.clone();tmparr.each(function(item){actionFunc(item.up('li'));});}else if(obj.hasClassName('mk_comment')||((obj.readAttribute('yg_type')=='mailing')||(obj.hasClassName('tree_btn_mailings')))||(obj.id.startsWith('users_'))||(obj.hasClassName('mk_file'))||(obj.hasClassName('mk_autopublish'))||(obj.hasClassName('mk_trashitem'))||(obj.hasClassName('mk_cblock')&&(obj.tagName=='TR'))){actionFunc(obj,true);}else{tmparr=focusobjs.clone();tmparr.each(function(item){actionFunc(item.up(0));});}}}
if(multiaction!=true){actionFunc(obj);}}}
$K.yg_actionSubmit=function(which,prefix,e){if(e)Event.stop(e);var wid=parseInt(which.up('.ywindow').id.replace(/wid_/g,''));if(prefix){if(prefix.endsWith('list')){var yg_id=which.up('li').readAttribute('yg_id');$K.windows['wid_'+wid].yg_id=$('wid_'+wid).yg_id=yg_id;}else if(prefix=='block'){$K.yg_blockSelect(which.up('.emcontainer'),undefined);return;}else{refobj=$(prefix+wid+'_actionbutton').reference;$K.windows[which.up('.ywindow').id].yg_id=$K.windows['wid_'+wid].yg_id=nlsTree[prefix+wid+'_tree'].nLst[refobj.id].yg_id;nlsTree[prefix+wid+'_tree'].selectNode(nlsTree[prefix+wid+'_tree'].nLst[refobj.id].id);}}
$K.windows['wid_'+wid].submit();$K.actionhover=false;}
$K.yg_toggleTreeButtons=function(wndid){if(!$(wndid+'_buttons'))return;tmparr=$(wndid+'_buttons').descendants();var focusObjCount=$K.yg_getFocusObj($(wndid)).length;if((focusObjCount==0)&&($(wndid+"_"+$K.windows[wndid].tab.toUpperCase()).down('.wdgt_tree'))){var treeId=$(wndid+"_"+$K.windows[wndid].tab.toUpperCase()).down('.wdgt_tree').id;if(nlsTree[treeId+'_tree']){focusObjCount=nlsTree[treeId+'_tree'].getSelNodes().length;}}
if(focusObjCount==0){tmparr.each(function(item){btn=item.down('.tree_btn');if(btn&&(btn.hasClassName('globalfunc')==false))btn.addClassName('disabled');});}else if(focusObjCount>1){tmparr.each(function(item){btn=item.down('.tree_btn');if(btn&&(btn.hasClassName('globalfunc')==false)){if(btn.hasClassName('multiselect')==false){btn.addClassName('disabled');}else{btn.removeClassName('disabled');}}});}}
$K.yg_getID=function(sourceElement){src_id=false;if((sourceElement.readAttribute('yg_id'))&&(sourceElement.readAttribute('yg_id')!="")){src_id=sourceElement.readAttribute('yg_id');}else{if(sourceElement.up('li')){src_id=sourceElement.up('li').readAttribute('yg_id');}}
return src_id;}
$K.yg_getType=function(sourceElement){src_type=false;if((sourceElement.readAttribute('yg_id'))&&(sourceElement.readAttribute('yg_id')!="")){src_type=sourceElement.readAttribute('yg_type');}else{if(sourceElement.up('li')){src_type=sourceElement.up('li').readAttribute('yg_type');}}
return src_type;}
$K.yg_deleteElement=function(reference,multi){reference=$(reference);if(reference.hasClassName('disabled')){return;}
if(reference.up('.ywindow')){var winID=reference.up('.ywindow').id;var yg_id=$K.windows[winID].yg_id;var wid=parseInt(winID.replace(/wid_/g,''));}
if(reference.up('.dropstackcontainer')){winId=reference.up('.ywindow').id;var focusObjs=$K.yg_getFocusObj(reference.up('.dropstackcontainer'));if(focusObjs.indexOf(reference.down()==-1)){reference.remove();}else{for(var i=0;i<focusObjs.length;i++){focusObjs[i].up('li').remove();}}
$K.windows[winId].refresh();}else if(reference.up('.mk_trashcan')){var focusObjs=$K.yg_getFocusObj(reference.up('.mk_contentgroup'));$K.yg_shredderObject(focusObjs[0]);}else if(reference.up('.wdgt_tree')||(reference.hasClassName('tree_btn')&&$(winID+"_"+$K.windows[winID].tabs.elements[$K.windows[winID].tabs.selected].NAME).down('.wdgt_tree'))){if(reference.up('.pages_tree')||(reference.hasClassName('tree_btn')&&reference.hasClassName('tree_btn_page'))){objtype="page";paramname="page";tree=nlsTree['pages_tree'+wid+'_tree'];objname=$K.TXT('TXT_PAGES');callback="deletePage";}
if(reference.up('.cblocks_tree')||(reference.hasClassName('tree_btn')&&reference.hasClassName('tree_btn_cblock'))){objtype="cblock";paramname="cblock";tree=nlsTree['cblocks_tree'+wid+'_tree'];objname=$K.TXT('TXT_OBJECTS');callback="deleteCBlock";}
if(reference.up('.files_tree')||(reference.hasClassName('tree_btn')&&reference.hasClassName('tree_btn_file'))){paramname="file";tree=nlsTree['files_tree'+wid+'_tree'];objname=$K.TXT('TXT_OBJECTS');callback="deleteFolder";}
if(reference.up('.templates_tree')||(reference.hasClassName('tree_btn')&&reference.hasClassName('tree_btn_templates'))){paramname="template";tree=nlsTree['templates_tree'+wid+'_tree'];objname=$K.TXT('TXT_OBJECTS');callback="deleteTemplate";}
if(reference.up('.tags_tree')||(reference.hasClassName('tree_btn')&&reference.hasClassName('tree_btn_tags'))){paramname="tagID";tree=nlsTree['tags_tree'+wid+'_tree'];objname=$K.TXT('TXT_TAGS');callback="deleteTag";}
if(reference.up('.entrymasks_tree')||(reference.hasClassName('tree_btn')&&reference.hasClassName('tree_btn_entrymasks'))){paramname="objectID";tree=nlsTree['entrymasks_tree'+wid+'_tree'];objname=$K.TXT('TXT_ENTRYMASKS');callback="deleteEntrymask";}
if(reference.hasClassName('tree_btn')){var page=yg_id.split('-')[0];var site=yg_id.split('-')[1];if(multi){var count=tree.getSelNodes().length;title=count+' '+objname;}else{title=tree.getSelNodes()[0].capt;}}else{selNodes=tree.getSelNodes();var inselection=false;var multi=false;for(var i=0;i<selNodes.length;i++){if(reference.id==selNodes[i].id)inselection=true;}
if(inselection&&selNodes.length>1)multi=true;var nodeid=reference.id;var page=tree.nLst[nodeid].yg_id.split('-')[0];var site=tree.nLst[nodeid].yg_id.split('-')[1];if(multi){var count=tree.getSelNodes().length;var title=count+' '+objname;}else{var title=reference.down('a').innerHTML;}}
$K.yg_promptbox($K.TXT('TXT_APPROVE_DELETE_TITLE'),$K.TXT('TXT_APPROVE_DELETE_P1')+title+$K.TXT('TXT_APPROVE_DELETE_P2'),'remove',function(data){if(multi){var selectedNodes=tree.getSelNodes();for(var i=0;i<selectedNodes.length;i++){var mpage=selectedNodes[i].yg_id.split('-')[0];var msite=selectedNodes[i].yg_id.split('-')[1];data={}
data[paramname]=mpage;data['site']=msite;data['wid']=wid;var data=Array('noevent',{yg_property:'deletePage',params:data});$K.yg_AjaxCallback(data,callback);}
$($K.windows["wid_"+wid].id).removeClassName('multiselect');}else{data={}
data[paramname]=page;data['site']=site;data['wid']=wid;var data=Array('noevent',{yg_property:'deletePage',params:data});$K.yg_AjaxCallback(data,callback);}
if($K.windows[$K.windows["wid_"+wid].boundWindow].yg_id==(page+"-"+site)){$($K.windows["wid_"+wid].boundWindow).addClassName('boxghost');$($K.windows["wid_"+wid].boundWindow+'_buttons').removeClassName('mk_folder');$K.windows[$K.windows["wid_"+wid].boundWindow].yg_id=$K.windows["wid_"+wid].yg_id=undefined;$K.windows[$K.windows["wid_"+wid].boundWindow].init();}},function(){$K.log('Cancelled...',$K.Log.INFO);});}else if(reference.hasClassName('mk_cblock')&&(reference.readAttribute('yg_property')=='listitem')){var inselection=false;var focusObjs=$K.yg_getFocusObj(reference.up('.mk_contentgroup'));if(focusObjs.indexOf(reference)>-1)inselection=true;if(inselection){if(focusObjs.length>1){var cblockName=focusObjs.length+' '+$K.TXT('TXT_OBJECTS');}else{var cblockName=focusObjs[0].readAttribute('name');}
var cblockIds=new Array();focusObjs.each(function(cblockItem){cblockIds.push(cblockItem.readAttribute('yg_id').split('-')[0]);});}else{var cblockName=reference.readAttribute('name');var cblockIds=reference.readAttribute('yg_id').split('-')[0];}
$K.yg_promptbox($K.TXT('TXT_APPROVE_DELETE_TITLE'),$K.TXT('TXT_APPROVE_DELETE_P1')+cblockName+$K.TXT('TXT_APPROVE_DELETE_P2'),'standard',function(data){var cblock=reference.readAttribute('yg_id').split('-')[0];var data=Array('noevent',{yg_property:'deleteCBlock',params:{cblock:cblockIds,site:'cblock',multi:multi}});$K.yg_AjaxCallback(data,'deleteCBlock');},function(){$K.log('Cancelled...',$K.Log.INFO);});}else if((reference.hasClassName('cntblockcontainer')&&reference.readAttribute('yg_type')=='mailing')||(reference.hasClassName('tree_btn_mailings'))){var focusobjs=$K.yg_getFocusObj($(reference.up('.ywindow')).id+'_'+$K.windows[$(reference.up('.ywindow')).id].tab.toUpperCase());var mailingName;var mailingIds=new Array();if((focusobjs.indexOf(reference)>-1)||(reference.hasClassName('tree_btn_mailings')&&(focusobjs.length>1)))multi=true;if(multi){mailingName=focusobjs.length+' '+$K.TXT('TXT_OBJECTS');mailingIds=new Array();focusobjs.each(function(mailing){if(!mailing.hasClassName('mk_nodel')){mailingIds.push(mailing.readAttribute('yg_id').split('-')[0]);}});}else{if(!reference.hasClassName('mk_nodel')){if(reference.hasClassName('tree_btn_mailings')){var mailingName=focusobjs[0].down('.objheadline ').innerHTML;var mailingIds=[focusobjs[0].readAttribute('yg_id').split('-')[0]];}else{var mailingName=reference.down('.objheadline ').innerHTML;var mailingIds=[reference.readAttribute('yg_id').split('-')[0]];}}}
$K.yg_promptbox($K.TXT('TXT_APPROVE_DELETE_TITLE'),$K.TXT('TXT_APPROVE_DELETE_P1')+mailingName+$K.TXT('TXT_APPROVE_DELETE_P2'),'standard',function(data){var data=Array('noevent',{yg_property:'deleteMailing',params:{mailingIds:mailingIds}});$K.yg_AjaxCallback(data,'deleteMailing');},function(){$K.log('Cancelled...',$K.Log.INFO);});}else if(reference.hasClassName('mk_view')||(reference.up('li')&&reference.up('li').hasClassName('mk_view'))){if(!reference.hasClassName('mk_nowrite')){if(reference.tagName!='LI')reference=reference.up('li');var view=reference.readAttribute('yg_id').split('-')[0];var fileID=yg_id.split('-')[0];var data=Array('noevent',{yg_property:'deleteFileView',params:{fileID:fileID,viewID:view}});$K.yg_AjaxCallback(data,'deleteFileView');}}else if(reference.hasClassName('mk_tag')){if(!reference.hasClassName('mk_nowrite')){var objectType=$K.windows[reference.up('.ywindow').id].yg_type;var tag=reference.readAttribute('yg_id').split('-')[0];var objectID=yg_id.split('-')[0];var siteID=yg_id.split('-')[1];var data=Array('noevent',{yg_property:'deleteObjectTag',params:{objectID:objectID,objectType:objectType,siteID:siteID,tagId:tag}});$K.yg_AjaxCallback(data,'deleteObjectTag');}}else if(reference.hasClassName('mk_autopublish')){if(!reference.hasClassName('mk_nowrite')){var focusobjs=$K.yg_getFocusObj(reference.up());if(focusobjs.indexOf(reference)==-1){focusobjs=new Array(reference);}
var type=reference.readAttribute('yg_type');switch(type){case"cblock":var action="removeCBlockAutopublishItem";break;case"page":var action="removePageAutopublishItem";break;}
focusobjs.each(function(item){var innercontent=item.up('.innercontent');var item_id=item.id.split("_");item_id=item_id[item_id.length-1];var page=yg_id.split('-')[0];var site=yg_id.split('-')[1];item.remove();$K.windows[winID].refresh(item);if(!item_id.startsWith('dummy')){var data=Array('noevent',{yg_property:action,params:{page:page,site:site,itemID:item_id}});$K.yg_AjaxCallback(data,action);}
$K.yg_removefromFocus(reference);});}}else if(reference.hasClassName('mk_usergroup')){if(reference.hasClassName('mk_nodel'))return;var roleId=reference.readAttribute('yg_id').split('-')[0];if(!yg_id)yg_id=reference.readAttribute('yg_id');if(yg_id.split('-')[1]=='mailing'){if(!reference.hasClassName('mk_nowrite')){var mailingId=yg_id.split('-')[0];var params={mode:'mailings',mailingId:mailingId,roleId:roleId,wid:winID};var data=Array('noevent',{yg_property:'deleteUserGroup',params:params});$K.yg_AjaxCallback(data,'deleteUserGroup');}}else if(yg_id.split('-')[1]=='user'){if(!reference.hasClassName('mk_nowrite')){var userId=yg_id.split('-')[0];var params={mode:'users',userId:userId,roleId:roleId,wid:winID};var data=Array('noevent',{yg_property:'deleteUserGroup',params:params});$K.yg_AjaxCallback(data,'deleteUserGroup');}}else if((yg_id.split('-')[1]=='usergroup')&&(!reference.hasClassName('mk_nodel'))){var data=Array('noevent',{yg_property:'deleteRole',params:{roleID:roleId,wid:winID}});$K.yg_AjaxCallback(data,'deleteRole');$K.yg_removefromFocus(reference);}}else if(reference.hasClassName('mk_site')){var win_id=reference.up('.ywindow').id;var innercontent=reference.up('.innercontent');if(reference.hasClassName('tree_btn')){var siteID=yg_id.split('-')[0];}else{var siteID=reference.readAttribute('yg_id').split('-')[0];}
var sitename=$('sites_'+win_id.replace(/wid_/g,'')+'_'+siteID).down('.title.txt').innerHTML;$K.yg_promptbox($K.TXT('TXT_APPROVE_DELETE_TITLE'),$K.TXT('TXT_APPROVE_DELETE_P1')+sitename+$K.TXT('TXT_APPROVE_DELETE_P2'),'standard',function(data){var data=Array('noevent',{yg_property:'deleteSite',params:{siteID:siteID,wid:win_id}});$K.yg_AjaxCallback(data,'deleteSite');$K.yg_removefromFocus(reference);},function(){$K.log('Cancelled...',$K.Log.INFO);});}else if(reference.hasClassName('mk_user')){var win_id=reference.up('.ywindow').id;if(!reference.hasClassName('mk_nodel')){if(reference.hasClassName('tree_btn')){var userID=yg_id.split('-')[0];var multiselect=false;$K.yg_currentfocusobj.each(function(userItem){if((userItem.id.split('_')[2]==userID)&&($K.yg_currentfocusobj.length>1)){multiselect=true;}});if(multiselect){var usercount=$K.yg_currentfocusobj.length;var username=usercount+' '+$K.TXT('TXT_USERS');}else{var username=$('users_'+win_id.replace(/wid_/g,'')+'_'+userID).down('a.user').innerHTML;}}else{if(multi){var usercount=$K.yg_currentfocusobj.length;var username=usercount+' '+$K.TXT('TXT_USERS');}else{var username=reference.down('a.user').innerHTML;}}
$K.yg_promptbox($K.TXT('TXT_APPROVE_DELETE_TITLE'),$K.TXT('TXT_APPROVE_DELETE_P1')+username+$K.TXT('TXT_APPROVE_DELETE_P2'),'standard',function(data){if(multi){var userIDs=new Array();$K.yg_currentfocusobj.each(function(userItem){if(!userItem.hasClassName('mk_nodel')){userIDs.push(userItem.id.split('_')[2]);}});var data=Array('noevent',{yg_property:'delUser',params:{userID:userIDs,winID:win_id}});$K.yg_AjaxCallback(data,'delUser');}else{if(reference.hasClassName('tree_btn')){var item=reference;var innercontent=reference.up('.innercontent');var userID=yg_id.split('-')[0];var multiselect=false;$K.yg_currentfocusobj.each(function(userItem){if(userItem.id.split('_')[2]==userID){multiselect=true;}});var userIDs=new Array();if(multiselect){$K.yg_currentfocusobj.each(function(userItem){if(!reference.hasClassName('mk_nodel')){userIDs.push(userItem.id.split('_')[2]);}});}else{userIDs.push(userID);}
var data=Array('noevent',{yg_property:'delUser',params:{userID:userIDs,winID:win_id}});$K.yg_AjaxCallback(data,'delUser');}else{var userID=reference.id.split('_')[2];if(!reference.hasClassName('mk_nodel')){var data=Array('noevent',{yg_property:'delUser',params:{userID:userID,winID:win_id}});$K.yg_AjaxCallback(data,'delUser');}}}
$K.yg_removefromFocus(reference);},function(){$K.log('Cancelled...',$K.Log.INFO);});}}else if(reference.hasClassName('mk_file')){var wid=parseInt(reference.up('.ywindow').id.replace(/wid_/g,''));var nodeid=reference.id;var file=nodeid.split('_')[2];var site=nodeid.split('_')[0];if(reference.hasClassName('mk_filepreview')){if(multi){var filecount=$K.yg_currentfocusobj.length;var filename=filecount+' '+$K.TXT('TXT_FILES');}else{var filename=reference.down('.filetitle').innerHTML;}}else{if(multi){var filecount=$K.yg_currentfocusobj.length;var filename=filecount+' '+$K.TXT('TXT_FILES');}else{var filename=reference.down('.filetitle').innerHTML;}}
$K.yg_promptbox($K.TXT('TXT_APPROVE_DELETE_TITLE'),$K.TXT('TXT_APPROVE_DELETE_P1')+filename+$K.TXT('TXT_APPROVE_DELETE_P2'),'standard',function(data){if(multi){var selectedNodes=$K.yg_currentfocusobj;for(var i=0;i<selectedNodes.length;i++){if(selectedNodes[i].hasClassName('mk_file')){var mfile=selectedNodes[i].id.split('_')[2];}else{var mfile=selectedNodes[i].up().id.split('_')[2];}
var data=Array('noevent',{yg_property:'deleteFile',params:{file:mfile,site:site}});$K.yg_AjaxCallback(data,'deleteFile');}
$($K.windows["wid_"+wid].id).removeClassName('multiselect');}else{var data=Array('noevent',{yg_property:'deleteFile',params:{file:file,site:site}});$K.yg_AjaxCallback(data,'deleteFile');}},function(){$K.log('Cancelled...',$K.Log.INFO);});}else if((reference.down(0).hasClassName('mk_cblock_edit'))){var contentblock_lnkid=reference.id.split('_')[4];var page=yg_id.split('-')[0];var site=yg_id.split('-')[1];if(!reference.hasClassName('mk_nodel')){var data=Array('noevent',{yg_property:'removeCBlockEntrymask',params:{contentblockLnkId:contentblock_lnkid,cblock:page,site:site}});$K.yg_AjaxCallback(data,'removeCBlockEntrymask');}}else if((reference.down(0).hasClassName('mk_cblock'))||(reference.down(0).hasClassName('mk_entrymask'))){var contentblock_lnkid=reference.id.split('_')[4];var page=yg_id.split('-')[0];var site=yg_id.split('-')[1];if(!reference.hasClassName('mk_nodel')){$K.log('Trying to delete contentblock with linkid: ',contentblock_lnkid,$K.Log.INFO);var backendAction='removePageContentblock';if(contentblock_lnkid.startsWith('extension-')){backendAction='removeObjectExtension';}
var data=Array('noevent',{yg_property:backendAction,params:{contentblockLnkId:contentblock_lnkid,page:page,site:site}});$K.yg_AjaxCallback(data,backendAction);}}else if(reference.hasClassName('mk_formfield')){var winID=reference.up('.ywindow').id;reference.remove();$K.windows[winID].refresh();}else if(reference.hasClassName('mk_filetype')||reference.up().hasClassName('mk_filetype')){var winID=reference.up('.ywindow').id;var currentTab=$K.windows[winID].tab.toLowerCase();var focusobjs=$K.yg_getFocusObj($(winID+'_'+currentTab.toUpperCase()));if(focusobjs.indexOf(reference.down('.actions').next())>-1){delObjs=focusobjs;}else{delObjs=new Array(reference);}
delObjs.each(function(currItem){if(currItem.up('li').id.indexOf('_NEW_')==-1){var hiddenFields=currItem.up('li').select('input[type=hidden]');var newElement=new Element('input',{type:'hidden',name:winID+'_filetype_del_ids[]',value:hiddenFields[hiddenFields.length-1].value});$(winID+'_filetypes_list').insert({bottom:newElement});}
currItem.up('li').remove();});reference.remove();$K.windows[winID].refresh();}else if(reference.up().hasClassName('mk_fileview')||reference.hasClassName('mk_fileview')){var winID=reference.up('.ywindow').id;var currentTab=$K.windows[winID].tab.toLowerCase();var focusobjs=$K.yg_getFocusObj($(winID+'_'+currentTab.toUpperCase()));if(focusobjs.indexOf(reference.down('.actions').next())>-1){delObjs=focusobjs;}else{delObjs=new Array(reference);}
delObjs.each(function(currItem){if(currItem.id.indexOf('_NEW_')==-1){var hiddenFields=currItem.up('li').select('input[type=hidden]');var newElement=new Element('input',{type:'hidden',name:winID+'_view_del_ids[]',value:hiddenFields[hiddenFields.length-1].value});$(winID+'_views_list').insert({bottom:newElement});}
currItem.up('li').remove();});reference.remove();$K.windows[winID].refresh();}else if(reference.up().hasClassName('mk_property')||reference.hasClassName('mk_property')){var winRef=reference.up('.ywindow');var currentTab=$K.windows[winRef.id].tab.toLowerCase();switch(currentTab){case'config_page-properties':var propertyType='page';break;case'config_cblock-properties':var propertyType='cblock';break;case'config_file-properties':var propertyType='file';break;case'config_user-properties':var propertyType='user';break;}
var winID=reference.up('.ywindow').id;var focusobjs=$K.yg_getFocusObj($(winID+'_'+currentTab.toUpperCase()));if(focusobjs.indexOf(reference.down('.actions').next())>-1){delObjs=focusobjs;}else{delObjs=new Array(reference);}
delObjs.each(function(currItem){if(currItem.id.indexOf('_NEW_')==-1){var newElement=new Element('input',{type:'hidden',name:winID+'_properties_'+propertyType+'_del_tsuffixes[]',value:currItem.select('input.mk_tsuffix')[0].value});$(winID+'_formfields_list').insert({bottom:newElement});}
currItem.up('li').remove();});$K.windows[winID].refresh();}else if(reference.hasClassName('mk_comment')){if(reference.up('div.cntmain')&&!reference.up('div.cntmain').hasClassName('mk_comments_closed')){var winID=reference.up('.ywindow').id;var yg_id=reference.readAttribute('obj_yg_id');var yg_type=reference.readAttribute('obj_yg_type');var selCommentIDs=new Array();var selectedNodes=$K.yg_getFocusObj(reference.up('.ywindow'));var inselection=false;if(selectedNodes.indexOf(reference)>-1)inselection=true;if(inselection){selectedNodes.each(function(item){if(item.up('.mk_comment')){selCommentIDs.push(item.up('.mk_comment').readAttribute('yg_id').split('-')[0]);}else if(item.hasClassName('mk_comment')){selCommentIDs.push(item.readAttribute('yg_id').split('-')[0]);}});}else{selCommentIDs.push(reference.readAttribute('yg_id').split('-')[0]);}
if(selCommentIDs.length>0){if(selCommentIDs.length>1){var innerText=selCommentIDs.length+' '+$K.TXT('TXT_COMMENTS');}else{var innerText='1 '+$K.TXT('TXT_COMMENT');}
$K.yg_promptbox($K.TXT('TXT_APPROVE_DELETE_TITLE'),$K.TXT('TXT_APPROVE_DELETE_P1')+innerText+$K.TXT('TXT_APPROVE_DELETE_P2'),'remove',function(data){var data=Array('noevent',{yg_property:'removeComment',params:{winID:winID,yg_type:yg_type,yg_id:yg_id,commentIDs:selCommentIDs}});$K.yg_AjaxCallback(data,'removeComment');},function(){$K.log('Cancelled...',$K.Log.INFO);});}}}else{$K.log('Unknown Element to delete...',$K.Log.INFO);$K.log(reference,$K.Log.INFO);$K.log(reference.down(0),$K.Log.INFO);$K.log(reference.up(2),$K.Log.INFO);}}
$K.yg_getActiveElement=function(){try{if(!Prototype.Browser.WebKit){if((document.activeElement.tagName=='INPUT')||(document.activeElement.tagName=='TEXTAREA')){return document.activeElement;}}else{var found;var activeElements=$$('input:focus','textarea:focus');activeElements.each(function(item){if(item.hasFocus){found=item;}});return found;}}
catch(ex){}
return;}
$K.yg_fireLateOnChange=function(setEdited,context,noblur){var activeElement=$K.yg_getActiveElement();if(activeElement){if(context&&!activeElement.descendantOf(context)){return;}
if(activeElement&&(typeof activeElement.onchange=='function')){if(activeElement.readAttribute('nolateonchange')=='true'){return;}
$K.log('late firing of onchange...',$K.Log.INFO);var onCh=activeElement.onchange.bind(activeElement);onCh();activeElement.removeClassName('changed');activeElement.setStyle({backgroundColor:''});}
tmpel=activeElement.up(2);if(tmpel.hasClassName('dropdownbox')){if($(tmpel.id+"_ddlist")){tmpel.insert($(tmpel.id+"_ddlist"));$(tmpel.id+"_ddlist").hide();}}
var yg_onCh=activeElement.readAttribute('yg_onchange');if(yg_onCh){var data=Array('change',$K.yg_getAttributes(activeElement));$K.yg_AjaxCallback(data,yg_onCh);}
if(setEdited){$K.yg_setEdited(activeElement);}else if(typeof activeElement.blur=='function'){if(!noblur)activeElement.blur();if(activeElement.onblur){var onBl=activeElement.onblur.bind(activeElement);onBl();}}}}
$K.yg_showHelp=function(which){if(which==false){$('helpdesc').innerHTML='';}else{if(which==""){$K.warn('HELP not found');$('helpdesc').innerHTML='$';}else{$('helpdesc').innerHTML=which}}}
$K.updateDOM=function(which){which=$(which);if(which){which.select('input','select','textarea').each(function(item){switch(item.type){case'select-one':for(var i=0;i<item.options.length;i++){if(i==item.selectedIndex){item.options[item.selectedIndex].writeAttribute('selected','selected');}else{item.options[item.selectedIndex].removeAttribute('selected');}}
break;case'text':item.writeAttribute('value',item.value);break;case'textarea':item.innerHTML=item.value;item.writeAttribute('value',item.value);break;case'checkbox':case'radio':if(item.checked){item.writeAttribute('checked','checked');}else{inputField.removeAttribute('checked');}
break;}});}}
$K.yg_fixCurrentFocusObjects=function(){var workArray=$K.yg_currentfocusobj;var newArray=new Array();workArray.each(function(item){if($(item)&&($(item).descendantOf($('maincontainer').up(1)))){if(!item.parentNode){newArray.push($(item.id));}else if(item){newArray.push(item);}}});$K.yg_currentfocusobj=newArray;}
$K.addOnDOMReady(function(){$K.yg_initWindow();});$K.addOnDOMReady(function(){try{$K.yg_googleDesktop=google.gears.factory.create('beta.desktop');}catch(e){}
document.observe('dragover',function(e){var target=Event.findElement(e);var dropAllowed=false;var pos=Event.pointer(e);$('yg_ddGhost').setStyle({display:'block',left:(pos.x+18)+'px',top:(pos.y+2)+'px'});$('yg_ddGhost').down('img').setStyle({display:'none',width:'0px',height:'0px',overflow:'hidden'});if((target.tagName=='INPUT')&&(target.type=='file')||(target.hasClassName('mk_uploadpanel'))||(target.up('.mk_uploadpanel'))){dropAllowed=true;$('yg_ddGhost').currentTarget=target;}
if(e.dataTransfer&&e.dataTransfer.mozItemCount){var itemCnt=e.dataTransfer.mozItemCount;var itemTxt=itemCnt+' '+$K.TXT('TXT_OBJECTS');if(itemCnt==1){itemTxt=itemCnt+' '+$K.TXT('TXT_OBJECT');}
itemTxt='('+itemTxt+')';}else if($K.yg_googleDesktop){var itemCnt=0;var dragData=$K.yg_googleDesktop.getDragData(e,'application/x-gears-files');if(dragData){itemCnt=dragData.count;}
var itemTxt=itemCnt+' '+$K.TXT('TXT_OBJECTS');if(itemCnt==1){itemTxt=itemCnt+' '+$K.TXT('TXT_OBJECT');}
itemTxt='('+itemTxt+')';if(itemCnt==0){itemTxt=$K.TXT('TXT_UNKNOWN');}}else{var itemTxt=$K.TXT('TXT_UNKNOWN');dropAllowed=false;}
$('yg_ddGhost').down('a.node').update(itemTxt);if(dropAllowed){$K.yg_setDropAllowed(true);}else{$('yg_ddGhost').currentTarget=null;$K.yg_setDropAllowed(false);}
e.preventDefault();Event.stop(e);});document.observe('dragleave',function(e){$('yg_ddGhost').setStyle({display:'none'});$K.yg_setDropAllowed(false);e.preventDefault();Event.stop(e);});document.observe('drop',function(e){$('yg_ddGhost').setStyle({display:'none'});$K.yg_setDropAllowed(false);e.preventDefault();Event.stop(e);});});$K.yg_urlCallback=function(strUrl,node,on_save,type){return strUrl;}
$K.yg_changeCSS=function(classname,element,value,onthefly){var cssRules;var added=false;if(onthefly){maxnum=1;}else{maxnum=document.styleSheets.length;}
for(var S=0;S<maxnum;S++){if(document.styleSheets[S]['rules']){cssRules='rules';}else if(document.styleSheets[S]['cssRules']){cssRules='cssRules';}else{}
for(var R=0;R<document.styleSheets[S][cssRules].length;R++){if(document.styleSheets[S][cssRules][R].selectorText==classname){if(document.styleSheets[S][cssRules][R].style[element]){if(!added){document.styleSheets[S][cssRules][R].style[element]=value;}
added=true;break;}}}}
if(!added){if(document.styleSheets[0].insertRule){document.styleSheets[0].insertRule(classname+' { '+element+': '+value+'; }',document.styleSheets[0][cssRules].length);}else if(document.styleSheets[0].addRule){document.styleSheets[0].addRule(classname,element+': '+value+';');}}}
$K.yg_reloadWin=function(winID,objId){if(winID=='null')winID=null;if(!winID&&objId){for(winItem in $K.windows){if($K.windows[winItem].yg_id==objId){$K.windows[winItem].tabs.elements[$K.windows[winItem].tabs.selected].cache=0;$K.windows[winItem].tabs.select($K.windows[winItem].tabs.selected);}}}else if(winID&&$K.windows[winID]){$K.windows[winID].tabs.elements[$K.windows[winID].tabs.selected].cache=0;$K.windows[winID].tabs.select($K.windows[winID].tabs.selected);}}
$K.yg_isHTML5UploadSupported=function(){var xhr;if(window.XMLHttpRequest){xhr=new XMLHttpRequest();return!!(xhr.sendAsBinary||xhr.upload);}
return false;}
$K.yg_IsNumeric=function(sText){var ValidChars="0123456789";var IsNumber=true;var Char;if(sText){for(i=0;i<sText.length&&IsNumber==true;i++){Char=sText.charAt(i);if(ValidChars.indexOf(Char)==-1){IsNumber=false;}}
return IsNumber;}else{return false;}}
$K.yg_addImageToCache=function(identifier,imagePath){if(!$K.yg_cachedImages){$K.yg_cachedImages=new Object();}
$K.yg_cachedImages[identifier]=new Image();$K.yg_cachedImages[identifier].src=imagePath;}
$K.addOnDOMReady(function(){for(iconKey in $K.icons){$K.yg_addImageToCache(iconKey,$K.imgdir+'icons/'+$K.icons[iconKey]);}});
;if(typeof Koala=="undefined")var Koala=new Object;Koala.mappedKeys={maps:{},amount:0};Koala.mapKeyHelper=function(event){var targetNodeName=event.target.nodeName;if((targetNodeName=='INPUT')||(targetNodeName=='TEXTAREA')){donotstopevent=true;return;}
var kc=(event.which)?(event.which):(event.keyCode);for(keymap in Koala.mappedKeys.maps){var checkMap=Koala.mappedKeys.maps[keymap];if(checkMap.event==event.type){if((kc>=checkMap.kc_start)&&(kc<=checkMap.kc_end)){switch(checkMap.mod){case'ctrl':realmodifier=event.ctrlKey;if(BrowserDetect.OS=="Mac")
realmodifier=event.metaKey;break;case'alt':realmodifier=event.altKey;break;case'shift':realmodifier=event.shiftKey;break;case'ctrl-meta':realmodifier=(event.ctrlKey&&event.metaKey);break;default:realmodifier=true;break;}
if(realmodifier){if(!checkMap.dontstop&&event&&event.preventDefault){event.preventDefault();}
if(!checkMap.dontstop&&event&&event.stopPropagation){event.stopPropagation();}
checkMap.func(kc,event);if(!checkMap.dontstop){Event.stop(event);}}}}}};$K.defaultKeyEvent='keypress';if(((BrowserDetect.OS=='Windows')||(navigator.appVersion.indexOf('Chrome')!=-1))&&(Prototype.Browser.WebKit||Prototype.Browser.IE)){$K.defaultKeyEvent='keydown';}
Event.observe(document,'keypress',Koala.mapKeyHelper);Event.observe(document,'keydown',Koala.mapKeyHelper);Koala.mapKey=function(keyfunction,modifier,keycodestart,keycodeend,donotstopevent,eventToCheck){if(!eventToCheck){eventToCheck=$K.defaultKeyEvent;}
if(!keycodeend)
keycodeend=keycodestart;var mapping={event:eventToCheck,func:keyfunction,mod:modifier,kc_start:keycodestart,kc_end:keycodeend,dontstop:donotstopevent}
Koala.mappedKeys.maps['keymap_'+Koala.mappedKeys.amount]=mapping;Koala.mappedKeys.amount++;return'keymap_'+(Koala.mappedKeys.amount-1);}
Koala.unMapKey=function(handle){$K.log('Koala.mappedKeys',Koala.mappedKeys,$K.Log.DEBUG);if(Koala.mappedKeys.maps[handle]){delete Koala.mappedKeys.maps[handle];Koala.mappedKeys.amount--;}
$K.log('Koala.mappedKeys (2)',Koala.mappedKeys,$K.Log.DEBUG);}
;$K.scrollbars=new Array();$K.windows={};$K.topZIndex=100;$K.wndid=0;$K.windowTopDiff=43;$K.winhorizontalDiff=28;$K.panelwidth=new Array();$K.panelminwidth=980;$K.panelheight=0;$K.maincontwid=0;$K.inherithover=false;$K.temptimer=new Array();$K.yg_templates=new Array();$K.yg_incrementTopZIndex=function(){$K.topZIndex+=4;return $K.topZIndex;}
$K.yg_windowToTop=function(winId){$K.activeWindow=$K.windows[winId];if($K.windows[winId]&&($K.windows[winId].type=="dialog")){if($(winId).style.zIndex!=$K.topZIndex){if($(winId).style.zIndex>=$K.topZIndex){$K.topZindex=$(winId).style.zIndex;}else{$(winId).style.zIndex=$K.yg_incrementTopZIndex();}}}}
$K.yg_wndobj=function(params){this.loadparams=new Object();if(params.config){($K.yg_windowdata[params.config]["WIDTH"])?boxwidth=$K.yg_windowdata[params.config]["WIDTH"]:boxwidth=$K.yg_windowdata["DEFAULT"]["WIDTH"];($K.yg_windowdata[params.config]["HEIGHT"])?boxheight=$K.yg_windowdata[params.config]["HEIGHT"]:boxheight=$K.yg_windowdata["DEFAULT"]["WIDTH"];($K.yg_windowdata[params.config]["MINWIDTH"])?minwidth=$K.yg_windowdata[params.config]["MINWIDTH"]:minwidth=$K.yg_windowdata["DEFAULT"]["MINWIDTH"];($K.yg_windowdata[params.config]["MINHEIGHT"])?minheight=$K.yg_windowdata[params.config]["MINHEIGHT"]:minheight=$K.yg_windowdata["DEFAULT"]["MINHEIGHT"];if(boxheight>(document.viewport.getHeight()-54))boxheight=document.viewport.getHeight()-54;if(minwidth>boxwidth)minwidth=boxwidth;if(minheight>boxheight)minheight=boxheight;i=0;tabs=new Array();for(var element in $K.yg_windowdata[params.config]["TABS"]){tabs[i]=new Array()
tabs[i]["NAME"]=element;if($K.yg_windowdata[params.config]["TABS"][element]["INIT"]){tabs[i].init=function(){initFunc=new Function($K.yg_windowdata[params.config]["TABS"][this.element]["INIT"]).bind({wndobj:this.wndobj,element:this.element});initFunc();}.bind({wndobj:this,element:element});}else{tabs[i].init=false;}
if($K.yg_windowdata[params.config]["TABS"][element]["REFRESH"]){tabs[i].refresh=function(){refreshFunc=new Function($K.yg_windowdata[params.config]["TABS"][this.element]["REFRESH"]).bind({wndobj:this.wndobj,element:this.element});refreshFunc();}.bind({wndobj:this,element:element});}else{tabs[i].refresh=false;}
if($K.yg_windowdata[params.config]["TABS"][element]["SUBMIT"]){tabs[i].submit=function(){submitFunc=new Function($K.yg_windowdata[params.config]["TABS"][this.element]["SUBMIT"]).bind({wndobj:this.wndobj,element:this.element});if(!$(this.wndobj.id).hasClassName('mk_noexec')){submitFunc();}}.bind({wndobj:this,element:element})}else{tabs[i].submit=false}
if($K.yg_windowdata[params.config]["TABS"][element]["CONTENTRIGHT"]){for(var elemright in $K.yg_windowdata[params.config]["TABS"][element]["CONTENTRIGHT"]){tabs[i]["CONTENTRIGHT"]=elemright;if($K.yg_windowdata[params.config]["TABS"][element]["CONTENTRIGHT"][elemright]["INIT"]){tabs[i].initcontentright=function(){initFunc=new Function($K.yg_windowdata[params.config]["TABS"][this.element]["CONTENTRIGHT"][this.elemright]["INIT"]).bind({wndobj:this.wndobj,element:this.element,elemright:this.elemright});initFunc();}.bind({wndobj:this,element:element,elemright:elemright});}else{tabs[i].initcontentright=false;}}}else{tabs[i]["CONTENTRIGHT"]=false}
if($K.yg_windowdata[params.config]["TABS"][element]["CLASS"]){tabs[i]["CLASS"]=$K.yg_windowdata[params.config]["TABS"][element]["CLASS"]}else{tabs[i]["CLASS"]=false}
if($K.yg_windowdata[params.config]["TABS"][element]["CACHE"]){tabs[i]["CACHE"]=$K.yg_windowdata[params.config]["TABS"][element]["CACHE"]}else{tabs[i]["CACHE"]=false}
if($K.yg_windowdata[params.config]["TABS"][element]["TITLE"]){tabs[i]["TITLE"]=$K.yg_windowdata[params.config]["TABS"][element]["TITLE"]}else{tabs[i]["TITLE"]=""}
if($K.yg_windowdata[params.config]["TABS"][element]["FOLDER"]){tabs[i]["FOLDER"]=parseInt($K.yg_windowdata[params.config]["TABS"][element]["FOLDER"])}else{tabs[i]["FOLDER"]=false}
if($K.yg_windowdata[params.config]["TABS"][element]["TRASHCAN"]){tabs[i]["TRASHCAN"]=Boolean($K.yg_windowdata[params.config]["TABS"][element]["TRASHCAN"])}else{tabs[i]["TRASHCAN"]=false}
if($K.yg_windowdata[params.config]["TABS"][element]["WORKFLOW"]){tabs[i]["WORKFLOW"]=$K.yg_windowdata[params.config]["TABS"][element]["WORKFLOW"]}else{tabs[i]["WORKFLOW"]=false}
if($K.yg_windowdata[params.config]["TABS"][element]["SELECTED"]){tabs[i]["SELECTED"]=$K.yg_windowdata[params.config]["TABS"][element]["SELECTED"]}else{tabs[i]["SELECTED"]=false}
i++;}
if($K.yg_windowdata[params.config]["LOADPARAMS"])this.loadparams=$K.yg_windowdata[params.config]["LOADPARAMS"].evalJSON();container=$K.yg_windowdata[params.config]["CONTAINER"];customid=$K.yg_windowdata[params.config]["CUSTOMID"];locking=$K.yg_windowdata[params.config]["LOCKING"];objecttype=$K.yg_windowdata[params.config]["OBJECTTYPE"];type=$K.yg_windowdata[params.config]["TYPE"];windowClass=$K.yg_windowdata[params.config]["CLASS"];windowStyle=$K.yg_windowdata[params.config]["STYLE"];stayInBackground=$K.yg_windowdata[params.config]["STAY_IN_BACKGROUND"];if($K.yg_windowdata[params.config]["VERTICALSPLIT"]){verticalsplit=$K.yg_windowdata[params.config]["VERTICALSPLIT"];}else{verticalsplit=false;}
icon=$K.yg_windowdata[params.config]["ICON"];titleclass=$K.yg_windowdata[params.config]["TITLE_CLASS"];title=$K.yg_windowdata[params.config]["TITLE"];buttons=$K.yg_windowdata[params.config]["BUTTONS"];}
boundWindow=false;yg_id=false;if(params.customid)customid=params.customid;if(params.objecttype)objecttype=params.objecttype;if(params.width)boxwidth=params.width;if(params.height)boxheight=params.height;if(params.minwidth)minwidth=params.minwidth;if(params.minheight)minheight=params.minheight;if(params.tabs){tabs=params.tabs;var me=this;tabs.each(function(item,itemID){if(item.INIT){tabs[itemID].init=function(){initFunc=new Function(item.INIT).bind({wndobj:me,element:element});initFunc();}}else{tabs[itemID].init=false;}
if(item.REFRESH){tabs[itemID].refresh=function(){refreshFunc=new Function(item.REFRESH).bind({wndobj:me,element:element});refreshFunc();}}else{tabs[itemID].refresh=false;}});}
if(params.type)type=params.type;if(params.container)container=params.container;if(params['class'])windowClass=params['class'];if(params.style)windowStyle=params.style;if(params.stayInBackground)stayInBackground=params.stayInBackground;if(params.boundWindow)boundWindow=params.boundwindow;if(params.verticalsplit)verticalsplit=params.verticalsplit;if(params.icon)icon=params.icon;if(params.titleclass)titleclass=params.titleclass;if(params.title)title=params.title;if(params.locking)locking=params.locking;if(params.buttons)buttons=params.buttons;if(params.openerYgId)this.openerYgId=params.openerYgId;if(this.loadparams==undefined)this.loadparams=new Object();if(params.loadparams)Object.extend(this.loadparams,params.loadparams);if((this.loadparams)&&(this.loadparams["yg_id"]))yg_id=this.loadparams["yg_id"];if(customid==undefined){$K.wndid++;var ywindownum=$K.wndid;}else{var ywindownum=customid;}
var ywindowid="wid_"+ywindownum;$K.windows[ywindowid]=this;var windowhtml=$K.yg_templates["window"].evaluate({win_no:ywindownum});if(container==undefined){if(type=="dialog"){container="dialogcontainer";}else{container="maincontainer";}}
$(container).insert({top:windowhtml});if(type=="dialog"){$(ywindowid).addClassName("ydialog");}else{if($(ywindowid+"_closelink")){$(ywindowid+"_closelink").addClassName("disabled");$(ywindowid+"_closelink").onclick=function(){return false;};}}
this.minwidth=minwidth;this.minheight=minheight;if(type=="tree"){this.basetype="tree";type="content";}
if(type!=undefined){this.type=type;}
ywindowobj=$(ywindowid);this.id=ywindowobj.id;this.num=ywindownum;this.locking=Boolean(locking);if(!this.locking){this.locked=false;}
this.stayInBackground=Boolean(stayInBackground);curbuttons=$(ywindowid+"_buttons").immediateDescendants();if(buttons){for(var element in buttons){var tmpbutton=$(document.createElement('td'));buttons[element].obj=$(document.createElement('a'));tmpbutton.appendChild(buttons[element].obj);tmpbutton.addClassName("ywindow_bt");if(buttons[element]["TDCLASS"])tmpbutton.addClassName(buttons[element]["TDCLASS"]);if(buttons[element]["ID"])buttons[element].obj.id=ywindowid+"_"+buttons[element]["ID"];if(buttons[element]["PROPERTY"])buttons[element].obj.writeAttribute("yg_property",buttons[element]["PROPERTY"]);if(buttons[element]["TYPE"])buttons[element].obj.writeAttribute("yg_type",buttons[element]["TYPE"]);if(buttons[element]["ONCLICK"]){buttons[element].obj.tmpOnclick=buttons[element]["ONCLICK"];buttons[element].obj.wndobj=this;buttons[element].obj.onclick=(function(event){this.event=event;if(this.hasClassName('disabled')==false){var tmpFunc=new Function(this.tmpOnclick).bindAsEventListener(this);tmpFunc();}}).bindAsEventListener(buttons[element].obj);}
if(buttons[element]["ONMOUSEOVER"]){buttons[element].obj.tmpOnMouseOver=buttons[element]["ONMOUSEOVER"];buttons[element].obj.wndobj=this;}
if(buttons[element]["HELP"]){buttons[element].obj.helptext=buttons[element]["HELP"];buttons[element].obj.writeAttribute("title",buttons[element]["HELP"]);}
buttons[element].obj.onmouseover=(function(){if(this.hasClassName('disabled')==false){var tmpFunc=new Function(this.tmpOnMouseOver).bindAsEventListener(this);tmpFunc();}
if(this.helptext){$K.yg_showHelp(this.helptext);}}).bindAsEventListener(buttons[element].obj);buttons[element].obj.onmouseout=function(){$K.yg_showHelp(false);}
if(buttons[element]["YG_ONCLICK"])buttons[element].obj.writeAttribute("yg_onclick",buttons[element]["YG_ONCLICK"]);buttons[element].obj.writeAttribute("yg_id","btn-"+ywindownum);buttons[element].obj.className=element.toLowerCase();if(buttons[element]["ACLASS"])buttons[element].obj.className+=" "+(buttons[element]["ACLASS"]);if(buttons[element]["FOLDER"]&&(buttons[element]["FOLDER"]=="1"))buttons[element].obj.addClassName("folder");if(buttons[element].obj.className.indexOf('tree_btn')!=-1){buttons[element].obj.className+=" tree_btn disabled";if(!(buttons[element]["PROPERTY"]))buttons[element].obj.writeAttribute("yg_property","tree_btn");}
curbuttons[curbuttons.length-1].insert({'before':tmpbutton});}}
if(windowClass!=undefined)ywindowobj.addClassName(windowClass);if(windowStyle!=undefined)ywindowobj.writeAttribute('style',windowStyle);if(icon!=undefined){if(typeof(icon)=='object'){$(ywindowid+"_header").addClassName('file');$K.windows[ywindowid].setFileType('<span class="filetype '+icon.color+'" yg_type="file" yg_id="'+icon.objectid+'-file" yg_property="type">'+icon.typecode.toUpperCase()+'</span>');$K.yg_customAttributeHandler($(ywindowid+"_klops"));}else{$(ywindowid+"_header").addClassName(icon);if($(ywindowid+"_klops")&&$(ywindowid+"_klops").down()){$(ywindowid+"_klops").down().addClassName(icon);}}}
if(objecttype){this.yg_type=ywindowobj.yg_type=objecttype;}
if(boundWindow){this.boundWindow=boundWindow;}
if(yg_id){this.yg_id=yg_id;}
if(titleclass)$(ywindowid+"_title").addClassName(titleclass);if(title){this.setCaption(title,objecttype);}
this.tabs=tabs;$K.activeWindow=this;$(ywindowid+"_container").observe('mouseover',function(ev){tmpid=this.id.substring(0,this.id.indexOf("_container"));if(($K.windows[tmpid])&&($K.windows[tmpid].fullsearch==true)){$K.yg_scrollObjAttr.activeArea=tmpid+"_searchcontent";}else{if($K.yg_preactive==false)$K.yg_scrollObjAttr.activeArea=tmpid;}});if($(ywindowid+"_column2content")){$(ywindowid+"_column2content").observe('mouseover',function(ev){$K.yg_scrollObjAttr.activeArea=this.id;});}
if(verticalsplit==false){if($(this.id+"_vertcut"))$(this.id+"_vertcut").remove();if($(this.id+"_vertcutbot"))$(this.id+"_vertcutbot").remove();if($(this.id+"_vertcuttop"))$(this.id+"_vertcuttop").remove();if($(this.id+"_column2"))$(this.id+"_column2").remove();if($(this.id+"_column2bot"))$(this.id+"_column2bot").remove();if($(this.id+"_column2top"))$(this.id+"_column2top").remove();}
this.verticalsplit=verticalsplit;if(type=="tree"){$K.yg_renderScroll($(this.id+"_searchscroll"),this.id+"_searchcontent");$K.scrollbars[this.id+"_searchcontent"]=$K.yg_initScrollbars($(this.id+"_searchcontent"),$(this.id+'_searchinnercontent'),$(this.id+'_searchinnercontentinner'),$(this.id+'_searchcontent_dragbar_v'),$(this.id+'_searchcontent_track_v'),$(this.id+'_searchcontent_dragbar_h'),$(this.id+'_searchcontent_track_h'),0);}
$K.yg_renderScroll($(this.id+"_scrollbars"),this.id);$K.scrollbars[this.id]=$K.yg_initScrollbars(ywindowobj,$(this.id+'_ywindowinner'),$(this.id+'_innercontent'),$(this.id+'_dragbar_v'),$(this.id+'_track_v'),$(this.id+'_dragbar_h'),$(this.id+'_track_h'),$(this.id+'_scrollblank'));if($(this.id+"_tablecols"))this.tablecols=true;if(this.type=="dialog"){$('minwins').insert($(this.id+'_klops'));$(this.id+'_klops').hide();$(this.id+'_klops').setStyle({visibility:'visible'});if($(this.id+'_modalbg'))$(this.id+'_modalbg').setStyle({zIndex:$K.yg_incrementTopZIndex()});$(this.id).setStyle({zIndex:$K.yg_incrementTopZIndex()});setTimeout("$('"+this.id+"').setStyle({zIndex: $K.yg_incrementTopZIndex()});",0);var tmpWinId=this.id;new Draggable(this.id,{handle:this.id+'_header',onStart:function(){$(tmpWinId).setStyle({zIndex:$K.yg_incrementTopZIndex()});},onEnd:function(){if($(this.handle)){pos=$(this.handle).up('.ywindow').viewportOffset();if(pos[1]<5){$(this.handle).up('.ywindow').setStyle({top:'5px'});}}}});}
zindexfunc=function(ev){$K.yg_windowToTop(this.id);}
ywindowobj.observe('click',zindexfunc);tmpdrag=$(this.id+'_dragcorner');new Draggable(tmpdrag,{change:$K.yg_boxResize.bind(this),starteffect:$K.yg_boxResizeStart.bind(this),endeffect:$K.yg_boxResizeEnd.bind(this)});if(verticalsplit>0){$K.yg_renderScroll($(this.id+"_column2scrollbars"),this.id+"_column2content");$K.scrollbars[this.id+"_column2"]=$K.yg_initScrollbars($(this.id+"_column2content"),$(this.id+'_column2innercontent'),$(this.id+'_column2innercontentinner'),$(this.id+'_column2content_dragbar_v'),$(this.id+'_column2content_track_v'),$(this.id+'_column2content_dragbar_h'),$(this.id+'_column2content_track_h'),$(this.id+'_scrollblankcolumn2'));tmpdrag=$(this.id+'_vertcutdrag');new Draggable(tmpdrag,{constraint:'horizontal',change:$K.yg_vertResize.bind(this),starteffect:$K.yg_vertResizeStart.bind(this),endeffect:$K.yg_vertResizeEnd.bind(this)});}
this.init(boxwidth,boxheight,true,false);}
$K.yg_wndobj.prototype.init=function(boxwidth,boxheight,firstrun,refreshmode){this.firstrun=firstrun;if(boxwidth!=undefined){this.boxwidth=boxwidth;}else{boxwidth=this.boxwidth;}
if(boxheight!=undefined){this.boxheight=boxheight;}else{boxheight=this.boxheight;}
if(firstrun==true){if(this.tabs.length>1){tmpobj=$(this.id+"_topleft");if(tmpobj){tmpobj.removeClassName('ywindow_tl');tmpobj.addClassName('ywindow_tltabs');}}else{$(this.id).addClassName('hidetabs');}}
dialogtop=0;dialogbottom=0;filterheight=0;if((this.tabs.elements)&&(this.tab)){if($(this.id+'_filter_'+this.tab)&&($(this.id+'_filter_'+this.tab).getStyle('display')!='none')){filterheight=$(this.id+'_filter_'+this.tab).getHeight();}}
if($(this.id+'_dialogtop'))dialogtop+=$(this.id+'_dialogtop').getHeight();if($(this.id+'_dialogbottom'))dialogbottom+=$(this.id+'_dialogbottom').getHeight();ywindowobj=$(this.id);ywindowobj.setStyle({width:boxwidth+'px'});this.topheight=$(this.id+'_tabs').getHeight()+$(this.id+'_buttons').getHeight();bottomdiff=16+$(this.id+'_bottom').getHeight()+$(this.id+'_spcbottom').getHeight();if((bottomdiff==32)&&(Prototype.Browser.IE))bottomdiff=16;this.contentwidth=boxwidth-41;tmpobj=$(this.id+'_cnttable');tmpobj.setStyle({display:'block'});contentheight=boxheight-this.topheight-bottomdiff-dialogtop-dialogbottom-filterheight;tmpobj=$(this.id+'_container');tmpobj.setStyle({height:contentheight+'px'});tmpobj=$(this.id+'_ywindowinner');tmpobj.setStyle({height:contentheight+'px'});if((this.firstrun==true)&&(Prototype.Browser.WebKit)){tmpcntwid=$(this.id+'_innercontent').getWidth();}
min=0;if($(tmpobj).down()){tmpobjd=$(tmpobj).down();}
if(tmpobjd){if((tmpobjd.getHeight()>contentheight)&&!(tmpobjd.getWidth()>(this.contentwidth-11)))min=9;}
this.column1width=this.contentwidth;this.column2width=0;vertcutwidth=0;if(this.verticalsplit>0){vertcutwidth=13;this.column2width=Math.round((this.contentwidth-1)/100*(100-this.verticalsplit))-vertcutwidth-1;this.column1width=this.contentwidth-2-this.column2width-vertcutwidth;if((Prototype.Browser.IE)&&(BrowserDetect.version>7)){this.column1width-=1;this.column2width+=4;}}
tmpobj=$(this.id+'_ywindowouter');tmpobj.setStyle({width:(this.column1width-1)+'px'});if(this.verticalsplit>0){tmpobj=$(this.id+'_column2');tmpobj.setStyle({width:(this.column2width)+'px'});if(Prototype.Browser.IE){col2wid=this.column2width;tmpobj=$(this.id+'_column2bot');tmpobj.setStyle({width:(col2wid)+'px'});tmpobj=$(this.id+'_column2top');tmpobj.setStyle({width:(col2wid)+'px'});}
column2contentheight=contentheight;if($(this.id+"_column2filter"))column2contentheight-=$(this.id+"_column2filter").getHeight();if($(this.id+"_column2bottom")&&($(this.id+"_column2bottom").getStyle('display')!="none"))column2contentheight-=$(this.id+"_column2bottom").getHeight();tmpobj=$(this.id+"_column2content");tmpobj.setStyle({height:column2contentheight+'px'});tmpobj.setStyle({width:(this.column2width-9)+'px'});tmpobj=$(this.id+"_column2outerbox");tmpobj.setStyle({height:column2contentheight+'px'});tmpobj=$(this.id+"_column2outercontent");tmpobj.setStyle({height:column2contentheight+'px'});tmpobj.setStyle({width:this.column2width+'px'});tmpobj=$(this.id+"_column2innercontent");tmpobj.setStyle({height:column2contentheight+'px'});tmpobj.setStyle({width:this.column2width+'px'});tmpdrag=$(this.id+'_vertcutdrag');tmpdrag.setStyle({height:contentheight+'px'});}
blankleft=this.column1width+5;blanktop=boxheight-(9+bottomdiff+dialogbottom);if(this.type=="dialog"){blanktop+=1;blankleft+=1;}
if($(this.id+"_column2")){blanktop2=blanktop;tmpobj=$(this.id+"_column2bottom");if((tmpobj)&&(tmpobj.getStyle('display')!="none")){blanktop2-=tmpobj.getHeight();}}
tmpobj=$(this.id+'_scrollblank');tmpobj.setStyle({top:blanktop+'px'});tmpobj.setStyle({left:blankleft+'px'});if($(this.id+'_scrollblankcolumn2')){tmpobj=$(this.id+'_scrollblankcolumn2');tmpobj.setStyle({top:(blanktop2)+'px'});tmpobj.setStyle({left:(this.column1width+21+this.column2width)+'px'});}
if((firstrun==true)&&(this.tabs!='notabs')){this.tabs=new $K.tabs($(this.id+'_tabs'),this.tabs,this.id,this);}
if((this.tabs)&&(refreshmode!=true)){if(typeof(this.tabs.init)=='function')this.tabs.init(true);}
if((this.firstrun==true)&&(Prototype.Browser.WebKit)){$(this.id+'_innercontent').rightWidth=$(this.id+'_innercontent').clientWidth=tmpcntwid;}
this.refresh();if(($K.windows[this.id])&&($K.windows[this.id].yg_id==undefined)){if(!((this.basetype!="tree")&&(this.type=="content"))){$(this.id).removeClassName('boxghost');}}
if(firstrun==true){$K.yg_customAttributeHandler($(this.id));if((this.type=="content")&&(this.basetype!="tree")){if(this.yg_id!=-1){$(this.id).addClassName('boxghost');}}
if(this.type=="dialog"){if($(this.id).descendantOf($('previewcontainer'))){$(this.id).setStyle({top:'5px'});$(this.id).setStyle({left:'5px'});}else{$K.yg_centerWindow($(this.id));}}
ywindowobj.setStyle({visibility:'visible'});this.firstrun=false;}}
$K.yg_wndobj.prototype.remove=function(force){if(($K.windows[this.id].stayInBackground!=true)||(force)){var successFunc=function(){if($K.yg_SWFUploadObjects[this.id]){$K.yg_SWFUploadObjects[this.id].destroy();}
if($K.windows[this.id].periodicTimer){$K.windows[this.id].periodicTimer.stop();$K.windows[this.id].periodicTimer=undefined;}
$K.yg_releaseLock(this.id.split('_')[1],$K.windows[this.id].yg_type,$K.windows[this.id].yg_id);if($(this.id))$(this.id).remove();if($(this.id+"_klops"))$(this.id+"_klops").remove();if($(this.id+"_modalbg"))$(this.id+"_modalbg").remove();delete $K.scrollbars[this.id];delete $K.windows[this.id];}
if(force){successFunc.bind(this)();}else{$K.yg_checkOpenWindows($K.windows[this.id].yg_id,$K.windows[this.id].yg_type,{onSuccess:successFunc.bind(this)});}}else{$(this.id).hide();$(this.id+"_klops").hide();}}
$K.yg_wndobj.prototype.min=function(){$(this.id).setStyle({display:'none'});$(this.id+"_klops").setStyle({display:'block'});if($('maincontainer').hasClassName("mk_horizontal")&&($(this.id).descendantOf($('maincontainer')))){$K.windows[$K.windows[this.id].boundWindow].init($K.windows[$K.windows[this.id].boundWindow].boxwidth,(document.viewport.getHeight()-$(this.id+"_klops").getHeight()-$K.windowTopDiff-$('toolbar').getHeight()-$K.winhorizontalDiff),false,false);if(!($(this.id+"_klops").down(".wrapper"))){$(this.id+"_klops").innerHTML="<div class='wrapperouter'><div class='wrapper'>"+$(this.id+"_klops").innerHTML+"</div></div>";$(this.id+"_klops").down(2).innerHTML=$(this.id+"_title").innerHTML;$(this.id+"_klops").down(2).writeAttribute("yg_property","name");$(this.id+"_klops").down(2).writeAttribute("yg_id",$(this.id+"_title").readAttribute("yg_id"));$(this.id+"_klops").down(2).writeAttribute("yg_type",$(this.id+"_title").readAttribute("yg_type"));}
this.resizeCollapsed();}
$K.windows[this.id].minimized=true;$K.yg_checkStatusBar();}
$K.yg_wndobj.prototype.max=function(){tmpwid=0;if($(this.id).descendantOf('maincontainer')){tmparrx=$('maincontainer').childElements();for(var k=0;k<tmparrx.length;k++){if((tmparrx[k].id!=this.id+"_klops")&&((tmparrx[k].id==this.id)||(tmparrx[k].getStyle('display')!='none'))){tmpwid+=tmparrx[k].getWidth();}}
if(tmpwid>$K.maincontwid){diff=tmpwid-($K.maincontwid-5);for(var k=0;k<tmparrx.length;k++){if((tmparrx[k].getStyle('display')!='none')&&(tmparrx[k].id!=this.id)&&(tmparrx[k].id!=this.id+"_klops")){if(!($('maincontainer').hasClassName("mk_horizontal")&&($(this.id).descendantOf($('maincontainer'))))){$K.windows[tmparrx[k].id].init(($K.windows[tmparrx[k].id].boxwidth-diff),$K.windows[tmparrx[k].id].boxheight,false,false);}}}}}
$(this.id+"_klops").setStyle({display:'none'});$(this.id).setStyle({display:'block'});if($('maincontainer').hasClassName("mk_horizontal")&&($(this.id).descendantOf($('maincontainer')))){newheight=this.boxheight;traceheight=$('toolbar').getHeight();boundheight=(document.viewport.getHeight()-this.boxheight-$K.windowTopDiff-traceheight-$K.winhorizontalDiff);if(((newheight+boundheight)>(document.viewport.getHeight()-$K.windowTopDiff-traceheight-$K.winhorizontalDiff))&&($(this.boundWindow).visible())||((boundheight<100)&&$(this.boundWindow).visible())){newheight=boundheight=(document.viewport.getHeight()-$K.windowTopDiff-traceheight-$K.winhorizontalDiff)/2;}
if($(this.boundWindow).visible()){$K.windows[this.boundWindow].init($K.windows[this.boundWindow].boxwidth,boundheight,false,false);}
this.init($K.windows[this.boundWindow].boxwidth,newheight,false,false);}else if(tmpwid>$K.maincontwid){$K.windows[this.id].init(this.boxwidth,this.boxheight,false,false);}else{$K.windows[this.id].init();}
$K.windows[this.id].minimized=false;$K.yg_checkStatusBar();}
$K.yg_centerWindow=function(obj){var tmpleft=Math.round((document.viewport.getWidth()-$(obj).getWidth())/2);var tmptop=Math.round((document.viewport.getHeight()-$(obj).getHeight())/2)-5;if(tmptop<5)tmptop=5;var posfree=false;while(posfree==false){posfree=true;for(winID in $K.windows){if($K.windows[winID].type=="dialog"){dim=$(winID).positionedOffset();if((dim[0]==tmpleft)&&(dim[1]==tmptop)){posfree=false;tmptop+=6;tmpleft+=6;}}}}
$(obj).setStyle({top:tmptop+'px',left:tmpleft+'px'});}
$K.yg_wndobj.prototype.resizeCollapsed=function(){if($(this.id+"_klops").visible())$(this.id+"_klops").setStyle({width:($K.windows[$K.windows[this.id].boundWindow].boxwidth-25)+"px"});}
$K.yg_wndobj.prototype.setLocked=function(userID){this.lockedByUser=userID;}
$K.yg_wndobj.prototype.setCaption=function(name,type){if(!type)type='page';this.caption=name;$(this.id+'_title').update(name);if(this.type=="dialog"){if($(this.id+'_klops').down(3))$(this.id+'_klops').down(3).update(name);if($(this.id+'_klops').down('span'))$(this.id+'_klops').down('.titlespan').update(name);}
$(this.id+'_klops').writeAttribute('title',name);$(this.id+'_title').yg_id=this.yg_id;$(this.id+'_title').yg_type=type;$(this.id+'_title').yg_property='name';$(this.id+'_title').writeAttribute('yg_id',this.yg_id);$(this.id+'_title').writeAttribute('yg_type',type);$(this.id+'_title').writeAttribute('yg_property','name');$(this.id+'_header').setStyle({width:'auto'});$(this.id+'_title').setStyle({width:'auto'});$K.yg_addLookup(this.yg_id,$(this.id+'_title'));if($(this.id+'_klops').down('span'))$K.yg_addLookup(this.yg_id,$(this.id+'_klops'));}
$K.yg_wndobj.prototype.setFileType=function(filetype){if(!$(this.id+'_headerfiletype')){$(this.id+'_header').insert({top:filetype});$(this.id+'_header').down('.filetype').id=this.id+'_headerfiletype';}else{$(this.id+'_headerfiletype').update(filetype);}
if(!$(this.id+'_klops_filetype')){$(this.id+'_klops').down().addClassName('file');$(this.id+'_klops').down().insert({top:filetype});$(this.id+'_klops').down('.filetype').id=this.id+"_klops_filetype";}else{$(this.id+'_klops_filetype').update(filetype);}
$K.yg_addLookup(this.yg_id,$(this.id+'_klops_filetype'));$K.yg_addLookup(this.yg_id,$(this.id+'_headerfiletype'));}
$K.yg_wndobj.prototype.setCaptionStyle=function(name){$(this.id+'_title').className=name;}
$K.yg_wndobj.prototype.setIcon=function(name){if($(this.id+'_header')!=undefined){$(this.id+'_header').className=name;}
if(($(this.id+'_klops')!=undefined)&&($(this.id+'_klops').down())){$(this.id+'_klops').down().className=name;}}
$K.yg_wndobj.prototype.setExtensionIcon=function(style){if($(this.id+'_header')!=undefined){if(!($(this.id+'_header').down('.iconextension'))){$(this.id+'_header').insert({top:'<div class="iconextension"></div>'});}
$(this.id+'_header').down('.iconextension').writeAttribute("style",style);}
if(($(this.id+'_klops')!=undefined)){$(this.id+'_klops').down(0).writeAttribute("style",style);}}
$K.yg_wndobj.prototype.setUserHeader=function(url,name,company,userid){if($(this.id+'_header')!=undefined){$(this.id+'_header').className='noicon';if(!($(this.id+'_header').down('.userpic'))){$(this.id+'_header').insert({top:'<div class="userpic" yg_property="picture" yg_id="'+userid+'-user" yg_type="user" style="background-image:url(\''+url+'?rnd='+(Math.random()*1000)+'\')"></div><span class="username" yg_property="name" yg_id="'+userid+'-user" yg_type="user">'+name+'</span><br /><span class="usercompany" yg_type="user" yg_id="'+userid+'-user" yg_property="company">'+company+'</span>'});$K.yg_customAttributeHandler($(this.id+'_header'));$(this.id+'_title').hide();$K.windows[this.id].init();}else{$(this.id+'_header').down('.userpic').replace('<div class="userpic" yg_property="picture" yg_id="'+userid+'-user" yg_type="user" style="background-image:url(\''+url+'?rnd='+(Math.random()*1000)+'\')"></div>');$(this.id+'_header').down('.username').replace('<span class="username" yg_property="name" yg_id="'+userid+'-user" yg_type="user">'+name+'</span>');$(this.id+'_header').down('.usercompany').replace('<span class="usercompany" yg_type="user" yg_id="'+userid+'-user" yg_property="company">'+company+'</span>');$K.yg_customAttributeHandler($(this.id+'_header'));}}
if(($(this.id+'_klops')!=undefined)&&$(this.id).hasClassName('ydialog')){$(this.id+'_klops').down(0).update('<span class="titlespan" yg_property="name" yg_id="'+userid+'-user" yg_type="user">'+name+'</span>');$K.yg_customAttributeHandler($(this.id+'_klops'));}}
$K.yg_wndobj.prototype.setStageButton=function(status){if($(this.id+'_stagebtn')){if(status=='1'){$(this.id+'_stagebtn').removeClassName('disabled');}else{$(this.id+'_stagebtn').addClassName('disabled');}}}
$K.yg_wndobj.prototype.scrollh=function(num,col){var scrollit=false;if(this.tablecols){scrollit=true;if($(this.id+"_tablecols")&&($(this.id+"_tablecols").descendantOf(this.id+"_column2"))&&(col!="col2")){scrollit=false;}}
if(scrollit){if($(this.id+"_tablecols"))$(this.id+"_tablecols").setStyle({left:num+'px'});}}
$K.yg_wndobj.prototype.refresh=function(frame){if(typeof frame=='object'){if($(frame).descendantOf($(this.id+'_innercontent'))){frame="col1";}else if($(frame).descendantOf($(this.id+'_column2innercontentinner'))){frame="col2";}}
if(!(frame))frame="all";if((((frame=="all")||(frame=="col1"))&&(this.verticalsplit>0))||((frame=="col2")&&(this.verticalsplit>0))){if($(this.id+'_column2innercontentinner').down('.mk_verticalcenter')){$K.yg_centerContent($(this.id+'_column2innercontentinner').down('.mk_verticalcenter'),$(this.id+'_column2innercontentinner'));}
if($(this.id+'_column2innercontentinner').down('.mk_fillcontentspace')){$K.yg_fillContentSpace($(this.id+'_column2innercontentinner').down('.mk_fillcontentspace'),$(this.id+'_column2innercontentinner'));}
$K.yg_updateInnerContent($(this.id+'_column2innercontentinner'));$K.scrollbars[this.id+"_column2"].setBarSize(this.firstrun);}
if((frame=="all")||(frame=="col1")){if($(this.id+'_'+this.tab)&&$(this.id+'_'+this.tab).down('.mk_verticalcenter')){$K.yg_centerContent($(this.id+'_'+this.tab).down('.mk_verticalcenter'),$(this.id+'_'+this.tab));}
if($(this.id+'_'+this.tab)&&$(this.id+'_'+this.tab).down('.mk_fillcontentspace')){$K.yg_fillContentSpace($(this.id+'_'+this.tab).down('.mk_fillcontentspace'),$(this.id+'_'+this.tab));}
$K.yg_updateInnerContent($(this.id+'_innercontent'));$K.scrollbars[this.id].setBarSize(this.firstrun);if($(this.id+'_scrollbar_h').getStyle('visibility')!='hidden'){$(this.id+'_pagedirs').setStyle({bottom:$(this.id+'_scrollbar_h').getHeight()+'px'});}else{$(this.id+'_pagedirs').setStyle({bottom:'0px'});}}}
$K.yg_wndobj.prototype.submit=function(){if(typeof this._submitFunction=='function'){this._submitFunction();}}
$K.yg_vertResizeStart=function(){this.basepos=Position.page($(this.id));}
$K.yg_vertResize=function(){tmpdrag=$(this.id+'_vertcutdrag');dragpos=Position.page(tmpdrag);this.verticalsplit=(dragpos[0]-this.basepos[0]-10)/this.contentwidth*100;if(this.verticalsplit<=10.5){this.verticalsplit=10;minwidth=this.contentwidth*(this.verticalsplit/100);tmpdrag.setStyle({left:(minwidth-this.column1width+1)+'px'});}else if(this.verticalsplit>=90){this.verticalsplit=90;maxwidth=this.contentwidth*this.verticalsplit/100;tmpdrag.setStyle({left:(maxwidth-this.column1width-1)+'px'});}
this.verticalsplit=Math.round(this.verticalsplit);}
$K.yg_vertResizeEnd=function(){this.init(this.boxwidth,this.boxheight,false,false);$(this.id+'_vertcutdrag').setStyle({left:'0px'});}
$K.yg_centerContent=function(obj,container){if(obj.down()){objheight=obj.down().getHeight();}else{if(obj.tagName=='IMG'){var tmpImage=new Image();tmpImage.src=obj.src;objheight=tmpImage.height;if(obj.readAttribute('zoomlevel'))objheight=objheight*(parseInt(obj.readAttribute('zoomlevel'))/100);}else{objheight=obj.getHeight();}}
delete tmpImage;containerheight=container.up(1).getHeight();margincontent=container.getStyle('marginTop');if(!(margincontent)){margincontent=0;}else{margincontent=parseInt(margincontent.substring(0,margincontent.length-2));}
margintop=Math.round((containerheight-objheight)/2)-margincontent;if(margintop<0)margintop=0;obj.setStyle({paddingTop:margintop+'px'});}
$K.yg_fillContentSpace=function(obj,container){obj.setStyle({height:'auto'});margintop=container.getStyle('margin-top');if((margintop)&&(margintop!="")){margintop=parseInt(margintop.slice(0,-2));}else{margintop=0;}
contentheight=container.up(1).getHeight()-margintop;listheight=container.getHeight();fillheight=Math.round(contentheight-listheight);buttonheight=0;if(obj.down())buttonheight=obj.down().getHeight();if(fillheight>0)obj.setStyle({height:(fillheight+buttonheight)+'px'});}
$K.yg_boxResizeStart=function(){$(this.id).appendChild(tmpdiv=document.createElement('div'));tmpdiv.className="resizeghost";tmpdiv.id="ywindowghost";dragcorner=$(this.id+'_dragcorner');if($(this.id).descendantOf('maincontainer')){tmparrx=$('maincontainer').childElements();tmpwid=0;tmphei=0;for(var k=0;k<tmparrx.length;k++){if((tmparrx[k].id!=this.id)&&(tmparrx[k].getStyle('display')!='none')){tmphei+=tmparrx[k].getHeight();if(k==0){tmpwid=360;}else{tmpwid=620;}}}
traceheight=$('toolbar').getHeight();if($('maincontainer').hasClassName('mk_horizontal')){this.maxwidth=this.minwidth=document.viewport.getWidth()-7;this.maxheight=Math.round(document.viewport.getHeight()/4*3)-$K.windowTopDiff-traceheight;}else{this.maxwidth=document.viewport.getWidth()-tmpwid-7;if(Prototype.Browser.IE)tmpdiv.maxwidth-=2;this.maxheight=this.minheight=document.viewport.getHeight()-$K.windowTopDiff-traceheight;}}else{this.maxwidth=0;this.maxheight=0;}}
$K.yg_boxResizeEnd=function(){dragcorner=$(this.id+'_dragcorner');base=$(this.id);ghost=$('ywindowghost');dragpos=Position.page(dragcorner);basepos=Position.page(base);finalwidth=dragpos[0]-basepos[0]+26;finalheight=dragpos[1]-basepos[1]+13;if(finalwidth<=this.minwidth)finalwidth=this.minwidth;if((finalwidth>=this.maxwidth)&&(this.maxwidth!=0))finalwidth=this.maxwidth;if(finalheight<=this.minheight)finalheight=this.minheight;if((finalheight>=this.maxheight)&&(this.maxheight!=0))finalheight=this.maxheight;if(ghost){if((finalwidth>ghost.maxwidth)&&(ghost.maxwidth!=0))finalwidth=ghost.maxwidth;if((finalheight>ghost.maxheight)&&(ghost.maxheight!=0))finalheight=ghost.maxheight;}
if($('ywindowghost'))base.removeChild($('ywindowghost'));this.init(finalwidth,finalheight,false,false);if($K.windows[this.boundWindow]){if($('maincontainer').hasClassName('mk_horizontal')){$K.windows[this.boundWindow].resizeCollapsed();$K.windows[this.id].resizeCollapsed();$K.windows[this.boundWindow].init(finalwidth,(document.viewport.getHeight()-finalheight-$K.windowTopDiff-$('toolbar').getHeight()-$K.winhorizontalDiff),false,false);}else{$K.windows[this.boundWindow].init((document.viewport.getWidth()-7-finalwidth),finalheight,false,false);}}
dragcorner.setStyle({left:'0px'});dragcorner.setStyle({top:'0px'});if(typeof this.onResize=='function'){this.onResize(this);}}
$K.yg_boxResize=function(){base=$(this.id);dragcorner=$(this.id+'_dragcorner');dragpos=Position.page(dragcorner);basepos=Position.page(base);ghostwidth=dragpos[0]-basepos[0]+5;ghostheight=dragpos[1]-basepos[1]+5;ghost=$('ywindowghost');if(ghostwidth<(this.minwidth-22))ghostwidth=this.minwidth-22;if((ghostwidth>(this.maxwidth-22))&&(this.maxwidth!=0))ghostwidth=this.maxwidth-22;if(ghostheight<(this.minheight-5))ghostheight=this.minheight-5;if((ghostheight>(this.maxheight-5))&&(this.maxheight!=0))ghostheight=this.maxheight-5;if((ghostwidth>ghost.maxwidth-22)&&(ghost.maxwidth!=0))ghostwidth=ghost.maxwidth-22;if((ghostheight>ghost.maxheight-5)&&(ghost.maxwidth!=0))ghostheight=ghost.maxheight-5;ghost.setStyle({width:ghostwidth+'px'});ghost.setStyle({height:ghostheight+'px'});}
$K.yg_windowResized=function(){$K.maincontwid=document.viewport.getWidth()-2;if(Prototype.Browser.IE)$K.maincontwid-=4;if($K.maincontwid<$K.panelminwidth)$K.maincontwid=$K.panelminwidth;tmparrx=$('maincontainer').childElements();tmparrwins=new Array();tmparrsizes=new Array();num=0;for(var k=0;k<tmparrx.length;k++){if(tmparrx[k].getStyle('display')!='none'){tmparrwins.push(tmparrx[k]);tmparrsizes[num]=new Array();tmparrsizes[num][0]=0;tmparrsizes[num][1]=0;num++;}}
var tmpwid=0;if($('toolbar')){traceheight=$('toolbar').getHeight();}else{traceheight=0;}
for(var k=0;k<tmparrwins.length;k++){if(($K.windows[tmparrwins[k].id])){tmparrsizes[k][1]=document.viewport.getHeight()-$K.windowTopDiff-traceheight;$K.panelheight=document.viewport.getHeight()-$K.windowTopDiff-traceheight;}}
var tmpwidvar=0;var tmpheivar=0;for(var k=0;k<tmparrwins.length;k++){if((tmparrwins[k].getStyle('display')!='none')&&($K.windows[tmparrwins[k].id])){tmparrsizes[k][0]=$K.windows[tmparrwins[k].id].boxwidth;tmpwidvar+=$K.windows[tmparrwins[k].id].boxwidth;tmpheivar+=$K.windows[tmparrwins[k].id].boxheight;}else if(!($K.windows[tmparrwins[k].id])){return false;}}
if($('maincontainer').hasClassName('mk_horizontal')){for(var k=0;k<tmparrwins.length;k++){if(tmparrwins[k].getStyle('display')!='none'){if(($K.windows[tmparrwins[k].id])){tmparrsizes[k][0]=$K.maincontwid-5;}else if(!($K.windows[tmparrwins[k].id])){tmparrsizes[k][0]=$K.maincontwid-5;}}}
for(var k=0;k<tmparrwins.length;k++){tmparrsizes[k][1]=Math.round((document.viewport.getHeight()-$K.windowTopDiff-traceheight-$K.winhorizontalDiff)/tmparrwins.length);}
$K.panelheight=document.viewport.getHeight()-$K.windowTopDiff-traceheight-$K.winhorizontalDiff;diff=Math.round((($K.panelwidth[0]+$K.panelwidth[1])-($K.maincontwid-5))/2);$K.panelwidth[0]-=diff;$K.panelwidth[1]-=diff;}else{diff=tmpwidvar-($K.maincontwid-5);if(tmparrsizes.length>1){tmparrsizes[1][0]-=diff;diff=0;if(tmparrsizes[1][0]<620){diff=620-tmparrsizes[1][0];tmparrsizes[1][0]=620;}
tmparrsizes[1][1]=$K.panelheight;}
if(tmparrsizes.length>0){tmparrsizes[0][0]-=diff;diff=0;if(tmparrsizes[0][0]<360){diff=360-tmparrsizes[0][0];tmparrsizes[0][0]=360;}
tmparrsizes[0][1]=$K.panelheight;}}
for(var k=0;k<tmparrwins.length;k++){if((tmparrsizes[k][0]>0)||(tmparrsizes[k][1]>0)){if($K.windows[tmparrwins[k].id]){if(tmparrsizes[k][0]==0)tmparrsizes[k][0]=$K.windows[tmparrwins[k].id].boxwidth;if(tmparrsizes[k][1]==0)tmparrsizes[k][1]=$K.windows[tmparrwins[k].id].boxheight;$K.windows[tmparrwins[k].id].init(tmparrsizes[k][0],tmparrsizes[k][1],false,false);}}}
var tmparr=$('logincontainer').immediateDescendants();tmparr.each(function(item){$K.yg_centerWindow($(item));});$('maincontainer').setStyle({width:($K.maincontwid)+'px'});$K.yg_checkStatusBar();}
$K.yg_initWindow=function(){$K.maincontwid=document.viewport.getWidth()-2;if($K.maincontwid<$K.panelminwidth)$K.maincontwid=$K.panelminwidth;if(Prototype.Browser.IE)$K.maincontwid-=2;$('maincontainer').setStyle({width:$K.maincontwid+'px'});if(document.viewport.getWidth()<$K.panelminwidth){panwidth=$K.panelminwidth;}else{panwidth=$K.maincontwid-5;}
$K.panelwidth[0]=Math.round(panwidth/3);if($K.panelwidth[0]<360)$K.panelwidth[0]=360;$K.panelwidth[1]=panwidth-$K.panelwidth[0];if($K.panelwidth[1]<620)$K.panelwidth[1]=620;$K.panelheight=document.viewport.getHeight()-$K.windowTopDiff-$('toolbar').getHeight();window.onresize=function(){$K.yg_windowResized();$K.yg_centerPreview();}}
$K.yg_treeresultSwap=function(obj){obj=$(obj);if(obj.hasClassName('opened')){obj.removeClassName('opened');obj.addClassName('closed');obj.next().setStyle({display:'none'});}else{obj.removeClassName('closed');obj.addClassName('opened');obj.next().setStyle({display:'block'});}
$K.windows[obj.up('.ywindow').id].refresh(obj);}
$K.yg_updateInnerContent=function(obj){if(Object.isUndefined(obj))
return;obj.setStyle({width:'auto'});objdim=obj.getDimensions();boxobj=obj.up();boxdim=boxobj.up().getDimensions();innerwidth=obj.up(2).getWidth();if(objdim.height>boxdim.height){tmpwidth=innerwidth-9;}else{tmpwidth=innerwidth;}
if(obj.hasClassName('sortablelist')){tmpwidth-=2;}
boxobj.setStyle({width:tmpwidth+'px'});if(($(obj))&&($(obj).up(1).next())){tmparr=$(obj).up(1).next().childElements();for(i=0;i<tmparr.length;i++){tmparr[i].setStyle({width:tmpwidth+'px'});}}
if(obj.hasClassName('sortablelist')){obj.setStyle({width:(tmpwidth)+'px'});}else{obj.setStyle({width:obj.getWidth()+'px'});}}
$K.yg_initDialogTree=function(obj){obj=$(obj);swid=obj.up().getWidth()+1;shei=obj.up().getHeight()+3;obj.setStyle({width:swid+'px'});obj.setStyle({height:shei+'px'});obj.setStyle({marginTop:'-1px'});obj.setStyle({marginLeft:'-1px'});tmpcont=obj.down();tmpcont.setStyle({width:swid+'px'});tmpcont.setStyle({height:shei+'px'});tmplist=tmpcont.down();if(tmplist.getHeight()>shei){tmplist.setStyle({width:(swid-$K.yg_scrollObjAttr.scrollBtnVWidth)+'px'})}else{tmplist.setStyle({width:'100%'});}}
$K.yg_updateContentArea=function(obj){swid=obj.up().getWidth()+1;shei=obj.up().getHeight()+3;tmpcont=obj.down();tmplist=tmpcont.down();if(tmplist.getHeight()>shei){tmplist.setStyle({width:(swid-$K.yg_scrollObjAttr.scrollBtnVWidth)+'px'})}else{tmplist.setStyle({width:'100%'});}
$K.windows[obj.id].refresh(obj);}
$K.yg_clearRefresh=function(yg_id){for(var i in $K.windows){if($K.windows[i].yg_id==yg_id){if(($K.windows[i].tab=="VERSIONS")||($K.windows[i].tab=="PUBLISHING")||(yg_id.endsWith('-file')&&($K.windows[i].tab!="PREVIEW"))){for(var k=0;k<$K.windows[i].tabs.elements.length;k++){if($K.windows[i].tabs.elements[k].NAME==$K.windows[i].tab){$K.windows[i].tabs.select(k);}}}}}}
$K.yg_refreshWin=function(yg_type,yg_id,yg_property){$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].innerHTML){if(!$K.yg_idlookuptable[yg_id][i]){return;}
var winRef=$K.yg_idlookuptable[yg_id][i].up('.ywindow').id;if($K.windows[winRef]&&($K.windows[winRef].basetype!='tree')){$K.windows[winRef].setCaption($(winRef+'_title').innerHTML,yg_type);$K.windows[winRef].init(undefined,undefined,false,true,0);}}
if(($K.yg_idlookuptable[yg_id][i].capt!=undefined)&&($($K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i])))){$K.scrollbars[$($K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i])).up('.ywindow').id].setBarSize();}}}}
$K.yg_showColumn2Bottom=function(winid){if($(winid+"_column2bottom")){$(winid+"_column2bottom").setStyle({display:'block'});$K.windows[winid].init(undefined,undefined,false,true,0);}}
$K.yg_hideColumn2Bottom=function(winid){if($(winid+"_column2bottom")){$(winid+"_column2bottom").setStyle({display:'none'});$K.windows[winid].init($K.windows[winid].boxwidth,$K.windows[winid].boxheight,false,false,0);}}
$K.yg_cleanWindows=function(){$H($K.windows).each(function(win_item){if(typeof win_item[1]=='object'){var checkWinObj=win_item[1];var checkWin=$(checkWinObj.id);if((checkWinObj.minimized!==true)&&(checkWin)&&(checkWin.style.display=='none')){checkWinObj.remove();}}});}
$K.yg_checkOpenWindows=function(ygId,ygType,options){if(!ygId){if(options&&typeof options.onSuccess=='function'){options.onSuccess();}
return;}
var isNotBlocked=true;var showWarning=false;var blockedWindows=new Array();for(winID in $K.windows){if($K.windows[winID].openerYgId==ygId){isNotBlocked=false;blockedWindows.push(winID);$K.log('YG_TYPE is:',$K.windows[winID].yg_type,$K.Log.WARN);if(($K.windows[winID].yg_type!='navigation')&&($K.windows[winID].yg_type!='template')&&($K.windows[winID].yg_type!='filefolder')&&($K.windows[winID].yg_type!='cblock')&&($K.windows[winID].yg_type!='tag')&&($K.windows[winID].yg_type!='view')&&($K.windows[winID].yg_type!='insertcontent')){showWarning=true;}}}
if(!isNotBlocked){if(options&&typeof options.onBeforeShow=='function'){options.onBeforeShow();}
var processBlockedWindows=function(){blockedWindows.each(function(blockedWinId){if(($K.windows[blockedWinId].type=='dialog')&&((($K.windows[blockedWinId].tab=='FILES_TREE')&&($K.windows[blockedWinId].yg_type=='filefolder'))||(($K.windows[blockedWinId].tab=='FILES_TREE')&&($K.windows[blockedWinId].yg_type=='file'))||(($K.windows[blockedWinId].tab=='CONTENTBLOCKS_TREE')&&($K.windows[blockedWinId].yg_type=='cblock'))||(($K.windows[blockedWinId].tab=='TAGS_TREE')&&($K.windows[blockedWinId].yg_type=='tag'))||(($K.windows[blockedWinId].tab=='TEMPLATES_TREE')&&($K.windows[blockedWinId].yg_type=='template'))||($K.windows[blockedWinId].yg_type=='insertcontent')||($K.windows[blockedWinId].yg_type=='view'))){if($(blockedWinId+'_bottom')&&$(blockedWinId+'_bottom').down()){$(blockedWinId).addClassName('mk_noexec');$(blockedWinId+'_bottom').down().remove();$K.windows[blockedWinId].refresh();}
if($(blockedWinId+'_bottom_'+$K.windows[blockedWinId].tab)){$(blockedWinId).addClassName('mk_noexec');$(blockedWinId+'_bottom_'+$K.windows[blockedWinId].tab).down().remove();$K.windows[blockedWinId].refresh();}
$K.windows[winID].openerYgId=null;}else{$K.windows[blockedWinId].remove(true);}});if(options&&typeof options.onSuccess=='function'){options.onSuccess();}}
if(showWarning){$K.yg_promptbox($K.TXT('TXT_WARNING'),$K.TXT('TXT_CHANGES_NOT_SAVED'),'standard',processBlockedWindows,Prototype.emptyFunction);}else{processBlockedWindows();}}else{if(options&&typeof options.onSuccess=='function'){options.onSuccess();}}}
;$K.yg_revealActionButtons=function(which,className){if(!className)className='row_hover';if(which.parentNode.reference)which.parentNode.reference.addClassName(className);$K.actionhover=true;}
$K.yg_hideActionButtons=function(which,className){if(!className)className='row_hover';if(which.parentNode.reference)which.parentNode.reference.removeClassName(className);$K.actionhover=false;}
$K.yg_showActions=function(obj,tree,file){if($K.yg_activeDragInfo.dragging)return;obj=$(obj);var ywindowinnerRef=obj.up(13);if((obj.hasClassName('cbheader')||obj.hasClassName('emheader'))&&(ywindowinnerRef.hasClassName('ywindowinner'))){var winRef=ywindowinnerRef.up('.ywindow');var obj_width=obj.getWidth();var box_width=ywindowinnerRef.getWidth();if($K.scrollbars[winRef.id].maxX>0){var leftPos=(box_width-22);}else{var leftPos=(box_width-34);}
if($K.scrollbars[winRef.id].maxY>0){leftPos-=11;}
if(winRef&&$K.scrollbars[winRef.id]&&($K.scrollbars[winRef.id].maxX>9)){var scrolledH=parseInt(-$K.scrollbars[winRef.id].x);leftPos+=scrolledH;}
if(leftPos>(obj_width-10)){leftPos=(obj_width-10);}
obj.down('.actions').setStyle({left:leftPos+'px'});}else if((obj.hasClassName('cbheader')||obj.hasClassName('emheader'))&&(ywindowinnerRef.tagName=='TR')){var winRef=ywindowinnerRef.up('.ywindow');var obj_width=obj.getWidth();var box_width=ywindowinnerRef.getWidth();if($K.scrollbars[winRef.id].maxX>0){var leftPos=(box_width-25);}else{var leftPos=(box_width-37);}
if($K.scrollbars[winRef.id].maxY>0){leftPos-=11;}
if(winRef&&$K.scrollbars[winRef.id]&&($K.scrollbars[winRef.id].maxX>9)){var scrolledH=parseInt(-$K.scrollbars[winRef.id].x);leftPos+=scrolledH;}
if(leftPos>(obj_width-12)){leftPos=(obj_width-12);}
obj.down('.actions').setStyle({left:leftPos+'px'});}else if(obj.hasClassName('editblocksortable')||obj.hasClassName('cntblockcontainersortable')){var leftPos=(obj.getWidth()-18);if($K.scrollbars[obj.up('.sortlist').id].maxX>0){leftPos-=9;}
obj.down('.actions').setStyle({left:leftPos+'px'});}else if(obj.hasClassName('cntblockcontainer')){var winRef=ywindowinnerRef.up('.ywindow');var obj_width=obj.getWidth();var box_width=ywindowinnerRef.getWidth();var leftPos=(box_width-20);if($K.scrollbars[winRef.id].maxY>0){leftPos-=11;}
if(winRef&&$K.scrollbars[winRef.id]&&($K.scrollbars[winRef.id].maxX>9)){var scrolledH=parseInt(-$K.scrollbars[winRef.id].x);leftPos+=scrolledH-5;}
if(leftPos>(obj_width-20)){leftPos=(obj_width-20);}
if(obj.down('.actions')){obj.down('.actions').setStyle({left:leftPos+'px'});}}else if(obj.hasClassName('panelheader')){var winRef=obj.up('.ywindow');var obj_width=obj.getWidth();var box_width=obj.up('.ywindowinner').getWidth();var leftPos=(box_width-22);if($K.scrollbars[winRef.id].maxY>0){leftPos-=11;}
if(winRef&&$K.scrollbars[winRef.id]&&($K.scrollbars[winRef.id].maxX>9)){var scrolledH=parseInt(-$K.scrollbars[winRef.id].x);leftPos+=scrolledH;}
if(obj.down('.actions')){obj.down('.actions').setStyle({left:leftPos+'px'});}}else if((tree)||(file)){var topOffset=obj.positionedOffset();leftOffset=topOffset[0];topOffset=topOffset[1];var winWidth=obj.up('.ywindowinner').getWidth();var winRef=obj.up('.ywindow');if(winRef){if($(winRef.id+"_column2")&&!(tree)){scrid=winRef.id+"_column2";}else{scrid=winRef.id;}
if(($K.scrollbars[scrid])&&($K.scrollbars[scrid].maxX!=0)){winWidth-=$K.scrollbars[scrid].x+9;}}
if(tree){var treePrefix=tree.substring(0,tree.length-5);if($(treePrefix+'_actionbutton')){$(treePrefix+'_actionbutton').setStyle({top:(topOffset+2)+'px',left:(winWidth-22)+'px'});$(treePrefix+'_actionbutton').reference=obj;}
var hideActionButton=false;if((obj.id.startsWith('entrymasks_')||obj.id.startsWith('cblocks_')||obj.id.startsWith('tags_')||obj.id.startsWith('files_')||obj.id.startsWith('pages_'))&&obj.up('.mk_chooser')&&obj.id.endsWith('treeroot_1')){hideActionButton=true;}
if(obj.id.endsWith('_trash')){hideActionButton=true;}
if((obj.id.startsWith('entrymasks_')||(obj.id.startsWith('cblocks_')))&&obj.up('.mk_chooser')){tmpobj=$(obj.down('a'));if(tmpobj.className.indexOf('prnnode')!=-1){hideActionButton=true;}
var ico=obj.down('.tree_ico');if(ico.src.indexOf('_page')!=-1){hideActionButton=true;}
if(ico.src.indexOf('_contentarea')!=-1){hideActionButton=true;}
if((ico.src.indexOf('_folder')!=-1)&&(!obj.up('.mk_folderchooser'))){hideActionButton=true;}}
if(obj.id.startsWith('templates_')&&obj.up('.mk_chooser')){tmpobj=$(obj.down('a'));if((tmpobj.hasClassName('nopreview'))||(tmpobj.hasClassName('root'))){hideActionButton=true;}}
if(obj.id.startsWith('tags_')&&!obj.up('.mk_chooser')){var nodeLnk=obj.down('a');if(nodeLnk.hasClassName('nodelete')&&nodeLnk.hasClassName('nosub')){hideActionButton=true;}}
if(hideActionButton){if($(treePrefix+'_actionbutton'))$(treePrefix+'_actionbutton').setStyle({visibility:'hidden'});}else{if($(treePrefix+'_actionbutton')&&$(treePrefix+'_actionbutton').down('.exec')&&$(treePrefix+'_actionbutton').down('.exec').getStyle("display")!="none"){obj.ondblclick=$(treePrefix+'_actionbutton').down('.exec').onclick;obj.observe("dblclick",function(ev){Event.stop(ev);});}
if($(treePrefix+'_actionbutton'))$(treePrefix+'_actionbutton').setStyle({visibility:''});}}else if(file=="thumbview"){obj.previous().setStyle({top:(topOffset+3)+'px',left:(leftOffset+obj.getWidth()-22)+'px'});}else if(file=="tableview"){tablewidth=obj.up('table').getWidth();var winRef=ywindowinnerRef.up('.ywindow');var obj_width=obj.getWidth();var box_width=ywindowinnerRef.getWidth();if(tablewidth<winWidth){var leftPos=tablewidth-20;}else{var leftPos=winWidth-9;if($K.scrollbars[scrid].maxY>0){leftPos-=11;}}
obj.down(1).setStyle({top:(topOffset+3)+'px',left:leftPos+'px'});}}}
$K.yg_hoverActions=function(obj){obj=$(obj);$('yg_fileHint').hide();if(!Object.isUndefined(obj.up().reference)){var lnk=obj.up().reference.down('a');if(obj.next().down('.del')){if(lnk.className.indexOf('nowrite')!=-1){if(obj.next().down('.moveto'))obj.next().down('.moveto').style.display='none';if(obj.next().down('.up'))obj.next().down('.up').style.display='none';if(obj.next().down('.down'))obj.next().down('.down').style.display='none';}else{if(obj.next().down('.moveto'))obj.next().down('.moveto').style.display='block';if(obj.next().down('.up'))obj.next().down('.up').style.display='block';if(obj.next().down('.down'))obj.next().down('.down').style.display='block';}
if(lnk.className.indexOf('nodelete')!=-1){if(obj.next().down('.del'))obj.next().down('.del').style.display='none';}else{if(obj.next().down('.del'))obj.next().down('.del').style.display='block';}
if(lnk.className.indexOf('noedit')!=-1){if(obj.next().down('.edit'))obj.next().down('.edit').style.display='none';}else{if(obj.next().down('.edit'))obj.next().down('.edit').style.display='block';}
if(lnk.className.indexOf('nopreview')!=-1){if(obj.next().down('.preview'))obj.next().down('.preview').style.display='none';}else{if(obj.next().down('.preview'))obj.next().down('.preview').style.display='block';}
if(lnk.className.indexOf('folder')!=-1){if(obj.next().down('.addfolder'))obj.next().down('.addfolder').style.display='block';if(obj.next().down('.add'))obj.next().down('.add').style.display='block';}else{if(obj.next().down('.addfolder'))obj.next().down('.addfolder').style.display='none';if(obj.next().down('.add'))obj.next().down('.add').style.display='none';}
if(lnk.className.indexOf('nosub')!=-1){if(obj.next().down('.addfolder'))obj.next().down('.addfolder').style.display='none';if(obj.next().down('.add'))obj.next().down('.add').style.display='none';}else{if(obj.next().down('.addfolder'))obj.next().down('.addfolder').style.display='block';if(obj.next().down('.add'))obj.next().down('.add').style.display='block';}
if(lnk.className.indexOf('nocopy')!=-1){if(obj.next().down('.copy'))obj.next().down('.copy').style.display='none';}else{if(obj.next().down('.copy'))obj.next().down('.copy').style.display='block';}
if(lnk.hasClassName('root')||lnk.hasClassName('selroot')){$w('preview edit copy moveto down up del').each(function(classToRemove){if(obj.next().down('.'+classToRemove)){obj.next().down('.'+classToRemove).style.display='none';}});}}
obj=$(obj).next();if(obj.down().hasClassName('actionborder')){subs=obj.childElements();}else{if((obj.up('.ywindow').hasClassName('mk_multiselect')&&(lnk.up('.selrow')||lnk.up('.darkselrow')))){obj.down('.multiselect').style.display='block';obj.down('.singleselect').hide();subs=obj.down('.multiselect').childElements();}else{obj.down('.multiselect').hide();obj.down('.singleselect').show();subs=obj.down('.singleselect').childElements();}}
var actionButtonShown=false;subs.each(function(item){if((item.style.display!='none')&&!item.hasClassName('actionborder')){actionButtonShown=true;}});if(actionButtonShown){obj.show();}else{obj.hide();}
acwidth=(subs.length-2)*34+3;obj.setStyle({width:acwidth+'px'});obj.setStyle({left:(acwidth*-1+15)+'px'});}else{obj.next().show();}}
;$K.yg_ipanelSwap=function(obj){if(($K.inherithover==false)&&($K.actionhover==false)){tmpobjhead=obj.down('.panelheader').down();tmpobjcnt=obj.down('.panelcontent');if(tmpobjcnt.getStyle('display')=='none'){tmpobjcnt.setStyle({display:'inline'});tmpobjhead.removeClassName('closed');tmpobjhead.addClassName('opened');tmpobjhead.up().removeClassName('panelheaderclosed');tmpobjcnt.setStyle({display:'block'});}else{tmpobjcnt.setStyle({display:'none'});tmpobjhead.removeClassName('opened');tmpobjhead.addClassName('closed');tmpobjhead.up().addClassName('panelheaderclosed');}
$K.windows[obj.up('.ywindow').id].refresh(obj);$K.yg_showActions(obj);}}
$K.yg_ipanelInherit=function(obj){if(obj.hasClassName('inherit')){obj.removeClassName('inherit');obj.addClassName('noinherit');}else{obj.removeClassName('noinherit');obj.addClassName('inherit');}}
$K.yg_ipanelHighlight=function(obj,action){if(action=="over"){obj.addClassName('ipanelhighlight');$K.actionhover=false;}else{if($K.actionhover!=true)obj.removeClassName('ipanelhighlight');}}
$K.yg_listCollapsSwap=function(obj,ev){$K.yg_fireLateOnChange(true);if(ev)Event.stop(ev);if(obj.hasClassName("closed")){obj.removeClassName('closed');obj.addClassName('opened');}else{obj.removeClassName('opened');obj.addClassName('closed');}
$K.windows[obj.up('.ywindow').id].refresh(obj);$K.yg_showActions(obj);}
;$K.yg_clickindropdown=new Array();$K.yg_dropdownkeydown=false;$K.yg_preactive=false;$K.yg_currentfocusobj=new Array();$K.lastActiveContent=false;var ctrlA_Keycode=97;if(((BrowserDetect.OS=='Windows')||(navigator.appVersion.indexOf('Chrome')!=-1))&&(Prototype.Browser.WebKit||Prototype.Browser.IE)){ctrlA_Keycode=65;}
Koala.mapKey(function(){$K.yg_blockSelectComplete();},'ctrl',ctrlA_Keycode,ctrlA_Keycode);var deleteEvent=$K.defaultKeyEvent;if((BrowserDetect.OS=='Mac')&&Prototype.Browser.WebKit){deleteEvent='keydown';}
Koala.mapKey(function(){if(($K.activeWindow)&&($K.activeWindow.id)){var activeWindowObj=$K.windows[$K.activeWindow.id];if(typeof(activeWindowObj.submit)=='function'){activeWindowObj.submit();}else{return false;}}},'',13,13);Koala.mapKey(function(event){if(!$K.activeWindow)return;var checkArea,actionRef,actionFunction;var activeWindowObj=$K.windows[$K.activeWindow.id];if((activeWindowObj.basetype=='tree')&&($(activeWindowObj.id+'_'+activeWindowObj.tab.toUpperCase()).down('.wdgt_tree'))){checkArea=$($K.activeWindow.id+'_innercontent');if(activeWindowObj.basetype=='tree'){actionFunction=$K.yg_deleteElement;actionRef=checkArea.down('.selrow');}else{$K.warn('Not implemented yet',$K.Log.INFO);}}else{focusobjs=$K.yg_getFocusObj($($K.activeWindow.id+'_'+activeWindowObj.tab.toUpperCase()));if(focusobjs.length>0){actionFunction=$K.yg_deleteElement;if(focusobjs[0].up('li')){actionRef=focusobjs[0].up('li');}else if(focusobjs[0].tagName=='TR'){actionRef=focusobjs[0];}else if(focusobjs[0].tagName=='DIV'){actionRef=focusobjs[0];}}else{$K.log('Not in tab of objects',$K.Log.INFO);}}
if(actionFunction&&actionRef){$K.yg_fireAction(actionFunction,actionRef,event);}},null,46,46,true,deleteEvent);$K.yg_keylistenerRadio={keydown:function(event){if(event.keyCode==32){$K.yg_radioboxSelect(this);}}}
$K.yg_keylistenerCheck={keydown:function(event){if(event.keyCode==32){$K.yg_checkboxSelect(this);}}}
$K.yg_fixDiff=function(input,obj){if(input.up('.ywindow')){boxid=input.up('.ywindow').id;objpos=Position.page(obj);objheight=obj.getHeight();}else{return;}
innerbox=$(boxid+'_ywindowinner');innerboxie=$(boxid+'_ywindowinnerie');innercontentobj=$(boxid+'_innercontent');if(innerbox){innerbox.scrollTop=0;scrollOffset=innercontentobj.positionedOffset()[1];objOffset=obj.cumulativeOffset()[1]-innercontentobj.cumulativeOffset()[1];if((scrollOffset+objOffset)<0){scrollOffset=objOffset*-1+8;}else if((scrollOffset+objOffset)>innerboxie.getHeight()-8){scrollOffset=objOffset*-1-8-objheight+innerboxie.getHeight();}
currentScroll=scrollOffset*-1;if((scrollOffset==0)||($K.scrollbars[boxid].y==scrollOffset)||($(boxid+'_dialogbottom')&&(input.descendantOf($(boxid+'_dialogbottom'))))||(input.up('.ywindowfilter'))||(input.up('.ywindowspecialbottom'))||(input.up('.ywindowfiltercolumn2'))){return;}else{$K.scrollbars[boxid].glideTo(0,currentScroll,100);}}}
$K.yg_formFocus=function(input,type){input.hasFocus=true;if(input.effect!=undefined){input.effect.cancel();input.style.backgroundColor='';input.removeClassName('changed');input.effect=undefined;}
input=$(input);if(type=="textbox"){parentobj=input.up();input.setStyle({backgroundColor:''});parentobj.removeClassName('textboxhover');parentobj.addClassName('textboxfocus');obj=input.up();}else if(type=="radiobox"){input.removeClassName('radioboxhover');input.addClassName('radioboxfocus');obj=input;$K.yg_keylistenerRadio.bkeydown=$K.yg_keylistenerRadio.keydown.bindAsEventListener(input);Event.observe(document,"keydown",$K.yg_keylistenerRadio.bkeydown);}else if(type=="checkbox"){input.removeClassName('checkboxhover');input.addClassName('checkboxfocus');obj=input;$K.yg_keylistenerCheck.bkeydown=$K.yg_keylistenerCheck.keydown.bindAsEventListener(input);Event.observe(document,"keydown",$K.yg_keylistenerCheck.bkeydown);}else if(type=="dropdownbox"){parentobj=input.up(2);if(!(Prototype.Browser.Gecko)){$K.yg_setCaretToEnd(input);}
if(!(parentobj.hasClassName('dropdownboxfocus'))){parentobj.removeClassName('dropdownboxhover');parentobj.addClassName('dropdownboxfocus');}
obj=input;}
$K.yg_fixDiff(input,obj);}
$K.yg_formBlur=function(input,type){if(type=="textbox"){inputobj=input.up();}else if(type=="radiobox"){inputobj=input;Event.stopObserving(document,"keydown",$K.yg_keylistenerRadio.bkeydown);}else if(type=="checkbox"){inputobj=input;Event.stopObserving(document,"keydown",$K.yg_keylistenerCheck.bkeydown);}else if(type=="dropdownbox"){if($K.yg_clickindropdown[input.up(2).id]!=true){inputobj=input.up(2);tmpobj=$(inputobj.id+"_ddlist");tmpobj.hide();}else{inputobj=false;}
if($K.yg_preactive!=false){$K.yg_scrollObjAttr.activeArea=$K.yg_preactive;$K.yg_preactive=false;}}
if(inputobj!=false){inputobj.removeClassName(type+'focus');inputobj.addClassName(type);}
input.hasFocus=false;}
$K.yg_radioboxSelect=function(obj){obj=$(obj);if(obj.readAttribute('disabled')==null){group=obj.up('.radiogroup');groupid=group.readAttribute('value');allradios=group.getElementsByClassName('radiobox');for(i=0;i<allradios.length;i++){tmpobj=allradios[i].down();if(allradios[i].id==obj.id){if(tmpobj.hasClassName('radioboxicon')){tmpobj.addClassName('radioboxiconsel');tmpobj.removeClassName('radioboxicon');}}else{if(tmpobj.hasClassName('radioboxiconsel')){tmpobj.addClassName('radioboxicon');tmpobj.removeClassName('radioboxiconsel');}}}
$(groupid).value=obj.id;}}
$K.yg_checkboxSelect=function(obj,check){if(obj.readAttribute('disabled')==null){input=obj.down('input');tmpobj=obj.down();if(check!=undefined){if(check==true){tmpobj.removeClassName('checkboxicon');tmpobj.addClassName('checkboxiconsel');input.value=1;}else{tmpobj.removeClassName('checkboxiconsel');tmpobj.addClassName('checkboxicon');input.value=0;}}else{if(tmpobj.hasClassName('checkboxicon')){tmpobj.removeClassName('checkboxicon');tmpobj.addClassName('checkboxiconsel');input.value=1;}else{tmpobj.removeClassName('checkboxiconsel');tmpobj.addClassName('checkboxicon');input.value=0;}}
if(input.getAttribute('onchange')){var func=new Function(input.getAttribute('onchange'));func.bind(obj)();}}}
$K.yg_initDropdown=function(obj){obj=$(obj);if(!obj)return;sel=obj.down('.dropdownlist').down('.selected');if(sel){obj.down('input').value=$K.yg_stripFileTag(sel.innerHTML);if(sel.value!=undefined){hiddeninput=obj.down('input',1);if(hiddeninput)hiddeninput.value=sel.value;}}
if(obj.readAttribute("readonly")=="readonly")return;obj.stopObserving();obj.down('.dropdownlist').observe("mouseout",function(){$K.yg_dropdownActivateScroll(this,'out');});obj.down('.dropdownlist').observe("mouseover",function(){$K.yg_dropdownActivateScroll(this,'over');});innerobj=obj.down('.dropdowninner');innerobj.stopObserving();innerobj.observe("mouseup",function(ev){if(ev)Event.stop(ev);$K.yg_clickindropdown[this.up(1).id]=false;});innerobj.observe("mousedown",function(ev){$K.yg_clickindropdown[this.up(1).id]=true;$K.yg_dropdownClick(this.up(1),ev);$K.yg_formHover(this.down(),'dropdownclick','dropdownbox');});innerobj.observe("click",function(ev){if(ev)Event.stop(ev);});inputobj=obj.down('input');inputobj.writeAttribute("readonly","true");inputobj.stopObserving();inputobj.observe("blur",function(){$K.yg_clickindropdown[this.up(1).id]=true;$K.yg_formBlur(this,'dropdownbox');});inputobj.observe("focus",function(){$K.yg_formFocus(this,'dropdownbox');});inputobj.observe("keydown",function(ev){if(!ev)ev=window.event;$K.yg_dropdownKey(this,ev.keyCode,1);if(ev.keyCode!=9)return false;});inputobj.observe("keypress",function(ev){if(!ev)ev=window.event;$K.yg_dropdownKey(this,ev.keyCode,0);if(ev.keyCode!=9)return false;});$K.yg_clickindropdown[obj.id]=false;listcontainer=obj.down('.dropdownlistcontainer');if(listcontainer==undefined)return;listcontainer.stopObserving();listcontainer.observe("mouseup",function(){$K.yg_clickindropdown[this.id.substring(0,this.id.length-7)]=false;return false;});listcontainer.observe("mousedown",function(){$K.yg_clickindropdown[this.id.substring(0,this.id.length-7)]=true;return false;});if(($(obj.id+"_ddlist"))&&($(obj.id+"_ddlist")!=listcontainer)){$(obj.id+"_ddlist").remove();}
if(obj.up('.emeditmode'))listcontainer.addClassName('editmode');listcontainer.id=obj.id+"_ddlist";listcontainer.setStyle({visibility:'visible'});listcontainer.hide();hiddeninput=obj.down('input',1);hiddeninput.name=obj.id;hiddeninput.writeAttribute('name',obj.id);list=listcontainer.down();tmparr=list.childElements();for(i=0;i<tmparr.length;i++){tmparr[i].onclick=function(){inputobj=$($(this).up('.dropdownlistcontainer').id.substring(0,$(this).up('.dropdownlistcontainer').id.length-7)).down('input');$K.yg_dropdownSelect(inputobj.up('.dropdownbox'),this);$K.yg_formHover(inputobj,'dropdownclickclose','dropdown');}.bind(tmparr[i]);}
if(obj.down('.mk_scrollbars')){$K.yg_renderScroll(obj.down('.mk_scrollbars'),obj.id);$K.scrollbars[''+obj.id]=$K.yg_initScrollbars(obj,obj.down('.dropdownlistcontainer'),obj.down('.dropdownlist'),$(obj.id+'_dragbar_v'),$(obj.id+'_track_v'),$(obj.id+'_dragbar_h'),$(obj.id+'_track_h'),0);}}
$K.yg_initTextbox=function(obj){obj=$(obj)
obj.observe("click",function(ev){$K.yg_formHover(this,'click','textbox',ev);});field=obj.down('input');if(!(field)||(field.readAttribute("type")=="hidden")){field=obj.down('textarea');if(field){if(field.readAttribute('yg_autogrow')!="false")$K.yg_setTextareaAutogrow(field.identify());if(field.readAttribute('maxlength')!=null){var evListener=function(ev){return $K.yg_limitTextArea(this,this.readAttribute('maxlength'),ev);};field.observe('keydown',evListener);field.observe('keyup',evListener);field.observe('keypress',evListener);}}else{return;}}
field.observe("focus",function(){$K.yg_formFocus(this,'textbox');});field.observe("blur",function(){$K.yg_formBlur(this,'textbox');});}
$K.yg_initCheckbox=function(obj){obj=$(obj);obj.onselectstart=function(){return false;}
obj.mousedown=function(){return false;}
obj.onclick=function(ev){if(ev)Event.stop(ev);if($(this).readAttribute("readonly")==null){$K.yg_checkboxClick(this);$K.yg_checkboxSelect(this);if($(this).readAttribute("onchange")!=null){eval($(this).readAttribute("onchange"));}}}
obj.onfocus=function(){$K.yg_formFocus(this,'checkbox');}
obj.onblur=function(){$K.yg_formBlur(this,'checkbox');}}
$K.yg_initRadiobox=function(obj){obj=$(obj);obj.onselectstart=function(){return false;}
obj.observe("mousedown",function(){return false;});obj.observe("click",function(ev){if(ev)Event.stop(ev);if($(this).readAttribute("readonly")==null){$K.yg_radioboxClick(this);$K.yg_radioboxSelect(this);if($(this).readAttribute("onchange")!=null){eval($(this).readAttribute("onchange"));}}});obj.observe("focus",function(){$K.yg_formFocus(this,'radiobox');});obj.observe("blur",function(){$K.yg_formBlur(this,'radiobox');});}
$K.yg_stripFileTag=function(string){pos=string.toUpperCase().indexOf('/DIV></DIV>');if(pos!=-1){return string.substring(pos+11,string.length).stripTags();}else{return string.stripTags();}}
$K.yg_dropdownKey=function(obj,code,downswitch){if(downswitch==1)$K.yg_dropdownkeydown=true;if(code==32)$K.yg_dropdownkeydown=false;if(Prototype.Browser.WebKit){if((downswitch==1)&&(code==32)){$K.yg_dropdownkeydown=true;}else{$K.yg_dropdownkeydown=false;}}
if(Prototype.Browser.IE)$K.yg_dropdownkeydown=false;if($K.yg_dropdownkeydown==false){switch(code){case 32:$K.yg_formHover(obj,'dropdownclick','dropdown');break;case 13:if($(obj.up('.dropdownbox').id+"_ddlist").visible()){cursel=$(obj.up(2).id+"_ddlist").down('.hovered');if(!(cursel)){cursel=$(obj.up(2).id+"_ddlist").down('.dropdownlist').down();}
$K.yg_dropdownSelect(obj.up(2),cursel);$K.yg_formHover(obj,'dropdownclickclose','dropdown');}
break;case 38:if($(obj.up('.dropdownbox').id+"_ddlist").visible()){$K.yg_dropdownMove(obj,'up');}else{$K.yg_dropdownSelect(obj.up(2),'up');}
break;case 40:if($(obj.up('.dropdownbox').id+"_ddlist").visible()){$K.yg_dropdownMove(obj,'down');}else{$K.yg_dropdownSelect(obj.up(2),'down');}
break;}}else{$K.yg_dropdownkeydown=false;}}
$K.yg_dropdownClick=function(obj,ev){if(ev)Event.stop(ev);inputobj=obj.down('input');if(!inputobj.readAttribute('disabled'))inputobj.focus();}
$K.yg_checkboxClick=function(obj,ev){if(ev)Event.stop(ev);inputobj=$(obj);try{if(!inputobj.readAttribute('disabled'))inputobj.focus();}catch(e){}}
$K.yg_radioboxClick=function(obj){inputobj=$(obj);try{if(inputobj.readAttribute('disabled')==null)inputobj.focus();}catch(e){}}
$K.yg_dropdownSelect=function(obj,dir,value,nofunction){var cursel,nusel,identifier,color,oldflag;obj=$(obj);if(obj.nodeName=="INPUT"){obj=obj.up('.dropdownbox');}
$K.inDropdownSelect=true;cursel=$($(obj).id+"_ddlist").down('.selected');oldflag=$(obj).down('span.filetype');if(value){var list=$($(obj).id+"_ddlist").down('.dropdownlist').childElements();list.each(function(item){if((item.getAttribute('value')==value)&&(item.getStyle("display")!="none")){nusel=item;throw $break;}});}else{if(dir=='up'){if((cursel.previous())&&(cursel.previous().getStyle("display")!="none"))nusel=cursel.previous();}else if(dir=='down'){if((cursel.next())&&(cursel.next().getStyle("display")!="none"))nusel=cursel.next();}else{nusel=dir;}}
hiddeninput=obj.down('input',1);inputobj=obj.down('input');if(nusel){if(nusel.down('span')){identifier=nusel.down('span').innerHTML;color=nusel.down('span').className;}else{identifier=" ";color="filetype";}
if(cursel)cursel.removeClassName('selected');nusel.removeClassName('onhover');nusel.addClassName('selected');inputobj.value=$K.yg_stripFileTag(nusel.innerHTML);if(identifier&&color&&oldflag){oldflag.update(identifier);oldflag.className=color;}
hiddeninput.value=nusel.readAttribute('value');inputobj.focus();if(inputobj.onchange&&(typeof inputobj.onchange=='function')&&(nofunction!=true)){inputobj.onchange(inputobj);}
if((inputobj.readAttribute('yg_onchange')!=undefined)&&(nofunction!=true)){window.temp_obj=inputobj;eval(inputobj.readAttribute('yg_onchange')+'("'+hiddeninput.value+'", "'+inputobj.readAttribute('yg_seq')+'", window.temp_obj);');window.temp_obj=null;}
returnvar=true;}else{returnvar=false;}
$K.inDropdownSelect=false;if(typeof $K.callStack=='function'){$K.log('Calling delayed function...',$K.Log.INFO);$K.callStack();$K.callStack=null;}
return returnvar;}
$K.yg_dropdownInsert=function(obj,title,value,selected,position){tmpobj=$($(obj).id+"_ddlist").down('.dropdownlist');dentry=document.createElement('div');if(position!='top'){tmpobj.insert({bottom:dentry});}else{tmpobj.insert({top:dentry});}
if(selected==1){if($($(obj).id+"_ddlist").down('.dropdownlist').down('.selected'))$($(obj).id+"_ddlist").down('.dropdownlist').down('.selected').removeClassName('selected');obj.down('.dropdowninner').down('input').value=title;obj.down().next('input').value=value;dentry.className='selected';}
dentry.value=value;dentry.setAttribute('value',value);dentry.appendChild(document.createTextNode(title));dentry.onclick=function(){inputobj=$($(this).up('.dropdownlistcontainer').id.substring(0,$(this).up('.dropdownlistcontainer').id.length-7)).down('input');$K.yg_dropdownSelect(inputobj.up('.dropdownbox'),this);$K.yg_formHover(inputobj,'dropdownclick','dropdown');}.bind(dentry);}
$K.yg_dropdownRemove=function(obj,value){tmpobj=$($(obj).id+"_ddlist").down('.dropdownlist');tmpobj.childElements().each(function(item){if(item.readAttribute('value')==value){if(item.hasClassName('selected')){if(item.next()){item.next().addClassName('selected');$(obj).down('input').value=item.next().readAttribute('value');}else if(item.previous()){item.previous().addClassName('selected');$(obj).down('input').value=item.previous().readAttribute('value');}else{$(obj).down('input').value='';}}
item.remove();}});$K.yg_initDropdown($(obj).id);}
$K.yg_dropdownMove=function(obj,dir){boxobj=obj.up('.dropdownbox');listcontainer=$(boxobj.id+"_ddlist");cursel=listcontainer.down('.hovered');if(!(cursel)){cursel=listcontainer.down('.selected');nusel=cursel;}else{if(dir=="up"){nusel=cursel.previous();}else if(dir=="down"){nusel=cursel.next();}}
if(nusel){cursel.removeClassName('hovered');nusel.addClassName('hovered');nuselpos=Position.page(nusel);listpos=Position.page(listcontainer);nuselheight=nusel.getHeight();listheight=listcontainer.getHeight();offset=listcontainer.down().getStyle('top');offset=parseInt(offset.substring(0,(offset.length-2)));if((nuselpos[1]+nuselheight)>(listpos[1]+listheight)){$K.scrollbars[boxobj.id].glideTo(0,(nuselpos[1]+nuselheight-listpos[1]-listheight-offset),1);}else if(nuselpos[1]<listpos[1]){$K.scrollbars[boxobj.id].glideTo(0,(nuselpos[1]-listpos[1]-offset),1);}}}
$K.yg_formHover=function(input,action,type,ev){if(ev)Event.stop(ev);input=$(input);if(action=="over"){if(!(input.hasClassName(type+'focus'))){input.addClassName(type+'hover');}}else if(action=="out"){input.removeClassName(type+'hover');}else if(action=="click"){input.removeClassName(type+'hover');focusable=input.down('input');if((focusable)&&(focusable.readAttribute('type')!="hidden")){focusable.focus();}else{tmpobj=input.down('textarea');if(tmpobj){if(tmpobj.readAttribute('disabled')==null)tmpobj.focus();}}}else if((action=="dropdownclick")||(action=="dropdownclickclose")){if(input.readAttribute('disabled')==null){if(input.up(2)){obj=$(input.up(2).id+"_ddlist");if((action=="dropdownclick")&&(obj.visible()))action="dropdownclickclose";if((action=="dropdownclickclose")&&(obj)){obj.hide();input.up(2).insert(obj);cursel=obj.up('.dropdownbox').down('.hovered');if(cursel)cursel.removeClassName('hovered');if($K.yg_preactive!=false){$K.yg_scrollObjAttr.activeArea=$K.yg_preactive;$K.yg_preactive=false;}}else if(obj){tmpwin=$(obj).up('.ywindow');if(tmpwin){curzIndex=$(obj).up('.ywindow').getStyle('z-index');tmpcontainer=$(obj).up('.ywindow');}else{tmpcontainer=document.body;curzIndex=100000;}
obj.setStyle({zIndex:(curzIndex+2)});obj.down('.scrollbar_v').setStyle({zIndex:(curzIndex+3)});obj.down('.scrollbar_h').setStyle({zIndex:(curzIndex+3)});tmpcontainer.insert({bottom:obj});pos=input.up().viewportOffset();if(input.up('.ywindow')){difpos=$(input.up('.ywindow')).viewportOffset();pos[0]-=difpos[0];pos[1]-=difpos[1];}
obj.show();obj.setStyle({left:pos[0]+'px'});obj.setStyle({top:pos[1]+input.getHeight()+'px'});if(Prototype.Browser.IE){obj.setStyle({width:(input.getWidth()+13)+'px'});}else{obj.setStyle({width:(input.getWidth()+14)+'px'});}
list=obj.down('.dropdownlist');listcontainer=list.up();listcontainer.setStyle({height:'140px'});tmparr=list.immediateDescendants();listheight=tmparr.length*16;if(listheight<listcontainer.getHeight()){if((Prototype.Browser.IE)&&(BrowserDetect.version==7))listheight+=tmparr.length;listcontainer.setStyle({height:listheight+'px'});}
if($K.scrollbars[input.up(2).id])$K.scrollbars[input.up(2).id].setBarSize();$K.yg_preactive=$K.yg_scrollObjAttr.activeArea;setTimeout("$K.yg_scrollObjAttr.activeArea='"+input.up(2).id+"';",50);$K.yg_scrollObjAttr.activeArea=input.up(2).id;input.up(2).observe('mouseover',function(ev){$K.yg_scrollObjAttr.activeArea=this.id;if(ev)Event.stop(ev);});}}}}}
$K.yg_removefromFocus=function(obj){for(var i=0;i<$K.yg_currentfocusobj.length;i++){if(($K.yg_currentfocusobj[i]==obj)||($K.yg_currentfocusobj[i].descendantOf(obj))){$K.yg_blockUnmark($K.yg_currentfocusobj[i]);$K.yg_currentfocusobj.splice(i,1);}}}
$K.yg_getSelectables=function(obj){var tmparr=new Array();if(obj.hasClassName('mk_contentgroup')){pcontent=obj;}else{pcontent=obj.up('.mk_contentgroup');}
contenttab=false;dropstack=false;list=false;table=false;tmpobj=true;if((pcontent!=undefined)&&(pcontent.readAttribute('yg_multiselect')=="true")){tmparr=pcontent.down('ul');var i=0;if(tmparr!=undefined){list=true;tmparr=new Array();tmpobjprev=false;tmpcontainer=pcontent.down('ul');while(tmpobj!=undefined){tmpobj=pcontent.down('ul',i);if(tmpobj!=undefined){i++;if(((tmpobjprev)&&(tmpobj.descendantOf(tmpobjprev)==false))||(tmpobjprev==false)){tmpobjprev=tmpobj;tmpobj=tmpobjprev.immediateDescendants();tmpobj.each(function(item){if(item!=undefined){if((item.hasClassName('mk_dummy')==false)&&(item.tagName!='INPUT')){if(tmpcontainer.hasClassName('page_contentarea')){tmparr.push($(item).down());contenttab=true;}else if(pcontent.hasClassName('mk_thumbcontainer')){tmparr.push($(item).down().next());list=false;}else{if(item.visible())tmparr.push($(item).down(1).next());}}}});}}}}else if(pcontent.down('.ytable')&&(pcontent.down('.tableborder').getStyle('display')!="none")){tmparr=pcontent.down('.ytable').down('tbody').immediateDescendants();table=true;}else{tmparr=pcontent.immediateDescendants();list=false;}
arrOut=new Array();for(var i=0;i<tmparr.length;i++){if((tmparr[i].nodeName!="INPUT")&&(!tmparr[i].hasClassName("mk_dummy"))&&(tmparr[i].visible())){arrOut.push(tmparr[i]);}}}
return arrOut;}
$K.yg_doubleClickTime=0;$K.yg_doubleClickObj=false;$K.yg_blockSelect=function(obj,event){if(!obj)return;$K.yg_clearTextSelection();if(Boolean(obj.readAttribute('yg_selectable'))==false)return false;if(event){var clickedElement=Event.findElement(event);if((clickedElement.tagName=='A')&&clickedElement.up('.actionhover')){return;}}
$K.yg_fixCurrentFocusObjects();var pcontent=obj.up('.mk_contentgroup');$K.lastActiveContent=pcontent;var focussedobjects=$K.yg_getFocusObj(pcontent);obj=$(obj);shiftpressed=false;controlpressed=false;if(event){if(event&&event.preventDefault)event.preventDefault();if(event.shiftKey)shiftpressed=true;if(BrowserDetect.OS=="Mac"){if(event.metaKey)controlpressed=true;}else{if(event.ctrlKey)controlpressed=true;}}
var d=new Date();var now=d.getTime();var doubleclick=false;if(((now-$K.yg_doubleClickTime)<400)&&($K.yg_doubleClickObj==obj)){eval(obj.readAttribute('ondoubleclick'));doubleclick=true;}else{$K.yg_doubleClickTime=now;$K.yg_doubleClickObj=obj;}
multiselecting=false;if(((controlpressed==true)||(shiftpressed==true))&&(focussedobjects.length>0)){if((pcontent)&&(pcontent.readAttribute('yg_multiselect')=="true")){multiselecting=true;}}
alreadyselected=false;for(i=0;i<focussedobjects.length;i++){if((focussedobjects[i]==obj)&&(doubleclick==false)){focusfield=$K.yg_getActiveElement();if(focusfield)focusfield.blur();alreadyselected=true;}}
if(controlpressed==true){if(multiselecting==true){if(alreadyselected==false){$K.yg_currentfocusobj.push(obj);$K.yg_blockMark(obj);}else{$K.yg_removefromFocus(obj);}}}else if(shiftpressed==true){if(multiselecting==true){var tmparr=$K.yg_getSelectables(obj);first=-1;for(i=(tmparr.length-1);i>-1;i--){tmpobj=tmparr[i];if(first==-1){for(j=0;j<focussedobjects.length;j++){if(tmpobj==focussedobjects[j]){first=i;}}}}
last=-1;for(i=0;i<tmparr.length;i++){tmpobj=tmparr[i];if(last==-1){for(j=0;j<focussedobjects.length;j++){if(tmpobj==focussedobjects[j]){last=i;}}}}
var clicked;for(i=0;i<tmparr.length;i++){tmpobj=tmparr[i];if(tmpobj==obj){clicked=i;}}
$K.yg_blockdeSelect(pcontent);if(clicked<=first){last=first;first=clicked;}else if(clicked>=last){first=last;last=clicked;}
for(var i=first;i<(last+1);i++){tmpobj=tmparr[i];if(tmpobj){$K.yg_currentfocusobj.push(tmpobj);$K.yg_blockMark(tmpobj);}}}}
if(multiselecting==false){if(alreadyselected==false){$K.yg_blockdeSelect(pcontent);$K.yg_currentfocusobj.push(obj);$K.yg_blockMark(obj);}else{var navList=false;if(obj.up('.mk_navpanel'))navList=true;if(!navList){$K.yg_blockdeSelect(pcontent);if(focussedobjects.length>1){$K.yg_currentfocusobj.push(obj);$K.yg_blockMark(obj);}}}}
if(pcontent&&($K.yg_getFocusObj(pcontent).length>1)){pcontent.addClassName('mk_multiselect');}else if(pcontent&&($K.yg_getFocusObj(pcontent).length>0)){pcontent.removeClassName('mk_multiselect');}}
$K.yg_getFocusObj=function(obj){var focusarr=new Array();$K.yg_currentfocusobj.each(function(item){if(item&&item.descendantOf(obj))focusarr.push(item);});return focusarr;}
$K.yg_clearTextSelection=function(){if(document.selection&&document.selection.empty){try{document.selection.empty();}catch(error){}}else if(window.getSelection){var sel=window.getSelection();try{sel.removeAllRanges();}catch(e){}}}
$K.yg_blockSelectComplete=function(){$K.yg_clearTextSelection();var tmparr=new Array();pcontent=$($K.lastActiveContent);if((pcontent)&&(pcontent.readAttribute('yg_multiselect')=="true")){tmparr=$K.yg_getSelectables(pcontent);$K.yg_blockdeSelect(pcontent);for(var i=0;i<(tmparr.length);i++){tmpobj=tmparr[i];if((tmpobj)&&(tmpobj.readAttribute('yg_selectable')=="true")){$K.yg_currentfocusobj.push(tmpobj);$K.yg_blockMark(tmpobj);}}
pcontent.addClassName('multiselect');if($K.windows[obj.up('.ywindow').id])$K.windows[obj.up('.ywindow').id].refresh(obj);}
$K.yg_toggleTreeButtons(obj.up('.ywindow').id);}
$K.yg_blockMark=function(obj){if(obj.hasClassName('cntblockcontainer'))obj=obj.down().next();if(!obj)return;if(obj.hasClassName('cbcontainer')){obj.removeClassName('cbcontainer');obj.addClassName('cbcontainerfocus');}else if(obj.hasClassName('cntblockselection')){obj.removeClassName('cntblockselection');obj.addClassName('cntblockselectionfocus');}else if(obj.hasClassName('listitempage')){obj.removeClassName('listitempage');obj.addClassName('listitempagefocus');}else if(obj.hasClassName('cntblock')){obj.removeClassName('cntblock');obj.addClassName('cntblockfocus');}else if(obj.hasClassName('cntblockselectionlist')){obj.removeClassName('cntblockselectionlist');obj.addClassName('cntblockselectionlistfocus');}else if(obj.hasClassName('emcontainer')){obj.removeClassName('emcontainer');obj.addClassName('emcontainerfocus');}else if(obj.hasClassName('cntblockversionsjump')){obj.removeClassName('cntblockversionsjump');obj.addClassName('cntblockversionsjumpfocus');}
if(obj.previous()&&obj.previous().hasClassName('actions')){obj.up().addClassName('mk_selected');}else{obj.addClassName('mk_selected');}}
$K.yg_blockUnmark=function(obj){if(obj.hasClassName('cntblockcontainer'))obj=obj.down().next();if((!obj)||(obj==null))return;if(obj.hasClassName('cbcontainerfocus')){obj.removeClassName('cbcontainerfocus');obj.addClassName('cbcontainer');}else if(obj.hasClassName('cntblockfocus')){obj.removeClassName('cntblockfocus');obj.addClassName('cntblock');}else if(obj.hasClassName('cntblockselectionfocus')){obj.removeClassName('cntblockselectionfocus');obj.addClassName('cntblockselection');}else if(obj.hasClassName('listitempagefocus')){obj.removeClassName('listitempagefocus');obj.addClassName('listitempage');}else if(obj.hasClassName('cntblockselectionlistfocus')){obj.removeClassName('cntblockselectionlistfocus');obj.addClassName('cntblockselectionlist');}else if(obj.hasClassName('emcontainerfocus')){obj.removeClassName('emcontainerfocus');obj.addClassName('emcontainer');tmpobj=obj.down('.checkarray');}else if(obj.hasClassName('cntblockversionsjumpfocus')){obj.removeClassName('cntblockversionsjumpfocus');obj.addClassName('cntblockversionsjump');}
if(obj.previous()&&obj.previous().hasClassName('actions')){obj.up().removeClassName('mk_selected');}else{obj.removeClassName('mk_selected');}}
$K.yg_blockdeSelect=function(parentobj){focussedobj=$K.yg_getFocusObj(parentobj);for(i=0;i<(focussedobj.length);i++){$K.yg_removefromFocus(focussedobj[i]);}}
$K.yg_blockFocus=function(obj){obj=$(obj);focusobj=false;focusfield=$K.yg_getActiveElement();if((focusfield==false)||((focusfield.up('.cntblock')!=obj)&&(focusfield.up('.cntblockfocus')!=obj))){if(focusfield)focusfield.blur();if(obj.down('input')){tmpobj=obj.down('input');if(tmpobj.readAttribute('type')=="hidden"){tmptmpobj=tmpobj.up().down('.radiobox');if((tmptmpobj)&&(tmptmpobj.readAttribute('disabled')==null)){focusobj=tmptmpobj;if(Prototype.Browser.WebKit){obj.removeClassName('cntblock');obj.addClassName('cntblockfocus');}}else{tmpobj=tmpobj.up(2).down('.checkbox');if((tmpobj)&&(tmpobj.readAttribute('disabled')==null)){focusobj=tmpobj;}}}else{tmpobj=obj.down('input');if((tmpobj)&&(tmpobj.readAttribute('disabled')==null))focusobj=tmpobj;}}else{tmpobj=obj.down('textarea');if((tmpobj)&&(tmpobj.readAttribute('disabled')==null))focusobj=tmpobj;}
if(focusobj!=false){if($K.yg_currentfocusobj.length<2)focusobj.focus();}}}
$K.yg_removeSearchEntry=function(obj,boxid){obj.remove();$K.windows[boxid].init(null,null,false,true,1);}
$K.yg_dropdownActivateScroll=function(obj,dir){if(dir=="over"){obj=$(obj);cont=$(obj.id+"_ddlist");if((cont)&&(cont.visible())){if($K.yg_scrollObjAttr.activeArea!=obj.id){$K.yg_preactive=$K.yg_scrollObjAttr.activeArea;$K.yg_scrollObjAttr.activeArea=obj.id;}}}else{if($K.yg_scrollObjAttr.activeArea==obj.id){if($K.yg_preactive!=false){$K.yg_scrollObjAttr.activeArea=$K.yg_preactive;$K.yg_preactive=false;}}}}
$K.yg_setSelectionRange=function(input,selectionStart,selectionEnd){if(input.setSelectionRange){input.focus();input.setSelectionRange(selectionStart,selectionEnd);}else if(input.createTextRange){var range=input.createTextRange();range.collapse(true);range.moveEnd('character',selectionEnd);range.moveStart('character',selectionStart);range.select();}}
$K.yg_setCaretToEnd=function(input){$K.yg_setSelectionRange(input,input.value.length,input.value.length);}
$K.yg_fadeField=function(input){input.removeClassName('changed');input.setStyle({backgroundColor:'#e6fcb3'});if((input.up('.dropdownbox'))||(input.up('.textboxfocus'))){endcolorvar='#e6feff';}else if((input.type)&&((input.type=="textarea")||(input.type=="text"))){if((input.descendantOf('dialogcontainer'))&&((input.up('.emcontentinner')==undefined))){endcolorvar='#252D23';}else if(input.up('.emcontentinner')!=undefined){endcolorvar='#EFF0EB';}else{endcolorvar='#ffffff';}}else if((input.descendantOf('dialogcontainer'))&&((input.up('.emcontentinner')==undefined))){endcolorvar='#252D23';}else if(input.up('.emcontentinner')!=undefined){endcolorvar='#ffffff';}else{endcolorvar='#F4F4F0';}
input.effect=new Effect.Highlight(input,{startcolor:'#e6fcb3',endcolor:endcolorvar,restorecolor:'false',duration:0.5,beforeStart:function(){},afterFinish:function(){input.removeClassName('changed');input.setStyle({backgroundColor:''});}});}
$K.yg_fadeFields=function(container,cssFilter,cssFilter2,cssFilter3){if(cssFilter2&&cssFilter3){var fields=container.select(cssFilter,cssFilter2,cssFilter3);}else if(cssFilter2){var fields=container.select(cssFilter,cssFilter2);}else{var fields=container.select(cssFilter);}
fields.each(function(item){$K.yg_fadeField(item);});}
$K.yg_saveWYSIWYG=function(input){$K.yg_editControl(input,'3');}
$K.yg_removeWYSIWYGControl=function(which){if(tinyMCE&&tinyMCE.editors[which]){$K.log(tinyMCE.editors[which],$K.Log.INFO);delete tinyMCE.editors[which];}}
$K.yg_limitTextArea=function(which,maxlen,event){if(!maxlen)maxlen=0;maxlen=parseInt(maxlen);if((maxlen!=0)&&(which.value.length>maxlen)){which.value=which.value.substring(0,maxlen);}
if(((event.keyCode>=37)&&(event.keyCode<=40))||(event.keyCode==8)||(event.keyCode==46)||(event.keyCode==35)||(event.keyCode==36)||(isNaN(maxlen))||(maxlen==0)||(event.ctrlKey)||(event.metaKey)||(event.altKey)){return;}
$K.log('keyCode was: ',event.keyCode,$K.Log.DEBUG);return(which.value.length<=(maxlen-1));}
$K.yg_cleanStyles=function(){$K.yg_cleanWindows();if($('placeHolder'))$('placeHolder').hide();return;for(var i in $K.yg_idlookuptable){for(var j=0;j<$K.yg_idlookuptable[i].length;j++){var element=$($K.yg_idlookuptable[i][j]);if(Object.isUndefined(element.tagName)){element=$($K.yg_idlookuptable[i][j].id);}
if(!Object.isUndefined(element.capt)){element.removeClassName('error');}else
if(element.hasClassName('dropdownbox')){element.down('input').removeClassName('error');}else
element.removeClassName('error');}}}
$K.yg_initCalendar=function(calendarRef){calendarRef=$(calendarRef);var pastAvailable=false;if(calendarRef.readAttribute('pastavailable')=='true'){pastAvailable=true;}
var calIdx=calendarRef.identify();var dateFormat=calendarRef.readAttribute('format');var targetFieldRef=$(calendarRef.readAttribute('targetfield'));var targetAnchorRef=new Element('a',{id:calIdx+'_anchor',name:calIdx+'_anchor'});targetFieldRef.insert({after:targetAnchorRef});calendarRef.observe('click',function(e){$K.yg_calendars[calIdx].select(targetFieldRef,targetAnchorRef.identify(),dateFormat);Event.stop(e);return false;});$K.yg_calendars[calIdx]=new CalendarPopup('yg_caldiv');$K.yg_calendars[calIdx].showNavigationDropdowns();$K.yg_calendars[calIdx].setMonthNames($K.TXT('TXT_JANUARY'),$K.TXT('TXT_FEBRUARY'),$K.TXT('TXT_MARCH'),$K.TXT('TXT_APRIL'),$K.TXT('TXT_MAY'),$K.TXT('TXT_JUNE'),$K.TXT('TXT_JULY'),$K.TXT('TXT_AUGUST'),$K.TXT('TXT_SEPTEMBER'),$K.TXT('TXT_OCTOBER'),$K.TXT('TXT_NOVEMBER'),$K.TXT('TXT_DECEMBER'));$K.yg_calendars[calIdx].setDayHeaders($K.TXT('TXT_SUNDAY_ABBR'),$K.TXT('TXT_MONDAY_ABBR'),$K.TXT('TXT_TUESDAY_ABBR'),$K.TXT('TXT_WEDNESDAY_ABBR'),$K.TXT('TXT_THURSDAY_ABBR'),$K.TXT('TXT_FRIDAY_ABBR'),$K.TXT('TXT_SATURDAY_ABBR'));var weekStart=0;if($K.userSettings.weekStart){weekStart=$K.userSettings.weekStart;}
$K.yg_calendars[calIdx].setWeekStartDay(weekStart);$K.yg_calendars[calIdx].setCssPrefix('yg_');$K.yg_calendars[calIdx].offsetX=0;$K.yg_calendars[calIdx].offsetY=0;if(Prototype.Browser.IE){$K.yg_calendars[calIdx].offsetX=-270;$K.yg_calendars[calIdx].offsetY=-5;}
$K.yg_calendars[calIdx].yearSelectStartOffset=15;now=new Date();yesterday=new Date(Date.parse(now)-(86400*1000));if(pastAvailable!=true)$K.yg_calendars[calIdx].addDisabledDates(null,formatDate(yesterday,'yyyy-MM-dd'));calendarRef.inited=true;}
$K.yg_checkDate=function(value,format,seperator){var checkstr='0123456789';var Datevalue='';var DateTemp='';var day;var month;var year;var leap=0;var err=0;var i;var dayPosition,monthPosition,yearPosition;var tmpValue=value;tmpValue=tmpValue.split(seperator);if(tmpValue.length<2){return'';}
if(tmpValue[0].length!=2){tmpValue[0]='0'.times(2-tmpValue[0].length)+tmpValue[0];}
if(tmpValue[1].length!=2){tmpValue[1]='0'.times(2-tmpValue[1].length)+tmpValue[1];}
value=tmpValue.join(seperator);format=format.toLowerCase().replace(/[^A-Za-z0-9]/g,'');if(format.length==6){format=format.replace(/yy/,'yyyy');}
if(format.length!=8){err=19;}
dayPosition=format.indexOf('dd');monthPosition=format.indexOf('mm');yearPosition=format.indexOf('yyyy');DateValue=value;for(i=0;i<DateValue.length;i++){if(checkstr.indexOf(DateValue.substr(i,1))>=0){DateTemp=DateTemp+DateValue.substr(i,1);}}
DateValue=DateTemp;if(DateValue.length==6){DateValue=DateValue.substr(0,yearPosition)+'20'+DateValue.substr(yearPosition,2);}
if(DateValue.length!=8){err=19;}
year=DateValue.substr(yearPosition,4);if(year==0){err=20;}
month=DateValue.substr(monthPosition,2);if((month<1)||(month>12)){err=21;}
day=DateValue.substr(dayPosition,2);if(day<1){err=22;}
if((year%4==0)||(year%100==0)||(year%400==0)){leap=1;}
if((month==2)&&(leap==1)&&(day>29)){err=23;}
if((month==2)&&(leap!=1)&&(day>28)){err=24;}
if((day>31)&&((month=='01')||(month=='03')||(month=='05')||(month=='07')||(month=='08')||(month=='10')||(month=='12'))){err=25;}
if((day>30)&&((month=='04')||(month=='06')||(month=='09')||(month=='11'))){err=26;}
if((day==0)&&(month==0)&&(year==00)){err=0;day='';month='';year='';seperator='';}
if(err==0){return day+seperator+month+seperator+year;}
else{return false;}}
$K.yg_checkField=function(element,parameters){var result=true;element.removeClassName('error');switch(parameters.type){case'integer':var min=parameters.min;var max=parameters.max;if((parseInt(element.value)!=element.value)||(parseInt(element.value)<min)||(parseInt(element.value)>max)){element.addClassName('error');result=false;}
break;case'date':if(parameters.format!=''){var seperator=parameters.format.replace(/\w+/g,'').substring(0,1);var dateCheckResult=$K.yg_checkDate(element.value,parameters.format,seperator);if(dateCheckResult==false){element.addClassName('error');result=false;}else{element.value=dateCheckResult;if(parameters.nodatesinpast==true){var dayPosition=parameters.format.toLowerCase().split(seperator).indexOf('dd');var monthPosition=parameters.format.toLowerCase().split(seperator).indexOf('mm');var yearPosition=parameters.format.toLowerCase().split(seperator).indexOf('yy');if(yearPosition==-1){yearPosition=parameters.format.toLowerCase().split(seperator).indexOf('yyyy');}
var now=new Date();var check_day=parseInt(element.value.split(seperator)[dayPosition],10);var check_month=parseInt(element.value.split(seperator)[monthPosition],10);if(element.value.split(seperator)[yearPosition].length==2){var check_year=parseInt(element.value.split(seperator)[yearPosition],10)+2000;}else{var check_year=parseInt(element.value.split(seperator)[yearPosition],10);}
var yesterday=new Date(Date.parse(now)-(86400*1000));yesterday=new Date(yesterday.getFullYear(),yesterday.getMonth(),yesterday.getDate(),0,0,0);var check_date=new Date(check_year,check_month-1,check_day,0,0,0);if(check_date<=yesterday){element.addClassName('error');result=false;}}}}
break;case'time':switch(parameters.format){case'12':var hour=element.value.split(':')[0];var minute=element.value.split(':')[1].split(' ')[0];var identifier=element.value.split(':')[1].split(' ')[1];if((hour.length<1)||(hour.length>2)){element.addClassName('error');result=false;}
if((minute.length<1)||(minute.length>2)){element.addClassName('error');result=false;}
if(!$K.yg_IsNumeric(hour)||!$K.yg_IsNumeric(minute)){element.addClassName('error');result=false;}
if((hour<1)||(hour>12)){element.addClassName('error');result=false;}
if((minute<0)||(hour>59)){element.addClassName('error');result=false;}
if((identifier!='am')&&(identifier!='pm')){element.addClassName('error');result=false;}
break;case'24':var hour=element.value.split(':')[0];var minute=element.value.split(':')[1];if((hour.length<1)||(hour.length>2)){element.addClassName('error');result=false;}
if(minute&&((minute.length<1)||(minute.length>2))){element.addClassName('error');result=false;}
if(!$K.yg_IsNumeric(hour)||!$K.yg_IsNumeric(minute)){element.addClassName('error');result=false;}
if((hour<0)||(hour>23)){element.addClassName('error');result=false;}
if((minute<0)||(hour>59)){element.addClassName('error');result=false;}
break;}
break;}
if(parameters.emptyallowed&&(element.value=='')){element.removeClassName('error');}
return result;}
$K.yg_sortEntry=function(which,dir){var classes=which.className.split(" ");var classx='';classes.each(function(item){if(item.indexOf('mk_')>-1){classx='.'+item;throw $break;}});elems=$$('#'+which.up().identify()+' li'+classx);for(var i=0;i<elems.length;i++){if(elems[i]==which){if(elems[i+dir]){if(dir==-1){elems[i+dir].insert({before:which});}else{elems[i+dir].insert({after:which});}}}}
$K.yg_showHelp(false);}
$K.yg_setTextareaAutogrow=function(which){which=$(which);if(!which)return;if(which.getWidth()<=0)return;which.autogrow={dummy:null,interval:null,line_height:parseInt(which.getStyle('line-height')),min_height:parseInt(which.getStyle('min-height')),max_height:parseInt(which.getStyle('max-height'))}
if(isNaN(which.autogrow.line_height)){which.autogrow.line_height=0;}
var startExpand=function(){which.autogrow.interval=window.setInterval(function(){checkExpand()},400);}
var stopExpand=function(){clearInterval(which.autogrow.interval);}
var checkExpand=function(){if(which.autogrow.dummy==null){which.autogrow.dummy=document.createElement('DIV');$(document.body).insert({bottom:which.autogrow.dummy});$(which.autogrow.dummy).setStyle({fontSize:which.getStyle('font-size'),fontFamily:which.getStyle('font-family'),width:which.getWidth()+'px',padding:which.getStyle('padding'),lineHeight:which.autogrow.line_height+'px',overflowX:'hidden',position:'absolute',top:'0px',left:'-9999px',wordWrap:'break-word',lineBreak:'strict',backgroundColor:'#cccccc',border:'solid 2px #ff0000'});}
var html=which.value.escapeHTML();html=html.replace(/\t/g,'    ').replace(/  /g,'&nbsp; ').replace(/  /g,' &nbsp;');if(Prototype.Browser.IE){html=html.replace(/\n/g,'<BR>new');}else{html=html.replace(/\n/g,'<br>new');}
if(which.autogrow.dummy.innerHTML!=html){which.autogrow.dummy.innerHTML=html;if(!which.parentWin){if(which.up('.ywindow')){which.parentWin=which.up('.ywindow');var windowId=which.up('.ywindow').id;$K.windows[windowId].refresh(which);}}else{if(which.parentWin){var windowId=which.parentWin.id;$K.windows[windowId].refresh(which);}}
if(which.autogrow.max_height>0&&(which.autogrow.dummy.getHeight()+which.autogrow.line_height>which.autogrow.max_height)){which.setStyle({overflowY:'auto'});}else{which.setStyle({overflowY:'hidden'});if(which.getHeight()<which.autogrow.dummy.getHeight()+which.autogrow.line_height||(which.autogrow.dummy.getHeight()<which.getHeight())){new Effect.Morph(which,{style:{height:which.autogrow.dummy.getHeight()+which.autogrow.line_height+'px'},duration:0.1,afterFinish:function(){if(which.parentWin){var windowId=which.parentWin.id;$K.windows[windowId].refresh(which);}}});}}}}
which.setStyle({overflow:'hidden',display:'block'});which.stopObserving('focus',startExpand);which.stopObserving('blur',stopExpand);which.observe('focus',startExpand);which.observe('blur',stopExpand);checkExpand();which.autogrow.checkExpand=checkExpand;}
$K.yg_pickTime=function(obj,format){$K.yg_customAttributeHandler($('yg_timediv'));$K.bCloser['yg_timediv']=$K.yg_clickCloser.bindAsEventListener($('yg_timediv'));Event.observe(document,'click',function(e){var target=(e.target)?(e.target):(e.srcElement);if(!target.descendantOf($('yg_timediv'))&&(typeof $K.bCloser['yg_timediv']=='function')){$K.bCloser['yg_timediv'](e);$K.yg_pickTimeChange();}});$K.yg_pickTimeObj=obj;timevar=obj.value;if(format==12){$('yg_timediv').addClassName("yg12h");$('yg_timediv_hh_ddlist').addClassName("yg12h");ampmvar=timevar.split(" ");if((ampmvar[1]==undefined)||(ampmvar[1].toUpperCase()!="AM")&&(ampmvar[1].toUpperCase()!="PM")){ampmvar="am";}else{timevar=ampmvar[0];ampmvar=ampmvar[1];}
$K.yg_dropdownSelect($('yg_timediv_ampm'),false,ampmvar,true);}else{$('yg_timediv').removeClassName("yg12h");$('yg_timediv_hh_ddlist').removeClassName("yg12h");}
timevar=timevar.split(":");if(timevar.length!=2){hhvar=mmvar="";mmvar="";}else{hhvar=timevar[0];mmvar=timevar[1];}
objpos=$(obj).cumulativeOffset();$('yg_timediv').setStyle({left:(objpos[0]+70)+'px'});$('yg_timediv').setStyle({top:(objpos[1]-18)+'px'});$('yg_timediv').setStyle({display:'block'});if($K.yg_dropdownSelect($('yg_timediv_hh'),false,hhvar.toString(),true)==false){if(format==12){$K.yg_dropdownSelect($('yg_timediv_hh'),false,"12",true);}else{$K.yg_dropdownSelect($('yg_timediv_hh'),false,"00",true);}}
if($K.yg_dropdownSelect($('yg_timediv_mm'),false,mmvar.toString(),true)==false){$K.yg_dropdownSelect($('yg_timediv_mm'),false,"00",true);}}
$K.yg_pickTimeChange=function(){if($('yg_timediv').hasClassName('yg12h')){var format=12}else{var format=24}
var hh=$('yg_timediv_hh').down('input',1).value;var mm=$('yg_timediv_mm').down('input',1).value;var timestring=hh+":"+mm;if(format==12){timestring+=" "+$('yg_timediv_ampm').down('input',1).value;}
$K.yg_pickTimeObj.value=timestring;if(typeof $K.yg_pickTimeObj.onchange=='function')$K.yg_pickTimeObj.onchange();$('yg_timediv_hh_ddlist').hide();$('yg_timediv_mm_ddlist').hide();$K.yg_pickTimeObj.blur();}
;$K.yg_hoverInt=false;$K.yg_hoverTagInt=false;$K.yg_hoverTagObj=false;$K.yg_pickTimeObj=false;$K.yg_hoverUserObj=false;$K.bCloser=new Array();$K.yg_hoverTagHint=function(obj,id){clearTimeout($K.yg_hoverTagInt);$K.yg_hoverTagObj=$(obj);$K.yg_hoverTagInt=setTimeout('$K.yg_showTagHint('+id+');',1000);Event.observe(obj,'mouseleave',$K.yg_hideTagHint);}
$K.yg_showTagHint=function(id){clearTimeout($K.yg_hoverTagInt);var rawPath=$K.yg_hoverTagObj.readAttribute('path');var realPath='';rawPath=rawPath.split('||');rawPath.each(function(pathItem,pathIdx){if(pathIdx!=(rawPath.length-1)){pathItem+=' <span class="traceicon"></span> ';}
realPath+='<nobr>'+pathItem+'</nobr> ';});$('yg_tagHint').innerHTML=realPath;$('yg_tagHint').setStyle({display:'block'});objpos=$($K.yg_hoverTagObj).cumulativeOffset();$('yg_tagHint').setStyle({top:(objpos[1]+18)+'px'});$K.yg_positionTagHint()
Event.observe($($K.yg_hoverTagObj),'mousemove',$K.yg_positionTagHint);}
$K.yg_hideTagHint=function(){clearTimeout($K.yg_hoverTagInt);$('yg_tagHint').setStyle({display:'none'});Event.stopObserving(obj,'mouseleave',$K.yg_hideTagHint);Event.stopObserving($($K.yg_hoverTagObj),'mousemove',$K.yg_positionTagHint);}
$K.yg_positionTagHint=function(){$('yg_tagHint').setStyle({left:($K.yg_mouseCoords.X+9)+'px'});}
$K.yg_showFilterContext=function(obj,e){Event.stop(e);context=obj.up().next();context.setStyle({display:'block'});$K.yg_statusObserve(obj.up().next().identify());}
$K.yg_statusObserve=function(obj){$K.bCloser[obj]=$K.yg_clickCloser.bindAsEventListener($(obj));Event.observe(document,'click',$K.bCloser[obj]);}
$K.yg_clickCloser=function(ev){if(!ev.findElement().descendantOf(this)){Event.stopObserving(document,'click',$K.bCloser[this.id]);delete $K.bCloser[this.id];$K.bCloser.compact();this.setStyle({display:'none'});}}
$K.yg_userInfos=new Array();$K.yg_hoverUserHint=function(obj){if(typeof obj=='number'){var userID=obj;}else{obj=$(obj);if(obj.hasClassName('unknown')){return;}
var userID=obj.readAttribute('yg_id');userID=userID.split('-')[0];$K.yg_hoverUserObj=$(obj);}
if(userID){if($K.yg_userInfos[userID]){$('yg_userHint').down('.username').innerHTML=$K.yg_userInfos[userID].name;$('yg_userHint').down('.usercompany').innerHTML=$K.yg_userInfos[userID].company;$('yg_userHint').down('.usergrouplist').innerHTML=$K.yg_userInfos[userID].groups;$('yg_userHint').down('img').src=$K.yg_userInfos[userID].pic;$('yg_userHint').down('img').onload=function(){};clearTimeout($K.yg_hoverInt);$K.yg_hoverInt=setTimeout('$K.yg_showUserHint(true);',500);}else{var data=Array('noevent',{yg_property:'getUserInfo',params:{userID:userID}});$K.yg_AjaxCallback(data,'getUserInfo');}}}
$K.yg_showUserHint=function(cached){if($K.yg_activeDragInfo.dragging)return;clearTimeout($K.yg_hoverInt);if(!($K.yg_hoverUserObj))return;if(!cached){$('yg_userHint').down('img').onload=function(){this.up(0).setStyle({display:'block'});}}
objpos=$($K.yg_hoverUserObj).cumulativeOffset();$('yg_userHint').setStyle({top:(objpos[1]-82)+'px'});if(cached){$('yg_userHint').setStyle({display:'block'});}
$K.yg_positionUserHint();Event.observe(document,'mousemove',$K.yg_positionUserHint);}
$K.yg_positionUserHint=function(){vport=document.viewport.getDimensions();$('yg_fileHint').hide();if($K.yg_mouseCoords.X>(vport.width/2)){$('yg_userHint').removeClassName('left');offset=330;}else{$('yg_userHint').addClassName('left');offset=20;}
$('yg_userHint').setStyle({left:($K.yg_mouseCoords.X-offset)+'px'});}
$K.yg_hideUserHint=function(){clearTimeout($K.yg_hoverInt);$K.yg_hoverUserObj=false;$('yg_userHint').setStyle({display:'none'});Event.stopObserving(document,'mousemove',$K.yg_positionUserHint);}
$K.yg_fileInfos=new Array();$K.yg_hoverFileHint=function(obj,e){if($K.yg_activeDragInfo.dragging)return;if(e){var targetElement=Event.findElement(e);if(targetElement.hasClassName('user')){return;}}
clearTimeout($K.yg_hoverInt);if((typeof obj=='number')||(typeof obj=='string')){var fileID=parseInt(obj,10);obj=$(Event.element(e));}else{obj=$(obj);if(obj){var fileID=obj.readAttribute('yg_id').split('-')[0];}}
$('yg_fileHint').down('.mk_thumbnail').select('img').each(function(item){item.onload=function(){};item.up('.mk_thumbnail').addClassName('loading');});if(fileID){$K.yg_fileHint=fileID;if($K.yg_fileInfos[fileID]){$K.yg_hoverInt=setTimeout('$K.yg_showFileHint(\''+fileID+'\');',100);}else{$K.yg_hoverInt=setTimeout((function(){var data=Array('noevent',{yg_property:'getFileInfo',params:{fileID:fileID}});$K.yg_AjaxCallback(data,'getFileInfo',null,'getFileInfo');}),100);}}
Event.observe(obj,'mouseleave',$K.yg_hideFileHint);}
$K.yg_hoverPropertyLinkFileHint=function(obj,e){if(obj.value.strip()!=''){var data=obj.value.split('/');if(data.length>1){var fileId=parseInt(data.last(),10);if(!isNaN(fileId)){$K.yg_hoverFileHint(fileId,e);}}}}
$K.yg_showFileHint=function(fileID){clearTimeout($K.yg_hoverInt);if(fileID==$K.yg_fileHint){if($K.yg_fileInfos[fileID].THUMB=='0'){$('yg_fileHint').down('.mk_thumbnail').down('.thumbdesc').hide();$('yg_fileHint').down('.mk_thumbnail').down('.thumbcnt_nothumb').show();$('yg_fileHint').down('.mk_thumbnail').removeClassName('loading');$('yg_fileHint').down('.mk_thumbnail').select('img').each(function(item){item.hide();});}else{$('yg_fileHint').down('.mk_thumbnail').down('.thumbcnt_nothumb').hide();$('yg_fileHint').down('.mk_thumbnail').down('.thumbdesc').show();$('yg_fileHint').down('.mk_thumbnail').select('img').each(function(item){item.show();});}
$('yg_fileHint').down('.filedesc').down('.title').update($K.yg_fileInfos[fileID].NAME);$('yg_fileHint').down('.thumbdesc').down('.filetype').update($K.yg_fileInfos[fileID].IDENTIFIER);$('yg_fileHint').down('.thumbdesc').down('.filetype').className='filetype '+$K.yg_fileInfos[fileID].COLOR;$('yg_fileHint').down('.filedesc').down('span.filename').update($K.yg_fileInfos[fileID].FILENAME);$('yg_fileHint').down('.filedesc').down('.user').update($K.yg_fileInfos[fileID].USERNAME);$('yg_fileHint').down('.tags').down('.taglist').update($K.yg_fileInfos[fileID].TAGS);if($K.yg_fileInfos[fileID].TAGS){$('yg_fileHint').down('.tags').show();}else{$('yg_fileHint').down('.tags').hide();}
if($K.yg_fileInfos[fileID].THUMB=='0'||$K.yg_fileInfos[fileID].WIDTH==null){$('yg_fileHint').down('.filedesc').down('.dimensions_size').update($K.yg_fileInfos[fileID].FILESIZE);}else{$('yg_fileHint').down('.filedesc').down('.dimensions_size').update($K.yg_fileInfos[fileID].WIDTH+'x'+$K.yg_fileInfos[fileID].HEIGHT+', '+$K.yg_fileInfos[fileID].FILESIZE);}
$('yg_fileHint').down('.filedesc').down('.filedatetime').update($K.yg_fileInfos[fileID].DATE+', '+$K.yg_fileInfos[fileID].TIME);$('yg_fileHint').down('.mk_thumbnail').select('img').each(function(item){item.src=$K.appdir+'image/'+fileID+'/yg-bigthumb/?rnd='+Math.random()*1000;item.onload=function(){$K.log('Image loaded',$K.Log.INFO);item.up('.mk_thumbnail').removeClassName('loading');};});$K.yg_positionFileHint();Event.observe(document,'mousemove',$K.yg_positionFileHint);if($K.actionhover!=true)$('yg_fileHint').show();}}
$K.yg_hideFileHint=function(){clearTimeout($K.yg_hoverInt);$K.yg_fileHint=false;$('yg_fileHint').down('.mk_thumbnail').select('img').each(function(item){item.src='';item.writeAttribute('src','');item.writeAttribute('loaded','false');item.onload=function(){};});$('yg_fileHint').setStyle({display:'none'});Event.stopObserving(document,'mousemove',$K.yg_positionFileHint);Event.stopObserving(obj,'mouseleave',$K.yg_hideFileHint);}
$K.yg_positionFileHint=function(){if($K.actionhover==true)return;vport=document.viewport.getDimensions();$('yg_fileHint').className='';if((($K.yg_mouseCoords.X+600)>vport.width)&&(($K.yg_mouseCoords.X-600)>0)){$('yg_fileHint').addClassName('rgt');$('yg_fileHint').setStyle({left:($K.yg_mouseCoords.X-550)+'px'});}else{$('yg_fileHint').addClassName('lft');$('yg_fileHint').setStyle({left:($K.yg_mouseCoords.X+15)+'px'});}
if(($K.yg_mouseCoords.Y+200)>(vport.height)){$('yg_fileHint').addClassName('bt');$('yg_fileHint').setStyle({top:($K.yg_mouseCoords.Y-163)+'px'});}else{$('yg_fileHint').addClassName('tp');$('yg_fileHint').setStyle({top:($K.yg_mouseCoords.Y-14)+'px'});}}
$K.yg_openUserInfo=function(id,which){which=$(which);if(which.hasClassName('unknown')){return;}
$K.yg_hideUserHint();new $K.yg_wndobj({config:'USER_INFO',loadparams:{userid:id}});}
;$K.promptfunc=new Array();$K.yg_promptbox=function(txtheadline,txtcopy,prompttype,okfunction,abortfunction){$K.wndid++;var ywindownum=$K.wndid;var funcid="prompt"+ywindownum;var acknowledgetext=$K.TXT('TXT_ACKNOWLEDGE');if(prompttype=='alert'){acknowledgetext=$K.TXT('TXT_OK');}
if(txtheadline=="")txtheadline=$K.TXT('TXT_NOTIFICATION');var windowhtml=$K.yg_templates["prompt"].evaluate({win_no:ywindownum,txtheadline:txtheadline,txtcopy:txtcopy,prompttype:prompttype,funcid:funcid,acknowledgetext:acknowledgetext,canceltext:$K.TXT('TXT_CANCEL')});$K.promptfunc[funcid]=new Object();if(okfunction){$K.promptfunc[funcid].okfunction=okfunction;}else{$K.promptfunc[funcid].okfunction=function(){return;};}
if(abortfunction){$K.promptfunc[funcid].abortfunction=abortfunction;}else{$K.promptfunc[funcid].abortfunction=function(){return;};}
$('dialogcontainer').insert({top:windowhtml});$K.yg_initPromptWindow('wid_'+ywindownum,prompttype,funcid);}
$K.yg_initPromptWindow=function(pBoxId,promptType,funcId){$(pBoxId).keyMapperOKHandle=Koala.mapKey(function(key){if($K.promptfunc[funcId]&&$K.promptfunc[funcId].okfunction&&(typeof $K.promptfunc[funcId].okfunction=='function')){$K.promptfunc[funcId].okfunction($(pBoxId+'_form').getInputs());}
$K.yg_removePrompt(pBoxId);},'',13,13);$(pBoxId).keyMapperESCHandle=Koala.mapKey(function(key){$K.promptfunc[funcId].abortfunction();$K.yg_removePrompt(pBoxId)},'',27,27);$K.promptfunc[funcId]['winno']=pBoxId;if(promptType=="alert"){$(pBoxId+'_cancelbutton').remove();}
$K.yg_centerWindow($(pBoxId));$(pBoxId+'_modalbg').setStyle({zIndex:100000});$(pBoxId).setStyle({visibility:'visible',zIndex:100001});new Draggable(pBoxId,{handle:pBoxId+'_header',zindex:100001,onStart:function(){$(this.handle).up('.pbox').setStyle({zIndex:100001});}});if(!Prototype.Browser.IE)
$(pBoxId+'_focus').focus();}
$K.yg_removePrompt=function(winno){for(var i in $K.promptfunc){if($($K.promptfunc[i].winno==winno)){$K.promptfunc.splice(i,i+1);}}
if($(winno).keyMapperOKHandle)
Koala.unMapKey($(winno).keyMapperOKHandle);if($(winno).keyMapperESCHandle)
Koala.unMapKey($(winno).keyMapperESCHandle);$(winno).remove();$(winno+"_modalbg").remove();}
;$K.yg_treecount=0;$K.yg_dynTrees=new Array();$K.yg_dynTreesXML=new Array();$K.yg_dynTreesDD=new Array();$K.yg_dynTreesWNDO=new Array();$K.initTree=function(elementRef){elementRef=$(elementRef);var widgetData={};var widgetInfo=elementRef.readAttribute('yg_widget');widgetInfo.split(';').each(function(item){var itemData=item.split(':');if(itemData[0]&&itemData[1]){widgetData[itemData[0]]=itemData[1];}});$K.yg_createDynTree(elementRef,widgetData.treename,widgetData.objtype,widgetData.accepts,widgetData.sort,widgetData.nosamelevel,widgetData.nodrag,false,widgetData.noclick,widgetData.site,widgetData.action,widgetData.editable,widgetData.sortable,widgetData.preselected);}
$K.yg_createDynTree=function(element,treename,type,accepts,sort,nosamelevel,nodrag,scrolls,noclick,site,action,editable,sortable,preselected){if(site=="")var site=1;var treeContainer=$(document.createElement('DIV'));treeContainer.id=treename;treeContainer.accepts=accepts;treeContainer.sort=sort;treeContainer.yg_type=type;treeContainer.writeAttribute("yg_type",type);treeContainer.className=element.className;if(scrolls==true){treeContainer.innerHTML='<div id="'+treename+'_inner"></div>'+'<div id="'+treename+'_sv" class="scrollbar_v">'+'<div class="scroll_up"><a onclick="return false" onmouseover="$K.yg_ddScrollOver\''+treename+'_inner\',\'up\')" onmouseout="$K.yg_ddScrollOut(\''+treename+'_inner\')" onmousedown="$K.yg_scroll_initScroll(\''+treename+'_inner\',\'up\')" onmouseup="$K.yg_scroll_stopScroll(\''+treename+'_inner\')"><img src="'+$K.imgdir+'scrollbars/btn-up.gif" width="12" height="12" alt="" /></a></div>'+'<div id="'+treename+'_tv" class="track_v"><div id="'+treename+'_dbv" class="dragBar_v"></div></div>'+'<div class="scroll_down"><a onclick="return false" onmouseover="$K.yg_ddScrollOver\''+treename+'_inner\',\'down\')" onmouseout="$K.yg_ddScrollOut(\''+treename+'_inner\')" onmousedown="$K.yg_scroll_initScroll(\''+treename+'_inner\',\'down\')" onmouseup="$K.yg_scroll_stopScroll(\''+treename+'_inner\')"><img src="'+$K.imgdir+'scrollbars/btn-dn.gif" width="12" height="12" alt="" /></a></div>'+'</div>'+'<div id="'+treename+'_sh" class="scrollbar_h">'+'<div class="scroll_left"><a onclick="return false" onmouseover="$K.yg_ddScrollOver\''+treename+'_inner\',\'left\')" onmouseout="$K.yg_ddScrollOut(\''+treename+'_inner\')" onmousedown="$K.yg_scroll_initScroll(\''+treename+'_inner\',\'left\')" onmouseup="$K.yg_scroll_stopScroll(\''+treename+'_inner\')"><img src="'+$K.imgdir+'scrollbars/btn-lft.gif" width="12" height="12" alt="" /></a></div>'+'<div id="'+treename+'_th" class="track_h"><div id="'+treename+'_dbh" class="dragBar_h"></div></div>'+'<div class="scroll_right"><a onclick="return false" onmouseover="$K.yg_ddScrollOver\''+treename+'_inner\',\'right\')" onmouseout="$K.yg_ddScrollOut(\''+treename+'_inner\')" onmousedown="$K.yg_scroll_initScroll(\''+treename+'_inner\',\'right\')" onmouseup="$K.yg_scroll_stopScroll(\''+treename+'_inner\')"><img src="'+$K.imgdir+'scrollbars/btn-rt.gif" width="12" height="12" alt="" /></a></div>'+'<div class="scroll_blank"></div>'+'</div>';}else{treeContainer.innerHTML='<div id="'+treename+'_inner"></div>';}
if(!element.next()){element.up().appendChild(treeContainer);}else{element.up().insertBefore(treeContainer,element.next());}
$K.yg_dynTrees[$K.yg_treecount]=new NlsTree(treename+'_tree');$K.yg_dynTrees[$K.yg_treecount].yg_type=type;$K.yg_dynTrees[$K.yg_treecount].sortable=sortable;$K.yg_dynTreesXML[$K.yg_treecount]=null;Event.observe(element.up(),'mousedown',function(){setTimeout("$K.yg_clearTextSelection()",0);});if(treeContainer.up('.ydialog')){$K.yg_dynTrees[$K.yg_treecount].opt.stlprf="dark";}
$K.yg_dynTrees[$K.yg_treecount].chUrl='about:blank';$K.yg_dynTrees[$K.yg_treecount].opt.mntState=true;if(editable){$K.yg_dynTrees[$K.yg_treecount].opt.editable=eval(editable);}
if(sortable){$K.yg_dynTrees[$K.yg_treecount].opt.sortable=eval(sortable);}
if(sort){$K.yg_dynTrees[$K.yg_treecount].opt.sort=sort;}
$K.yg_dynTrees[$K.yg_treecount].treeOnNodeChange=$K.yg_customOnChange;var params=element.readAttribute('yg_widget').split(';');params.each(function(item){if(item.startsWith('site:')){site=item.split(':')[1];}});rootnodename='root_1';var xtra='';if(noclick){xtra='noclick';}
$K.yg_dynTrees[$K.yg_treecount].add(rootnodename,0,'','',$K.imgdir+'window/x.gif',true,false,xtra);$K.yg_dynTrees[$K.yg_treecount].setEditablity(rootnodename,false);if(!nodrag)$K.yg_dynTreesDD[$K.yg_treecount]=new NlsTreeDD(treename+'_tree');if(!nodrag)$K.yg_dynTreesDD[$K.yg_treecount].onNodeDrop=$K.yg_customOnDrop;if(nosamelevel){$K.yg_dynTrees[$K.yg_treecount].opt.nosamelevel=nosamelevel;if(!nodrag)$K.yg_dynTreesDD[$K.yg_treecount].shiftToReorder=true;}else{if(!nodrag)$K.yg_dynTreesDD[$K.yg_treecount].shiftToReorder=false;}
$K.yg_dynTrees[$K.yg_treecount].setDrag(rootnodename,false,false);$K.yg_dynTrees[$K.yg_treecount].render(treename+'_inner');if(scrolls==true){$K.yg_dynTreesWNDO[$K.yg_treecount]=new $K.yg_scrollObj(treename+'_inner',treename+'_tree',treename+'_tree');$K.yg_dynTreesWNDO[$K.yg_treecount].setUpScrollbar(treename+'_dbv',treename+'_tv','v',1,1);$K.yg_dynTreesWNDO[$K.yg_treecount].setUpScrollbar(treename+'_dbh',treename+'_th','h',1,1);$K.yg_dynTreesWNDO[$K.yg_treecount].setBarSize();}
var hlper_function=function(id){if(!Object.isUndefined(nlsTree[treename+'_tree']))
if(typeof nlsTree[treename+'_tree'].remapAction=='function')
nlsTree[treename+'_tree'].remapAction();$K.windows[$(treename+'_tree').up('.ywindow').id].refresh('col1');}
$K.yg_dynTrees[$K.yg_treecount].treeOnExpand=$K.yg_dynTrees[$K.yg_treecount].treeOnCollapse=hlper_function;element.up().observe('mouseenter',function(){if($(treename+'_actionbutton'))$(treename+'_actionbutton').show();});element.up().observe('mouseleave',function(){if((!$K.actionhover)&&$(treename+'_actionbutton'))$(treename+'_actionbutton').hide();});element.remove();$K.yg_fillTree($(treename+'_tree').up('.ywindow').id.split("_")[1],type,treename,site,action,preselected);$K.yg_treecount++;}
$K.yg_fillTree=function(winID,objecttype,treename,site,action,preselected){foo={showMenu:function(clientX,clientY){}}
var yeagerTreeIconSet=function(path,iconstr){this.pnb=path+'plusnb.gif';this.pb=path+'plusb.gif';this.pnl=path+'plusnl.gif';this.mnb=path+'minusnb.gif';this.mb=path+'minusb.gif';this.mnl=path+'minusnl.gif';this.opf=path+'../icons/ico_'+iconstr+'_s.png';this.clf=path+'../icons/ico_'+iconstr+'_s.png';this.chd=path+'../icons/ico_'+iconstr+'_s.png';this.rot=path+'../icons/ico_'+iconstr+'_s.png';this.lnb=path+'lineang.gif';this.lb=path+'lineints.gif';this.lin=path+'line.gif';this.bln=path+'blank.gif';this.lod=path+'blank.gif';this.toString=function(){return'yeager tree icons';}
return this;}
window.mapAction=function(){for(var property in nlsTree[treename+'_tree'].nLst){if(nlsTree[treename+'_tree'].nLst[property]!=null){var tree_actChild=$(nlsTree[treename+'_tree'].nLst[property].id);if(tree_actChild!=undefined){if((tree_actChild.down('.actions')==undefined)){if(!tree_actChild.alreadyUpdated){tree_actChild._onmouseover=function(e){$K.yg_showActions(this,treename+'_tree');if($(treename+'_actionbutton'))$(treename+'_actionbutton').show();$K.yg_currentHover=this;}
tree_actChild.alreadyUpdated=true;}}}}}
if(window.mapAction!=undefined){nlsTree[treename+'_tree'].remapAction=window.mapAction;}
window.mapAction=undefined;}
with(nlsTree[treename+'_tree']){useIconSet(new yeagerTreeIconSet($K.imgdir+'tree/',objecttype));defImgPath=$K.imgdir+'nlstree/';opt.selRow=true;chUrl=$K.appdir+objecttype+'s_tree_nodes';if(site)chUrl+="?site="+site;rootnodename='root_1';reloadNode(rootnodename);expandNode(rootnodename);var handlerFunc=function(t){nlsTree[treename+'_tree'].addChildNodesXML(t.responseXML.documentElement,true,true);window.mapAction();var nodes=nlsTree[treename+'_tree'].nLst;$(treename).up(3).removeClassName('tab_loading');$K.windows["wid_"+winID].refresh("col1");if((preselected!=undefined)&&(preselected!="")){nlsTree[treename+'_tree'].selectNodeById(objecttype+'_'+preselected);}else{if($K.windows["wid_"+winID].boundWindow)$K.yg_selectNode($(nlsTree[treename+'_tree'].rt.id),false,false);}}
var errFunc=function(t){$K.yg_promptbox($K.TXT('TXT_ERROR'),'<center>Error '+t.status+' -- '+t.statusText+'</center>','alert');}
var treebg=$(treename).up(3);treebg.addClassName('tab_loading');var treeParameters={action:action};Object.extend(treeParameters,$K.windows['wid_'+winID].loadparams);treeParameters.us=document.body.id;treeParameters.lh=$K.yg_getLastGuiSyncHistoryId();new Ajax.Request(chUrl,{parameters:treeParameters,onComplete:handlerFunc,onFailure:errFunc,onlyLatestOfClass:winID+'_tree'});}
nlsTree[treename+'_tree'].setGlobalCtxMenu(foo);}
$K.yg_treeFinishedLoading=function(window_ref,objecttype,dragndrop,response){var oldRootNodeId=nlsTree[objecttype+'_tree'+window_ref+'_tree'].rt.orgId;nlsTree[objecttype+'_tree'+window_ref+'_tree'].removeChilds(oldRootNodeId,true);nlsTree[objecttype+'_tree'+window_ref+'_tree'].addChildNodesXML(response.responseXML.documentElement,true,true);if(typeof(nlsTree[objecttype+'_tree'+window_ref+'_tree'].remapAction)=='function'){nlsTree[objecttype+'_tree'+window_ref+'_tree'].remapAction();}
if(!dragndrop){for(var nodeid in nlsTree[objecttype+'_tree'+window_ref+'_tree'].nLst){var nD=nlsTree[objecttype+'_tree'+window_ref+'_tree'].nLst[nodeid];if(nD==null)continue;if(nD.orgId!='root_1'){nlsTree[objecttype+'_tree'+window_ref+'_tree'].setDrag(nD.orgId,false,false);nlsTree[objecttype+'_tree'+window_ref+'_tree'].setDrop(nD.orgId,false,false);}}}
treebg=$(objecttype+'_tree'+window_ref).up(3);treebg.removeClassName('tab_loading');treebg.setStyle({width:'auto'});$(objecttype+'_tree'+window_ref).show();if($K.windows["wid_"+window_ref].boundWindow)$K.yg_selectNode($(nlsTree[objecttype+'_tree'+window_ref+'_tree'].rt.id),false,false);$K.windows["wid_"+window_ref].refresh("col1");}
$K.yg_treeStartLoading=function(window_ref,objecttype){treebg=$(objecttype+'_tree'+window_ref).up(3);treebg.addClassName('tab_loading');$(objecttype+'_tree'+window_ref).hide();$K.windows["wid_"+window_ref].refresh("col1");}
$K.yg_switchSite=function(newSite,window_ref){$('wid_'+window_ref+'_buttons').select('.tree_btn').each(function(item){item.addClassName('disabled');});var objecttype="pages";var handlerFunc=function(t){window.setTimeout(function(){$K.yg_treeFinishedLoading(window_ref,objecttype,true,t)},1);}
var errFunc=function(t){$K.yg_promptbox($K.TXT('TXT_ERROR'),'<center>Error '+t.status+' -- '+t.statusText+'</center>','alert');}
$K.yg_treeStartLoading(window_ref,objecttype);var ajaxParams={};Object.extend(ajaxParams,$K.windows['wid_'+window_ref].loadparams);ajaxParams.site=newSite;ajaxParams.us=document.body.id;ajaxParams.lh=$K.yg_getLastGuiSyncHistoryId();new Ajax.Request($K.appdir+objecttype+'_tree_nodes',{parameters:ajaxParams,onComplete:handlerFunc,onFailure:errFunc,onlyLatestOfClass:window_ref+'_tree'});}
$K.yg_switchSiteContentBlocks=function(newSite,window_ref){var objecttype="cblocks";var url='';var site=0;if(newSite.indexOf('structure_site')!=-1){url=$K.appdir+'cblocksextras_tree_nodes_extras';site=newSite.substr(newSite.lastIndexOf('_')+1);nlsTree['cblocks_tree'+window_ref+'_tree'].opt.sort="no";}else if(newSite.indexOf('structure')!=-1){url=$K.appdir+'cblocks_tree_nodes?displayMode=dialog';site=0;nlsTree['cblocks_tree'+window_ref+'_tree'].opt.sort="asc";}
url+='?site='+site;nlsTree['cblocks_tree'+window_ref+'_tree'].chUrl=url;var handlerFunc=function(t){window.setTimeout(function(){$K.yg_treeFinishedLoading(window_ref,objecttype,true,t)},1);}
var errFunc=function(t){$K.yg_promptbox($K.TXT('TXT_ERROR')+'!','<center>Error '+t.status+' -- '+t.statusText+'</center>','alert');}
$K.yg_treeStartLoading(window_ref,objecttype);new Ajax.Request(url,{parameters:{site:site,us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()},onComplete:handlerFunc,onFailure:errFunc,onlyLatestOfClass:window_ref+'_tree'});}
$K.yg_switchSiteCopyFrom=function(newSite,window_ref){var objecttype="pagesextras";var url='';var site=0;var dragndrop=true;if(newSite.indexOf('pages_with_cblocks')!=-1){site=newSite.substr(newSite.lastIndexOf('_')+1);url=$K.appdir+'pagesextras_tree_nodes_extras?site='+site;nlsTree['pagesextras_tree'+window_ref+'_tree'].opt.sort="no";$K.windows['wid_'+window_ref].loadparams.treemode='pages_with_cblocks';}else if(newSite.indexOf('pages')!=-1){site=newSite.substr(newSite.lastIndexOf('_')+1);url=$K.appdir+'pages_tree_nodes?site='+site+'&dnd=false';dragndrop=false;nlsTree['pagesextras_tree'+window_ref+'_tree'].opt.sort="no";$K.windows['wid_'+window_ref].loadparams.treemode='pages';}else if(newSite.indexOf('cblocks')!=-1){site=0;url=$K.appdir+'cblocks_tree_nodes?displayMode=dialog&site='+site;nlsTree['pagesextras_tree'+window_ref+'_tree'].opt.sort="asc";$K.windows['wid_'+window_ref].loadparams.treemode='cblocks';}
nlsTree['pagesextras_tree'+window_ref+'_tree'].chUrl=url;var handlerFunc=function(t){window.setTimeout(function(){$K.yg_treeFinishedLoading(window_ref,objecttype,false,t)},1);}
var errFunc=function(t){$K.yg_promptbox($K.TXT('TXT_ERROR')+'!','<center>Error '+t.status+' -- '+t.statusText+'</center>','alert');}
$K.yg_treeStartLoading(window_ref,objecttype);new Ajax.Request(url,{parameters:{site:site,us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()},onComplete:handlerFunc,onFailure:errFunc,onlyLatestOfClass:window_ref+'_tree'});}
$K.yg_expandTreeNodes=function(win_id,yg_type,nodelist,select_id,reloadtree){var queueFunc=function(){nodelist=$A(nodelist.split(','));win_id=win_id.replace(/wid_/g,'');var objectid=yg_type+'_tree'+win_id+'_tree';nodelist.each(function(item,idx){nodelist[idx]='page_'+item;});nlsTree[objectid].expandNodes(nodelist);}
if(reloadtree&&(reloadtree=='true')){$K.yg_reloadTree(win_id,yg_type,select_id,queueFunc);}else{queueFunc();}}
$K.yg_reloadTree=function(win_id,yg_type,node_id,onSuccess){org_win_id=win_id;win_id=win_id.replace(/wid_/g,'');var objectid=yg_type+'s_tree'+win_id+'_tree';var site=nlsTree[objectid].rt.yg_id.split('-')[1];var handlerFunc=function(t){var oldRootNodeId=nlsTree[objectid].rt.orgId;nlsTree[objectid].removeChilds(oldRootNodeId,false);nlsTree[objectid].addChildNodesXML(t.responseXML.documentElement,true,true);if(typeof nlsTree[objectid].remapAction=='function'){nlsTree[objectid].remapAction();}
if(onSuccess&&(typeof onSuccess=='function')){onSuccess();}
$K.yg_restoreTreeState(objectid);if(node_id){$K.yg_selectTreeNode(org_win_id,yg_type.substring(0,yg_type.length-1),node_id);}}
var errFunc=function(t){$K.yg_promptbox($K.TXT('TXT_ERROR')+'!','<center>Error '+t.status+' -- '+t.statusText+'</center>','alert');}
new Ajax.Request($K.appdir+yg_type+'s_tree_nodes',{parameters:{site:site,us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()},onComplete:handlerFunc,onFailure:errFunc});}
$K.yg_restoreTreeState=function(objectid){var sid=null;if(nlsTree[objectid]&&nlsTree[objectid].opt.mntState&&nls_getCookie){var sid=nls_getCookie(nlsTree[objectid].tId+"_selnd");nls_maintainNodeState(nlsTree[objectid].tId,true);}
if(sid&&sid!="")nlsTree[objectid].selectNodeById(sid);}
$K.yg_selectTreeNode=function(win_id,yg_type,nodeid){win_id=win_id.replace(/wid_/g,'');var objectid=yg_type+'s_tree'+win_id+'_tree';$K.yg_restoreTreeState(objectid);if(nlsTree[objectid])nlsTree[objectid].selectNodeById(yg_type+'_'+nodeid);$K.yg_selectNode($(objectid+yg_type+'_'+nodeid));}
$K.yg_getTreeReference=function(object){if(object.pr){return $K.yg_getTreeReference(object.pr);}else{var regex=new RegExp(object.orgId);var treeName=object.id.replace(regex,'');return treeName;}}
$K.yg_moveTreeNode=function(treeType,sourceYgId,targetYgId,moveType){if(!moveType)moveType=1;$K.yg_cleanLookupTable();for(currWinId in $K.windows){var winID=currWinId.split('_')[1];var objectid=treeType+'s_tree'+winID+'_tree';var rightSite=true;if((treeType=='page')&&nlsTree[objectid]){var targetSite=targetYgId.split('-')[1];var currTreeSite=nlsTree[objectid].rt.yg_id.split('-')[1];if(targetSite!=currTreeSite){rightSite=false;}}
if(nlsTree[objectid]&&rightSite){var currentTree=nlsTree[objectid];var sourceNode=null;var targetNode=null;if($K.yg_idlookuptable[sourceYgId])
for(var i=0;i<$K.yg_idlookuptable[sourceYgId].length;i++){if(($K.yg_idlookuptable[sourceYgId][i].yg_property=='name')&&($K.yg_idlookuptable[sourceYgId][i].yg_type==treeType)){if($K.yg_idlookuptable[sourceYgId][i].id.indexOf(currentTree.tId)===0){sourceNode=$K.yg_idlookuptable[sourceYgId][i];}}}
if($K.yg_idlookuptable[targetYgId])
for(var i=0;i<$K.yg_idlookuptable[targetYgId].length;i++){if(($K.yg_idlookuptable[targetYgId][i].yg_property=='name')&&($K.yg_idlookuptable[targetYgId][i].yg_type==treeType)){if($K.yg_idlookuptable[targetYgId][i].id.indexOf(currentTree.tId)===0){targetNode=$K.yg_idlookuptable[targetYgId][i];}}}
if(sourceNode&&!sourceNode.pr){sourceNode=null;}
if(sourceNode&&targetNode){currentTree.moveChild([sourceNode],targetNode,moveType);}else if(sourceNode&&!targetNode){currentTree.remove(sourceNode.orgId);}else if(!sourceNode&&targetNode){var origTreeId=targetYgId.split('-')[1]+'_'+targetYgId.split('-')[0];if(treeType=='page'){var origTreeId='page_'+targetYgId.split('-')[0];}
if(targetYgId.split('-')[0]==1){var origTreeId='root_1';}
nlsTree[objectid].ajaxLoadChildNodes(origTreeId);}
nlsTree[objectid].remapAction();}}}
$K.yg_customOnChange=function(orgId,tId){var node=nlsTree[tId].nLst[tId+orgId];if(node!=undefined){switch(node.yg_type){case'page':var data=Array('change',{name:'pagename',yg_id:node.yg_id,yg_property:node.yg_property,yg_type:node.yg_type,value:node.capt});$K.yg_AjaxCallback(data,'setPageName');break;case'file':var data=Array('change',{name:'filename',yg_id:node.yg_id,yg_property:node.yg_property,yg_type:node.yg_type,value:node.capt});$K.yg_AjaxCallback(data,'setFileName');break;case'cblock':var data=Array('change',{name:'cblockname',yg_id:node.yg_id,yg_property:node.yg_property,yg_type:node.yg_type,value:node.capt});$K.yg_AjaxCallback(data,'setCBlockName');break;case'tag':var data=Array('change',{name:'tagname',yg_id:node.yg_id,yg_property:node.yg_property,yg_type:node.yg_type,value:node.capt});$K.yg_AjaxCallback(data,'setTagName');break;case'template':case'templatefolder':var data=Array('change',{name:'templatename',yg_id:node.yg_id,yg_property:node.yg_property,yg_type:node.yg_type,value:node.capt});$K.yg_AjaxCallback(data,'setTemplateName');break;case'entrymask':var data=Array('change',{name:'entrymaskname',yg_id:node.yg_id,yg_property:node.yg_property,yg_type:node.yg_type,value:node.capt});$K.yg_AjaxCallback(data,'setEntrymaskName');break;}}}
;$K.yg_maskSwap=function(obj){tmpobjhead=obj.down('.emheader').down('a');tmpobjcnt=obj.down('.emcontentouter');tmpobjerror=tmpobjhead.next(2);if(tmpobjcnt.getStyle('display')=="none"){tmpobjcnt.setStyle({display:'block'});if(obj.hasClassName('emerror')){tmpobjerror.setStyle({display:'block'});obj.removeClassName('emcollapsed');}
tmpobjhead.removeClassName('closed');tmpobjhead.addClassName('opened');tmpobjhead.up().removeClassName('closed');obj.select('textarea').each(function(textareaItem){$K.yg_setTextareaAutogrow(textareaItem.identify());});}else{if(obj.hasClassName('emerror')){tmpobjerror.setStyle({display:'none'});obj.addClassName('emcollapsed');}
tmpobjcnt.setStyle({display:'none'});tmpobjhead.removeClassName('opened');tmpobjhead.addClassName('closed');tmpobjhead.up().addClassName('closed');}
$K.windows[obj.up('.ywindow').id].refresh(obj);if(obj.up('.cbcontent')){$K.yg_showActions(obj.up('.cbcontent').down());}
$K.yg_showActions(tmpobjhead.up());}
$K.yg_cblockSwap=function(obj){obj=$(obj);tmpobjhead=$(obj.id.replace(/_selector/,'_cbheader'));tmpobjcnt=$(obj.id.replace(/_selector/,'_cbcontentinner'));tmpobjerror=tmpobjhead.next(2);if(tmpobjcnt.getStyle('display')=="none"){tmpobjcnt.setStyle({display:'block'});if(obj.hasClassName('cberror'))tmpobjerror.setStyle({display:'block'});tmpobjhead.removeClassName('closed');tmpobjhead.addClassName('opened');tmpobjhead.up().removeClassName('closed');obj.select('textarea').each(function(textareaItem){$K.yg_setTextareaAutogrow(textareaItem.identify());});}else{if(obj.hasClassName('cberror'))tmpobjerror.setStyle({display:'none'});tmpobjcnt.setStyle({display:'none'});tmpobjhead.removeClassName('opened');tmpobjhead.addClassName('closed');tmpobjhead.up().addClassName('closed');}
$K.windows[obj.up('.ywindow').id].refresh(obj);$K.yg_showActions(tmpobjhead.up());}
$K.yg_toggleElemTitles=function(obj){$K.log(obj,$K.Log.INFO);obj=$(obj);if(obj.hasClassName('noelemtitles')){obj.removeClassName('noelemtitles');}else{obj.addClassName('noelemtitles');}
$K.windows[obj.up('.ywindow').id].refresh(obj);$K.yg_showActions($(obj));}
$K.yg_maskHighlight=function(obj,action){if(action=="over"){$(obj).addClassName('emcontentinnerhover');}else{if($K.actionhover!=true)$(obj).removeClassName('emcontentinnerhover');}}
$K.yg_goEditMode=function(obj,event){if(event)Event.stop(event);if(Boolean(obj.readAttribute('yg_selectable'))){if(!(obj.hasClassName('emeditmode'))){obj.addClassName('emeditmode');$K.currentEditMode=obj;var textboxes=obj.select('textarea');textboxes.each(function(item){if(item&&item.autogrow&&item.autogrow.dummy){item.autogrow.dummy.innerHTML='';var newWidth=item.getWidth()+'px';item.autogrow.dummy.setStyle({width:newWidth});item.autogrow.checkExpand.defer();}});}}
$K.yg_customAttributeHandler(obj);$K.windows[obj.up('.ywindow').id].refresh(obj);}
$K.yg_closeEditMode=function(obj){$K.yg_fireLateOnChange();if(Boolean(obj.readAttribute('yg_selectable'))){obj.removeClassName('emeditmode');}
$K.yg_customAttributeHandler(obj);$K.windows[obj.up('.ywindow').id].refresh(obj);}
$K.yg_clearControl=function(which,objectid,formfield){which=$(which);var site=$K.windows[which.up('.ywindow').id].yg_id.split('-')[1];entrymask=false;if(which.up('.emcontainerfocus')||which.up('.emcontainer')){entrymask=true;parentobj=which.up('.maskedit');$K.yg_submitControl(which.up('.maskedit').down('.title_txt'),formfield);}else{parentobj=which.up('.mk_property');var targetField=parentobj.down('input[type=hidden]');var infoContainer=parentobj.down('span.title_txt');targetField.value='';if(infoContainer){infoContainer.writeAttribute('param01','');infoContainer.writeAttribute('param02','');infoContainer.writeAttribute('param03','');infoContainer.writeAttribute('param04','');}
$K.yg_setObjectProperty(targetField);}
if(formfield=='5'){parentobj.down('.title').previous().className='icn noicon';}
if(parentobj.hasClassName('mk_file')||parentobj.down('.mk_file')){parentobj.down('.title_txt').innerHTML=$K.TXT('TXT_SELECTOR_FILE');parentobj.down('div.title').writeAttribute('onmouseover','');if(parentobj.down('.filetype'))parentobj.down('.filetype').remove();}else if(parentobj.hasClassName('mk_link')){parentobj.writeAttribute('param01','');parentobj.writeAttribute('param02','');parentobj.writeAttribute('param03','');parentobj.writeAttribute('param04','');if(parentobj.down('.elemtitle').next()){parentobj.down('.elemtitle').next().down().className="icn noicon";parentobj.down('.title_txt').innerHTML=$K.TXT('TXT_SELECTOR_LINK');parentobj.down('.elemtitle').next().down().setStyle({display:'block'});}}else{if(parentobj.down('.icn'))parentobj.down('.icn').className='icn noicon';if(parentobj.down('.filetype'))parentobj.down('.filetype').remove();if(parentobj.down().hasClassName('mk_link')||parentobj.hasClassName('mk_link'))emptyText=$K.TXT('TXT_SELECTOR_LINK');if(parentobj.down().hasClassName('mk_tag')||parentobj.hasClassName('mk_tag'))emptyText=$K.TXT('TXT_SELECTOR_TAG');if(parentobj.down().hasClassName('mk_cblock')||parentobj.hasClassName('mk_cblock'))emptyText=$K.TXT('TXT_SELECTOR_CBLOCK');if(parentobj.down().hasClassName('mk_page')||parentobj.hasClassName('mk_page'))emptyText=$K.TXT('TXT_SELECTOR_PAGE');if(parentobj.down().hasClassName('mk_file')||parentobj.hasClassName('mk_file'))emptyText=$K.TXT('TXT_SELECTOR_FILE');parentobj.down('.title_txt').innerHTML=emptyText;}
$K.yg_fadeField(parentobj);}
$K.yg_submitControl=function(which,formfieldtype){var id=which.up('.emcontainer').id.split('_')[3];var coid=which.up('li').getAttribute('yg_id').split('-')[0];var page=$K.windows[which.up('.ywindow').id].yg_id.split('-')[0];var site=$K.windows[which.up('.ywindow').id].yg_id.split('-')[1];var objecttype=$K.windows[which.up('.ywindow').id].yg_type;var formfieldid=which.up('.maskedit').getAttribute('yg_id').split('-')[0];var all_data={id:id,coid:coid,page:page,site:site,objecttype:objecttype,formfieldid:formfieldid};all_data[formfieldid+'-VALUE01']=' ';all_data[formfieldid+'-VALUE02']=' ';all_data[formfieldid+'-VALUE03']=' ';all_data[formfieldid+'-VALUE04']=' ';all_data[formfieldid+'-VALUE05']=' ';all_data[formfieldid+'-VALUE06']=' ';all_data[formfieldid+'-VALUE07']=' ';all_data[formfieldid+'-VALUE08']=' ';var winID=which.up('.ywindow').id;var backendAction='savePageEntrymask';if($K.windows[winID].tab=='EXTENSIONS'){backendAction='saveExtensionProperties';all_data.id=which.up('.mk_extension').readAttribute('yg_id').split('-')[0];}
var data=Array('noevent',{yg_property:backendAction,params:{allData:Object.toJSON(all_data)}});$K.yg_AjaxCallback(data,backendAction);}
$K.yg_editControl=function(which,formfieldtype,dragndrop,data){which=$(which);if(!(which))return;if(which.up('.emcontainer.mk_cblock')){var id=which.up('.emcontainer.mk_cblock').id.split('_')[3];}else if(which.up('.mk_cblock')){var id=which.up('.mk_cblock').id.split('_')[3];}else if(which.up('.emcontainer.mk_extension')){var id=which.up('.emcontainer.mk_extension').id.split('_')[3];}
var coid=which.up('li').getAttribute('yg_id').split('-')[0];var page=$K.windows[which.up('.ywindow').id].yg_id.split('-')[0];var site=$K.windows[which.up('.ywindow').id].yg_id.split('-')[1];var objecttype=$K.windows[which.up('.ywindow').id].yg_type;var formfieldid=which.up('.maskedit').getAttribute('yg_id').split('-')[0];var havedata=false;var all_data={id:id,coid:coid,page:page,site:site,objecttype:objecttype,formfieldid:formfieldid};$K.log('which: ',which,$K.Log.INFO);$K.log('id: ',id,$K.Log.INFO);$K.log('coid: ',coid,$K.Log.INFO);$K.log('site: ',site,$K.Log.INFO);$K.log('objecttype: ',objecttype,$K.Log.INFO);$K.log('formfieldid: ',formfieldid,$K.Log.INFO);switch(parseInt(formfieldtype)){case 1:$K.log('Single Line Text',$K.Log.INFO);all_data[formfieldid+'-VALUE01']=which.value;havedata=true;break;case 2:$K.log('Multi Line Text',$K.Log.INFO);all_data[formfieldid+'-VALUE01']=which.value;havedata=true;break;case 3:$K.log('WYSIWYG',$K.Log.INFO);if(which.realHTML){all_data[formfieldid+'-VALUE01']=which.realHTML;}else{all_data[formfieldid+'-VALUE01']=which.innerHTML;}
havedata=true;break;case 4:$K.log('Checkbox',$K.Log.INFO);all_data[formfieldid+'-VALUE01']=which.down('input').value;havedata=true;break;case 5:$K.log('Link',$K.Log.INFO);if(data&&data['objecttype']&&data['objecttype']=='page'){$(which).up('.selectionmarker').down('.icn').className='icn iconpage';which.up('.title').previous().show();if(data['yg_id']&&!data['href']){all_data[formfieldid+'-VALUE01']=$K.appdir+'page/'+data['yg_id'].split('-')[1]+'/'+data['yg_id'].split('-')[0];all_data[formfieldid+'-VALUE02']='';all_data[formfieldid+'-VALUE03']='';all_data[formfieldid+'-VALUE04']='';}else{all_data[formfieldid+'-VALUE01']=data['href'];all_data[formfieldid+'-VALUE02']=data['target'];all_data[formfieldid+'-VALUE03']='';all_data[formfieldid+'-VALUE04']=data['onclick'];}}else if(data&&data['objecttype']&&data['objecttype']=='link'){$(which).up('.selectionmarker').down('.icn').className='icn iconlink';which.up('.title').previous().show();all_data[formfieldid+'-VALUE01']=data['href'];all_data[formfieldid+'-VALUE02']=data['target'];all_data[formfieldid+'-VALUE03']='';all_data[formfieldid+'-VALUE04']=data['onclick'];}else if(data&&data['objecttype']&&data['objecttype']=='email'){$(which).up('.selectionmarker').down('.icn').className='icn iconemail';which.up('.title').previous().show();all_data[formfieldid+'-VALUE01']=data['href'];all_data[formfieldid+'-VALUE02']='';all_data[formfieldid+'-VALUE03']='';all_data[formfieldid+'-VALUE04']='';}else if(data&&data['objecttype']&&data['objecttype']=='file'){which.up('.title').previous().hide();if(data['yg_id']&&!data['href']){all_data[formfieldid+'-VALUE01']=$K.appdir+'download/'+data['yg_id'].split('-')[0];}else{all_data[formfieldid+'-VALUE01']=data['href'];}
all_data[formfieldid+'-VALUE02']='';all_data[formfieldid+'-VALUE03']='';all_data[formfieldid+'-VALUE04']='';if(data['filecolor'].strip().length&&data['filetype'].strip().length&&data['title'].strip().length){data['title']='<span class="filetype '+data['filecolor']+'" yg_type="'+$K.windows[which.up('.ywindow').id].yg_type+'" yg_id="'+$K.windows[which.up('.ywindow').id].yg_id+'" yg_property="type">'+data['filetype']+'</span>'+data['title'];}}
if((!data['title'])||(data['title']=='')){data['title']=$K.TXT('TXT_SELECTOR_LINK');}
which.update(data['title']);which.up('.maskedit').writeAttribute('param01',all_data[formfieldid+'-VALUE01']);which.up('.maskedit').writeAttribute('param02',all_data[formfieldid+'-VALUE02']);which.up('.maskedit').writeAttribute('param03',all_data[formfieldid+'-VALUE03']);which.up('.maskedit').writeAttribute('param04',all_data[formfieldid+'-VALUE04']);havedata=true;break;case 6:$K.log('File',$K.Log.INFO);if(data.title.toLowerCase().startsWith('<span class="')){which.update(data.title);}else{which.update('<span class="filetype '+data.filecolor+'">'+data.filetype+'</span>'+data.title);}
which.up('div.title').writeAttribute('onmouseover','$K.yg_hoverFileHint(\''+data['yg_id'].split('-')[0]+'\', event);');all_data[formfieldid+'-VALUE01']=data['yg_id'].split('-')[0];havedata=true;break;case 7:$K.log('Contentblock',$K.Log.INFO);$(which).innerHTML=data["title"];$(which).up('.selectionmarker').down('.icn').className='icn iconcblock';all_data[formfieldid+'-VALUE01']=data['yg_id'].split('-')[0];havedata=true;break;case 8:$K.log('Tag',$K.Log.INFO);$(which).innerHTML=data["title"];$(which).up('.selectionmarker').down('.icn').className='icn icontag';all_data[formfieldid+'-VALUE01']=data['yg_id'].split('-')[0];havedata=true;break;case 9:$K.log('List',$K.Log.INFO);all_data[formfieldid+'-VALUE01']=which.value;havedata=true;break;case 10:$K.log('Password',$K.Log.INFO);all_data[formfieldid+'-VALUE01']=which.value;havedata=true;break;case 11:$K.log('Date',$K.Log.INFO);all_data[formfieldid+'-VALUE01']=which.value;havedata=true;break;case 12:$K.log('Datetime',$K.Log.INFO);var fieldId=which.id;if(fieldId.endsWith('2')){fieldId=fieldId.substring(0,fieldId.length-1);}
var newValue=$(fieldId).value+'||'+$(fieldId+'2').value;all_data[formfieldid+'-VALUE01']=newValue;havedata=true;break;case 15:$K.log('Page',$K.Log.INFO);$(which).innerHTML=data["title"];$(which).up('.selectionmarker').down('.icn').className='icn iconpage';all_data[formfieldid+'-VALUE01']=data['yg_id'].split('-')[0];all_data[formfieldid+'-VALUE02']=data['yg_id'].split('-')[1];havedata=true;break;case 16:$K.log('Filefolder',$K.Log.INFO);$(which).innerHTML=data["title"];$(which).up('.selectionmarker').down('.icn').className='icn iconfolder';all_data[formfieldid+'-VALUE01']=data['yg_id'].split('-')[0];havedata=true;break;default:$K.warn('Not implemented yet! (Type: '+formfieldtype+')',$K.Log.INFO);break;}
if(havedata){$K.log('aquired data is:',all_data,$K.Log.INFO);var winID=which.up('.ywindow').id;var backendAction='savePageEntrymask';var ajaxParams={};if($K.windows[winID].tab=='EXTENSIONS'){var yg_id=$K.windows[winID].yg_id;backendAction='saveExtensionProperties';ajaxParams.page=yg_id.split('-')[0];ajaxParams.site=yg_id.split('-')[1];all_data.id=which.up('.emcontentinner').id.split('_')[4].split('-')[1];}
ajaxParams.allData=Object.toJSON(all_data);var data=Array('noevent',{yg_property:backendAction,params:ajaxParams});$K.yg_AjaxCallback(data,backendAction);}}
;$K.yg_selectNode=function(node,e,init){if(!node||node.nodeName=='A')
return false;var wid=parseInt($(node).up('.ywindow').id.replace(/wid_/g,''));if(typeof(node)=='object'){var nodeid=node.id;var prefix=node.id.substring(0,node.id.indexOf('_'));if(node.up('.nlstree')||node.up('.darknlstree')){tree=true;}else{tree=false;}
if((tree)&&(nlsTree[prefix+'_tree'+wid+'_tree']==undefined))
return false;if(tree==false){if(node.hasClassName('mk_user')||node.hasClassName('mk_mailing')){var data=node.readAttribute("yg_id").split('-');}else{var data=node.up(1).readAttribute("yg_id").split('-');}
var page=data[0];var site=data[1];}else if(nlsTree[prefix+'_tree'+wid+'_tree'].nLst[nodeid].yg_id!=null){var data=nlsTree[prefix+'_tree'+wid+'_tree'].nLst[nodeid].yg_id.split('-');var page=data[0];var site=data[1];var url=nlsTree[prefix+'_tree'+wid+'_tree'].nLst[nodeid].ygurl;}else{var data=nlsTree[prefix+'_tree'+wid+'_tree'].nLst[nodeid].orgId.split('_')
var page=data[0];var site=data[1];var url=nlsTree[prefix+'_tree'+wid+'_tree'].nLst[nodeid].ygurl;}
if(tree){var type=nlsTree[prefix+'_tree'+wid+'_tree'].yg_type;}else{var type=node.readAttribute('yg_type');if(node.up('li')){type=node.up('li').readAttribute('yg_type');}else{type=node.readAttribute('yg_type');}
if(type==undefined||type==''){type=$(node).up('.ywindow').yg_type;}}}
selNode=page+'-'+site;var selectOldNode=Prototype.emptyFunction;if((typeof(node)=='object')&&($K.windows['wid_'+wid].yg_id)&&nlsTree[prefix+'_tree'+wid+'_tree']){var objectType=nlsTree[prefix+'_tree'+wid+'_tree'].nLst[prefix+'_tree'+wid+'_treeroot_1'].yg_type;var selNodeId=prefix+'_tree'+wid+'_tree'+objectType+'_'+$K.windows['wid_'+wid].yg_id.split('-')[0];selectOldNode=function(){nlsTree[prefix+'_tree'+wid+'_tree'].selectNode(selNodeId);}}
var notDelayed=function(){var boundwin=false;if($K.windows['wid_'+wid]&&($K.windows['wid_'+wid].boundWindow!=undefined)&&($K.windows['wid_'+wid].boundWindow!='')&&($K.windows[$K.windows['wid_'+wid].boundWindow]!=undefined))
boundwin=true;var tmparr=new Array();if(tree){if(nlsTree[prefix+'_tree'+wid+'_tree']){var tmparr=nlsTree[prefix+'_tree'+wid+'_tree'].getSelNodes();if(tmparr[0]){var tmparr=tmparr[0].id.split("_");}
var selNodeCount=nlsTree[prefix+'_tree'+wid+'_tree'].getSelNodes().length;}}else{selNodeCount=$K.yg_getFocusObj($("wid_"+wid)).length;}
if(boundwin&&((selNodeCount>1)||(selNodeCount==0)||(tmparr[2]=="treeroot"))){$($K.windows['wid_'+wid].boundWindow).addClassName('boxghost');$K.yg_windowResized();}else if(boundwin&&$($K.windows['wid_'+wid].boundWindow).hasClassName('boxghost')){$($K.windows['wid_'+wid].boundWindow).removeClassName('boxghost');$K.yg_windowResized();}
if(selNodeCount<2)
if($('wid_'+wid))
$('wid_'+wid).removeClassName('mk_multiselect');if(boundwin)
$K.windows[$K.windows['wid_'+wid].boundWindow].tabs.init();if(selNodeCount==0){tmparr=$('wid_'+wid+'_buttons').descendants();tmparr.each(function(item){btn=item.down('.tree_btn');if(btn&&(btn.hasClassName('globalfunc')==false))btn.addClassName('disabled');});}else if(selNodeCount>1){$K.yg_toggleTreeButtons('wid_'+wid);}}
window.setTimeout(notDelayed,0);if(e){if(e&&(e.ctrlKey||e.metaKey||e.shiftKey)){$('wid_'+wid).addClassName('mk_multiselect');$K.yg_clearTextSelection();return true;}}
if(($K.windows['wid_'+wid].boundWindow!=undefined)||($('wid_'+wid+'_column2innercontentinner'))||($K.windows['wid_'+wid].tab=='MAILINGS')||($K.windows['wid_'+wid].tab=='TAGS_TREE')){$K.yg_checkOpenWindows($K.windows['wid_'+wid].yg_id,$K.windows['wid_'+wid].yg_type,{onBeforeShow:selectOldNode,onSuccess:function(){if(nlsTree[prefix+'_tree'+wid+'_tree']){var objectType=nlsTree[prefix+'_tree'+wid+'_tree'].nLst[prefix+'_tree'+wid+'_treeroot_1'].yg_type;if(objectType!='templatefolder'){try{if(node.down('a').hasClassName('root')||node.down('a').hasClassName('selroot')){nlsTree[prefix+'_tree'+wid+'_tree'].selectNode(prefix+'_tree'+wid+'_treeroot_1');}else if(selNode!='trash-file'){nlsTree[prefix+'_tree'+wid+'_tree'].selectNode(node.id);}}catch(e){}}}
$K.yg_fireLateOnChange();$K.windows['wid_'+wid].yg_id=selNode;if(($K.windows['wid_'+wid].boundWindow!=undefined)&&($K.windows['wid_'+wid].boundWindow!='')&&($K.windows[$K.windows['wid_'+wid].boundWindow]!=undefined)){$K.windows[$K.windows['wid_'+wid].boundWindow].yg_id=$K.windows['wid_'+wid].yg_id;origWin=$K.windows[$K.windows['wid_'+wid].boundWindow];origNo=parseInt($K.windows['wid_'+wid].boundWindow.replace(/wid_/g,''));var completed=function(){$K.yg_customAttributeHandler($($K.windows['wid_'+wid].boundWindow));}
var tabInner=$($K.windows['wid_'+wid].boundWindow+'_innercontent');var tabInnerChildren=tabInner.childElements();for(var k=0;k<tabInnerChildren.length;k++){tabInnerChildren[k].innerHTML='';}
var tabBottom=$($K.windows['wid_'+wid].boundWindow+'_bottom');var tabBottomChildren=tabBottom.childElements();for(var k=0;k<tabBottomChildren.length;k++){if(!tabBottomChildren[k].hasClassName('minibottom')){tabBottomChildren[k].remove();tmphei=$($K.windows['wid_'+wid].boundWindow+'_container').getHeight()+19;$($K.windows['wid_'+wid].boundWindow+'_container').setStyle({height:tmphei+'px'});$($K.windows['wid_'+wid].boundWindow+'_ywindowinner').setStyle({height:tmphei+'px'});}}
var tabs=$K.windows[$K.windows['wid_'+wid].boundWindow].tabs.elements;for(var k=0;k<tabs.length;k++){tabs[k]["LOADED"]=false;}
var lastselected=$K.windows[$K.windows['wid_'+wid].boundWindow].tabs.selected;var iconstyle='page';var titlestyle='title';var icon='';if(tree){var title=node.down('a').innerHTML;title=title.replace(/&nbsp;/g,' ').strip();var style=node.down('a').className;var icon=node.down('.tree_ico').src.split("/");var icon=icon[icon.length-1];}else{if(node.down('.title')){if(node.down('.title').down('b')){title=node.down('.title').down('b').innerHTML;}else if(node.down('.title').down('strong')){title=node.down('.title').down('strong').innerHTML;}else{title=node.down('.title').innerHTML;}}}
$K.windows[$K.windows['wid_'+wid].boundWindow].folderselected=0;$K.windows[$K.windows['wid_'+wid].boundWindow].trashcanselected=0;$($K.windows['wid_'+wid].boundWindow+'_buttons').removeClassName('mk_folder');$($K.windows['wid_'+wid].boundWindow+'_buttons').removeClassName('mk_trashcan');if((icon.indexOf('folder')>-1)){if($K.windows[$K.windows['wid_'+wid].boundWindow].tabs.elements[lastselected]["FOLDER"]!=1){lastselected=-1;k=0;while(lastselected==-1){if(!($K.windows[$K.windows['wid_'+wid].boundWindow].tabs.elements[k]))
break;if($K.windows[$K.windows['wid_'+wid].boundWindow].tabs.elements[k]["FOLDER"]>0)
lastselected=k;k++;}}
$K.windows[$K.windows['wid_'+wid].boundWindow].folderselected=1;$K.windows[$K.windows['wid_'+wid].boundWindow].setIcon('folder');$($K.windows['wid_'+wid].boundWindow+'_buttons').addClassName('mk_folder');}else if((icon.indexOf('trashcan')>-1)){lastselected=-1;delete $K.windows[$K.windows['wid_'+wid].boundWindow].loadparams.pagedir_orderby;delete $K.windows[$K.windows['wid_'+wid].boundWindow].loadparams.pagedir_orderdir;k=0;while(lastselected==-1){if(!($K.windows[$K.windows['wid_'+wid].boundWindow].tabs.elements[k]))
break;if($K.windows[$K.windows['wid_'+wid].boundWindow].tabs.elements[k]["TRASHCAN"])
lastselected=k;k++;}
$K.windows[$K.windows['wid_'+wid].boundWindow].setIcon('trashcan');$K.windows[$K.windows['wid_'+wid].boundWindow].trashcanselected=1;$($K.windows['wid_'+wid].boundWindow+'_buttons').addClassName('mk_trashcan');}else if(type=='page'){if(icon.indexOf('hidden')!=-1)
iconstyle+='hidden';if(icon.indexOf('inactive')!=-1)
iconstyle+='inactive';if(icon.indexOf('softsync')!=-1)
iconstyle+='softsync';if(style.indexOf('changed')!=-1)
titlestyle+=' changed';if(style.indexOf('nowrite')!=-1)
titlestyle+=' nowrite';$K.windows[$K.windows['wid_'+wid].boundWindow].setIcon(iconstyle);}else if(type=='cblock'){if(style.indexOf('changed')!=-1)
titlestyle+=' changed';if(style.indexOf('nowrite')!=-1)
titlestyle+=' nowrite';$K.windows[$K.windows['wid_'+wid].boundWindow].setIcon(type);}else if((type=='extpage')||(type=='extcblock')||(type=='extfile')||(type=='extmailing')||(type=='extimport')||(type=='extexport')||(type=='extcolistview')){$K.windows[$K.windows['wid_'+wid].boundWindow].setExtensionIcon(node.down('.iconextension').readAttribute('style'));$K.windows[$K.windows['wid_'+wid].boundWindow].setIcon(type);}else if(type=='user'){var userpicture;if(!userpicture){userpicture=$K.imgdir+'content/temp_userpic.png';}
$K.windows[$K.windows['wid_'+wid].boundWindow].setUserHeader(userpicture,$(node).readAttribute('user_name'),$(node).readAttribute('user_company'),nodeid.split('_')[2]);}else{$K.windows[$K.windows['wid_'+wid].boundWindow].setIcon(type);}
$K.windows[$K.windows['wid_'+wid].boundWindow].setCaption(title,type);$K.windows[$K.windows['wid_'+wid].boundWindow].setCaptionStyle(titlestyle);$('wid_'+wid+'_title').writeAttribute('yg_id',$K.windows['wid_'+wid].yg_id);if((lastselected!=undefined)&&(lastselected>=0)&&(($K.windows[$K.windows['wid_'+wid].boundWindow].tabs.elements[$K.windows[$K.windows['wid_'+wid].boundWindow].tabs.selected]["TRASHCAN"]==false)||($K.windows[$K.windows['wid_'+wid].boundWindow].trashcanselected==1))&&(($K.windows[$K.windows['wid_'+wid].boundWindow].tabs.elements[lastselected]["FOLDER"]!=2)&&($K.windows[$K.windows['wid_'+wid].boundWindow].folderselected!=1))||(($K.windows[$K.windows['wid_'+wid].boundWindow].tabs.elements[lastselected]["FOLDER"]>0)&&($K.windows[$K.windows['wid_'+wid].boundWindow].folderselected==1))){if(init!=false)$K.windows[$K.windows['wid_'+wid].boundWindow].tabs.select(lastselected);}else{for(var i=0;i<$K.windows[$K.windows['wid_'+wid].boundWindow].tabs.elements.length;i++){if($K.windows[$K.windows['wid_'+wid].boundWindow].tabs.elements[i]["FOLDER"]<2){if(init!=false)$K.windows[$K.windows['wid_'+wid].boundWindow].tabs.select(i);break;}}}
if(type=='page'){$K.yg_updatePreviewUrls($K.windows['wid_'+wid].boundWindow,url);var btn=$($K.windows['wid_'+wid].boundWindow+'_buttons').down('.ywindow_bt');var btn2=$($K.windows['wid_'+wid].boundWindow+'_buttons').down('.ywindow_btl');btn.firstChild.setAttribute('yg_id',$K.windows['wid_'+wid].yg_id);btn.firstChild.yg_id=$K.windows['wid_'+wid].yg_id;btn.firstChild.yg_done=undefined;if(btn2&&btn2.firstChild){btn2.firstChild.setAttribute('yg_id',$K.windows['wid_'+wid].yg_id+'-'+$K.windows['wid_'+wid].boundWindow.replace(/wid_/,''));btn2.firstChild.yg_id=$K.windows['wid_'+wid].yg_id+'-'+$K.windows['wid_'+wid].boundWindow.replace(/wid_/,'');}}
if(type=='cblock'){var btn=$($K.windows['wid_'+wid].boundWindow+'_buttons').down('.ywindow_bt');var btn2=$($K.windows['wid_'+wid].boundWindow+'_buttons').down('.ywindow_btl');if(btn.down().hasClassName('clear')==false){btn.next().down().onclick=function(ev){Event.stop(ev);$K.yg_preview({objecttype:'cblock',id:page});}
btn.next().down().href=$K.appdir+"?preview=1&objecttype=cblock&id="+page;btn.down().onclick=function(ev){Event.stop(ev);$K.yg_preview({objecttype:'cblock',id:page,version:'working'});}
btn.down().href=$K.appdir+"?preview=1&objecttype=cblock&id="+page+"&version=working";}
btn.firstChild.setAttribute('yg_id',$K.windows['wid_'+wid].yg_id);btn.firstChild.yg_id=$K.windows['wid_'+wid].yg_id;btn.firstChild.yg_done=undefined;if(btn2&&btn2.firstChild){btn2.firstChild.setAttribute('yg_id',$K.windows['wid_'+wid].yg_id+'-'+$K.windows['wid_'+wid].boundWindow.replace(/wid_/,''));btn2.firstChild.yg_id=$K.windows['wid_'+wid].yg_id+'-'+$K.windows['wid_'+wid].boundWindow.replace(/wid_/,'');$K.log('FC: ',btn2.firstChild.yg_done,$K.Log.DEBUG);}}
$K.yg_customAttributeHandler($($K.windows['wid_'+wid].boundWindow+'_buttons'));}
if(($K.windows['wid_'+wid].tab=='PAGES_TREE_EXTRAS')&&(selNode.split('-')[1].startsWith('cblock'))){$('wid_'+wid+'_column2innercontentinner').innerHTML='';$('wid_'+wid+'_column2innercontentinner').addClassName('tab_loading');var objectType='page';new Ajax.Updater('wid_'+wid+'_column2innercontentinner',$K.appdir+'cblocks',{evalScripts:true,asynchronous:true,method:'post',parameters:{win_no:wid,co:selNode,displaymode:'dialog',us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId(),site:'cblock_copy',page:'cblock_copy'},onComplete:function(){$K.windows["wid_"+wid].refresh("col2");$('wid_'+wid+'_column2innercontentinner').removeClassName('tab_loading');$K.yg_customAttributeHandler($('wid_'+wid+'_column2innercontentinner'))},onSuccess:function(transport){}});return true;}
if(($K.windows['wid_'+wid].tab=='PAGES_TREE_EXTRAS')&&!isNaN(parseInt(selNode.split('-')[1]))){$('wid_'+wid+'_column2innercontentinner').innerHTML='';$('wid_'+wid+'_column2innercontentinner').addClassName('tab_loading');var objectType='page';new Ajax.Updater('wid_'+wid+'_column2innercontentinner',$K.appdir+'tab_CONTENT',{asynchronous:true,evalScripts:true,method:'post',parameters:{yg_id:selNode,yg_type:objectType,win_no:wid,displaymode:'dialog',us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()},onComplete:function(){$K.yg_initContentTab.defer($K.windows['wid_'+wid].yg_id,'',$K.windows['wid_'+wid].id,'page');}});return true;}
if((node.up('.ywindow').hasClassName('ydialog'))&&!isNaN(parseInt(selNode.split('-')[0]))&&(selNode.split('-')[1]=='file')){if($('wid_'+wid+'_column2innercontentinner'))
$('wid_'+wid+'_column2innercontentinner').update('');$K.yg_hideColumn2Bottom('wid_'+wid);if($('wid_'+wid+'_column2innercontentinner'))
$('wid_'+wid+'_column2innercontentinner').addClassName('tab_loading');var view='listview';if($('wid_'+wid).hasClassName('thumbview')){view='thumbview';}
if(!$('wid_'+wid+'_column2innercontentinner'))
return;parameters=$K.windows['wid_'+wid].loadparams;parameters['yg_id']=selNode;parameters['wid']='wid_'+wid;parameters['displaymode']='dialog';parameters['view']=view;parameters['us']=document.body.id;parameters['lh']=$K.yg_getLastGuiSyncHistoryId();new Ajax.Updater('wid_'+wid+'_column2innercontentinner',$K.appdir+'tab_FOLDERCONTENT',{asynchronous:true,evalScripts:true,method:'post',parameters:parameters,onComplete:function(){$K.yg_customAttributeHandler($('wid_'+wid+'_ywindowinner'));$K.yg_customAttributeHandler($('wid_'+wid+'_column2innercontent'));var thumbContainer=$('wid_'+wid+'_column2innercontentinner');if($('wid_'+wid).hasClassName('filelist3')){$K.yg_loadThumbPreview(thumbContainer,'.mk_filelist img');}else if($('wid_'+wid).hasClassName('thumbview')){$K.yg_loadThumbPreview(thumbContainer,'.mk_filepreview img');}
$K.windows['wid_'+wid].refresh();$('wid_'+wid+'_column2innercontentinner').removeClassName('tab_loading');}});return true;}
if((node.up('.ywindow').hasClassName('ydialog'))&&!isNaN(parseInt(selNode.split('-')[0]))&&(selNode.split('-')[1]=='template')){if($('wid_'+wid+'_column2innercontentinner')){$('wid_'+wid+'_column2innercontentinner').addClassName('tab_loading');$('wid_'+wid+'_column2innercontentinner').innerHTML="";new Ajax.Updater('wid_'+wid+'_column2innercontentinner',$K.appdir+'template_info/',{onComplete:function(){$('wid_'+wid+'_column2innercontentinner').removeClassName('tab_loading');$K.windows['wid_'+wid].init();},asynchronous:true,evalScripts:true,method:'post',onlyLatestOfClass:wid+'_TAB_CONTENT',parameters:{template:selNode.split('-')[0],us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}});}
return true;}
if((node.up('.ywindow').hasClassName('ydialog'))&&(type=='usergroup')){return true;}
if((type=='file')&&($($K.windows['wid_'+wid].boundWindow))&&(!$($K.windows['wid_'+wid].boundWindow).down('.ywindowfilter'))){return false;}
if((type=='page')&&(!($K.windows[node.up('.ywindow').id].boundWindow))){return false;}
var backendAction;switch(type){default:case'site':backendAction='siteSelectNode';break;case'page':backendAction='pageSelectNode';break;case'file':backendAction='fileSelectNode';break;case'tag':backendAction='tagSelectNode';break;case'template':backendAction='templateSelectNode';break;case'entrymask':backendAction='entrymaskSelectNode';break;case'extension':backendAction='extensionSelectNode';break;case'cblock':backendAction='contentblockSelectNode';break;case'usergroup':backendAction='usergroupsSelectNode';break;case'user':backendAction='userSelectNode';break;case'mailing':backendAction='mailingSelectNode';break;}
var data=Array('noevent',{yg_property:backendAction,params:{node:selNode.split('-')[0],siteID:selNode.split('-')[1],wid:wid}});var backendDelayed=function(){if(!$K.windows["wid_"+wid])
return;if(($K.yg_getFocusObj($("wid_"+wid+"_"+$K.windows["wid_"+wid].tab.toUpperCase())).indexOf(node)>-1)||$("wid_"+wid+"_"+$K.windows["wid_"+wid].tab.toUpperCase()).down('.wdgt_tree')){$K.yg_AjaxCallback(data,backendAction);}}
window.setTimeout(backendDelayed,0);}});}else{$K.windows['wid_'+wid].yg_id=selNode;}
$(node).up('.ywindow').removeClassName('mk_multiselect');}
;$K.initSortable=function(elementRef){elementRef=$(elementRef);if(!elementRef)return false;var widgetData={};var widgetInfo=elementRef.readAttribute('yg_widget');widgetInfo.split(';').each(function(item){var itemData=item.split(':');if(itemData[0]&&itemData[1]){widgetData[itemData[0]]=itemData[1];}});var defaultCallbacks={starteffect:function(element,widgetData){Draggable._dragging[element]=true;if(widgetData.callbacks&&$K[widgetData.callbacks]&&(typeof $K[widgetData.callbacks].starteffect=='function')){$K[widgetData.callbacks].starteffect.bind(this)(element);}},endeffect:function(element,widgetData){Draggable._dragging[element]=false;if(widgetData.callbacks&&$K[widgetData.callbacks]&&(typeof $K[widgetData.callbacks].endeffect=='function')){$K[widgetData.callbacks].endeffect.bind(this)(element);}},onUpdate:function(element,widgetData){if(widgetData.callbacks&&$K[widgetData.callbacks]&&(typeof $K[widgetData.callbacks].onUpdate=='function')){$K[widgetData.callbacks].onUpdate.bind(this)(element);}}};var sortableOptions={dropOnEmpty:true,constraint:false,ghosting:true,accepts:widgetData.accepts,objectType:widgetData.objecttype,containment:[elementRef.id],starteffect:function(element){defaultCallbacks.starteffect.bindAsEventListener(this,widgetData)(element);},endeffect:function(element){defaultCallbacks.endeffect.bindAsEventListener(this,widgetData)(element);},onUpdate:function(element){defaultCallbacks.onUpdate.bindAsEventListener(this,widgetData)(element);}};if(widgetData.yg_clone!=undefined)sortableOptions.yg_clone=widgetData.yg_clone;if(widgetData.tag!=undefined)sortableOptions.tag=widgetData.tag;if(widgetData.tagTree!=undefined)sortableOptions.tag=widgetData.tagTree;if(widgetData.callbacks&&$K[widgetData.callbacks]&&(typeof $K[widgetData.callbacks].onCreate=='function')){$K[widgetData.callbacks].onCreate.bind(elementRef)(elementRef);}
Sortable.create(elementRef.id,sortableOptions);}
$K.yg_initSortable=function(obj){obj=$(obj);if(!obj.down('.mk_scrollbars'))return;$K.yg_renderScroll(obj.down('.mk_scrollbars'),obj.id);var swid=obj.up().getWidth()-2;var shei=obj.up().getHeight()-2;if((shei>0)&&(swid>0)){obj.setStyle({width:swid+'px',height:shei+'px'});}
tmpcont=obj.down('.sortablelistcontainer');if((shei>0)&&(swid>0)){tmpcont.setStyle({width:swid+'px',height:shei+'px'});}
tmplist=tmpcont.down();if((tmplist.getHeight()>shei)&&((shei>0)&&(swid>0))){tmplist.setStyle({width:(swid-$K.yg_scrollObjAttr.scrollBtnVWidth)+'px'})}else{tmplist.setStyle({width:'100%'});}
$K.scrollbars[obj.id]=$K.yg_initScrollbars(obj,obj.down('.sortablelistcontainer'),obj.down('.sortablelist'),$(obj.id+'_dragbar_v'),$(obj.id+'_track_v'),$(obj.id+'_dragbar_h'),$(obj.id+'_track_h'),0);$(obj.id).observe('mouseover',function(ev){if($K.yg_scrollObjAttr.activeArea!=this.id){$K.yg_preactive=$K.yg_scrollObjAttr.activeArea;$K.yg_scrollObjAttr.activeArea=obj.id;}});$(obj.id).observe('mouseout',function(ev){if($K.yg_scrollObjAttr.activeArea!=$K.yg_preactive){if($K.yg_preactive!=false){$K.yg_scrollObjAttr.activeArea=$K.yg_preactive;$K.yg_preactive=false;}}});$K.scrollbars[obj.id].setBarSize();}
;$K.yg_pageDir=function(obj){obj=$(obj);var winID=obj.up('.ywindow').id;if(obj.tagName=='INPUT'){var value=obj.value;}else{var value=obj.readAttribute('value');}
if(obj.up().hasClassName('textbox')){var currMaxPages=parseInt($(winID+'_pagedir_'+$K.windows[winID].tab).down('div.currentpage').down('strong').innerHTML,10);if(value<1)value=1;if(value>currMaxPages)value=currMaxPages;obj.value=value;$K.windows[winID].loadparams.pagedir_page=value;$K.windows[winID].loadparams.pagedir_from=(value-1)*parseInt($K.windows[winID].loadparams.pagedir_perpage,10)+1;}else{if(obj.readAttribute('shortname')){obj.up().previous().down().innerHTML=obj.readAttribute('shortname');}
$K.windows[winID].loadparams.pagedir_perpage=value;$K.windows[winID].loadparams.pagedir_page=1;$K.windows[winID].loadparams.pagedir_from=1;$(winID+'_pagedir_'+$K.windows[winID].tab).down('div.currentpage').down('input').value=1;}
$K.windows[winID].tabs.select($K.windows[winID].tabs.selected,{refresh:1},false,true);}
$K.yg_pageDirIE=function(which,e){if(Prototype.Browser.IE){which=$(which);if(e.keyCode==13){$K.yg_pageDir(which);}}}
$K.yg_pageDirReset=function(win){$K.windows[win].loadparams['pagedir_page']=1;$K.windows[win].loadparams['pagedir_from']=1;$K.windows[win].loadparams['pagedir_limit']='0,'+$K.windows[win].loadparams['pagedir_perpage'];if($(win+'_pagedir_'+$K.windows[win].tab)){$(win+'_pagedir_'+$K.windows[win].tab).down('div.currentpage').down('input').value=1;}}
$K.yg_pageDirNext=function(which){which=$(which);var winID=which.up('.ywindow').id;var currMaxPages=parseInt($(winID+'_pagedir_'+$K.windows[winID].tab).down('div.currentpage').down('strong').innerHTML,10);var currPage=$K.windows[winID].loadparams.pagedir_page;currPage++;if(currPage>currMaxPages)currPage=currMaxPages;$K.windows[winID].loadparams.pagedir_page=currPage;$K.windows[winID].loadparams.pagedir_from=(currPage-1)*parseInt($K.windows[winID].loadparams['pagedir_perpage'],10)+1;$(winID+'_pagedir_'+$K.windows[winID].tab).down('div.currentpage').down('input').value=currPage;$K.windows[winID].tabs.select($K.windows[winID].tabs.selected,{refresh:1});}
$K.yg_pageDirPrevious=function(which){which=$(which);var winID=which.up('.ywindow').id;var currPage=$K.windows[winID].loadparams.pagedir_page;currPage--;if(currPage<1)currPage=1;$K.windows[winID].loadparams.pagedir_page=currPage;$K.windows[winID].loadparams.pagedir_from=(currPage-1)*parseInt($K.windows[winID].loadparams['pagedir_perpage'],10)+1;$(winID+'_pagedir_'+$K.windows[winID].tab).down('div.currentpage').down('input').value=currPage;$K.windows[winID].tabs.select($K.windows[winID].tabs.selected,{refresh:1});}
$K.yg_pageDirOrderBy=function(which){var winId=which.up('.ywindow').id;var currColNum;var columns=$(which).up().immediateDescendants();for(var i=0;i<columns.length;i++){if($(columns[i])==$(which)){currColNum=i;break;}}
currColNum+=1;currColIndex=$(which).readAttribute('yg_colindex');var oldSortColumn=$K.windows[winId].loadparams.pagedir_orderby;if(!$K.windows[winId].loadparams.pagedir_orderdir){$K.windows[winId].loadparams.pagedir_orderdir=1;}
$K.windows[winId].loadparams.pagedir_orderby=currColIndex;if($K.windows[winId].loadparams.pagedir_orderby==oldSortColumn){$K.windows[winId].loadparams.pagedir_orderdir=($K.windows[winId].loadparams.pagedir_orderdir*-1);}else{$K.windows[winId].loadparams.pagedir_orderdir=1;}
if($K.windows[winId].loadparams&&($K.windows[winId].loadparams.pagedir_perpage&&(($K.windows[winId].loadparams.pagedir_perpage==-1)||($K.windows[winId].loadparams.pagedir_perpage>=parseInt($(winId+'_objcnt').innerHTML,10))))||(!($K.windows[winId].loadparams.pagedir_perpage))){TableKit.Sortable.sort(winId+'_tablecontent',currColNum);}else{$K.windows[winId].tabs.select($K.windows[winId].tabs.selected,{refresh:1});}}
$K.yg_pageDirUpdate=function(winID,currentPage,perPage,maxPages,orderBy,orderDir,from,limit){if($K.windows['wid_'+winID]){$K.windows['wid_'+winID].loadparams.pagedir_page=currentPage;$K.windows['wid_'+winID].loadparams.pagedir_perpage=perPage;$K.windows['wid_'+winID].loadparams.pagedir_orderby=orderBy;$K.windows['wid_'+winID].loadparams.pagedir_orderdir=orderDir;if(orderDir=="ASC")$K.windows['wid_'+winID].loadparams.pagedir_orderdir=1;if(orderDir=="DESC")$K.windows['wid_'+winID].loadparams.pagedir_orderdir=-1;$K.windows['wid_'+winID].loadparams.pagedir_from=from;$K.windows['wid_'+winID].loadparams.pagedir_limit=limit;if($('wid_'+winID+'_pagedir_'+$K.windows['wid_'+winID].tab)){if(maxPages==0)maxPages=1;$('wid_'+winID+'_pagedir_'+$K.windows['wid_'+winID].tab).down('div.currentpage').down('strong').update(maxPages);$('wid_'+winID+'_pagedir_'+$K.windows['wid_'+winID].tab).down('div.currentpage').down('input').value=currentPage;}}}
;$K.yg_currentdragobj=new Array();$K.yg_activeDragInfo=new Object();$K.yg_currentHover=null;$K.yg_overDroppable=null;$K.yg_mouseCoords=new Object();$K.yg_mousedown=false;$K.yg_dropAreas=new Array();$K.yg_recreateSortables=function(which){if($(which)){if(!Sortable.sortables[which])return;var containments=Sortable.sortables[which].containment;var containments_clean=new Array();if(typeof(containments.each)=='function'){containments.each(function(item){if($(item))containments_clean.push(item);});}else{if($(containments))containments_clean.push($(containments).id);}
containments_clean.each(function(item){Sortable.create(item,{accepts:Sortable.sortables[item].accepts,objectType:Sortable.sortables[item].objectType,dropOnEmpty:Sortable.sortables[item].dropOnEmpty,containment:Sortable.sortables[item].containment,handle:Sortable.sortables[item].handle,constraint:Sortable.sortables[item].constraint,ghosting:Sortable.sortables[item].ghosting,yg_clone:Sortable.sortables[item].yg_clone,starteffect:Sortable.sortables[item].starteffect,reverteffect:Sortable.sortables[item].reverteffect,endeffect:Sortable.sortables[item].endeffect,onUpdate:Sortable.sortables[item].onUpdate});});}}
$K.yg_clearPlaceHolder=function(){if(Sortable._marker){if(Sortable._marker.hoverOverMarker)
return;}
if($('placeHolder')){if($('placeHolder').hoverOverMarker)
return;}
if(Sortable)Sortable.unmark();$K.yg_activeDragInfo.hoverOverTree=false;}
$K.yg_clearDragSession=function(){$K.yg_activeDragInfo.dragging=false;$K.yg_activeDragInfo.hoverOverTree=false;$K.yg_activeDragInfo.hoverOverSortable=false;$K.yg_activeDragInfo.target=null;$K.yg_activeDragInfo.position=null;with($('yg_ddGhost')){setStyle({display:'none'});dataTxt=null;dataXtra=null;_originalParent=null;}
if($('yg_ddGhost').srcReference){$('yg_ddGhost').srcReference.finishDrag(null,false);}
$('yg_ddGhostTree').hide();if(nlsddSession)nlsddSession.consume();document.onmousemove=null;document.onmouseup=null;document.onmousedown=function(){return true;};document.onselectstart=function(){return true;};document.ondragstart=function(){return true;};$K.yg_clearPlaceHolder();document.body.removeClassName('drag');}
$K.yg_ddScrollOver=function(element,direction){if(nlsddSession&&nlsddSession.action){$K.yg_scroll_initScroll(element,direction);}
if(Draggables.activeDraggable){if(Sortable._marker){Sortable._marker.hide();}
$K.yg_scroll_initScroll(element,direction);}}
$K.yg_ddScrollOut=function(element){if(nlsddSession&&nlsddSession.action){$K.yg_scroll_stopScroll(element);}
if(Draggables.activeDraggable){$K.yg_scroll_stopScroll(element);}}
$K.yg_updateSortables=function(){for(var i=0;i<$K.yg_treecount;i++){if($K.yg_dynTreesWNDO[i]!=undefined){$K.yg_dynTreesWNDO[i].setBarSize();}}
if($('placeHolder'))$('placeHolder').remove();}
$K.yg_removeSortable=function(element){element.parentNode.parentNode.removeChild(element.parentNode);$K.yg_updateSortables();}
$K.yg_startDragging=function(dragobj,ghosting){$K.yg_currentdragobj=new Array();document.body.addClassName('drag');$K.yg_activeDragInfo.dragging=true;$('yg_ddGhost').srcReference=dragobj;focuselem=dragobj.element.down('.mk_selectable');if(!(focuselem))focuselem=dragobj.element.up('.mk_selectable');if(!(focuselem))focuselem=dragobj.element;focusobjs=$K.yg_getFocusObj(focuselem.up('.mk_contentgroup'));if(focusobjs.length>1){$K.yg_currentdragobj=focusobjs;}else{$K.yg_currentdragobj.push(focuselem);}
if(ghosting)$K.yg_setGhostIcon(dragobj.element);}
$K.yg_setGhostIcon=function(element){var yg_ddGhost=$('yg_ddGhost');yg_ddGhost.setStyle({display:'block'});if(($(element.id+'_txt')!=null)||element.down('.mk_txt')){if($K.yg_currentdragobj.length>1){yg_ddGhost.dataTxt='('+$K.yg_currentdragobj.length+' '+$K.TXT('TXT_OBJECTS')+')';}else{if($(element.id+'_txt')){yg_ddGhost.dataTxt=$(element.id+'_txt').innerHTML;}else if(element.down('.mk_txt')){yg_ddGhost.dataTxt=element.down('.mk_txt').innerHTML;}else{yg_ddGhost.dataTxt='[UNKNOWN]';}}}
yg_ddGhost.down('a').innerHTML=yg_ddGhost.dataTxt;icoURL=null;for(var i=0;i<$K.yg_currentdragobj.length;i++){var icon=$($K.yg_currentdragobj[i]).down('.icn');if(icon){newIcoURL=icon.getStyle('backgroundImage').strip();if(newIcoURL!='none'){newIcoURL=newIcoURL.substring(newIcoURL.lastIndexOf('/')+1);newIcoURL=newIcoURL.substring(0,newIcoURL.indexOf('.png')+4);}}else{newIcoURL='none';}
if(icoURL==null)icoURL=newIcoURL;if(icoURL!=newIcoURL){icoURL='none';break;}}
if((icoURL=='none')||(icoURL=='icon.png')){yg_ddGhost.down('img').src=$K.imgdir+'tree/blank.gif';yg_ddGhost.down('img').setStyle({display:'inline-block',width:'2px',height:'0px',overflow:'hidden'});}else{yg_ddGhost.down('img').src=$K.imgdir+'icons/'+icoURL;yg_ddGhost.down('img').setStyle({display:'inline-block',width:'auto',height:'auto',overflow:'visible'});}}
$K.yg_clearDropAreas=function(){var newDropArr=new Array();for(var k=0;k<$K.yg_dropAreas.length;k++){elem=$($K.yg_dropAreas[k]);if(elem)newDropArr.push($K.yg_dropAreas[k]);}
$K.yg_dropAreas=newDropArr;}
$K.yg_checkIfOverDroppable=function(eventRef){if(!eventRef.target)eventRef.target=eventRef.srcElement;var overDroppables=new Array();var inDroppables=new Array();for(var k=$K.yg_dropAreas.length-1;k>-1;k--){elem=$($K.yg_dropAreas[k]);if(elem==null)continue;if($K.yg_checkDroppableOffset(elem)){var currElement=document.elementFromPoint($K.yg_mouseCoords.X,$K.yg_mouseCoords.Y);if((currElement==elem)||(elem&&currElement.descendantOf(elem))||(elem.hasClassName('page_contentarea'))){overDroppables.push(elem);}}}
if(overDroppables.length==0){return false;}else{zIndex=-1;for(var i=0;i<overDroppables.length;i++){curZIndex=parseInt(overDroppables[i].up('.ywindow').getStyle('zIndex'));if(isNaN(curZIndex))curZIndex=0;if(curZIndex==zIndex){inDroppables.push(overDroppables[i]);}else if(curZIndex>zIndex){inDroppables=new Array();inDroppables.push(overDroppables[i]);zIndex=curZIndex;}}}
for(var i=0;i<inDroppables.length;i++){elem=inDroppables[i];if(typeof $(eventRef.target).descendantOf=='function'){var isDesc=$(eventRef.target).descendantOf(elem);if($(eventRef.target)==$(elem))isDesc=true;}else{var isDesc=false;}
var overMarker=false;if($(eventRef.target)&&typeof($(eventRef.target).hasClassName=='function')){if($(eventRef.target).hasClassName('noselection')||$(eventRef.target).hasClassName('selectionmarker')||(isDesc&&$(elem).hasClassName('cntblockadd'))){overMarker=true;}}
if(isDesc||overMarker){return elem.id;}else{return false;}}}
$K.yg_setSortableMarkerIndex=function(winId){var winZIndex=parseInt($(winId).getStyle('z-index'),10);if(isNaN(winZIndex))winZIndex=1;Sortable._marker.style.zIndex=(winZIndex+3);Sortable._marker.style.cursor='pointer';if($(winId).hasClassName('ydialog')){Sortable._marker.addClassName('dropmarker_dialog');}else{Sortable._marker.removeClassName('dropmarker_dialog');}}
$K.yg_checkDroppableOffset=function(element){var offset=element.cumulativeOffset();var mouseX=$K.yg_mouseCoords.X;var mouseY=$K.yg_mouseCoords.Y;var tempHeight=element.offsetHeight;var result=(mouseY>=offset[1]-1&&mouseY<offset[1]-1+tempHeight&&mouseX>=offset[0]-1&&mouseX<offset[0]-1+element.offsetWidth);return result;}
Event.observe(document,'mousemove',function(e){$K.yg_mouseCoords.X=Event.pointerX(e);$K.yg_mouseCoords.Y=Event.pointerY(e);});$K.yg_attachMouseListener=function(){Event.observe(document,'mousedown',function(e){$K.yg_mousedown=true;});Event.observe(document,'mouseup',function(e){$K.yg_mousedown=false;});Event.observe(document,'mousemove',function(e){if(!($K.yg_activeDragInfo.dragging))return;setTimeout("$K.yg_clearTextSelection();",0);$K.log("IN ATTACH MOUSE LISTENER",$K.Log.DEBUG);$K.log($K.yg_activeDragInfo.dragging,$K.Log.DEBUG);$K.yg_mouseCoords.X=Event.pointerX(e);$K.yg_mouseCoords.Y=Event.pointerY(e);$K.yg_overDroppable=$K.yg_checkIfOverDroppable(e);if((!$K.yg_overDroppable&&!$K.yg_activeDragInfo.overTreeNode&&!$K.yg_activeDragInfo.overNeedle)&&(!Sortable._marker||!Sortable._marker.hoverOverMarker)&&(!$('placeHolder')||!$('placeHolder').hoverOverMarker)){$K.log("NOT OVER DROPPABLE",$K.Log.DEBUG);$K.yg_currentHover=null;$K.yg_drawTopborder(null,true);$K.yg_clearPlaceHolder();}else{$K.yg_currentHover=$K.yg_overDroppable;var sourceObject=false;var objInAcceptList=false;var forceNotAllow=false;if(nlsddSession&&nlsddSession.action&&nlsddSession.srcData){sourceObject=nlsddSession.srcData[0].yg_type;}
var targetAccepts=$K.yg_getTargetAcceptList();if(targetAccepts&&(targetAccepts.split(',').indexOf(sourceObject)!=-1)){objInAcceptList=true;}
if($('yg_ddGhost').srcReference){var yg_ddGhost=$('yg_ddGhost');if((yg_ddGhost.srcReference.element.parentNode)&&(yg_ddGhost._originalParent!=undefined)){var target_tree=Sortable.sortables[$K.yg_currentHover];if(target_tree){var targetAccepts=target_tree.accepts;if(target_tree.element.hasClassName('page_contentarea')&&(source_tree)&&source_tree.element.hasClassName('page_contentarea')&&($K.yg_currentdragobj.length>1)){forceNotAllow=true;}}
if($K.yg_currentdragobj[0]&&$K.yg_currentdragobj[0].up('li')&&($K.yg_currentdragobj[0].up('li').readAttribute('yg_type')!=null)){for(var i=0;i<$K.yg_currentdragobj.length;i++){if($K.yg_currentdragobj[i].up('li')&&($K.yg_currentdragobj[i].up('li').readAttribute('yg_type')!=null)&&targetAccepts&&(targetAccepts.split(',').indexOf($K.yg_currentdragobj[i].up('li').readAttribute('yg_type'))!=-1)){sourceObject=$K.yg_currentdragobj[i].up('li').readAttribute('yg_type');objInAcceptList=true;break;}}}else if(typeof($('yg_ddGhost').srcReference.element.readAttribute=='function')&&($('yg_ddGhost').srcReference.element.readAttribute('yg_type'))){sourceObject=$('yg_ddGhost').srcReference.element.readAttribute('yg_type');}else{var source_tree=Sortable.sortables[yg_ddGhost._originalParent.id];if(source_tree)sourceObject=source_tree.objectType;}}}
if((!objInAcceptList)&&(sourceObject)){if(targetAccepts&&(targetAccepts.split(',').indexOf(sourceObject)!=-1))objInAcceptList=true;}
$K.log('Accepts: '+targetAccepts+" : "+sourceObject,(Math.random()*1000),$K.Log.DEBUG);$K.log('forceNotAllow: '+forceNotAllow,$K.Log.DEBUG);$K.log('objInAcceptList: '+objInAcceptList,$K.Log.DEBUG);if(!sourceObject){$K.yg_setDropAllowed(false);return;}
if(!objInAcceptList||((target_tree)&&(target_tree.element)&&(target_tree.element.hasClassName('dialog_lst')))||forceNotAllow){if((!Sortable._marker||!Sortable._marker.hoverOverMarker)&&(!$('placeHolder')||!$('placeHolder').hoverOverMarker)&&(!$K.yg_activeDragInfo.overNeedle)){$K.yg_setDropAllowed(false);return;}}else{$K.yg_setDropAllowed(true);}
if($($K.yg_currentHover)){if($('yg_ddGhost')&&($('yg_ddGhost').srcReference)&&($($K.yg_overDroppable).up('.ywindow')==$('yg_ddGhost').srcReference.element.up('.ywindow'))){$K.yg_activeDragInfo.reordering=true;if($($K.yg_currentHover).yg_reordering=="false"){$K.yg_activeDragInfo.reordering=false;$K.yg_setDropAllowed(false);return;}}else{$K.yg_activeDragInfo.reordering=false;}
if($K.yg_activeDragInfo.hoverOverTree){return;}
if(($($K.yg_currentHover).hasClassName('mk_nodrop')||$($K.yg_currentHover).hasClassName('mk_nowrite'))){$K.yg_setDropAllowed(false);return;}
if($($K.yg_currentHover).hasClassName('cntblockadd')&&($K.yg_activeDragInfo.dropAllowed)&&($($K.yg_currentHover).yg_reordering!="false")){list=$($K.yg_currentHover).up(2).down('ul');if(list){if(list.immediateDescandants){listitems=list.immediateDescandants();}else{listitems=new Array;}
if(listitems.length>0){$K.yg_activeDragInfo.target=listitems[listitems.length-1];$K.yg_activeDragInfo.position="after";}else{$K.yg_activeDragInfo.target=$($K.yg_currentHover).up(2).down('ul');$K.yg_activeDragInfo.before=null;$K.yg_activeDragInfo.position="into";}}
$K.yg_drawTopborder($($K.yg_currentHover));}else{$K.yg_drawTopborder(null,true);}
if(($($K.yg_currentHover).yg_type=='formfield')&&(sourceObject!='formfield')){$K.yg_activeDragInfo.hoverOverFormfield=true;$K.yg_drawTopborder(null,true);if(Sortable._marker){Sortable._marker.hide();}}else{$K.yg_activeDragInfo.hoverOverFormfield=false;}}}});}
$K.addOnDOMReady($K.yg_attachMouseListener);$K.yg_checkIframeDrop=function(winID,x,y){if(!($K.yg_activeDragInfo.dragging))return;tce=tinymce.get('textarea_'+winID);offset=tinymce.DOM.getViewPort(tce.getWin());y=y-offset.y;x=x-offset.x;offset=$('textarea_'+winID+'_ifr').viewportOffset();$K.yg_mouseCoords.X=offset[0]+x+10;$K.yg_mouseCoords.Y=offset[1]+y+10;yg_ddGhost=$("yg_ddGhost");if(yg_ddGhost.visible()==false){yg_ddGhost=$("yg_ddGhostTree");}
if(yg_ddGhost.visible()){yg_ddGhost.setStyle({left:$K.yg_mouseCoords.X+'px'});yg_ddGhost.setStyle({top:$K.yg_mouseCoords.Y+'px'});}
$K.yg_overDroppable=window;$K.yg_activeDragInfo.hoverOverFormfield=false;$K.yg_activeDragInfo.reordering=false;sourceObject="";if($('yg_ddGhost').srcReference){yg_ddGhost=$("yg_ddGhost");if($K.yg_currentdragobj[0]&&$K.yg_currentdragobj[0].up('li')&&($K.yg_currentdragobj[0].up('li').readAttribute('yg_type')!=null)){sourceObject=$K.yg_currentdragobj[0].up('li').readAttribute('yg_type');}else if(typeof($('yg_ddGhost').srcReference.element.readAttribute=='function')&&($('yg_ddGhost').srcReference.element.readAttribute('yg_type'))){sourceObject=$('yg_ddGhost').srcReference.element.readAttribute('yg_type');}else{if(nlsddSession&&nlsddSession.action&&nlsddSession.srcData){sourceObject=nlsddSession.srcData[0].yg_type;}}
targetAccepts="page,file";if(targetAccepts.split(',').indexOf(sourceObject)==-1){$K.yg_setDropAllowed(false);}else{$K.yg_setDropAllowed(true);}}else{$K.yg_setDropAllowed(false);}}
$K.yg_setDropAllowed=function(value){if(value){$K.log('$K.yg_setDropAllowed(true);',$K.Log.DEBUG);$K.yg_activeDragInfo.dropAllowed=true;$K.yg_showNoDropMarker(false);}else{if((!Sortable._marker||!Sortable._marker.hoverOverMarker)||(!$('placeHolder')||!$('placeHolder').hoverOverMarker)){$K.log('$K.yg_setDropAllowed(false);',$K.Log.DEBUG);$K.yg_activeDragInfo.dropAllowed=false;$K.yg_showNoDropMarker(true);}}}
$K.yg_getTargetAcceptList=function(){var targetAccepts=false;if(nlsddSession&&nlsddSession.action){var sData,dData,sObj,dObj;with(nlsddSession){sData=srcData;sObj=srcObj;dData=destData;dObj=destObj;}
if(dObj&&$K.yg_activeDragInfo.overTreeNode){if(dObj.tId.endsWith('_tree')){var target_tree=$(dObj.tId).up(1);}else{var target_tree=$(dObj.tId);}
targetAccepts=target_tree.accepts;if($K.yg_activeDragInfo.treeNodeLink.hasClassName('nosub')){if(dObj.yg_type==sObj.yg_type)targetAccepts=false;}
if((dObj.yg_type==sObj.yg_type)&&(dObj.tId!=sObj.tId))targetAccepts=false;}}
if((!targetAccepts)&&($($K.yg_currentHover))){targetAccepts=$($K.yg_currentHover).accepts;}else if((!targetAccepts)&&($K.yg_activeDragInfo.target)&&($K.yg_activeDragInfo.target.accepts)){targetAccepts=$K.yg_activeDragInfo.target.accepts;}
return targetAccepts;}
$K.yg_showNoDropMarker=function(nodrop){ghost=$('yg_ddGhost');treeghost=$('yg_ddGhostTree');if(treeghost&&(treeghost.nodrop!=nodrop)){if(nodrop){if(treeghost.down('.nodrop'))treeghost.down('.nodrop').setStyle({display:'block'});}else{if(treeghost.down('.nodrop'))treeghost.down('.nodrop').setStyle({display:'none'});}
treeghost.nodrop=nodrop;}
if(ghost&&(ghost.nodrop!=nodrop)){if(nodrop){ghost.down('.nodrop').setStyle({display:'block'});}else{ghost.down('.nodrop').setStyle({display:'none'});}
ghost.nodrop=nodrop;}}
$K.yg_drawNeedles=function(point,element){$K.log('!!! Drawing needle on ',element,$K.Log.DEBUG);$K.yg_drawTopborder(null,true);if($('yg_ddGhost')){if($K.yg_activeDragInfo.dropAllowed){$K.log('dropAllowed',$K.Log.DEBUG);$('yg_ddGhost').down('img').src=$K.yg_cachedImages['page_small'].src;}else{$K.log('dropNOTAllowed',$K.Log.DEBUG);if(Sortable._marker){if(!Sortable._marker.hoverOverMarker){Sortable._marker.hide();if($('placeHolder')){if(!$('placeHolder').hoverOverMarker){$('placeHolder').remove();}}
$K.yg_showNoDropMarker(true);}}}}
if(!element){return;}
var elementPos=element.cumulativeOffset();var elementOffsetTop=(point[1]-elementPos[1]);var overlap=(elementOffsetTop/element.offsetHeight);var dropon=element;if(overlap<0.5){if(($K.yg_activeDragInfo.target!=dropon)||(Sortable._marker&&Sortable._marker.style.display=='none')||(($K.yg_activeDragInfo.target==dropon)&&($K.yg_activeDragInfo.position!='before'))){Sortable.mark(dropon,'before');$K.yg_activeDragInfo.target=dropon;$K.yg_activeDragInfo.position='before';}}else{if(($K.yg_activeDragInfo.target!=dropon)||(Sortable._marker&&Sortable._marker.style.display=='none')||(($K.yg_activeDragInfo.target==dropon)&&($K.yg_activeDragInfo.position!='after'))){Sortable.mark(dropon,'after');$K.yg_activeDragInfo.target=dropon;$K.yg_activeDragInfo.position='after';}}}
$K.yg_drawTopborder=function(which,remove){if(remove==true){if($('$treeNeedle')==undefined)return;$('$treeNeedle').hide();$K.log('Needle hidden!!',(Math.random()*1000),$K.Log.DEBUG);}else{$K.log('Drawing topborder on ',which,$K.Log.DEBUG);var whichParent=which.up();if(!(which.hasClassName('cntblockadd'))&&!(which.hasClassName('selectionmarker'))&&!(which.hasClassName('noselection'))&&!$K.yg_activeDragInfo.hoverOverTree)return;if(Object.isUndefined(which))return;$K.log('...######## Drawing topborder on: ',which.className,$K.Log.DEBUG);which=$(which);var isDialog=false;if(which.up('.ywindow')&&which.up('.ywindow').hasClassName('ydialog')){isDialog=true;}
if(which.up('.ywindow')){var newZIndex=parseInt(which.up('.ywindow').getStyle('zIndex'));if(isNaN(newZIndex))newZIndex=0;newZIndex+=2;}
if($('$treeNeedle')==undefined){var needle=$(document.createElement('div'));needle.onmouseover=function(){$K.yg_activeDragInfo.overNeedle=true;$K.yg_setDropAllowed(true);this.show();};needle.onmouseout=function(){$K.yg_activeDragInfo.overNeedle=false;};needle.onmouseup=function(ev){$K.yg_customSortableOnDrop($($K.yg_activeDragInfo.target).readAttribute('id'),ev);}
needle.id='$treeNeedle';needle.addClassName('needle');document.body.appendChild(needle);}else{needle=$('$treeNeedle');}
var pos=which.cumulativeOffset();if(Object.isUndefined(which.up('.innercontent'))){return;}
var leftoffset=which.up('.innercontent').positionedOffset();leftoffset=leftoffset[0];pos.left-=leftoffset;pos.width=which.up('.ywindowinner').getWidth();pos.width-=10;if(which.hasClassName('cntblockadd')){pos.top-=1;pos.width+=10;if((which.up('.mk_contentarea'))){if(which.up('.mk_contentarea').down('li')){pos.top+=6;}}}
if(which.hasClassName('cntblockselection')){$K.log('match',$K.Log.DEBUG);pos.top+=10;pos.width+=10;}
needle.setStyle({left:pos.left+'px',top:(pos.top)+'px',width:pos.width+'px',zIndex:newZIndex});if(Sortable._marker){Sortable._marker.hide();}
if(isDialog){needle.addClassName('needle_dialog');}else{needle.removeClassName('needle_dialog');}
needle.show();$K.log('Needle shown ('+(pos.left)+', '+(pos.top)+') at index: '+newZIndex+'   >',(Math.random()*1000),needle,$K.Log.DEBUG);}
return;}
;$K.yg_activeDragInfo.dragging=false;$K.yg_drawLoadingPlaceholder=function(target,position){var liElement=new Element('li',{className:'loading_placeholder'});if(position=='before'){if(!target.up('ul').down('.loading_placeholder')){target.insert({before:liElement});}}else if(position=='after'){if(!target.up('ul').down('.loading_placeholder')){target.insert({after:liElement});}}else{if(!target.match('ul')&&target.match('div.ipanel')&&target.down('ul.page_contentarea')){target=target.down('ul.page_contentarea');}
if(!target.down('.loading_placeholder')){target.insert(liElement);}}}
$K.yg_customSortableOnDrop=function(element,ev){if(!$K.yg_activeDragInfo.dragging){return;}
$K.yg_activeDragInfo.dragging=false;if(ev)Event.stop(ev);if($('yg_ddGhost')&&($K.yg_activeDragInfo.dropAllowed==false)){$K.yg_clearDragSession();return;}
$K.yg_drawTopborder(null,true);$K.log('In $K.yg_customSortableOnDrop',element,$K.Log.DEBUG);var target_tree=Sortable.sortables[$K.yg_currentHover];trgt_type=false;trgt_property=false;trgt_list=false;trgt_accepts=$K.yg_getTargetAcceptList();if(($(element).tagName=='UL')||($(element).up&&$(element).up('ul')))trgt_list=true;if($(element)&&(typeof($(element).readAttribute)=='function')){trgt_type=$(element).readAttribute('yg_type');trgt_property=$(element).readAttribute('yg_property');}
if((trgt_type==null)&&$(element).down('ul')){trgt_list=true;trgt_type=$(element).down('ul').readAttribute('yg_type');trgt_property=$(element).down('ul').readAttribute('yg_property');}
if(trgt_property=="")trgt_property=false;if(nlsddSession&&nlsddSession.action&&nlsddSession.srcData){if(($K.yg_activeDragInfo.target)&&($K.yg_activeDragInfo.position!='into')){var targetElementParent=$K.yg_activeDragInfo.target;}else{var targetElementParent=$($K.yg_currentHover);}
if($K.yg_activeDragInfo.target){targetElement=$K.yg_activeDragInfo.target;}else{targetElement=$(element);}
targetPosition=$K.yg_activeDragInfo.position;$K.yg_currentdragobj=new Array();for(var i=0;i<nlsddSession.srcData.length;i++){treeobj=$(nlsddSession.srcData[i].id)
treeobj.writeAttribute('yg_id',nlsddSession.srcData[i].yg_id);treeobj.writeAttribute('yg_type',nlsddSession.srcData[i].yg_type);treeobj.writeAttribute('yg_url',nlsddSession.srcData[i].ygurl);treeobj.down('a').addClassName('mk_txt');$K.yg_currentdragobj.push(treeobj);}}else if($('yg_ddGhost')){var origParent=$('yg_ddGhost')._originalParent;if($K.yg_activeDragInfo.target&&$K.yg_activeDragInfo.target.hasClassName('mk_cblock')){targetElement=$K.yg_activeDragInfo.target;if(targetElement){targetElementParent=$K.yg_activeDragInfo.target.parentNode;}
if(!targetElementParent)targetElementParent=$(element);if(!targetElement)targetElement=targetElementParent;}else{targetElement=$(element);targetElementParent=$(element).parentNode;targetPosition=$K.yg_activeDragInfo.position;}}
var trgt_id=null;var trgt_objid=null;var scr_id=null;var scr_objid=null;var trgt_win=null;var src_win=null;if($(targetElement)&&(typeof($(targetElement).readAttribute)=="function")&&($(targetElement).readAttribute('yg_id')))trgt_id=$(targetElement).readAttribute('yg_id');if($(element)&&(typeof($(element).up)=='function'))var trgt_win=$(element).up('.ywindow').id;var src_win=false;if($K.yg_currentdragobj[0]&&$K.yg_currentdragobj[0].up('.ywindow'))src_win=$K.yg_currentdragobj[0].up('.ywindow').id;if(src_win==trgt_win)return;if(element.editorId&&(element.editorId!="")){trgt_type="tinymce";trgt_accepts="page,file";}
$K.yg_currentdragobj.each(function(sourceElement,index){src_id=$K.yg_getID(sourceElement);src_type=$K.yg_getType(sourceElement);if(src_id)var src_objid=src_id.split('-')[0];if(trgt_id)var trgt_objid=trgt_id.split('-')[0];if(!trgt_accepts||trgt_accepts.split(',').indexOf(src_type)==-1)return;if(src_type=="file"){if(sourceElement.down('.filetitle')){caption=sourceElement.down('.filetitle').innerHTML;captionfull=caption;if(caption.lastIndexOf('>')!=-1){caption=caption.substring(caption.lastIndexOf('>')+1).strip();}}else{src_type="filefolder";caption=sourceElement.down('.mk_txt').innerHTML;}}else{if(sourceElement.down('.mk_txt')){caption=sourceElement.down('.mk_txt').innerHTML;}else if(sourceElement.down('.title')){caption=sourceElement.down('.title').innerHTML;}}
if(trgt_type=="dropstack"){if((src_type=="cblock")&&(sourceElement.readAttribute("yg_entrymask")!="")&&(sourceElement.readAttribute("yg_entrymask")!=null)){src_id=sourceElement.readAttribute("yg_entrymask");src_type="entrymask";}
if(src_type=="file")caption=captionfull;$K.windows[trgt_win].addFunction(src_id,src_type,caption,trgt_id,targetPosition);}else{switch(src_type){case"template":if(trgt_property=='template'){$K.windows[trgt_win].changeTemplate(src_objid);}
break;case"templatefolder":if(trgt_property=='templatefolder'){$K.windows[trgt_win].changeTemplateRoot(src_objid);}
break;case"navigation":if(trgt_property=='navigation'){$K.windows[trgt_win].changeNavigation(src_objid);$K.windows[src_win].yg_id=undefined;}
break;case"tag":if(trgt_property=='yg_taglist'){if(!trgt_objid)targetPosition='into';$K.windows[trgt_win].addFunction(src_objid,trgt_objid,targetPosition);}else
if(trgt_type=='formfield'){$K.windows[trgt_win].addTagtoFormfield(element,src_id,caption);}else
if((trgt_type=='file')&&(!$(element).identify().endsWith('property'))){var data=Array('noevent',{yg_property:'addObjectTag',params:{objectID:trgt_objid,objectType:'file',tagId:src_objid,targetId:'norefresh'}});$K.yg_AjaxCallback(data,'addObjectTag');if(typeof $K.windows[trgt_win].addTagToFile=='function'){$K.windows[trgt_win].addTagToFile(element,src_id);}}else
if(trgt_type!='formfield'){$(element).update(caption);if($(element).up('div.selectionmarker')&&$(element).up('div.selectionmarker').next('input[type=hidden]')){$(element).up('div.selectionmarker').next('input[type=hidden]').value=src_objid;}
$K.yg_setObjectProperty($(element),src_objid);$K.yg_fadeField($(element).up('.cntblock'));}
break;case"cblock":case"entrymask":case"extpage":case"extcblock":case"extfile":case"extmailing":if(trgt_type=='contentarea'){if(targetElement){if(targetElement.hasClassName('mk_cblock')){var target_id=targetElement.id.split('_')[4];}else{var target_id=trgt_objid;}}else{var target_id=null;}
if(index==$K.yg_currentdragobj.length-1){refreshvar=true;}else{refreshvar=false;}
if((src_type=="cblock")||(src_type=="entrymask")){if($(targetElementParent).hasClassName('cntblockadd')){targetElementParent=targetElementParent.previous().down();}else if(targetElementParent.tagName!='UL'){if(targetElement.down('ul.page_contentarea')){targetElementParent=targetElement.down('ul.page_contentarea');}else{targetElementParent=targetElementParent.up('ul.page_contentarea');}}
var targetPosition=$K.yg_activeDragInfo.position;$K.yg_drawLoadingPlaceholder(targetElement,targetPosition);$K.windows[trgt_win].addFunction(src_id,target_id,targetPosition,refreshvar,targetElementParent.id,src_type,sourceElement);}else{$K.windows[trgt_win].addExtension(src_id,$K.windows[trgt_win].yg_id,src_type,refreshvar);}}else{if(src_type=="cblock"){if(trgt_type!='formfield'){$(element).update(caption);if($(element).up('div.selectionmarker')&&$(element).up('div.selectionmarker').next('input[type=hidden]')){$(element).up('div.selectionmarker').next('input[type=hidden]').value=src_objid;}
$K.yg_setObjectProperty($(element),src_objid);$K.yg_fadeField($(element).up('.cntblock'));}else
if(trgt_type=='formfield'){$K.windows[trgt_win].addContentblocktoFormfield(element,src_id,caption);return;}}
if(src_type.substring(0,3)=="ext"){if(trgt_type!=src_type.substring(3,src_type.length))break;var data=Array('noevent',{yg_property:'addObjectExtension',params:{page:trgt_objid,site:trgt_type,extensionId:src_objid,openerRefID:false,refresh:false}});$K.yg_AjaxCallback(data,'addObjectExtension');}}
break;case"page":if(trgt_type=='formfield'){$K.windows[trgt_win].addPagetoFormfield(element,src_id,caption);}
if(trgt_type=='tinymce'){element.execCommand('mceInsertContent',false,"<a href='"+sourceElement.readAttribute("yg_url")+"'>"+caption+"</a>");}
if((trgt_type!='formfield')&&(trgt_type!='tinymce')){var site=src_id.split('-')[1];var page=src_id.split('-')[0];if($(element).hasClassName('mk_page')){$(element).update(caption);var pageInfo={page:page,site:site};$(element).up('td').down('input[type=hidden]').value=Object.toJSON(pageInfo);$K.yg_setObjectProperty($(element),{page:page,site:site});}else{var data=$K.appdir+'page/'+site+'/'+page+'/';$(element).up('.title').previous().className='iconpage icn';$(element).up('.title').previous().show();$(element).update(caption);$(element).up('.selectionmarker').next().value=data;$K.yg_setObjectProperty($(element),data);}
$K.yg_fadeField($(element).up('.cntblock'));}
break;case"filefolder":var data={objecttype:'file',yg_id:src_id,title:caption};if((trgt_type=='formfield')&&(trgt_property=='filefolder')){$K.yg_editControl($(element).down('.title_txt'),'16',true,data);}
break;case"file":var tmpFiletype='FILE';var tmpFilecolor='red';if(sourceElement&&sourceElement.down('span.filetype')){tmpFiletype=sourceElement.down('span.filetype').innerHTML.strip();tmpFilecolor=sourceElement.down('span.filetype').className.replace(/filetype/,'').strip();}
if(trgt_type=='formfield'){var data={objecttype:'file',yg_id:src_id,title:caption,filetype:tmpFiletype,filecolor:tmpFilecolor};if(trgt_property=='file'){$K.yg_editControl($(element).down('.title_txt'),'6',true,data);}else if(trgt_property=='link'){$K.yg_editControl($(element).down('.title_txt'),'5',true,data);}
$K.yg_fadeField($(element));}else
if(trgt_type=='tinymce'){if(sourceElement.up('li.mk_file'))sourceElement=sourceElement.up('li.mk_file');if(sourceElement.readAttribute("yg_imageurl")==""){element.execCommand('mceInsertContent',false,"<a href='"+sourceElement.readAttribute("yg_downloadurl")+"'>"+caption+"</a>");}else{element.execCommand('mceInsertContent',false,"<img src='"+sourceElement.readAttribute("yg_imageurl")+"'>");}}
if((trgt_type!='formfield')&&(trgt_type!='tinymce')){if($(element).hasClassName('mk_file')){var fileInfo=sourceElement.down('.filetitle').innerHTML;var titlefield=$(element).down('.title_txt');titlefield.update('<span class="filetype '+tmpFilecolor+'" yg_type="'+$K.windows[$(element).up('.ywindow').id].yg_type+'" yg_id="'+$K.windows[$(element).up('.ywindow').id].yg_id+'" yg_property="type">'+tmpFiletype+'</span> '+caption);var valuefield=$(element).down('input[type=hidden]');valuefield.value=src_objid;if(!$(element).hasClassName('mk_noautosave')){$K.yg_setObjectProperty(valuefield);}}else{var data=$K.appdir+'download/'+src_objid;$(element).up('.title').previous().hide();$(element).update('<span class="filetype '+tmpFilecolor+'" yg_type="'+$K.windows[$(element).up('.ywindow').id].yg_type+'" yg_id="'+$K.windows[$(element).up('.ywindow').id].yg_id+'" yg_property="type">'+tmpFiletype+'</span> '+caption);$(element).up('.selectionmarker').next().value=data;$K.yg_setObjectProperty($(element),data);}
$K.yg_fadeField($(element).up('.cntblock'));}
break;case"formfield":case"property":if(((src_type=='formfield')&&(trgt_type=='formfield'))||((src_type=='property')&&(trgt_type=='property'))){if((typeof($($K.yg_currentHover).hasClassName)=='function')&&$($K.yg_currentHover).hasClassName('cntblockadd'))$K.yg_activeDragInfo.position='into';$K.yg_addFormfieldToList(trgt_win,$(element),sourceElement);$K.yg_hilite('entrymask',$K.windows[trgt_win].yg_id,'name',true);}
break;case"view":if(trgt_type=='file'){trgt_objid=targetElement.readAttribute('yg_id').split('-')[0];var data=Array('noevent',{yg_property:'addFileView',params:{file:trgt_objid,view:src_objid}});$K.yg_AjaxCallback(data,'addFileView');}
break;case"usergroup":if((trgt_type=='user')||(trgt_type=='mailing')){if(trgt_type=='mailing'){if(targetElement.tagName=='LI'){targetElement=targetElementParent;trgt_objid=targetElement.readAttribute('yg_id').split('-')[0];}else{trgt_objid=$K.windows[targetElement.up('.ywindow').id].yg_id.split('-')[0];}
var params={mode:trgt_type,mailingId:trgt_objid,roleId:src_objid,openerRefId:trgt_win,refresh:'true'}}else{if(targetElement.tagName=='LI'){targetElement=targetElementParent;trgt_objid=targetElement.readAttribute('yg_id').split('-')[0];}else{trgt_objid=$K.windows[targetElement.up('.ywindow').id].yg_id.split('-')[0];}
var params={mode:trgt_type,userId:trgt_objid,roleId:src_objid,openerRefId:trgt_win,refresh:'true'}}
var data=Array('noevent',{yg_property:'addUsergroup',params:params});$K.yg_AjaxCallback(data,'addUsergroup');}
break;}}});$K.log("src_type: "+src_type+" trgt_type: "+trgt_type+"  trgt_property: "+trgt_property,$K.Log.INFO);$K.yg_clearDragSession();if(targetElementParent){$K.yg_recreateSortables(targetElementParent.id);}
return;}
$K.yg_customOnDrop=function(e){$K.yg_activeDragInfo.dragging=false;if($K.yg_activeDragInfo.dropAllowed==false)return;if($('yg_ddGhost')&&($('yg_ddGhost').dataTxt)){if($('yg_ddGhost').getStyle('display')!='none'){if(this.tId.endsWith('_tree')){var target_tree=$(this.tId).up(1);}else{var target_tree=$(this.tId);}
var trgt_type=target_tree.yg_type;var yg_ddGhost=$('yg_ddGhost');var source_tree=Sortable.sortables[yg_ddGhost._originalParent.id];var sData,dData,sObj,dObj;with(nlsddSession){sData=srcData;sObj=srcObj;dData=destData;dObj=destObj;}
$K.log('DRAG AND DROP: ',sObj,dObj,$K.Log.INFO);$K.log('DTARGET: IsType: '+trgt_type+', '+'Accepting: '+target_tree.accepts,$K.Log.INFO);$K.yg_currentdragobj.each(function(sourceElement){src_id=$K.yg_getID(sourceElement);src_type=$K.yg_getType(sourceElement);if(src_id)var src_objid=src_id.split('-')[0];if(target_tree.accepts.indexOf(src_type)==-1)return;switch(src_type){case"file":if((dData.orgId=='root_1')||sourceElement.hasClassName('mk_nowrite')||(source_tree=="dropstack"))return;var fileName;if(($K.yg_currentdragobj.length>1)&&(yg_ddGhost.srcReference.element.up('.mk_contentgroup')==$K.yg_currentdragobj[0].up('.mk_contentgroup'))){fileName=$K.yg_currentdragobj.length+' '+$K.TXT('TXT_OBJECTS');}else{fileName=yg_ddGhost.srcReference.element.down('.filetitle').innerHTML;}
var origDragObject=$K.yg_currentdragobj;var origDData=dData;var origSrcReference=yg_ddGhost.srcReference;var origDObj=dObj;$K.yg_promptbox($K.TXT('TXT_APPROVE_MOVE_TITLE'),$K.TXT('TXT_APPROVE_MOVE_P1')+fileName+$K.TXT('TXT_APPROVE_MOVE_P2'),'standard',function(){var fileIDs=new Array();if((origDragObject.length>0)&&(origDragObject[0].up('.mk_contentgroup')==origSrcReference.element.up('.mk_contentgroup'))){origDragObject.each(function(item){if(!item.hasClassName('mk_nowrite')){if(item.up('li')){fileIDs.push(item.up('li').yg_id);}else{fileIDs.push(item.yg_id);}}});}else{fileIDs.push(origSrcReference.element.yg_id);}
fileIDs.each(function(item){var fileID=item.split('-')[0];var objectID=origDData.yg_id.split('-')[0];var data=Array('noevent',{yg_property:'moveFile',params:{source:fileID,target:objectID,openerRef:origSrcReference.element.up('.ywindow').id,before:null}});$K.yg_AjaxCallback(data,'moveFile');});$K.yg_showActions($(origDData.id),origDObj.tId);},function(){});throw $break;case"tag":var data=Array('noevent',{yg_property:'addObjectTag',params:{objectID:dData.yg_id.split('-')[0],objectType:dData.yg_type,site:dData.yg_id.split('-')[1],tagId:src_objid,targetId:''}});$K.yg_AjaxCallback(data,'addObjectTag');$K.yg_showActions($(dData.id),dObj.tId);break;case"view":var data=Array('noevent',{yg_property:'addFileView',params:{file:dData.yg_id.split('-')[0],view:src_objid}});$K.yg_AjaxCallback(data,'addFileView');$K.yg_showActions($(dData.id),dObj.tId);break;case"template":$K.yg_changeTemplate(src_objid,dData.yg_id);$K.yg_showActions($(dData.id),dObj.tId);break;case"cblock":if((dData.orgId=='root_1')||sourceElement.hasClassName('mk_nowrite')||(source_tree=="dropstack"))return;var objName;if(($K.yg_currentdragobj.length>1)&&(yg_ddGhost.srcReference.element.up('.mk_contentgroup')==$K.yg_currentdragobj[0].up('.mk_contentgroup'))){objName=$K.yg_currentdragobj.length+' '+$K.TXT('TXT_OBJECTS');}else{objName=yg_ddGhost.srcReference.element.down('.mk_txt').innerHTML;}
$K.yg_promptbox($K.TXT('TXT_APPROVE_MOVE_TITLE'),$K.TXT('TXT_APPROVE_MOVE_P1')+objName+$K.TXT('TXT_APPROVE_MOVE_P2'),'standard',function(){var objIds=new Array();if(($K.yg_currentdragobj.length>0)&&($K.yg_currentdragobj[0].up('.mk_contentgroup')==yg_ddGhost.srcReference.element.up('.mk_contentgroup'))){$K.yg_currentdragobj.each(function(item){if(!item.hasClassName('mk_nowrite')){objIds.push(item.yg_id);}});}else{objIds.push(yg_ddGhost.srcReference.element.yg_id);}
objIds.each(function(item){var objID=item.split('-')[0];var objectID=dData.yg_id.split('-')[0];var data=Array('noevent',{yg_property:'moveCBlock',params:{source:objID,target:objectID,orgAction:'movefromlist',openerRef:yg_ddGhost.srcReference.element.up('.ywindow').id,before:null}});$K.yg_AjaxCallback(data,'moveCBlock');});$K.yg_showActions($(dData.id),dObj.tId);},function(){});throw $break;break;case"extpage":case"extcblock":case"extfile":case"extmailing":if(trgt_type!=src_type.substring(3,src_type.length))break;var data=Array('noevent',{yg_property:'addObjectExtension',params:{page:dData.yg_id.split('-')[0],site:dData.yg_id.split('-')[1],extensionId:src_objid,openerRefID:false,refresh:false}});$K.yg_AjaxCallback(data,'addObjectExtension');break;}});$K.yg_clearDragSession();return;}}
if(!nlsddSession)return;var sData,dData,sObj,dObj;with(nlsddSession){if(!action)return;sData=srcData;sObj=srcObj;dData=destData;dObj=destObj;}
if(dObj.tId.endsWith('_tree')){var target_tree=$(dObj.tId).up(1);}else{var target_tree=$(dObj.tId);}
if(sObj.tId.endsWith('_tree')){var source_tree=$(sObj.tId).up(1);}else{var source_tree=$(sObj.tId);}
if(target_tree.accepts.indexOf(source_tree.yg_type)==-1){$K.log('dropping not allowed!',$K.Log.DEBUG);return;}
var savedNlsddSession=Object.clone(nlsddSession);$K.yg_dndOnSuccess=function(){if(sObj.tId==dObj.tId){switch(savedNlsddSession.action){case NlsDDAction.DD_INSERT:sObj.moveChild(sData,dData,2);break;case NlsDDAction.DD_APPEND:sObj.moveChild(sData,dData,1);break;}}else{switch(savedNlsddSession.action){case NlsDDAction.DD_INSERT:for(i=0;i<sData.length;i++){with(sData[i]){var nNd=dObj.addBefore(null,dData.orgId,capt,url,(ic?ic.join(","):ic),exp,chk,xtra,title,sData.add);if(fc)duplicateNode(fc,nNd);}}
dObj.reloadNode(dData.pr.orgId);break;case NlsDDAction.DD_APPEND:for(i=0;i<sData.length;i++){with(sData[i]){var nNd=dObj.append(null,dData.orgId,capt,url,(ic?ic.join(","):ic),exp,chk,xtra,title,sData.add);if(fc)duplicateNode(fc,nNd);}}
dObj.reloadNode(nNd.orgId);dObj.expandNode(dData.orgId);break;}}
for(var j=0;j<$K.yg_dynTreesWNDO.length;j++){$K.yg_dynTreesWNDO[j].setBarSize();}
if(typeof(nlsTree[source_tree.id+'_tree'].remapAction)=='function'){nlsTree[source_tree.id+'_tree'].remapAction();}
if(source_tree!=target_tree){if(typeof(nlsTree[target_tree.id+'_tree'].remapAction)=='function'){nlsTree[target_tree.id+'_tree'].remapAction();}}
$K.yg_clearDragSession();$K.yg_dndOnSuccess=function(){};};var source=sData[0].yg_id;var target=dData.yg_id;var opener=$($K.yg_getTreeReference(sData[0])).up('.ywindow').id;switch(sObj.yg_type){case"tag":if(sObj.tId!=dObj.tId){var selectedNodes=nlsTree['tags_tree'+opener.split('_')[1]+'_tree'].getSelNodes();for(var i=0;i<selectedNodes.length;i++){var tagId=selectedNodes[i].yg_id.split('-')[0];var objectType=dObj.yg_type;var objectID=target.split('-')[0];var site=target.split('-')[1];var data=Array('noevent',{yg_property:'addObjectTag',params:{objectID:objectID,objectType:objectType,site:site,tagId:tagId,targetId:''}});$K.yg_AjaxCallback(data,'addObjectTag');}
$K.yg_showActions($(dData.id),dObj.tId);}
if(sObj.tId==dObj.tId){var selectedNodes=nlsTree['tags_tree'+opener.split('_')[1]+'_tree'].getSelNodes();var nodeList=new Array();selectedNodes.each(function(currNode){nodeList.push(currNode.yg_id.split('-')[0]);});var objectID=target.split('-')[0];var site=target.split('-')[1];var data=Array('noevent',{yg_property:'moveTag',params:{source:nodeList,target:dData.yg_id.split('-')[0],openerRef:opener}});$K.yg_AjaxCallback(data,'moveTag');$K.yg_showActions($(dData.id),dObj.tId);}
break;case"template":if(sObj.tId==dObj.tId){var selectedNodes=nlsTree['templates_tree'+opener.split('_')[1]+'_tree'].getSelNodes();var multi=false;if(selectedNodes.length>1){multi=true;}
if(multi){var objectCount=selectedNodes.length;objectName=objectCount+' '+$K.TXT('TXT_TEMPLATES');}else{objectName=selectedNodes[0].capt;}
$K.yg_promptbox($K.TXT('TXT_APPROVE_MOVE_TITLE'),$K.TXT('TXT_APPROVE_MOVE_P1')+objectName+$K.TXT('TXT_APPROVE_MOVE_P2'),'standard',function(data){for(var i=0;i<selectedNodes.length;i++){var sourceId=selectedNodes[i].yg_id.split('-')[0];var data=Array('noevent',{yg_property:'moveTemplate',params:{source:sourceId,target:dData.yg_id.split('-')[0],openerRef:opener}});$K.yg_AjaxCallback(data,'moveTemplate');}},function(){$K.log('Cancelled...',$K.Log.INFO);});$K.yg_showActions($(dData.id),dObj.tId);}else
if(dData.yg_type=="page"){var selectedNodes=nlsTree['templates_tree'+opener.split('_')[1]+'_tree'].getSelNodes();sourceId=selectedNodes[0].yg_id.split('-')[0];$K.yg_changeTemplate(sourceId,dData.yg_id);$K.yg_showActions($(dData.id),dObj.tId);}
break;case"entrymask":if(sObj.tId==dObj.tId){var selectedNodes=nlsTree['entrymasks_tree'+opener.split('_')[1]+'_tree'].getSelNodes();var multi=false;if(selectedNodes.length>1){multi=true;}
if(multi){var objectCount=selectedNodes.length;objectName=objectCount+' '+$K.TXT('TXT_ENTRYMASKS');}else{objectName=selectedNodes[0].capt;}
$K.yg_promptbox($K.TXT('TXT_APPROVE_MOVE_TITLE'),$K.TXT('TXT_APPROVE_MOVE_P1')+objectName+$K.TXT('TXT_APPROVE_MOVE_P2'),'standard',function(data){for(var i=0;i<selectedNodes.length;i++){var sourceId=selectedNodes[i].yg_id.split('-')[0];var data=Array('noevent',{yg_property:'moveEntrymask',params:{source:sourceId,target:dData.yg_id.split('-')[0],openerRef:opener}});$K.yg_AjaxCallback(data,'moveEntrymask');}},function(){$K.log('Cancelled...',$K.Log.INFO);});$K.yg_showActions($(dData.id),dObj.tId);}
break;case"cblock":if(sObj.tId==dObj.tId){var treeNode=$(dData.id);var treeNodeLink=treeNode.down('a');if(!treeNodeLink.hasClassName('nodrop')){switch(nlsddSession.action){case NlsDDAction.DD_INSERT:var data=Array('noevent',{yg_property:'moveCBlock',params:{source:sData[0].yg_id.split('-')[0],target:dData.yg_id.split('-')[0],openerRef:opener,before:true}});$K.log('Data is:',data,$K.Log.INFO);$K.yg_AjaxCallback(data,'moveCBlock');break;case NlsDDAction.DD_APPEND:var data=Array('noevent',{yg_property:'moveCBlock',params:{source:sData[0].yg_id.split('-')[0],target:dData.yg_id.split('-')[0],openerRef:opener,before:false}});$K.log('Data is:',data,$K.Log.INFO);$K.yg_AjaxCallback(data,'moveCBlock');break;}}}
break;case"page":if(sObj.tId==dObj.tId){switch(nlsddSession.action){case NlsDDAction.DD_INSERT:for(var i=0;i<sData.length;i++){var data=Array('noevent',{yg_property:'movePage',params:{sourceSite:sData[i].yg_id.split('-')[1],source:sData[i].yg_id.split('-')[0],targetSite:dData.yg_id.split('-')[1],target:dData.yg_id.split('-')[0],openerRef:opener,before:true}});$K.log('Data is:',data,$K.Log.INFO);$K.yg_AjaxCallback(data,'movePage');}
break;case NlsDDAction.DD_APPEND:for(var i=0;i<sData.length;i++){var data=Array('noevent',{yg_property:'movePage',params:{sourceSite:sData[i].yg_id.split('-')[1],source:sData[i].yg_id.split('-')[0],targetSite:dData.yg_id.split('-')[1],target:dData.yg_id.split('-')[0],openerRef:opener,before:false}});$K.log('Data is:',data,$K.Log.INFO);$K.yg_AjaxCallback(data,'movePage');}
break;}}
break;case"file":if(sObj.tId==dObj.tId){switch(nlsddSession.action){case NlsDDAction.DD_INSERT:var data=Array('noevent',{yg_property:'moveFile',params:{source:sData[0].yg_id.split('-')[0],target:dData.yg_id.split('-')[0],openerRef:opener,before:true}});$K.log('Data is:',data,$K.Log.INFO);$K.yg_AjaxCallback(data,'moveFile');break;case NlsDDAction.DD_APPEND:var data=Array('noevent',{yg_property:'moveFile',params:{source:sData[0].yg_id.split('-')[0],target:dData.yg_id.split('-')[0],openerRef:opener,before:false}});$K.log('Data is:',data,$K.Log.INFO);$K.yg_AjaxCallback(data,'moveFile');break;}}
break;}
$K.yg_clearDragSession();}
;Koala.objectMethods={'type':function(object,key,value){$(object).addClassName('dnd_'+$K.yg_trim(value));},'accepts':function(object,key,value){var accepts=value.split(',');for(m=0;m<accepts.length;m++)accepts[m]='dnd_'+$K.yg_trim(accepts[m]);Droppables.add(object.id,{accept:accepts,onDrop:function(element,droppableElement){if($(droppableElement).callback){var data=Array((this.event)?(this.event):'none',$K.yg_getAttributes(element),$K.yg_getAttributes(droppableElement));$K.yg_AjaxCallback(data,$(droppableElement).callback);}}});}}
Koala.widgetMethods={'type':function(object,key,value){object=$(object);switch(value){case'tree':object.addClassName('wdgt_'+$K.yg_trim(value));$K.initTree(object);break;case'sortable':object.addClassName('wdgt_'+$K.yg_trim(value));$K.initSortable(object);break;case'collapsable':case'singlelinetext':case'multilinetext':case'checkbox':case'radiobutton':case'dropdown':case'combobox':case'image':case'submitbutton':object.addClassName('wdgt_'+$K.yg_trim(value));break;default:$K.warn('WARNING: The type \''+value+'\' is not a known type of widget!',object,$K.Log.INFO);break;}},'treename':function(object,key,value){if(object.className.indexOf('wdgt_tree')!=-1){object.treename=value;}else{$K.warn('WARNING: The property \''+key+'\' may only be used with widgets of type \'tree\'!',object,$K.Log.INFO);}},'styleprefix':function(object,key,value){if(object.className.indexOf('wdgt_tree')!=-1){object.styleprefix=value;}else{$K.warn('WARNING: The property \''+key+'\' may only be used with widgets of type \'tree\'!',object,$K.Log.INFO);}},'accepts':function(object,key,value){if(object.className.indexOf('wdgt_tree')!=-1){object.accepts=value;}},'objtype':function(object,key,value){var styleprefix=object.readAttribute('styleprefix');if(styleprefix!=null){object.styleprefix=styleprefix;}
if(object.className.indexOf('wdgt_tree')!=-1){if(!object.treename){$K.warn('WARNING: The property \'treename\' is mandantory when creating a object of type \'tree\'!',object,$K.Log.INFO);}}else{$K.warn('WARNING: The property \''+key+'\' may only be used with widgets of type \'tree\'!',object,$K.Log.INFO);}}}
$K.yg_customAttributeHandler=function(root){if(root==null)return;var startTimer=new Date();$K.log('Getting all elements below given element...',$K.Log.DEBUG);if(!root){var elements=document.getElementsByTagName('*');}else{var elements=root.getElementsByTagName('*');}
var endTimer=new Date();var differenceTimer=endTimer.getTime()-startTimer.getTime();startTimer=new Date();$K.log('Parsing custom attributes...',root,$K.Log.DEBUG);$K._yg_customAttributeHandler(elements);endTimer=new Date();differenceTimer=endTimer.getTime()-startTimer.getTime();$K.warn('Finished parsing custom attributes... ('+differenceTimer+' ms)',$K.Log.DEBUG);}
$K._yg_customAttributeHandler=function(elements,i){if(i==undefined)i=0;if(i<elements.length){var batchSize=600;for(var xx=i;xx<i+batchSize&&xx<elements.length;++xx){obj=elements[xx];if(obj.attributes)
for(var j=0;j<obj.attributes.length;j++){attribute=obj.attributes[j];if((attribute.nodeName.substring(0,3)=='yg_')&&(obj.yg_done!=true)){if(attribute.nodeValue==undefined)
continue;var yg_customProperties=attribute.nodeValue.split(';');for(k=0;k<yg_customProperties.length;k++){yg_customProperties[k]=$K.yg_trim(yg_customProperties[k]);if(yg_customProperties[k]=='')yg_customProperties.splice(k,1);}
if((obj.attributes.length-1)==j){obj.yg_done=true;$K.log('done:',obj,$K.Log.DEBUG);}
switch(attribute.nodeName.toLowerCase()){case'yg_id':obj.yg_id=yg_customProperties[0];$K.yg_addLookup(obj.yg_id,obj);break;case'yg_property':obj.yg_property=yg_customProperties[0];break;case'yg_type':obj.yg_type=yg_customProperties[0];break;case'yg_form':obj.yg_form=yg_customProperties[0];if(obj.yg_form=="dropdown")$K.yg_initDropdown(obj);if(obj.yg_form=="textbox")$K.yg_initTextbox(obj);if(obj.yg_form=="checkbox")$K.yg_initCheckbox(obj);if(obj.yg_form=="radiobox")$K.yg_initRadiobox(obj);if((obj.yg_form=="calendar")&&(!obj.inited))$K.yg_initCalendar(obj);break;case'yg_accepts':obj.accepts=obj.yg_accepts=yg_customProperties[0];$K.yg_clearDropAreas();$K.yg_dropAreas.push(obj);break;case'yg_reordering':obj.yg_reordering=yg_customProperties[0];break;case'yg_selectable':obj.yg_selectable=Boolean(yg_customProperties[0]);if(obj.className.indexOf('mk_selectable')==-1)obj.className+=" mk_selectable";var handler=function(event){$K.yg_blockSelect(this,event)}
Event.stopObserving(obj,'click');Event.observe(obj,'click',handler.bindAsEventListener(obj));break;case'yg_onformsubmit':var handler=function(e){for(var jxx=0;jxx<this.attributes.length;jxx++){if(this.attributes[jxx].nodeName=="yg_submitform")myFormID=this.attributes[jxx].nodeValue;if(this.attributes[jxx].nodeName=="yg_onformsubmit")myActionName=this.attributes[jxx].nodeValue;}
var all_fields=new Object();all_fields.isArray=true;formelement=document.getElementById(myFormID);all_fields[0]=$K.yg_getAttributes(formelement);for(var i=0;i<formelement.length;i++){all_fields[i+1]=$K.yg_getAttributes(formelement[i])}
var data=Array("submit",all_fields);$K.yg_AjaxCallback(data,myActionName);if(e)Event.stop(e);}
Event.observe(obj,'click',handler.bindAsEventListener(obj));obj.fireSubmit=handler;break;case'yg_panel':obj.onmouseover=function(){$K.yg_ipanelHighlight(this,'over');if(this.down('.actions'))$K.yg_showActions(this);}
obj.onmouseout=function(){$K.yg_ipanelHighlight(this,'out');}
obj.down(1).onclick=function(){$K.yg_ipanelSwap(this.up(1));}
obj.down().onselectstart=function(){return false;}
obj.down().onmousedown=function(){return false;}
obj.down().onfocus=function(){this.blur();}
break;case'yg_onclick':case'yg_onrightclick':case'yg_onkeydown':case'yg_onkeyup':case'yg_onkeypress':case'yg_onchange':case'yg_onfocus':case'yg_onblur':case'yg_onselect':case'yg_ondrag':case'yg_ondrop':case'yg_oncollapse':case'yg_onuncollapse':case'yg_onsubmit':for(l=0;l<yg_customProperties.length;l++){var eventname=attribute.nodeName.substr(5);var properties=yg_customProperties[l].split(':');if(typeof obj.callback!='object')obj.callback={};obj.callback[eventname]=properties[0];if(eventname=='submit'){var handler=function(e){var all_fields=new Object();all_fields.isArray=true;all_fields[0]=$K.yg_getAttributes(this);for(var i=0;i<this.length;i++){all_fields[i+1]=$K.yg_getAttributes(this[i]);}
var data=Array('submit',all_fields);$K.yg_AjaxCallback(data,this.callback['submit']);if(e)Event.stop(e);}
Event.observe(obj,'submit',handler.bindAsEventListener(obj));obj.fireSubmit=handler;}else if((eventname=='drag')||(eventname=='drop')){$K.warn('Drag/Drop callback-events not implemented yet!!',$K.Log.INFO);}else if((eventname=='collapse')||(eventname=='uncollapse')){$K.warn('Collapse/Uncollapse callback-events not implemented yet!!',$K.Log.INFO);}else if(eventname=='rightclick'){var handler=function(e){var data=Array('rightclick',$K.yg_getAttributes(this));$K.yg_AjaxCallback(data,this.callback['rightclick']);Event.stop(e);}
Event.observe(obj,'contextmenu',handler.bindAsEventListener(obj));}else{if($(obj).hasClassName('checkbox')){var handler=function(e){var attrData=$K.yg_getAttributes(this);attrData.value=this.down('input').value;if(!Prototype.Browser.WebKit&&!Prototype.Browser.IE){if(attrData.value==0){attrData.value=1;}else{attrData.value=0;}}
var data=Array(e.type,attrData);$K.yg_AjaxCallback(data,this.callback[e.type]);}
Event.observe(obj,eventname,handler.bindAsEventListener(obj));}else{var handler=function(e){if(this.hasClassName('disabled'))return;var fieldData=$K.yg_getAttributes(this);if((this.tagName=='INPUT')||(this.tagName=='TEXTAREA')){fieldData.value=this.value;}
if(this.up('.ywindow')){fieldData.winID=this.up('.ywindow').id;}
var data=Array(e.type,fieldData);$K.yg_AjaxCallback(data,this.callback[e.type]);}
Event.stopObserving(obj,eventname);Event.observe(obj,eventname,handler.bindAsEventListener(obj));}}}
break;case'yg_object':var drag_handle=null;var revert_drag=null;for(l=0;l<yg_customProperties.length;l++){var properties=yg_customProperties[l].split(':');var a_key=properties[0];var a_value=properties[1];if(typeof Koala.objectMethods[a_key]=='function'){Koala.objectMethods[a_key](obj,a_key,a_value);}
if(a_key=='handle'){drag_handle=$K.yg_trim(a_value);}
if(a_key=='revert'){revert_drag=$K.yg_trim(a_value);}}
if(drag_handle){if(revert_drag=='false'){new Draggable(obj.id,{revert:false,handle:drag_handle});}else{new Draggable(obj.id,{revert:true,handle:drag_handle});}}else{if(revert_drag=='false'){new Draggable(obj.id,{revert:false});}else{new Draggable(obj.id,{revert:true});}}
break;case'yg_widget':for(l=0;l<yg_customProperties.length;l++){var properties=yg_customProperties[l].split(':');var a_key=properties[0];var a_value=properties[1];if(typeof Koala.widgetMethods[a_key]=='function'){Koala.widgetMethods[a_key](obj,a_key,a_value);}}
break;}}}}
var nextBitOfQueue=function(){$K._yg_customAttributeHandler(elements,i+batchSize)}
setTimeout(nextBitOfQueue,0);}}
$K.yg_addLookup=function(yg_id,object){if(!$K.yg_idlookuptable[yg_id]){$K.yg_idlookuptable[yg_id]=new Array();}
var ilt_idx=$K.yg_idlookuptable[yg_id].indexOf(object);if((ilt_idx==-1)||($K.yg_idlookuptable[yg_id][ilt_idx]!=object)){$K.yg_idlookuptable[yg_id].push(object);}}
$K.yg_addChild=function(yg_type,yg_id,yg_property,name,new_yg_type,new_yg_id,new_yg_property,new_icon,new_cstclass,andSelect,url){if(!url)url="";if(new_icon==undefined){new_icon='';}else{new_icon=$K.imgdir+'icons/'+new_icon;}
$K.yg_cleanLookupTable();var already_done=new Object();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){var treeRef=$K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i]);if(nlsTree[treeRef].rt.yg_type=='page'){var tmpTreeSiteId=nlsTree[treeRef].rt.yg_id.split('-')[1];var tmpYgIdSiteId=yg_id.split('-')[1];if(tmpTreeSiteId!=tmpYgIdSiteId){continue;}}
if(!already_done[treeRef]){already_done[treeRef]={};already_done[treeRef][$K.yg_idlookuptable[yg_id][i].yg_id]=true;objid=new_yg_id.split("-");var new_node=nlsTree[treeRef].add(new_yg_type+"_"+objid[0],$K.yg_idlookuptable[yg_id][i].orgId,name,'',new_icon,'',null,null,'',null,new_yg_id,new_yg_type,new_yg_property,url);if(nlsTree[treeRef].opt.sort=='no'){var treeType=nlsTree[treeRef].rt.yg_type;var lastChild=nlsTree[treeRef].rt.lc;var trashNode=nlsTree[treeRef].getNodeById(treeType+'_trash');if(trashNode&&(trashNode!=lastChild)){nlsTree[treeRef].ctx_moveChild([trashNode],lastChild,3);}}
if(new_cstclass!=undefined){nlsTree[treeRef].setNodeStyle(new_node.orgId,new_cstclass,true);}
nlsTree[treeRef].expandNode($K.yg_idlookuptable[yg_id][i].orgId);nlsTree[treeRef].reloadNode($K.yg_idlookuptable[yg_id][i].orgId);if(Boolean(andSelect)){nlsTree[treeRef].selectAfterAjax=new_node.orgId;nlsTree[treeRef].selectNodeById(new_node.orgId);$K.yg_selectNode($(new_node.id));}
prnt=$K.yg_idlookuptable[yg_id][i].pr;while(prnt!=null){nlsTree[$K.yg_getTreeReference(prnt)].expandNode(prnt.orgId);prnt=prnt.pr;}
if(typeof(nlsTree[treeRef].remapAction)=='function'){nlsTree[treeRef].remapAction();}
$K.windows[$($K.yg_idlookuptable[yg_id][i].id).up('.ywindow').id].refresh();}else if(already_done[treeRef][$K.yg_idlookuptable[yg_id][i].yg_id]){delete $K.yg_idlookuptable[yg_id][i];}}}}
delete already_done;return false;}
$K.yg_addEntry=function(yg_type,yg_id,yg_property,value,title){$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].hasClassName('dropdownbox')){var prnt=$($K.yg_idlookuptable[yg_id][i].id+"_ddlist").down();prnt.innerHTML='<div value="'+value+'">'+title+'</div>'+prnt.innerHTML;$K.yg_initDropdown($K.yg_idlookuptable[yg_id][i]);}}}
return false;}
$K.yg_clearEntries=function(yg_type,yg_id,yg_property){$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].hasClassName('dropdownbox')){$K.yg_idlookuptable[yg_id][i].down('input').value='';var prnt=$($K.yg_idlookuptable[yg_id][i].id+"_ddlist").down();prnt.innerHTML='';}}}
return false;}
$K.yg_selectEntry=function(yg_type,yg_id,yg_property,value){$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].hasClassName('dropdownbox')){$K.yg_idlookuptable[yg_id][i].down('input').value=value;}}}
return false;}
$K.yg_confirm=function(title,text,action,parameters){var paramObject=parameters.evalJSON();$K.yg_promptbox(title,text,'standard',function(){paramObject['confirmed']='true';paramObject['positive']='true';var data=Array('noevent',{yg_property:action,params:paramObject});$K.yg_AjaxCallback(data,action);},function(){paramObject['confirmed']='true';paramObject['positive']='false';var data=Array('noevent',{yg_property:action,params:paramObject});$K.yg_AjaxCallback(data,action);});}
$K.yg_collapse=function(yg_type,yg_id,yg_property){$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if(typeof $K.yg_idlookuptable[yg_id][i].down('.handle').onclick=='function'){$K.yg_idlookuptable[yg_id][i].down('.handle').onclick();}}}
return false;}
$K.yg_check=function(yg_type,yg_id,yg_property,check,which){if(!which)which='';$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].hasClassName('radiogroup')){if(check==true){var prnt=$K.yg_idlookuptable[yg_id][i].down('.radioarray');var chldNodes=$A(prnt.childNodes);chldNodes.each(function(x){if((x.nodeName=='DIV')&&(x.id==which)){$K.yg_radioboxSelect(x);}});}}else
if($K.yg_idlookuptable[yg_id][i].hasClassName('checkbox')){$K.yg_checkboxSelect($K.yg_idlookuptable[yg_id][i],check);}}}
return false;}
$K.yg_loadFromURL=function(yg_type,yg_id,yg_property,url){$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){var handlerFunc=new Array();var errFunc=new Array();if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){handlerFunc[i]={func:function(t){nlsTree[$K.yg_getTreeReference($K.yg_idlookuptable[this.yg_id][this.iterator])].addNodesXML($K.yg_idlookuptable[this.yg_id][this.iterator].orgId,t.responseXML.documentElement,true);nlsTree[$K.yg_getTreeReference($K.yg_idlookuptable[this.yg_id][this.iterator])].expandNode($K.yg_idlookuptable[this.yg_id][this.iterator].orgId);},yg_id:yg_id,iterator:i}
errFunc[i]=function(t){$K.error('Error '+t.status+' -- '+t.statusText,$K.Log.INFO);}
new Ajax.Request(url,{onSuccess:handlerFunc[i].func.bind(handlerFunc[i]),onFailure:errFunc[i],parameters:{us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}});prnt=$K.yg_idlookuptable[yg_id][i].pr;while(prnt!=null){nlsTree[$K.yg_getTreeReference(prnt)].expandNode(prnt.orgId);prnt=prnt.pr;}}}}
return false;}
$K.yg_select=function(yg_type,yg_id,yg_property){$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){var srcnode=$K.yg_idlookuptable[yg_id][i];var src=new Array(srcnode);var treeRef=$K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i]);nlsTree[treeRef].selectNodeById(srcnode.orgId);}}}
return false;}
$K.yg_addFile=function(yg_type,yg_id,objectid,thumb,color,identifier,name,pname,tags,filesize,ref_count,timestamp,datum,uhrzeit,uid,username,filename,width,height){$K.yg_cleanLookupTable();for(windowItem in $K.windows){if($K.windows[windowItem].yg_id==yg_id){if(($K.windows[windowItem].yg_type=='file')||($K.windows[windowItem].yg_type=='filefolder')&&(($K.windows[windowItem].tab=='FOLDERCONTENT')||(($K.windows[windowItem].tab=='FILES_TREE')&&($K.windows[windowItem].type=='dialog')))){var targetTable=targetContainer=null;if($($K.windows[windowItem].id+'_tablecontent'))targetTable=$($K.windows[windowItem].id+'_tablecontent');if($($K.windows[windowItem].id+'_thumbcontainer'))targetContainer=$($K.windows[windowItem].id+'_thumbcontainer').down('ul');if(typeof tags.evalJSON=='function'){tags=tags.evalJSON();}else{tags=[];}
var all_tags='';if(tags.length>0){all_tags='<div class="related_tags"><span>';tags.each(function(tagItem,tagIndex){var tagParents='';for(var i=(tagItem.PARENTS.length-1);i>=0;i--){tagParents+=tagItem.PARENTS[i].NAME;if(i!=0)tagParents+='||';}
all_tags+='<span onmouseover="$K.yg_hoverTagHint(this,'+tagItem.ID+');" path="'+tagParents+'">'+tagItem.NAME+'</span>';if(tagIndex!=(tags.length-1))all_tags+=', ';});all_tags+='</span></div>';}
var fileData={targetTable:targetTable,targetContainer:targetContainer,yg_type:yg_type,yg_id:yg_id,objectid:objectid,thumb:thumb,classname:'noload',color:color,identifier:identifier,name:name,pname:pname,all_tags:all_tags,filesize:filesize,ref_count:ref_count,datum:datum,uhrzeit:uhrzeit,timestamp:timestamp,uid:uid,username:username,filename:filename,width:width,height:height}
if(typeof $K.windows[windowItem].addFileToFolder=='function'){$K.windows[windowItem].addFileToFolder(fileData);}}}}}
$K.yg_moveUp=function(yg_type,yg_id,yg_property,count,reselect){if(!count)count=1;if(!reselect)reselect=true;$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){var x=$K.yg_idlookuptable[yg_id][i].pv;for(k=0;k<count-1;k++){x=x.pv;}
var prev=x;if(prev){var srcnode=$K.yg_idlookuptable[yg_id][i];var src=new Array(srcnode);var treeRef=$K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i]);nlsTree[treeRef].expandNode(nlsTree[treeRef].getNodeById(srcnode.orgId).pr.orgId);nlsTree[treeRef].ctx_moveChild(src,prev,2);if(reselect!=false){nlsTree[treeRef].selectNodeById(srcnode.orgId);}
if(typeof nlsTree[treeRef].remapAction=='function'){nlsTree[treeRef].remapAction();}
$K.yg_restoreTreeState(treeRef);}}}}
return false;}
$K.yg_moveCBlockUp=function(which){which=$(which);if(which.previous()!=null){which.insert({after:which.previous()});}}
$K.yg_moveCBlockDown=function(which){which=$(which);if(which.next()!=null){which.insert({before:which.next()});}}
$K.yg_moveDown=function(yg_type,yg_id,yg_property,count,reselect){if(!count)count=1;if(!reselect)reselect=1;$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){var x=$K.yg_idlookuptable[yg_id][i].nx;for(k=0;k<count-1;k++){x=x.nx;}
var next=x;if(next){var srcnode=$K.yg_idlookuptable[yg_id][i];var src=new Array(srcnode);var treeRef=$K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i]);nlsTree[treeRef].expandNode(nlsTree[treeRef].getNodeById(srcnode.orgId).pr.orgId);nlsTree[treeRef].ctx_moveChild(src,next,3);if(reselect!=false){nlsTree[treeRef].selectNodeById(srcnode.orgId);}
if(typeof nlsTree[treeRef].remapAction=='function'){nlsTree[treeRef].remapAction();}
$K.yg_restoreTreeState(treeRef);}}}}
return false;}
$K.yg_del=function(yg_type,yg_id,yg_property,windowType,window_yg_id){$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if(windowType&&window_yg_id){var windowRef=null;if($K.yg_idlookuptable[yg_id][i].capt!=undefined){if(nlsTree[$K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i])]){var treeRef=$K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i]);if(treeRef){windowRef=$(treeRef).up('.ywindow');}}}else{windowRef=$K.yg_idlookuptable[yg_id][i].up('.ywindow');}
if(windowRef){if(($K.windows[windowRef.id].yg_type!=windowType)||($K.windows[windowRef.id].yg_id!=window_yg_id)){continue;}}}
if($K.yg_idlookuptable[yg_id][i].capt!=undefined){if(nlsTree[$K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i])]){var treeRef=$K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i]);var windowRef=$(treeRef).up('.ywindow');nlsTree[treeRef].remove($K.yg_idlookuptable[yg_id][i].orgId);var selNodeCount=nlsTree[treeRef].getSelNodes().length;if(selNodeCount==0){tmparr=$(windowRef.id+'_buttons').descendants();tmparr.each(function(item){btn=item.down('.tree_btn');if(btn)btn.addClassName('disabled');});$(windowRef).removeClassName('mk_multiselect');}
if(typeof(nlsTree[treeRef].remapAction)=='function'){nlsTree[treeRef].remapAction();}}}else if($K.yg_idlookuptable[yg_id][i].hasClassName('filetitle')){var windowRef=$K.yg_idlookuptable[yg_id][i].up('.ywindow');if(windowRef){if($K.yg_idlookuptable[yg_id][i].hasClassName('mk_list')){if($K.yg_idlookuptable[yg_id][i].up('tr')){$K.yg_idlookuptable[yg_id][i].up('tr').remove();}}else if($K.yg_idlookuptable[yg_id][i].hasClassName('mk_thumb')){if($K.yg_idlookuptable[yg_id][i].up('.mk_file')){$K.yg_idlookuptable[yg_id][i].up('.mk_file').remove();}}
if($(windowRef.id+'_objcnt')){$(windowRef.id+'_objcnt').update(parseInt($(windowRef.id+'_objcnt').innerHTML)-1);}
var isDialog=false;if($(windowRef.id).hasClassName('ydialog')&&($(windowRef.id+'_column2')))isDialog=true;$K.windows[windowRef.id].refresh();}}else if($K.yg_idlookuptable[yg_id][i].hasClassName('mk_usergroup')){var windowRef=$K.yg_idlookuptable[yg_id][i].up('.ywindow');if(windowRef){$K.yg_idlookuptable[yg_id][i].remove();$K.windows[windowRef.id].refresh();}}else if($K.yg_idlookuptable[yg_id][i].hasClassName('mk_user')&&($K.yg_idlookuptable[yg_id][i].tagName=='TR')){var windowRef=$K.yg_idlookuptable[yg_id][i].up('.ywindow');if(windowRef){var tableRef=$K.yg_idlookuptable[yg_id][i].up('table');$K.yg_idlookuptable[yg_id][i].remove();$K.windows[$(tableRef).up('.ywindow').id].refresh($(tableRef));if(tableRef.childElements().length==0){tableRef.up().previous().style.display='block';tableRef.up().previous().down('.actionbutton').style.display='';}
for(windowItem in $K.windows){if(($K.windows[windowItem].yg_id==yg_id)&&($K.windows[windowItem].tab!='USERLIST')){$(windowItem).addClassName('boxghost');$K.windows[$K.windows[windowItem].boundWindow].tabs.select($K.windows[$K.windows[windowItem].boundWindow].tabs.selected,{refresh:1});$K.windows[windowItem].init();}}
$(windowRef.id+'_objcnt').update(parseInt($(windowRef.id+'_objcnt').innerHTML,10)-1);$K.windows[windowRef.id].refresh();}}else if($K.yg_idlookuptable[yg_id][i].hasClassName('mk_tag')){var item=$K.yg_idlookuptable[yg_id][i];if(!item.orgId){var ulRef=item.up('ul');$K.yg_removefromFocus(item);if(item.tagName=='LI'){item.remove();}else{item.up('li').remove();}
$K.windows[$(ulRef).up('.ywindow').id].refresh($(ulRef));}}else if(($K.yg_idlookuptable[yg_id][i].hasClassName('mk_extension'))||($K.yg_idlookuptable[yg_id][i].hasClassName('mk_cblock'))){if($K.yg_idlookuptable[yg_id][i].readAttribute('yg_property')=='listitem'){var winId=$K.yg_idlookuptable[yg_id][i].up('.ywindow').id;if($K.windows[winId].loadparams&&$K.windows[winId].loadparams.pagedir_perpage&&(($K.windows[winId].loadparams.pagedir_perpage==-1)||($K.windows[winId].loadparams.pagedir_perpage>parseInt($(winId+'_objcnt').innerHTML,10)))){$K.yg_idlookuptable[yg_id][i].remove();$(winId+'_objcnt').update(parseInt($(winId+'_objcnt').innerHTML,10)-1);$K.windows[winId].refresh();}else{$K.windows[winId].tabs.select($K.windows[winId].tabs.selected,{refresh:1});}}else{var reference=$K.yg_idlookuptable[yg_id][i].up('li');ulRef=reference.up('ul');if(reference.parentNode)reference.remove();if(ulRef){$K.windows[$(ulRef).up('.ywindow').id].refresh($(ulRef));}}}}}
$K.yg_cleanLookupTable();return false;}
$K.yg_refreshTags=function(yg_type,yg_id,yg_property,tags){$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){}else if($K.yg_idlookuptable[yg_id][i].hasClassName('mk_file')){$K.yg_refreshFileTags($K.yg_idlookuptable[yg_id][i],tags);}}}
return false;}
$K.yg_refresh=function(yg_type,yg_id,yg_property){$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){nlsTree[$K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i])].reloadNode($K.yg_idlookuptable[yg_id][i].orgId);}}}
return false;}
$K.yg_change=function(yg_type,yg_id,yg_property,value){if(Prototype.Browser.IE){value=value.replace(/\\n/g,'\n\r');}else{value=value.replace(/\\n/g,'\n');}
$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if((($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)&&($K.yg_idlookuptable[yg_id][i].yg_id==yg_id))||($K.yg_idlookuptable[yg_id][i].readAttribute&&($K.yg_idlookuptable[yg_id][i].readAttribute('yg_property')==yg_property)&&($K.yg_idlookuptable[yg_id][i].readAttribute('yg_type')==yg_type)&&($K.yg_idlookuptable[yg_id][i].readAttribute('yg_id')==yg_id))){if(yg_property=='listitem'){var targetElement=$K.yg_idlookuptable[yg_id][i];var winId=$K.yg_idlookuptable[yg_id][i].up('.ywindow').id;var listViewExtensionId=$(winId+'_listview').down('input[type=hidden]').value;var coId=yg_id.split('-')[0];var coFolderId=$K.windows[winId].yg_id.split('-')[0];new Ajax.Request($K.appdir+'contentblock_listitem',{onSuccess:function(t){if(targetElement.hasClassName('cntblockfocus')){t.responseText=t.responseText.replace(/cntblock/,'cntblockfocus');}
if(targetElement.down('div.listthumb')&&targetElement.down('div.listthumb').down('img')){var oldSrc=targetElement.down('div.listthumb').down('img').src;var oldImageUrlArray=oldSrc.split('/');var oldImageId;oldImageUrlArray.each(function(oldImageUrlArrayItem){if(!isNaN(parseInt(oldImageUrlArrayItem,10))){oldImageId=parseInt(oldImageUrlArrayItem,10);}});if(oldImageId){var dummyDiv=new Element('table');dummyDiv.insert(t.responseText);if(dummyDiv.down('div.listthumb')){var realSrc=dummyDiv.down('div.listthumb').down('img').readAttribute('real_src');if(!realSrc){realSrc=dummyDiv.down('div.listthumb').down('img').readAttribute('src');}
var newImageUrlArray=realSrc.split('/');var newImageId;newImageUrlArray.each(function(newImageUrlArrayItem){if(!isNaN(parseInt(newImageUrlArrayItem,10))){newImageId=parseInt(newImageUrlArrayItem,10);}});if(newImageId&&(newImageId==oldImageId)){var imgRef=dummyDiv.down('div.listthumb').down('img');imgRef.writeAttribute('src',oldSrc);t.responseText=dummyDiv.down('tr');}}}}
oldId=targetElement.id;targetElement.replace(t.responseText);$K.yg_currentfocusobj.push($(oldId));$K.yg_customAttributeHandler($(winId+'_listcontainer'));$K.yg_loadThumbPreview($(winId+'_listcontainer'),'.cntblock img');TableKit.Sortable.sort(winId+'_tablecontent',$K.windows[winId].loadparams.pagedir_orderby,$K.windows[winId].loadparams.pagedir_orderdir);TableKit.Sortable.sort(winId+'_tablecontent',$K.windows[winId].loadparams.pagedir_orderby,$K.windows[winId].loadparams.pagedir_orderdir);},parameters:{us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId(),listViewExtensionId:listViewExtensionId,coId:coId,yg_id:coFolderId+'-cblock',wid:winId}});continue;}
if($K.yg_idlookuptable[yg_id][i].src!=undefined){$K.yg_idlookuptable[yg_id][i].src=value;}
if($K.yg_idlookuptable[yg_id][i].capt!=undefined){var currTree=nlsTree[$K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i])];currTree.setNodeCaption($K.yg_idlookuptable[yg_id][i].orgId,value);$K.yg_idlookuptable[yg_id][i].capt=value;nlsTree[$K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i])].reloadNode($K.yg_idlookuptable[yg_id][i].orgId);if(typeof currTree.remapAction=='function'){window.setTimeout(function(){currTree.remapAction();},0);}}
if(typeof $K.yg_idlookuptable[yg_id][i].value=='string'){$K.yg_idlookuptable[yg_id][i].value=value;if($K.yg_idlookuptable[yg_id][i].readAttribute('oldvalue')){$K.yg_idlookuptable[yg_id][i].writeAttribute('oldvalue',value)}
var fadedata=$K.yg_idlookuptable[yg_id][i];$K.yg_fadeField(fadedata);}
if($K.yg_idlookuptable[yg_id][i].nodeName=='TEXTAREA'){$K.yg_idlookuptable[yg_id][i].value=value;var fadedata2=$K.yg_idlookuptable[yg_id][i];var fade2=function(){$K.yg_fadeField(fadedata2);}
fade2.delay(0.1);}
if(($K.yg_idlookuptable[yg_id][i].innerHTML!=undefined)&&($K.yg_idlookuptable[yg_id][i].nodeName!='TEXTAREA')&&($K.yg_idlookuptable[yg_id][i].nodeName!='INPUT')){if(yg_property=='email'){var newA=new Element('a',{className:$K.yg_idlookuptable[yg_id][i].className,href:'mailto:'+value});newA.update(value);var newSpan=new Element('span',{yg_type:yg_type,yg_id:yg_id,yg_property:yg_property});newSpan.insert(newA);var newId=newSpan.identify();var oldId=$K.yg_idlookuptable[yg_id][i].identify();$(oldId).replace(newSpan);$K.yg_idlookuptable[yg_id][i]=$(newId);}else{if($K.yg_idlookuptable[yg_id][i].down('.txt')){$K.yg_idlookuptable[yg_id][i].down('.txt').update(value);}else{if($K.yg_idlookuptable[yg_id][i].nodeName=='INPUT'){$K.yg_idlookuptable[yg_id][i].value=value;}else{$K.yg_idlookuptable[yg_id][i].update(value);}}}}}}
return false;}
$K.yg_changeClass=function(yg_type,yg_id,yg_property,value){if(Prototype.Browser.IE){value=value.replace(/\\n/g,'\n\r');}else{value=value.replace(/\\n/g,'\n');}
$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if((($($K.yg_idlookuptable[yg_id][i]).yg_property==yg_property)&&($($K.yg_idlookuptable[yg_id][i]).yg_type==yg_type))||($($K.yg_idlookuptable[yg_id][i]).readAttribute&&($($K.yg_idlookuptable[yg_id][i]).readAttribute('yg_property')==yg_property)&&($($K.yg_idlookuptable[yg_id][i]).readAttribute('yg_type')==yg_type))){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){}else{$K.yg_idlookuptable[yg_id][i].className=value;}}}
return false;}
$K.yg_changePName=function(yg_type,yg_id,yg_property,value,url,imgurl){if(Prototype.Browser.IE){value=value.replace(/\\n/g,'\n\r');}else{value=value.replace(/\\n/g,'\n');}
$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($($K.yg_idlookuptable[yg_id][i]).yg_property==yg_property)&&($($K.yg_idlookuptable[yg_id][i]).yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){$K.yg_idlookuptable[yg_id][i].pname=value;$K.yg_idlookuptable[yg_id][i].ygurl=url;}}
if((typeof $($K.yg_idlookuptable[yg_id][i]).readAttribute=='function')&&($($K.yg_idlookuptable[yg_id][i]).readAttribute('yg_property')=='pname')&&($($K.yg_idlookuptable[yg_id][i]).readAttribute('yg_type')==yg_type)){if($K.yg_idlookuptable[yg_id][i].tagName=='INPUT'){$K.yg_idlookuptable[yg_id][i].oldvalue=$K.yg_idlookuptable[yg_id][i].value=value;$K.yg_idlookuptable[yg_id][i].writeAttribute('value',value);}}
if((typeof $($K.yg_idlookuptable[yg_id][i]).readAttribute=='function')&&($($K.yg_idlookuptable[yg_id][i]).readAttribute('yg_property')==yg_property)&&($($K.yg_idlookuptable[yg_id][i]).readAttribute('yg_type')=='file')&&($($K.yg_idlookuptable[yg_id][i]).readAttribute('pname')!='')){if($K.yg_idlookuptable[yg_id][i].up('.mk_file')){$K.yg_idlookuptable[yg_id][i].up('.mk_file').pname=value;$K.yg_idlookuptable[yg_id][i].up('.mk_file').writeAttribute('pname',value);$K.yg_idlookuptable[yg_id][i].up('.mk_file').writeAttribute('yg_downloadurl',url);$K.yg_idlookuptable[yg_id][i].up('.mk_file').writeAttribute('yg_imageurl',imgurl);}}}
if(url!=''){for(windowItem in $K.windows){if($K.windows[windowItem].yg_id==yg_id){$K.yg_updatePreviewUrls(windowItem,url);}}}
return false;}
$K.yg_changeBGImage=function(yg_type,yg_id,yg_property,value){if(Prototype.Browser.IE){value=value.replace(/\\n/g,'\n\r');}else{value=value.replace(/\\n/g,'\n');}
$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($($K.yg_idlookuptable[yg_id][i]).readAttribute('yg_property')==yg_property)&&($($K.yg_idlookuptable[yg_id][i]).readAttribute('yg_type')==yg_type)){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){}else{$K.yg_idlookuptable[yg_id][i].setStyle({backgroundImage:'url('+value+')'});}}}
return false;}
$K.yg_disable=function(yg_type,yg_id,yg_property){if(Object.isUndefined($K.yg_idlookuptable[yg_id]))return;$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){$($K.yg_idlookuptable[yg_id][i].id).addClassName('disabledstyle');}else
if($($K.yg_idlookuptable[yg_id][i]).hasClassName('dropdownbox')){$($K.yg_idlookuptable[yg_id][i]).down('input').disabled='disabled';}else
if($K.yg_idlookuptable[yg_id][i].hasClassName('radiogroup')){var prnt=$K.yg_idlookuptable[yg_id][i].down('.radioarray');var chldNodes=$A(prnt.childNodes);chldNodes.each(function(x){if((x.nodeName=='DIV')&&(x.hasClassName('radiobox'))){x.setAttribute('disabled','disabled');}});}else
if($K.yg_idlookuptable[yg_id][i].hasClassName('tree_btn')){$K.yg_idlookuptable[yg_id][i].addClassName('disabled');}else
{$K.yg_idlookuptable[yg_id][i].disabled='disabled';$K.yg_idlookuptable[yg_id][i].setAttribute('disabled','disabled');}}}
return false;}
$K.yg_enable=function(yg_type,yg_id,yg_property){if($K.yg_idlookuptable[yg_id]==undefined)
return;$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){var element=$($K.yg_idlookuptable[yg_id][i]);if(Object.isUndefined(element.tagName)){element=$($K.yg_idlookuptable[yg_id][i].id);}
if((element.yg_property==yg_property)&&(element.yg_type==yg_type)){if(!Object.isUndefined(element.capt)){$(element.id).removeClassName('disabledstyle');}else
if(element.hasClassName('dropdownbox')){element.down('input').disabled='';}else
if(element.hasClassName('radiogroup')){var prnt=element.down('.radioarray');var chldNodes=$A(prnt.childNodes);chldNodes.each(function(x){if((x.nodeName=='DIV')&&(x.hasClassName('radiobox'))){x.removeAttribute('disabled');}});}else
if(element.hasClassName('tree_btn')){element.removeClassName('disabled')}else
{element.disabled='';element.removeAttribute('disabled');}}}
return;}
$K.yg_focus=function(yg_type,yg_id,yg_property){$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){$K.yg_idlookuptable[yg_id][i].focus();}}
return false;}
$K.yg_hilite=function(yg_type,yg_id,yg_property,notInTree){if($K.yg_idlookuptable[yg_id]==undefined)return;$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)&&($K.yg_idlookuptable[yg_id][i].yg_id==yg_id)){$K.log('Found matching item: ',$K.yg_idlookuptable[yg_id][i],$K.Log.DEBUG);if($K.yg_idlookuptable[yg_id][i].capt!=undefined){if(!notInTree){var treeName=$K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i]);var page=yg_id.split('-');page=page[0];var newClass='';if($(treeName+yg_type+'_'+page)){newClass=$(treeName+yg_type+'_'+page).down('a').className;}
newClass+=' changed';if(nlsTree[treeName])nlsTree[treeName].setNodeStyle(yg_type+'_'+page,newClass,true);}}else
if($K.yg_idlookuptable[yg_id][i].hasClassName('dropdownbox')){$K.yg_idlookuptable[yg_id][i].down('input').addClassName('changed');}else
if($K.yg_idlookuptable[yg_id][i].hasClassName('radiogroup')){var prnt=$K.yg_idlookuptable[yg_id][i].down('.radioarray');var chldNodes=$A(prnt.childNodes);chldNodes.each(function(x){if((x.nodeName=='DIV')&&(x.hasClassName('radiobox'))){x.addClassName('changed');}});}else{if(($K.yg_idlookuptable[yg_id][i].nodeName!='INPUT')&&($K.yg_idlookuptable[yg_id][i].nodeName!='LI')){$K.yg_idlookuptable[yg_id][i].addClassName('changed');}}}}
return false;}
$K.yg_fade=function(yg_type,yg_id,yg_property){$K.log('yg_type, yg_id, yg_property',yg_type,yg_id,yg_property,$K.Log.INFO);if($K.yg_idlookuptable[yg_id]==undefined)return;$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){$K.yg_idlookuptable[yg_id][i].select('input','textarea').each(function(currField){$K.yg_fadeField(currField);});}}
return false;}
$K.yg_unHilite=function(yg_type,yg_id,yg_property){if($K.yg_idlookuptable[yg_id]==undefined)return;$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){var treeName=$K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i]);var page=yg_id.split('-');page=page[0];var oldNodeStyle="";if($(treeName+yg_type+'_'+page))var oldNodeStyle=$(treeName+yg_type+'_'+page).down('a').className;var newNodeStyle='node';if(oldNodeStyle.indexOf('nosub')!=-1){newNodeStyle+=' nosub';}
nlsTree[treeName].setNodeStyle(yg_type+'_'+page,newNodeStyle,true);}else if($K.yg_idlookuptable[yg_id][i].hasClassName('dropdownbox')){$K.yg_idlookuptable[yg_id][i].down('input').removeClassName('changed');}else if($K.yg_idlookuptable[yg_id][i].up().hasClassName('dropdowninner')){$K.yg_fadeField($K.yg_idlookuptable[yg_id][i]);}else if($K.yg_idlookuptable[yg_id][i].hasClassName('radiogroup')){var prnt=$K.yg_idlookuptable[yg_id][i].down('.radioarray');var chldNodes=$A(prnt.childNodes);chldNodes.each(function(x){if((x.nodeName=='DIV')&&(x.hasClassName('radiobox'))){x.removeClassName('changed');}});}else{if($K.yg_idlookuptable[yg_id][i].nodeName!='INPUT'){$K.yg_idlookuptable[yg_id][i].removeClassName('changed');}}}}
return false;}
$K.yg_deActivate=function(yg_type,yg_id,yg_property){if($K.yg_idlookuptable[yg_id]==undefined)return;$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){var treeName=$K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i]);var page=yg_id.split('-');page=page[0];if((nlsTree[treeName].nLst[treeName+yg_type+'_'+page].ic==null)||(nlsTree[treeName].nLst[treeName+yg_type+'_'+page].ic[0].indexOf('hidden')==-1))
{nlsTree[treeName].nLst[treeName+yg_type+'_'+page].setIcon($K.imgdir+'icons/ico_page_inactive_s.png');}else{nlsTree[treeName].nLst[treeName+yg_type+'_'+page].setIcon($K.imgdir+'icons/ico_page_inactive_hidden_s.png');}
nlsTree[treeName].reloadNode(yg_type+'_'+page,false);nlsTree[treeName].selectNodeById(yg_type+'_'+page);}else{if($K.yg_idlookuptable[yg_id][i].nodeName!='INPUT'){var ref=$($K.yg_idlookuptable[yg_id][i]).up();switch(ref.className){case'page':ref.className='pageinactive';break;case'pagehidden':ref.className='pagehiddeninactive';break;case'pageinactive':ref.className='pageinactive';break;case'pagehiddeninactive':ref.className='pagehiddeninactive';break;}}}}}
return false;}
$K.yg_activate=function(yg_type,yg_id,yg_property){if($K.yg_idlookuptable[yg_id]==undefined)return;$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){var treeName=$K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i]);var page=yg_id.split('-');page=page[0];if((nlsTree[treeName].nLst[treeName+yg_type+'_'+page].ic==null)||(nlsTree[treeName].nLst[treeName+yg_type+'_'+page].ic[0].indexOf('hidden')==-1))
{nlsTree[treeName].nLst[treeName+yg_type+'_'+page].setIcon($K.imgdir+'icons/ico_page_s.png');}else{nlsTree[treeName].nLst[treeName+yg_type+'_'+page].setIcon($K.imgdir+'icons/ico_page_hidden_s.png');}
nlsTree[treeName].reloadNode(yg_type+'_'+page,false);nlsTree[treeName].selectNodeById(yg_type+'_'+page);}else
{if($K.yg_idlookuptable[yg_id][i].nodeName!='INPUT'){var ref=$($K.yg_idlookuptable[yg_id][i]).up();switch(ref.className){case'page':ref.className='page';break;case'pagehidden':ref.className='pagehidden';break;case'pageinactive':ref.className='page';break;case'pagehiddeninactive':ref.className='pagehidden';break;}}}}}
return false;}
$K.yg_unHide=function(yg_type,yg_id,yg_property){$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){var treeName=$K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i]);var page=yg_id.split('-');page=page[0];if((nlsTree[treeName].nLst[treeName+yg_type+'_'+page].ic==null)||(nlsTree[treeName].nLst[treeName+yg_type+'_'+page].ic[0].indexOf('inactive')==-1))
{nlsTree[treeName].nLst[treeName+yg_type+'_'+page].setIcon($K.imgdir+'icons/ico_page_s.png');}else{nlsTree[treeName].nLst[treeName+yg_type+'_'+page].setIcon($K.imgdir+'icons/ico_page_inactive_s.png');}
nlsTree[treeName].reloadNode(yg_type+'_'+page,false);nlsTree[treeName].selectNodeById(yg_type+'_'+page);}else{if($K.yg_idlookuptable[yg_id][i].nodeName!='INPUT'){var ref=$($K.yg_idlookuptable[yg_id][i]).up();switch(ref.className){case'page':ref.className='page';break;case'pagehidden':ref.className='page';break;case'pageinactive':ref.className='pageinactive';break;case'pagehiddeninactive':ref.className='pageinactive';break;}}}}}
return false;}
$K.yg_hide=function(yg_type,yg_id,yg_property){if($K.yg_idlookuptable[yg_id]==undefined)return;$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){var treeName=$K.yg_getTreeReference($K.yg_idlookuptable[yg_id][i]);var page=yg_id.split('-');page=page[0];if((nlsTree[treeName].nLst[treeName+yg_type+'_'+page].ic==null)||(nlsTree[treeName].nLst[treeName+yg_type+'_'+page].ic[0].indexOf('inactive')==-1))
{nlsTree[treeName].nLst[treeName+yg_type+'_'+page].setIcon($K.imgdir+'icons/ico_page_hidden_s.png');}else{nlsTree[treeName].nLst[treeName+yg_type+'_'+page].setIcon($K.imgdir+'icons/ico_page_inactive_hidden_s.png');}
nlsTree[treeName].reloadNode(yg_type+'_'+page,false);nlsTree[treeName].selectNodeById(yg_type+'_'+page);}else{if($K.yg_idlookuptable[yg_id][i].nodeName!='INPUT'){var ref=$($K.yg_idlookuptable[yg_id][i]).up();switch(ref.className){case'page':ref.className='pagehidden';break;case'pagehidden':ref.className='pagehidden';break;case'pageinactive':ref.className='pagehiddeninactive';break;case'pagehiddeninactive':ref.className='pagehiddeninactive';break;}}}}}
return false;}
$K.yg_error=function(yg_type,yg_id,yg_property){$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){$($K.yg_idlookuptable[yg_id][i].id).addClassName('error');}else
if($K.yg_idlookuptable[yg_id][i].hasClassName('dropdownbox')){$K.yg_idlookuptable[yg_id][i].down('input').addClassName('error');}else
if($K.yg_idlookuptable[yg_id][i].hasClassName('radiogroup')){}else
if($K.yg_idlookuptable[yg_id][i].hasClassName('checkbox')){}else
{$K.yg_idlookuptable[yg_id][i].addClassName('error');}}}
return false;}
$K.yg_cleanLookupTable=function(){var entriesToDelete=new Array();var isInBody=function(item){if(!item)return false;if(item.orgId){var regex=new RegExp(item.orgId);var treeName=item.id.replace(regex,'');if(!$(treeName)){if(nlsTree[treeName])
delete nlsTree[treeName];return false;}else{return true;}}
if(Prototype.Browser.IE&&item.yg_id&&item.yg_id.startsWith('btn-'))return true;try{if((typeof(item.descendantOf)=='function')&&(item.descendantOf(document.body))){return true;}}catch(e){return false;}
return false;}
for(idx in $K.yg_idlookuptable){for(var item_idx=0;item_idx<$K.yg_idlookuptable[idx].length;item_idx++){if(!isInBody($K.yg_idlookuptable[idx][item_idx])){delete $K.yg_idlookuptable[idx][item_idx];$K.yg_idlookuptable[idx]=$K.yg_idlookuptable[idx].compact();if($K.yg_idlookuptable[idx].size()==0){entriesToDelete.push(idx);}}}}
entriesToDelete.each(function(item){delete $K.yg_idlookuptable[item];});}
;$K.addOnDOMReady(function(){new PeriodicalExecuter(function(pe){$K.yg_refreshLocks();},$K.objectRelockInterval);});$K.yg_releaseLock=function(winID,objectType,objectYgId){if($K.windows['wid_'+winID].locking){var data=Array('noevent',{yg_property:'releaseLock',params:{winID:winID,objectType:objectType,objectYgId:objectYgId,us:document.body.id}});$K.yg_AjaxCallback(data,'releaseLock');}}
$K.yg_refreshLocks=function(){var currentObjects=new Array();for(currWindow in $K.windows){var currentWindow=$K.windows[currWindow];if(currentWindow.locking){var isLocked=false;if(currentWindow.locked){isLocked=true;}
currentObjects.push({winID:currentWindow.id.replace(/wid_/,''),objectType:currentWindow.yg_type,winYgId:currentWindow.yg_id,locked:isLocked});}}
if((currentObjects.length>0)&&($K.isAuthenticated)){var data=Array('noevent',{yg_property:'aquireLock',params:{currentObjects:Object.toJSON(currentObjects),us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}});$K.yg_AjaxCallback(data,'aquireLock');}}
$K.changeWindowLockState=function(winID,lockStatus){if(!$K.windows['wid_'+winID])return;var oldStatus=$K.windows['wid_'+winID].locked;if(lockStatus==true){$K.windows['wid_'+winID].locked=true;}else if(lockStatus==false){$K.windows['wid_'+winID].locked=false;}
if((oldStatus!=lockStatus)&&($K.windows['wid_'+winID].tab.toLowerCase()!='foldercontent')){$K.windows['wid_'+winID].tabs.select($K.windows['wid_'+winID].tabs.selected);}}
$K.yg_changeWindowLockStateForObject=function(ygType,ygId,lockStatus){if(lockStatus=='true'){lockStatus=true;}else{lockStatus=false;}
for(winId in $K.windows){if(($K.windows[winId].yg_id==ygId)||($K.windows[winId].yg_type==ygType)){$K.changeWindowLockState(winId,lockStatus);}}}
;$K.yg_initStartSections=function(winID){if($(winID).down('.mk_updater')){var data=Array('noevent',{yg_property:'checkUpdates',params:{winID:winID}});$K.yg_AjaxCallback(data,'checkUpdates',true);}}
;$K.yg_sortSubPageUp=function(which){if(which.previous()!=null){var page=which.yg_id.split('-')[0];var site=which.yg_id.split('-')[1];var data=Array('noevent',{yg_property:'moveUpPage',params:{page:page,site:site,reload:false.toString()}});$K.yg_AjaxCallback(data,'moveUpPage');which.previous().insert({before:which});}}
$K.yg_sortSubPageDown=function(which){if(which.next()!=null){var page=which.yg_id.split('-')[0];var site=which.yg_id.split('-')[1];var data=Array('noevent',{yg_property:'moveDownPage',params:{page:page,site:site,reload:false.toString()}});$K.yg_AjaxCallback(data,'moveDownPage');which.next().insert({after:which});}}
$K.yg_addChildPage=function(pageref){if(pageref.hasClassName('tree_btn')){if(pageref.hasClassName('disabled'))return;var page=$K.windows[pageref.up('.ywindow').id].yg_id;}else{var wid=parseInt(pageref.up('.ywindow').id.replace(/wid_/g,''));var nodeid=pageref.id;var page=nlsTree['pages_tree'+wid+'_tree'].nLst[nodeid].yg_id;}
var site=page.split('-')[1];page=page.split('-')[0];var data=Array('noevent',{yg_property:'addPage',params:{page:page,site:site}});$K.yg_AjaxCallback(data,'addPage');}
$K.yg_moveUpPage=function(pageref){if(pageref.hasClassName('tree_btn')){if(pageref.hasClassName('disabled'))return;var page=$K.windows[pageref.up('.ywindow').id].yg_id;}else{var wid=parseInt(pageref.up('.ywindow').id.replace(/wid_/g,''));var nodeid=pageref.id;var page=nlsTree['pages_tree'+wid+'_tree'].nLst[nodeid].yg_id;}
var site=page.split('-')[1];page=page.split('-')[0];var data=Array('noevent',{yg_property:'moveUpPage',params:{page:page,site:site}});$K.yg_AjaxCallback(data,'moveUpPage');}
$K.yg_changePagePName=function(element){if(Prototype.Browser.WebKit&&$$('.ywindow.pbox.standard').length){return;}
var value=element.value;var yg_id=element.getAttribute('yg_id');if(!element.oldvalue){element.oldvalue=element.readAttribute('oldvalue');}
if(element.value==element.oldvalue){return;}
if(value.strip()==''){element.value=element.oldvalue;$K.yg_promptbox($K.TXT('TXT_CHANGE_PAGE_URL_TITLE'),$K.TXT('TXT_CHANGE_PAGE_URL_EMPTY'),'alert');return;}
if(!isNaN(value)){element.value=element.oldvalue;$K.yg_promptbox($K.TXT('TXT_CHANGE_PAGE_URL_TITLE'),$K.TXT('TXT_CHANGE_PAGE_URL_NUMERIC'),'alert');return;}
$K.yg_promptbox($K.TXT('TXT_CHANGE_PAGE_URL_TITLE'),$K.TXT('TXT_CHANGE_PAGE_URL'),'standard',function(){$K.yg_setEdited(element);element.setAttribute('yg_previous',value);var page=yg_id.split('-')[0];var site=yg_id.split('-')[1];var data=Array('noevent',{yg_property:'setPagePName',params:{value:value,page:page,site:site}});$K.yg_AjaxCallback(data,'setPagePName');},function(){element.value=element.getAttribute('yg_previous');});}
$K.yg_moveDownPage=function(pageref){var wid=parseInt(pageref.up('.ywindow').id.replace(/wid_/g,''));if(pageref.hasClassName('tree_btn')){if(pageref.hasClassName('disabled'))return;var page=$K.windows[pageref.up('.ywindow').id].yg_id;var nodeid='pages_tree'+wid+'_treepage'+pageref.id;}else{var nodeid=pageref.id;var page=nlsTree['pages_tree'+wid+'_tree'].nLst[nodeid].yg_id;}
if(nlsTree['pages_tree'+wid+'_tree'].nLst[nodeid].nx&&(nlsTree['pages_tree'+wid+'_tree'].nLst[nodeid].nx.orgId=='page_trash')){return;}
var site=page.split('-')[1];page=page.split('-')[0];var data=Array('noevent',{yg_property:'moveDownPage',params:{page:page,site:site}});$K.yg_AjaxCallback(data,'moveDownPage');}
$K.yg_actionAddChildPage=function(which){$K.yg_addChildPage(which.up(2).reference);}
$K.yg_actionDeletePage=function(which,multi){$K.yg_deleteElement(which.up(2).reference,multi);}
$K.yg_actionMoveUpPage=function(which){$K.yg_moveUpPage(which.up(2).reference);which.up('.actions').hide();}
$K.yg_actionMoveDownPage=function(which){$K.yg_moveDownPage(which.up(2).reference);which.up('.actions').hide();}
$K.yg_actionEditPage=function(which){which.up(2).reference.onclick();}
$K.yg_actionCopyPage=function(which){var wid=parseInt(which.up('.ywindow').id.replace(/wid_/g,''));$K.windows['wid_'+wid].yg_id=nlsTree['pages_tree'+wid+'_tree'].nLst[which.up(2).reference.id].yg_id;new $K.yg_wndobj({config:'PAGE_COPY',loadparams:{action:'copy',opener_reference:which.up('.ywindow').id,site:$(which.up('.ywindow').id+'_dd_site').value}});}
$K.yg_actionMovePage=function(which){var wid=parseInt(which.up('.ywindow').id.replace(/wid_/g,''));$K.windows['wid_'+wid].yg_id=nlsTree['pages_tree'+wid+'_tree'].nLst[which.up(2).reference.id].yg_id;new $K.yg_wndobj({config:'PAGE_MOVE',loadparams:{action:'move',opener_reference:which.up('.ywindow').id,site:$(which.up('.ywindow').id+'_dd_site').value}});}
$K.yg_actionshowPagePreviewTree=function(which){var wid=parseInt(which.up(2).reference.up('.ywindow').id.replace(/wid_/g,''));var nodeid=which.up(2).reference.id;var data=nlsTree['pages_tree'+wid+'_tree'].nLst[nodeid].yg_id.split('-');var url=nlsTree['pages_tree'+wid+'_tree'].nLst[nodeid].ygurl;var page=data[0];var site=data[1];$K.yg_preview({objecttype:'page',id:page,site:site,version:'working',url:url});}
$K.yg_actionsSetPagePreviewHref=function(which){var wid=parseInt(which.up(2).reference.up('.ywindow').id.replace(/wid_/g,''));var nodeid=which.up(2).reference.id;var url=nlsTree['pages_tree'+wid+'_tree'].nLst[nodeid].ygurl;which.href=url+"?version=working";}
$K.yg_actionMoveDownCBlock=function(which){$K.log('actionMoveDownCBlock',which.up('li'),$K.Log.DEBUG);var cblock=which.up('li').id.split('_')[4];var winno=which.up('.ywindow').id.split('_')[1];var page=$K.windows['wid_'+winno].yg_id.split('-')[0];var site=$K.windows['wid_'+winno].yg_id.split('-')[1];var data=Array('noevent',{yg_property:'moveDownPageContentblock',params:{cblock:cblock,page:page,site:site,win_no:winno}});$K.yg_AjaxCallback(data,'moveDownPageContentblock');}
$K.yg_actionMoveUpCBlock=function(which){$K.log('actionMoveUpCBlock',which.up('li'),$K.Log.DEBUG);var cblock=which.up('li').id.split('_')[4];var winno=which.up('.ywindow').id.split('_')[1];var page=$K.windows['wid_'+winno].yg_id.split('-')[0];var site=$K.windows['wid_'+winno].yg_id.split('-')[1];var data=Array('noevent',{yg_property:'moveUpPageContentblock',params:{cblock:cblock,page:page,site:site,win_no:winno}});$K.yg_AjaxCallback(data,'moveUpPageContentblock');}
$K.yg_selectEntrymask=function(which,wid){if($('wid_'+wid+'_column2innercontentinner')){$('wid_'+wid+'_column2innercontentinner').innerHTML="";$('wid_'+wid+'_column2innercontentinner').addClassName('tab_loading');new Ajax.Updater('wid_'+wid+'_column2innercontentinner',$K.appdir+'cblocks',{evalScripts:true,asynchronous:true,method:'post',parameters:{site:'dummy',page:'dummy',co:which,win_no:wid,us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()},onComplete:function(){$K.windows["wid_"+wid].refresh("col2");$('wid_'+wid+'_column2innercontentinner').removeClassName('tab_loading');},onSuccess:function(transport){}});}}
$K.yg_selectContentblock=function(which,wid){if(!($K.windows['wid_'+wid]))return;if($K.windows['wid_'+wid].tab=='copy'){var mode='cblock_copy';}else{var mode='cblock';}
if($($K.windows['wid_'+wid].openerReference)){var openerSelectedNode=$K.windows[$($K.windows['wid_'+wid].openerReference).up('.ywindow').id].yg_id;var openerPage=openerSelectedNode.split('-')[0];var openerSite=openerSelectedNode.split('-')[1];}
if($('wid_'+wid+'_column2innercontentinner')){$('wid_'+wid+'_column2innercontentinner').innerHTML="";$('wid_'+wid+'_column2innercontentinner').addClassName('tab_loading');new Ajax.Updater('wid_'+wid+'_column2innercontentinner',$K.appdir+'cblocks',{evalScripts:true,asynchronous:true,method:'post',parameters:{site:mode,page:mode,win_no:wid,co:which,co_site:openerSite,co_page:openerPage,us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()},onComplete:function(){$K.windows["wid_"+wid].refresh("col2");$('wid_'+wid+'_column2innercontentinner').removeClassName('tab_loading');},onSuccess:function(transport){}});}}
$K.yg_updatePagesTreeScrolls=function(which){$K.windows[$(which).up('.ywindow').id].init();}
$K.yg_approvePage=function(which){which=$(which);var winID=which.up('.ywindow').id.replace(/wid_/,'');var ygId=$K.windows['wid_'+winID].yg_id;var data=Array('noevent',{yg_property:'approvePage',params:{page:ygId.split('-')[0],site:ygId.split('-')[1],winID:winID}});$K.yg_AjaxCallback(data,'approvePage');}
$K.yg_setPageState=function(which){which=$(which);var winID=which.up('.ywindow').id.replace(/wid_/,'');var ygId=$K.windows['wid_'+winID].yg_id;var data=Array('noevent',{yg_property:'setPageState',params:{page:ygId.split('-')[0],site:ygId.split('-')[1],active:which.down('input').value}});$K.yg_AjaxCallback(data,'setPageState');}
;$K.yg_fileSliders=new Array();$K.yg_initReUploadButton=function(winID,uploadTitle,uploadType,fileID){var readOnly=true;if($('wid_'+winID+'_reuploadpanel')){readOnly=false;}
if(readOnly){if($('wid_'+winID+'_buttons')&&$('wid_'+winID+'_buttons').down('.moveto')){$('wid_'+winID+'_buttons').down('.moveto').addClassName('disabled');}
return;}
$K.yg_loadDlgUpload();if($K.uploadFramework=='swfuploader'){var swfuploadSettings=Object.clone($K.yg_SWFUploadSettings);Object.extend(swfuploadSettings,{upload_url:$K.appdir+'responder?handler=reUploadFile',flash_url:$K.jsdir+'3rd/swfupload/swfupload.swf',button_width:"2000",button_height:"56",button_placeholder_id:'wid_'+winID+'_reuploadpanel',custom_settings:{uploadButtonId:'wid_'+winID+'_okbutton',uploadTitle:uploadTitle,uploadType:uploadType,fileID:fileID,autoUpload:true},button_action:SWFUpload.BUTTON_ACTION.SELECT_FILE});$K.yg_SWFUploadObjects['wid_'+winID]=new SWFUpload(swfuploadSettings);}
if($K.uploadFramework=='plupload'){var customSettings={uploadButtonId:'wid_'+winID+'_okbutton',uploadTitle:uploadTitle,uploadType:uploadType,fileID:fileID,autoUpload:true};$K.yg_UploadInit('wid_'+winID,'wid_'+winID+'_reuploadpanel',null,{handler:'reUploadFile'},customSettings,[],false,true);}}
$K.yg_initFileMgr=function(wndid){if(!$K.windows[wndid].yg_id)return;if(!$('wid_upload')){$K.yg_loadDlgUpload($K.windows[wndid].yg_id);}
var fileID=$K.windows[wndid].yg_id.split('-')[0];if($K.uploadFramework=='plupload'){var customSettings={uploadButtonId:'wid_upload_okbutton',statusPanelTemplate:'wid_upload_filestoupload_template',uploadTitle:'wid_upload_title',uploadType:'wid_upload_filetype'};if(!Prototype.Browser.IE||(BrowserDetect.version!=8)){if($(wndid+'_column2innercontent')){$K.yg_UploadInit('wid_upload',wndid+'_'+fileID+'_fakePanel',wndid+'_column2innercontent',{handler:'uploadFile'},customSettings,[],true);}else{$K.yg_UploadInit('wid_upload',wndid+'_'+fileID+'_fakePanel',wndid+'_ywindowinnerie',{handler:'uploadFile'},customSettings,[],true);}}}
var jsTemplateList=$K.windows[wndid].jsTemplateList;var jsTemplateThumb=$K.windows[wndid].jsTemplateThumb;if($(wndid).hasClassName('mk_filechooser')){if($(wndid+'_listcontainer'))$(wndid+'_listcontainer').writeAttribute('yg_multiselect','false');if($(wndid+'_thumbcontainer'))$(wndid+'_thumbcontainer').writeAttribute('yg_multiselect','false');}
$K.windows[wndid].tablecols=true;if(!($K.windows[wndid].loadparams.view))$K.windows[wndid].loadparams.view='listview';if(!($K.windows[wndid].filelist))$K.windows[wndid].filelist=2;$K.yg_switchFileView(wndid,$K.windows[wndid].loadparams.view);$K.windows[wndid].addFileToFolder=function(fileData){if($(wndid).hasClassName('filelist1')||$(wndid).hasClassName('filelist2')||$(wndid).hasClassName('filelist3')){var item_template=$K.yg_makeTemplate(jsTemplateList);var thumbnailData=$K.yg_makeThumb(fileData);var newFile=item_template.evaluate({item_objectid:fileData.objectid,item_thumbnail:thumbnailData,item_color:fileData.color,item_identifier:fileData.identifier,item_name:fileData.name,item_tags:fileData.tags,item_filesize:$K.yg_filesize(fileData.filesize),item_ref_count:fileData.ref_count,item_timestamp:fileData.timestamp,item_datum:fileData.datum,item_uhrzeit:fileData.uhrzeit,item_uid:fileData.uid,item_username:fileData.username,item_filename:fileData.filename,item_width:fileData.width,item_height:fileData.height,win_no:wndid.replace(/wid_/,'')});if(fileData.targetTable)fileData.targetTable.down('tbody').insert({bottom:newFile});}else if($(wndid).hasClassName('thumbview')){var item_template=$K.yg_makeTemplate(jsTemplateThumb);var alignment='';if(fileData.width){var ratioPic=(fileData.width/fileData.height);if((ratioPic>(4/3))||(fileData.thumb!='1')){alignment='x-scale';}else{alignment='y-scale';}}
var full_filename='';if(fileData.width&&fileData.height){full_filename=fileData.width+'x'+fileData.height+', ';}
full_filename+=$K.yg_filesize(fileData.filesize);var thumbnailData='<div class="thumbcnt ';if(fileData.thumb!='1')thumbnailData+='thumbcnt_nothumb';thumbnailData+='">';if((alignment=='x-scale')||(fileData.thumb!='1'))thumbnailData+='<table cellspacing="0" cellpadding="0"><tr><td>';if(fileData.thumb=='1'){var randomSuffix='?rnd='+parseInt(Math.random()*10000000);thumbnailData+='<img class="noload" real_src="'+$K.appdir+'image/'+fileData.objectid+'/yg-thumb/'+randomSuffix+'" onload="$K.yg_setThumbPreviewLoaded(this);">';}else{thumbnailData+='<div class="noimg">?</div>';}
if((alignment=='x-scale')||(fileData.thumb!='1'))thumbnailData+='</td></tr></table>';thumbnailData+='</div>';var newFile=item_template.evaluate({item_objectid:fileData.objectid,item_thumbnail:thumbnailData,item_color:fileData.color,item_identifier:fileData.identifier,item_name:fileData.name,item_full_filename:full_filename,alignment:alignment,win_no:wndid.replace(/wid_/,'')});var itemsArray=new Array();var newItem=fileData.name.toLowerCase()+'<<>>'+'file_'+wndid.replace(/wid_/,'')+'_'+fileData.objectid;fileData.targetContainer.select('li').each(function(item){itemsArray.push(item.down('.filetitle').innerHTML.toLowerCase()+'<<>>'+item.id);});itemsArray.push(newItem);itemsArray.sort();var targetPosition=itemsArray.indexOf(newItem);targetPosition--;if(targetPosition<0){if(fileData.targetContainer)fileData.targetContainer.insert({top:newFile});}else{var targetId=itemsArray[targetPosition].split('<<>>')[1];$(targetId).insert({after:newFile});}}
var oldFileCount=parseInt($(wndid+'_objcnt').innerHTML);$(wndid+'_objcnt').update(++oldFileCount);if($('file_'+wndid.replace(/wid_/,'')+'_'+fileData.objectid)){$K.yg_customAttributeHandler($('file_'+wndid.replace(/wid_/,'')+'_'+fileData.objectid).up());}
$K.initSortable(wndid+'_'+$K.windows[wndid].yg_id.replace(/-file/,'')+'_files_list');$K.yg_refreshFileMgr(wndid);}
$K.windows[wndid].addTagToFile=function(targetFormfield,sourceYgID){var objectID=targetFormfield.split('_')[2];var objectType='file';var tagId=sourceYgID.split('-')[0];var data=Array('noevent',{yg_property:'addObjectTag',params:{objectID:objectID,objectType:objectType,site:'file',tagId:tagId}});$K.yg_AjaxCallback(data,'addObjectTag');$K.yg_fadeField($(targetFormfield));};}
$K.yg_refreshFileMgr=function(wndid,switchmode){if(($(wndid).hasClassName('filelist1')||$(wndid).hasClassName('filelist2')||$(wndid).hasClassName('filelist3'))&&(switchmode!=true)){if(!($K.yg_fileSliders[wndid+'_list'])&&($(wndid+"_slider").getWidth()>0)){$K.yg_fileSliders[wndid+'_list']=new Control.Slider(wndid+"_sliderhandle",wndid+"_slider",{axis:"horizontal",minimum:0,maximum:($(wndid+"_slider").getWidth()-$(wndid+"_sliderhandle").getWidth()),alignX:0,increment:2,sliderValue:0.5});$K.yg_fileSliders[wndid+'_list'].options.onSlide=function(value){$K.yg_switchFileListView(wndid,value);}
$K.yg_fileSliders[wndid+'_list'].options.onChange=function(value){$K.yg_switchFileListView(wndid,value);}}
if(!($K.windows[wndid].loadparams.pagedir_orderdir))$K.windows[wndid].loadparams.pagedir_orderdir=-1;if(!($K.windows[wndid].loadparams.pagedir_orderby)){$K.windows[wndid].loadparams.pagedir_orderby='title';$(wndid+"_tablehead").down('.fcol_name').addClassName("sortcol");$(wndid+"_tablehead").down('.fcol_name').addClassName("sortasc");}
TableKit.unloadTable(wndid+"_tablecontent");TableKit.unloadTable(wndid+"_tablehead");TableKit.Sortable.init(wndid+"_tablehead");TableKit.Sortable.init(wndid+"_tablecontent");TableKit.Resizable.init(wndid+"_tablehead");TableKit.Sortable.sort(wndid+"_tablecontent",$K.windows[wndid].loadparams.pagedir_orderby,$K.windows[wndid].loadparams.pagedir_orderdir*-1);TableKit.Sortable.sort(wndid+"_tablecontent",$K.windows[wndid].loadparams.pagedir_orderby,1);if(($K.windows[wndid].loadparams.pagedir_orderby=='title')&&($K.windows[wndid].loadparams.pagedir_orderdir==1)){TableKit.Sortable.sort(wndid+"_tablecontent",$K.windows[wndid].loadparams.pagedir_orderby,1);}}
if($(wndid).hasClassName('ydialog')){$K.yg_customAttributeHandler($(wndid+'_ywindowinner'));$K.yg_customAttributeHandler($(wndid+'_column2innercontent'));$(wndid+'_column2innercontent').removeClassName('tab_loading');}else{$K.yg_customAttributeHandler($(wndid+'_ywindowinner'));$(wndid+'_ywindowinner').removeClassName('tab_loading');}
if($(wndid).hasClassName('filelist3')){if($(wndid+'_listcontainer')){$K.yg_loadThumbPreview($(wndid+'_listcontainer'),'.mk_filelist img');}}else if($(wndid).hasClassName('thumbview')){$K.yg_loadThumbPreview($(wndid+'_thumbcontainer'),'.mk_filepreview img');}
$K.windows[wndid].refresh();}
$K.yg_switchFileView=function(wndid,value){currentview=$K.windows[wndid].loadparams.view;$K.windows[wndid].loadparams.view=value;$(wndid+'_fileview').down('input').blur();if(value=="thumbview"){$(wndid).removeClassName('filelist1');$(wndid).removeClassName('filelist2');$(wndid).removeClassName('filelist3');$(wndid).addClassName('thumbview');$K.yg_scaleFileThumbs(wndid,'false');}else{if($K.windows[wndid].filelist==1)$K.yg_switchFileListView(wndid,0.1);if($K.windows[wndid].filelist==2)$K.yg_switchFileListView(wndid,0.5);if($K.windows[wndid].filelist==3)$K.yg_switchFileListView(wndid,1);}
var id=$K.windows[wndid].yg_id;if(!id){id=0;}else{id=id.split('-')[0];}
dialog=false;if($(wndid).hasClassName('ydialog')&&($(wndid+'_column2')))dialog=true;if((dialog)&&(id!=0)){var action='';if($K.windows[wndid].loadparams&&$K.windows[wndid].loadparams.action){action=$K.windows[wndid].loadparams.action;}
$(wndid+'_column2innercontent').addClassName('tab_loading');new Ajax.Updater(wndid+'_column2innercontentinner',$K.appdir+'tab_FOLDERCONTENT',{asynchronous:true,evalScripts:true,method:'post',displaymode:dialog,onComplete:function(){$K.yg_refreshFileMgr(wndid);},parameters:{seq:wndid.replace(/wid_/,''),wid:wndid,yg_id:id+'-file',yg_type:'filefolder',view:value,action:action,us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}});}else{if(currentview!=$K.windows[wndid].loadparams.view){$K.windows[wndid].tabs.select($K.windows[wndid].tabs.selected,{refresh:1});}
$K.yg_customAttributeHandler($(wndid+'_ywindowinner'));$(wndid+'_ywindowinner').removeClassName('tab_loading');$K.yg_refreshFileMgr(wndid);}}
$K.yg_switchFileListView=function(wndid,value){$(wndid).removeClassName('thumbview');if($(wndid+'_column2')){innerwidth=$(wndid+'_column2innercontent').getWidth();}else{innerwidth=$(wndid+'_ywindowinner').getWidth();}
var refreshvar=false;var slider=$(wndid+"_sliderhandle");if(slider){$(wndid+"_tablecols").show();if(Math.round(value*100)<33){if(($K.windows[wndid].filelist!=1)||(!($(wndid).hasClassName('filelist1')))){$(wndid).removeClassName("filelist3");$(wndid).removeClassName("filelist2");$(wndid).addClassName("filelist1");$(wndid+"_colhead_tags_2nd").hide();$(wndid+"_colhead_tags").hide();$(wndid+"_colhead_inuse").show();$(wndid+"_colhead_inuse_2nd").hide();$(wndid+"_colhead_filename").hide();$(wndid+"_colhead_filesize").hide();$(wndid+"_colhead_preview").hide();$(wndid+"_colhead_author").hide();namewidth=Math.floor((innerwidth-38-54-21)*0.57);lastchangewidth=innerwidth-38-54-21-namewidth-4;$K.yg_changeCSS('#'+wndid+' .fcol_type','width','34px',true);$K.yg_changeCSS('#'+wndid+' .fcol_name','width',namewidth+'px',true);$K.yg_changeCSS('#'+wndid+' .fcol_size','width','50px',true);$K.yg_changeCSS('#'+wndid+' .fcol_lastchange','width',lastchangewidth+'px',true);refreshvar=true;$K.windows[wndid].filelist=1;}
slider.setStyle({left:'0px'});}else if(Math.round(value*100)<66){if(($K.windows[wndid].filelist!=2)||(!($(wndid).hasClassName('filelist2')))){$(wndid).addClassName("filelist2");$(wndid).removeClassName("filelist1");$(wndid).removeClassName("filelist3");$(wndid+"_colhead_tags_2nd").hide();$(wndid+"_colhead_tags").show();$(wndid+"_colhead_inuse").hide();$(wndid+"_colhead_inuse_2nd").show();$(wndid+"_colhead_filename").show();$(wndid+"_colhead_filesize").show();$(wndid+"_colhead_preview").hide();$(wndid+"_colhead_author").show();namewidth=Math.floor((innerwidth-38-54-25-136)*0.5);filenamewidth=innerwidth-38-54-25-136-namewidth-4;$K.yg_changeCSS('#'+wndid+' .fcol_type','width','34px',true);$K.yg_changeCSS('#'+wndid+' .fcol_name','width',namewidth+'px',true);$K.yg_changeCSS('#'+wndid+' .fcol_size','width','50px',true);$K.yg_changeCSS('#'+wndid+' .fcol_lastchange','width','132px',true);$K.yg_changeCSS('#'+wndid+' .fcol_filename','width',filenamewidth+'px',true);refreshvar=true;$K.windows[wndid].filelist=2;}
slider.setStyle({left:'74px'});}else if(Math.round(value*100)>=66){if(($K.windows[wndid].filelist!=3)||(!$(wndid).hasClassName('filelist3'))){$(wndid).addClassName("filelist3");$(wndid).removeClassName("filelist1");$(wndid).removeClassName("filelist2");$(wndid+"_colhead_tags_2nd").show();$(wndid+"_colhead_tags").hide();$(wndid+"_colhead_inuse").hide();$(wndid+"_colhead_inuse_2nd").show();$(wndid+"_colhead_filename").show();$(wndid+"_colhead_filesize").show();$(wndid+"_colhead_preview").show();$(wndid+"_colhead_author").show();namewidth=Math.floor(innerwidth-106-50-21-132)*0.5;filenamewidth=innerwidth-130-50-21-132-namewidth;$K.yg_changeCSS('#'+wndid+' .fcol_type','width','106px',true);$K.yg_changeCSS('#'+wndid+' .fcol_name','width',namewidth+'px',true);$K.yg_changeCSS('#'+wndid+' .fcol_size','width','50px',true);$K.yg_changeCSS('#'+wndid+' .fcol_lastchange','width','132px',true);$K.yg_changeCSS('#'+wndid+' .fcol_filename','width',filenamewidth+'px',true);if($(wndid).hasClassName('ydialog')){var thumbContainer=$(wndid+'_column2innercontentinner');}else{var thumbContainer=$(wndid+'_FOLDERCONTENT');}
$K.yg_loadThumbPreview(thumbContainer,'.mk_filelist img');refreshvar=true;$K.windows[wndid].filelist=3;}
slider.setStyle({left:'147px'});}}
if(refreshvar)$K.yg_refreshFileMgr(wndid,true);}
$K.yg_makeThumb=function(fileData){var alignment='';if(fileData.height){var ratioPic=(fileData.width/fileData.height);if((ratioPic>(4/3))||(fileData.thumb!='1')){alignment='vimg';}}
if(Prototype.Browser.IE){alignment+=' loaded';}
if(fileData.thumb!=1)alignment+=' nothumb';var thumbnailData='<div class="'+alignment+'">';if(fileData.thumb==1){var randomSuffix='?rnd='+parseInt(Math.random()*10000000);thumbnailData+='<img class="'+fileData.classname+'" real_src="'+$K.appdir+'image/'+fileData.objectid+'/yg-list/'+randomSuffix+'" onload="$K.yg_setFileListPreviewLoaded(this);">';}else{thumbnailData+='<div class="noimg">?</div>';}
thumbnailData+='</div>';return thumbnailData;}
$K.yg_openFileChooserWindow=function(which,targetFolder,objectid,formfield){which=$(which);var targetElement;var openerRef;if(which.up('.maskedit')&&which.up('.maskedit').down('.title_txt')){targetElement=which.up('.maskedit').down('.title_txt');openerRef=which.up('.maskedit');}else{targetElement=openerRef=which;}
new $K.yg_wndobj({config:'FILE_SELECT',loadparams:{yg_id:targetFolder,element:targetElement.identify(),formfield:formfield,opener_reference:openerRef.identify()}});}
$K.yg_changeFileType=function(value,wndid,which){var file=$K.windows['wid_'+wndid].yg_id.split('-')[0];var data=Array('noevent',{yg_property:'changeFileType',params:{file:file,wid:wndid,type:value}});$K.yg_AjaxCallback(data,'changeFileType');}
$K.yg_selectFile=function(which){which=$(which);var winRef=which.up('.ywindow');var openerReference=$($K.windows[winRef.id].openerReference);$K.yg_hideColumn2Bottom(winRef.id);if($(winRef.id+'_viewselect'))$(winRef.id+'_viewselect').down().next('input').value="";if($K.windows[winRef.id].loadparams['opener_reference']&&($K.windows[winRef.id].loadparams['type']=='image')&&(which.hasClassName('cntblock')||which.hasClassName('cntblockcontainer'))){params={};params.id=which.readAttribute("yg_id").split("-")[0];params.win=winRef.id.split('_')[1];var data=Array('noevent',{params:params});$K.yg_AjaxCallback(data,'refreshFileViewDetails');}}
$K.yg_updateFileViewDetails=function(views,win){if((!($("wid_"+win)))||(!($("wid_"+win+"_viewselect"))))return;views=views.evalJSON();$("wid_"+win+"_viewselect_ddlist").down().innerHTML="";var count=0;for(var i=0;i<views.length;i++){if(views[i]["VIEWTYPE"]==1){title=views[i]["NAME"];value=views[i]["IDENTIFIER"];if(views[i]["IDENTIFIER"]=="YGSOURCE"){title=$K.TXT('TXT_SOURCEFILE');value="";}
title+=": ";if((views[i]["WIDTH"]!=0)&&(views[i]["WIDTH"]!=null)){title+=views[i]["WIDTH"]}else{title+="[-]";}
title+=" x ";if((views[i]["HEIGHT"]!=0)&&(views[i]["HEIGHT"]!=null)){title+=views[i]["HEIGHT"]}else{title+="[-]";}
if(count==0){selected=true;}else{selected=false;}
$K.yg_dropdownInsert($("wid_"+win+"_viewselect"),title,value,selected);count++;}}
if(count>0){$K.yg_initDropdown($("wid_"+win+"_viewselect"));$K.yg_showColumn2Bottom("wid_"+win);}}
$K.yg_setFileListPreviewLoaded=function(which){which=$(which);if((which.dummy_loaded)||(!which.src.endsWith('x.gif'))){setTimeout(function(){which.up('div').addClassName('loaded');},0);}else{which.dummy_loaded=true;}}
$K.yg_setThumbPreviewLoaded=function(which){which=$(which);if((which.dummy_loaded)||(!which.src.endsWith('x.gif'))){setTimeout(function(){if(which.up('div'))which.up('div').addClassName('thumbcnt_loaded');},0);}else{which.dummy_loaded=true;}}
$K.yg_loadThumbPreview=function(thumbContainer,classFilter){thumbContainer=$(thumbContainer);if(!classFilter)classFilter='img';if(thumbContainer){thumbContainer.select(classFilter).each(function(listitem){if(listitem.readAttribute('real_src')&&!listitem.hasClassName('noload')){listitem.src=listitem.readAttribute('real_src');listitem.removeAttribute('real_src');}});}}
$K.yg_scaleFileThumbs=function(wndid,value){if(!($K.yg_fileSliders[wndid+'_preview'])){$K.yg_fileSliders[wndid+'_preview']=new Control.Slider(wndid+"_sliderhandlepreview",wndid+"_sliderpreview",{axis:"horizontal",minimum:0,maximum:($(wndid+"_sliderpreview").getWidth()-$(wndid+"_sliderhandlepreview").getWidth()),alignX:0,increment:2,sliderValue:0.5});$K.yg_fileSliders[wndid+'_preview'].options.onSlide=function(value){$K.yg_scaleFileThumbs(wndid,value);}
$K.yg_fileSliders[wndid+'_preview'].options.onChange=function(value){$K.yg_scaleFileThumbs(wndid,value);}}
if($(wndid+'_column2')){dialog=true;var scaleGroup=$(wndid+"_column2innercontentinner");}else{dialog=false;var scaleGroup=$(wndid+"_container");}
if(value=='false'){if(scaleGroup.className.indexOf('thumbscale')!=-1){value=parseInt(scaleGroup.className.substring(scaleGroup.className.indexOf('thumbscale')+10,scaleGroup.className.indexOf('thumbscale')+13));}else{value=50;}
$K.yg_fileSliders[wndid+'_preview'].setValue(parseInt(value)/100);}else{percent=Math.round(value*100);if(scaleGroup.className.indexOf('thumbscale')!=-1)scaleGroup.className=scaleGroup.className.substring(0,scaleGroup.className.indexOf('thumbscale')-1);scaleGroup.addClassName('thumbscale'+percent);}
if(dialog){$K.windows[wndid].refresh("col2");}else{$K.windows[wndid].refresh("col1");}}
$K.yg_fileSlideClick=function(wndid,value){if($(wndid).hasClassName('filelist1')){if(value>0){$K.yg_switchFileListView(wndid,0.5);}}else if($(wndid).hasClassName('filelist2')){if(value>0){$K.yg_switchFileListView(wndid,0.7);}else{$K.yg_switchFileListView(wndid,0);}}else if($(wndid).hasClassName('filelist3')){if(value<0){$K.yg_switchFileListView(wndid,0.5);}}else{var scaleGroup=$(wndid+"_container");var currentvalue=parseInt(scaleGroup.className.replace("container thumbscale",""))/100;if(isNaN(currentvalue))currentvalue=0.5;if(value>0){currentvalue+=0.1;}else{currentvalue-=0.1;}
if(currentvalue>1)currentvalue=1;if(currentvalue<0)currentvalue=0;$K.yg_fileSliders[wndid+'_preview'].setValue(currentvalue);}}
$K.yg_addChildFolder=function(fileref){if(fileref.hasClassName('tree_btn')){if(fileref.hasClassName('disabled'))return;var file=$K.windows[fileref.up('.ywindow').id].yg_id;}else{var wid=parseInt(fileref.up('.ywindow').id.replace(/wid_/g,''));var nodeid=fileref.id;var file=nlsTree['files_tree'+wid+'_tree'].nLst[nodeid].yg_id;}
file=file.split('-')[0];var data=Array('noevent',{yg_property:'addFileChildFolder',params:{file:file}});$K.yg_AjaxCallback(data,'addFileChildFolder');}
$K.yg_moveUpFolder=function(fileref){if(fileref.hasClassName('tree_btn')){if(fileref.hasClassName('disabled'))return;var file=$K.windows[fileref.up('.ywindow').id].yg_id;}else{var wid=parseInt(fileref.up('.ywindow').id.replace(/wid_/g,''));var nodeid=fileref.id;var file=nlsTree['files_tree'+wid+'_tree'].nLst[nodeid].yg_id;}
var site=file.split('-')[1];file=file.split('-')[0];var data=Array('noevent',{yg_property:'moveUpFolder',params:{file:file,site:site}});$K.yg_AjaxCallback(data,'moveUpFolder');}
$K.yg_moveDownFolder=function(fileref){if(fileref.hasClassName('tree_btn')){if(fileref.hasClassName('disabled'))return;var file=$K.windows[fileref.up('.ywindow').id].yg_id;}else{var wid=parseInt(fileref.up('.ywindow').id.replace(/wid_/g,''));var nodeid=fileref.id;var file=nlsTree['files_tree'+wid+'_tree'].nLst[nodeid].yg_id;}
var site=file.split('-')[1];file=file.split('-')[0];var data=Array('noevent',{yg_property:'moveDownFolder',params:{file:file,site:site}});$K.yg_AjaxCallback(data,'moveDownFolder');}
$K.yg_refreshFileTags=function(which,tags){which=$(which);if(which&&which.down('.mk_tags')){var tagContainer=which.down('.mk_tags');var output='';tags=tags.evalJSON();if(tags.length>0){output='<div class="related_tags"><span>';tags.each(function(tagItem,tagIndex){var tagParents='';for(var i=(tagItem.PARENTS.length-1);i>=0;i--){tagParents+=tagItem.PARENTS[i].NAME;if(i!=0)tagParents+='||';}
output+='<span onmouseout="$K.yg_hideTagHint();" onmouseover="$K.yg_hoverTagHint(this,'+tagItem.ID+');" path="'+tagParents+'">'+tagItem.NAME+'</span>';if(tagIndex!=(tags.length-1))output+=', ';});output+='</span></div>';}
tagContainer.update(output);}}
$K.yg_actionAddChildFolder=function(which){$K.yg_addChildFolder(which.up(2).reference);}
$K.yg_actionDeleteFolder=function(which,multi){$K.yg_deleteElement(which.up(2).reference,multi);}
$K.yg_actionMoveUpFolder=function(which){$K.yg_moveUpFolder(which.up(2).reference);}
$K.yg_actionMoveDownFolder=function(which){$K.yg_moveDownFolder(which.up(2).reference);}
$K.yg_actionCopyFolder=function(which){var wid=parseInt(which.up('.ywindow').id.replace(/wid_/g,''));$K.windows['wid_'+wid].yg_id=nlsTree['files_tree'+wid+'_tree'].nLst[which.up(2).reference.id].yg_id;new $K.yg_wndobj({config:'FOLDER_COPY',loadparams:{opener_reference:which.up('.ywindow').id,type:'folder'}});}
$K.yg_actionCopyFile=function(which){var wid=parseInt(which.up('.ywindow').id.replace(/wid_/g,''));var sourceYgId=which.readAttribute('yg_id');new $K.yg_wndobj({config:'FILE_COPY',loadparams:{sourceYgId:sourceYgId,opener_reference:which.up('.ywindow').id,type:'file'}});}
$K.yg_actionMoveFolder=function(which){var wid=parseInt(which.up('.ywindow').id.replace(/wid_/g,''));var sourceYgId=nlsTree['files_tree'+wid+'_tree'].nLst[which.up(2).reference.id].yg_id;$K.windows['wid_'+wid].yg_id=nlsTree['files_tree'+wid+'_tree'].nLst[which.up(2).reference.id].yg_id;new $K.yg_wndobj({config:'FOLDER_MOVE',loadparams:{sourceYgId:sourceYgId,opener_reference:which.up('.ywindow').id,type:'folder'}});}
$K.yg_actionMoveFile=function(which){var wid=parseInt(which.up('.ywindow').id.replace(/wid_/g,''));$K.windows[which.up('.ywindow').id].yg_id=which.readAttribute('yg_id');new $K.yg_wndobj({config:'FILE_MOVE',loadparams:{opener_reference:which.up('.ywindow').id,type:'file',sourceYgId:which.readAttribute('yg_id')}});}
$K.yg_addFileId=function(filePrefix,uploadID,reUpload,title,color,typecode){$('wid_uploadprogress').select('li').each(function(item){if(item.readAttribute('yg_id')==uploadID+'-file'){item.filePrefix=filePrefix;if(reUpload=='true'){item.reUpload=true;}else{item.reUpload=false;}
item.observe('dblclick',function(ev){$K.yg_openObjectDetails(filePrefix.split('-')[0],'file',title,{color:color,typecode:typecode});});item.down('.edit').show().observe('click',function(ev){$K.yg_openObjectDetails(filePrefix.split('-')[0],'file',title,{color:color,typecode:typecode});});}});}
$K.yg_setFileStatusOK=function(filePrefix){$('wid_uploadprogress').select('li').each(function(item){if(item.filePrefix==filePrefix){item.removeClassName('uploadprocessing');item.addClassName('uploaddone');item.down('.uploadpercent').update('OK');}else if(item.id==filePrefix){item.removeClassName('uploadprocessing');item.addClassName('uploaddone');item.down('.uploadpercent').update('OK');item.removeAttribute('id');}});}
$K.yg_setFileUploadButton=function(wid,disable){if($($K.windows['wid_'+wid].boundWindow+'_uploadbtn')){if(disable=='true'){$($K.windows['wid_'+wid].boundWindow+'_uploadbtn').addClassName('disabled');}else{$($K.windows['wid_'+wid].boundWindow+'_uploadbtn').removeClassName('disabled');}}}
$K.yg_setFileInfoLinks=function(winID,fileID,url){$('wid_'+winID+'_downloadlink').writeAttribute('href',url);$('wid_'+winID+'_previewlink').href=$K.internalprefix+'?preview=1&objecttype=file&id='+fileID;$('wid_'+winID+'_previewlink').writeAttribute('onclick','Event.stop(event);$K.yg_preview({objecttype: \'file\', id: '+fileID+', fullscreen: true});');$('wid_'+winID+'_previewlinkwin').writeAttribute('onclick','$K.yg_preview({objecttype: \'file\', id: '+fileID+'});');}
$K.filesSortCallbacks={onUpdate:function(element){var listArray=Array();for(var i=0;i<element.childNodes.length;i++){var fileID=element.childNodes[i].readAttribute('yg_id').split('-');fileID=fileID[0];listArray.push(fileID);}
var parentWin=$K.windows[this.element.up('.ywindow').id];var siteID=parentWin.yg_id.split('-')[1];var objectID=parentWin.yg_id.split('-')[0];var data=Array('noevent',{yg_property:'orderObjectFile',params:{objectID:objectID,site:siteID,listArray:listArray}});$K.yg_AjaxCallback(data,'orderObjectFile');}};$K.yg_changeFilePName=function(element){if(Prototype.Browser.WebKit&&$$('.ywindow.pbox.standard').length){return;}
var value=element.value;var yg_id=element.getAttribute('yg_id');if(!element.oldvalue){element.oldvalue=element.readAttribute('oldvalue');}
if(element.value==element.oldvalue){return;}
if(value.strip()==''){element.value=element.oldvalue;$K.yg_promptbox($K.TXT('TXT_CHANGE_FILE_URL_TITLE'),$K.TXT('TXT_CHANGE_FILE_URL_EMPTY'),'alert');return;}
if(!isNaN(value)){element.value=element.oldvalue;$K.yg_promptbox($K.TXT('TXT_CHANGE_FILE_URL_TITLE'),$K.TXT('TXT_CHANGE_FILE_URL_NUMERIC'),'alert');return;}
$K.yg_promptbox($K.TXT('TXT_CHANGE_FILE_URL_TITLE'),$K.TXT('TXT_CHANGE_FILE_URL'),'standard',function(){$K.yg_setEdited(element);element.setAttribute('yg_previous',value);var file=yg_id.split('-')[0];var data=Array('noevent',{yg_property:'setFilePName',params:{value:value,file:file}});$K.yg_AjaxCallback(data,'setFilePName');},function(){element.value=element.getAttribute('yg_previous');});}
;$K.yg_saveFileTypes=function(which,winID){which=$(which);var hasError=false;var winRef=which.up('.ywindow');var listRef=$(winRef.id+'_CONFIG_FILE-TYPES');var allFields=listRef.select('input');var parameters={wid:winRef.id};allFields.each(function(item){if(item.name){if(parameters[item.name]!=undefined){parameters[item.name]+=','+item.value;}else{parameters[item.name]=item.value;}}});var codes=new Array();var abbreviations=new Array();var extensions=new Array();var legalChars=/^[a-zA-Z0-9\-\.\_]*$/;for(parameter_idx in parameters){if(parameter_idx.indexOf('___NEW___')!=-1){continue;}
if(parameter_idx.endsWith('_title')){if(parameters[parameter_idx].strip()==''){var errField=$(document.forms['wid_'+winID+'_form'][parameter_idx]);errField.addClassName('error');if(errField.up('li').hasClassName('closed')){$K.yg_listCollapsSwap(errField.up('li'),null);}
hasError=true;}else{$(document.forms[0][parameter_idx]).removeClassName('error');}}
if(parameter_idx.endsWith('_code')){if((codes.indexOf(parameters[parameter_idx])!=-1)||(!legalChars.test(parameters[parameter_idx]))||(parameters[parameter_idx].strip()=='')){var errField=$(document.forms[0][parameter_idx]);errField.addClassName('error');if(errField.up('li').hasClassName('closed')){$K.yg_listCollapsSwap(errField.up('li'),null);}
hasError=true;}else{$(document.forms['wid_'+winID+'_form'][parameter_idx]).removeClassName('error');}
codes.push(parameters[parameter_idx]);}
if(parameter_idx.endsWith('_abbreviation')){if((abbreviations.indexOf(parameters[parameter_idx])!=-1)||(!legalChars.test(parameters[parameter_idx]))||(parameters[parameter_idx].strip()=='')){var errField=$(document.forms['wid_'+winID+'_form'][parameter_idx]);errField.addClassName('error');if(errField.up('li').hasClassName('closed')){$K.yg_listCollapsSwap(errField.up('li'),null);}
hasError=true;}else{$(document.forms[0][parameter_idx]).removeClassName('error');}
abbreviations.push(parameters[parameter_idx]);}
if(parameter_idx.endsWith('_extensions')){if(parameters[parameter_idx].indexOf(',')==-1){parameters[parameter_idx]+=',';}
var extensions_array=parameters[parameter_idx].toLowerCase().split(',');extensions_array.each(function(item,idx){extensions_array[idx]=extensions_array[idx].strip();});var hasExtError=false;extensions_array.each(function(item){if(item!=''){if(extensions.indexOf(item)!=-1){var errField=$(document.forms['wid_'+winID+'_form'][parameter_idx]);errField.addClassName('error');if(errField.up('li').hasClassName('closed')){$K.yg_listCollapsSwap(errField.up('li'),null);}
hasError=true;hasExtError=true;}}});extensions=extensions.concat(extensions_array);if(!hasExtError){$(document.forms['wid_'+winID+'_form'][parameter_idx]).removeClassName('error');}}}
if(!hasError){var data=Array('noevent',{yg_property:'saveFileTypes',params:parameters});$K.yg_AjaxCallback(data,'saveFileTypes');}}
$K.yg_addNewFileType=function(ref){ref=$(ref);var wid=ref.up('.ywindow').id;var newElement=$K.windows[wid].jsTemplate;var newId=0;if(!$(wid+'_filetypes_list')){return;}
$(wid+'_filetypes_list').select('input[type=hidden]').each(function(item){if(item.name.endsWith('_filetype_ids[]')&&item.value.startsWith('NEW_')){newId=parseInt(item.value.replace(/NEW_/,''));}});newId++;newElement=newElement.replace(/__NEW__/g,'NEW_'+newId);$(wid+'_filetypes_list').insert({bottom:newElement});var listChildren=$(wid+'_filetypes_list').childElements();newElement=listChildren[listChildren.length-1];$K.yg_customAttributeHandler(newElement);$K.windows[wid].refresh();}
$K.yg_removeFileTypeEntry=function(which){which=$(which);var winID=which.up('.ywindow').id;if(which.id.indexOf('_NEW_')==-1){var hiddenFields=which.select('input[type=hidden]');var newElement=new Element('input',{type:'hidden',name:winID+'_filetype_del_ids[]',value:hiddenFields[hiddenFields.length-1].value});$(winID+'_filetypes_list').insert({bottom:newElement});}
which.remove();$K.windows[winID].refresh();}
;$K.yg_saveProperties=function(which,winID){which=$(which);var hasError=false;var tooShort=false;var winRef=which.up('.ywindow');var currentTab=$K.windows[winRef.id].tab.toLowerCase();var listRef=$(winRef.id+'_formfields_list');var allFields=listRef.select('input');var parameters={wid:winRef.id};allFields.each(function(item){if(item.name){if(parameters[item.name]!=undefined){parameters[item.name]+=','+item.value;}else{parameters[item.name]=item.value;}}});var names=new Array();var identifiers=new Array();var legalChars=/^[a-zA-Z0-9\.\_]*$/;for(parameter_idx in parameters){if(parameter_idx.indexOf('___NEW___')!=-1){continue;}
if(parameter_idx.endsWith('_name')){if((parameters[parameter_idx].strip()=='')){var errField=$('wid_'+winID).down('input[name='+parameter_idx+']');errField.addClassName('error');if(errField.up('li').hasClassName('closed')){$K.yg_listCollapsSwap(errField.up('li'),null);}
hasError=true;}else{$('wid_'+winID).down('input[name='+parameter_idx+']').removeClassName('error');}
names.push(parameters[parameter_idx]);}
if(parameter_idx.endsWith('_tsuffix')){if((identifiers.indexOf(parameters[parameter_idx])!=-1)||(parameters[parameter_idx].indexOf(' ')!=-1)||(parameters[parameter_idx].indexOf('-')!=-1)||(!legalChars.test(parameters[parameter_idx]))||(parameters[parameter_idx].strip()=='')){var errField=$('wid_'+winID).down('input[name='+parameter_idx+']');errField.addClassName('error');if(errField.up('li').hasClassName('closed')){$K.yg_listCollapsSwap(errField.up('li'),null);}
hasError=true;}else{$('wid_'+winID).down('input[name='+parameter_idx+']').removeClassName('error');}
identifiers.push(parameters[parameter_idx]);}}
if(!hasError){var data=Array('noevent',{yg_property:'saveProperties',params:parameters});$K.yg_AjaxCallback(data,'saveProperties');}}
$K.yg_setObjectProperty=function(which,value){which=$(which);whichobj=$(which).up('.hoverable');if(whichobj&&value){if(whichobj.hasClassName('mk_tag'))whichobj.down('.icn').className="icn icontag";if(whichobj.hasClassName('mk_page'))whichobj.down('.icn').className="icn iconpage";if(whichobj.hasClassName('mk_cblock'))whichobj.down('.icn').className="icn iconcblock";if(whichobj.hasClassName('mk_link')){if(value.objecttype=="page")whichobj.down('.icn').className="icn iconpage";if(value.objecttype=="link")whichobj.down('.icn').className="icn iconlink";if(value.objecttype=="email")whichobj.down('.icn').className="icn iconemail";}}
if(which.hasClassName('disabled'))return;var fieldData=$K.yg_getAttributes(which);if(value){fieldData.value=value;}else if((which.tagName=='INPUT')||(which.tagName=='TEXTAREA')){fieldData.value=which.value;}else if(which.tagName=='DIV'){fieldData.value=which.innerHTML;}
var data=Array('change',fieldData);$K.yg_AjaxCallback(data,'setObjectProperty');}
;$K.yg_initMailingPropertyTab=function(mailingID,winID){$K.windows['wid_'+winID].changeTemplate=function(templateId){var mailingId=this.yg_id.split('-');mailingId=mailingId[0];var data=Array('noevent',{yg_property:'setMailingTemplate',params:{mailingId:mailingId,templateId:templateId,wid:winID}});$K.yg_AjaxCallback(data,'setMailingTemplate');}
$K.windows['wid_'+winID].refreshTemplate=function(templateId){var tabRef=$('wid_'+winID+'_MAILING_PROPERTIES');if(!Object.isUndefined(tabRef)){var panelRef=tabRef.down('.cntblockselection');panelRef.writeAttribute('yg_preselected',templateId);new Ajax.Updater(panelRef,$K.appdir+'template_info/',{onComplete:function(){$K.windows['wid_'+winID].init();},asynchronous:true,evalScripts:true,method:'post',parameters:{template:templateId,mode:'details',us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}});}else{$K.log('Panel not there, nothing to update...',$K.Log.INFO);}}}
$K.yg_approveMailing=function(which){which=$(which);var winID=which.up('.ywindow').id.replace(/wid_/,'');var ygId=$K.windows['wid_'+winID].yg_id;var data=Array('noevent',{yg_property:'approveMailing',params:{mailing:ygId.split('-')[0],winID:winID}});$K.yg_AjaxCallback(data,'approveMailing');}
$K.yg_initMailings=function(win){$K.yg_initMailingFilter(win);if(!$K.windows[win].periodicTimer){$K.windows[win].periodicMail=false;$K.windows[win].periodicTimer=new PeriodicalExecuter(function(){if($K.windows[win].periodicMail==true)return;$K.windows[win].periodicMail=true;var mailingIds=new Array();$(win+'_MAILINGS').down('.mk_contentgroup').select('.cntblockcontainer').each(function(item){mailingIds.push(parseInt(item.readAttribute('yg_id').split('-')[0],10));});var data=Array('noevent',{yg_property:'updateMailingStatus',params:{mailingIds:mailingIds}});$K.yg_AjaxCallback(data,'updateMailingStatus');},3);}}
$K.yg_initMailingFilter=function(win){if(!$K.windows[win].loadparams.mailingfilter_status){$K.windows[win].loadparams.mailingfilter_status='ALL';}else{for(var filtername in $K.windows[win].loadparams){if(filtername.substring(0,19)=="mailingfilter"){tmpobj=$(win+"_"+filtername);if(tmpobj)tmparr=tmpobj.immediateDescendants();for(var k=0;k<tmparr.length;k++){if(tmparr[k].readAttribute("value")==$K.windows[win].loadparams[filtername]){tmpobj.previous().down('span').innerHTML=tmparr[k].readAttribute("shortname");}}}}}}
$K.yg_filterMailings=function(col,value,shorttitle,win){$K.yg_pageDirReset(win);$(win+'_mailingfilter_'+col).previous().down().innerHTML=shorttitle;$K.windows[win].loadparams['mailingfilter_'+col]=value;var params=new Object();params.refresh=1;var window=$K.windows[win];window.tabs.select(window.tabs.selected,params);$K.yg_toggleTreeButtons(win);}
$K.yg_sendMailing=function(which){which=$(which);$K.yg_promptbox($K.TXT('TXT_APPROVE_MAILING_TITLE'),$K.TXT('TXT_APPROVE_MAILING_SEND'),'standard',function(){var mailingId=which.up('.cntblockcontainer').readAttribute('yg_id').split('-')[0];var data=Array('noevent',{yg_property:'sendMailing',params:{mailingId:mailingId}});$K.yg_AjaxCallback(data,'sendMailing');},function(){});}
$K.yg_pauseMailing=function(which){which=$(which);$K.yg_promptbox($K.TXT('TXT_APPROVE_MAILING_TITLE'),$K.TXT('TXT_APPROVE_MAILING_PAUSE'),'standard',function(){which.up('.status_info').className='status_info paused justchanged';var mailingId=which.up('.cntblockcontainer').readAttribute('yg_id').split('-')[0];var data=Array('noevent',{yg_property:'pauseMailing',params:{mailingId:mailingId}});$K.yg_AjaxCallback(data,'pauseMailing');},function(){});}
$K.yg_resumeMailing=function(which){which=$(which);$K.yg_promptbox($K.TXT('TXT_APPROVE_MAILING_TITLE'),$K.TXT('TXT_APPROVE_MAILING_RESUME'),'standard',function(){which.up('.status_info').className='status_info inprogress justchanged';var mailingId=which.up('.cntblockcontainer').readAttribute('yg_id').split('-')[0];var data=Array('noevent',{yg_property:'resumeMailing',params:{mailingId:mailingId}});$K.yg_AjaxCallback(data,'resumeMailing');},function(){});}
$K.yg_changeMailingPName=function(element){if(Prototype.Browser.WebKit&&$$('.ywindow.pbox.standard').length){return;}
var value=element.value;var yg_id=element.getAttribute('yg_id');if(!element.oldvalue){element.oldvalue=element.readAttribute('oldvalue');}
if(element.value==element.oldvalue){return;}
if(value.strip()==''){element.value=element.oldvalue;$K.yg_promptbox($K.TXT('TXT_CHANGE_MAILING_URL_TITLE'),$K.TXT('TXT_CHANGE_MAILING_URL_EMPTY'),'alert');return;}
if(!isNaN(value)){element.value=element.oldvalue;$K.yg_promptbox($K.TXT('TXT_CHANGE_MAILING_URL_TITLE'),$K.TXT('TXT_CHANGE_MAILING_URL_NUMERIC'),'alert');return;}
$K.yg_promptbox($K.TXT('TXT_CHANGE_MAILING_URL_TITLE'),$K.TXT('TXT_CHANGE_MAILING_URL'),'standard',function(){$K.yg_setEdited(element);element.setAttribute('yg_previous',value);var mailing=yg_id.split('-')[0];var data=Array('noevent',{yg_property:'setMailingPName',params:{value:value,mailing:mailing}});$K.yg_AjaxCallback(data,'setMailingPName');},function(){element.value=element.getAttribute('yg_previous');});}
$K.yg_cancelMailing=function(which){which=$(which);$K.yg_promptbox($K.TXT('TXT_APPROVE_MAILING_TITLE'),$K.TXT('TXT_APPROVE_MAILING_CANCEL'),'standard',function(){which.up('.status_info').className='status_info cancelled justchanged';var mailingId=which.up('.cntblockcontainer').readAttribute('yg_id').split('-')[0];var data=Array('noevent',{yg_property:'cancelMailing',params:{mailingId:mailingId}});$K.yg_AjaxCallback(data,'cancelMailing');},function(){});}
$K.yg_updateMailingStatus=function(data){data=data.evalJSON();if(data&&(data.length>0)){for(winId in $K.windows){if($K.windows[winId].tab=='MAILINGS'){$K.windows[winId].periodicMail=false;$(winId+'_MAILINGS').down('.mk_contentgroup').select('.cntblockcontainer').each(function(item){data.each(function(dataItem){if(dataItem.MAILING_ID==parseInt(item.readAttribute('yg_id').split('-')[0],10)){if((dataItem.STATUS=='UNSENT')||(dataItem.STATUS=='SENT')){item.down('span.status_num').update('0 / '+dataItem.RECEIPIENTS);var progressPercent=0;}else{item.down('span.status_num').update((dataItem.RECEIPIENTS-dataItem.JOBCOUNT)+' / '+dataItem.RECEIPIENTS);var progressPercent=((dataItem.RECEIPIENTS-dataItem.JOBCOUNT)/dataItem.RECEIPIENTS)*100;}
item.down('td.receipientstd').update(dataItem.RECEIPIENTS);item.down('div.progress').setStyle({width:progressPercent+'%'});if(item.down('.status_info').hasClassName('justchanged')){item.down('.status_info').removeClassName('justchanged');}else{item.down('.status_info').className='status_info '+dataItem.STATUS.toLowerCase();}}});});}}}}
$K.yg_submitMailingTest=function(winId,ygId){var mailingId=ygId.split('-')[0];var emailAddress=$(winId+'_send_to').value;$(winId+'_send_to').removeClassName('error');var validationError=false;if(emailAddress.indexOf(',')!=-1){var emailAdresses=emailAddress.split(',');emailAdresses.each(function(item){item=item.strip();if(!Validator.isEmail(item)||(item.strip()=='')){validationError=true;}});}else{if(!Validator.isEmail(emailAddress)||(emailAddress.strip()=='')){validationError=true;}}
if(validationError){$(winId+'_send_to').addClassName('error');}else{var data=Array('noevent',{yg_property:'sendMailing',params:{testRecipient:emailAddress,testOnly:true,mailingId:mailingId}});$K.yg_AjaxCallback(data,'sendMailing');$K.windows[winId].remove();}}
$K.yg_addMailing=function(which){which=$(which);var winId=which.up('.ywindow').id;var data=Array('noevent',{yg_property:'addMailing',params:{winId:winId}});$K.yg_AjaxCallback(data,'addMailing');}
$K.yg_refreshMailingsWindow=function(onlyRefresh){for(winId in $K.windows){if(($K.windows[winId].yg_type=='mailing')&&($K.windows[winId].tab=='MAILINGS')){if(!onlyRefresh){$K.yg_pageDirReset(winId);$K.windows[winId].tabs.select($K.windows[winId].tabs.selected,$K.windows[winId].tabs.params);}else if($(winId).down('.panelcontent').select('.cntblockcontainer').length<=1){$K.yg_pageDirPrevious($(winId+'_pagedir_MAILINGS'));}else{$K.windows[winId].tabs.select($K.windows[winId].tabs.selected,$K.windows[winId].tabs.params);}}}}
$K.yg_editMailing=function(which){which=$(which);var winId=which.up('.ywindow').id;var ygId=$K.windows[winId].yg_id;var mailingId=ygId.split('-')[0];var tmpOnclick=new Function($('mailings_'+winId.split('_')[1]+'_'+mailingId).readAttribute('ondblclick'));tmpOnclick();}
$K.yg_initMailingConfig=function(parentWinID){$K.windows['wid_'+parentWinID].changeTemplate=function(templateId){var data=Array('noevent',{yg_property:'setMailingConfigTemplate',params:{templateId:templateId,wid:parentWinID}});$K.yg_AjaxCallback(data,'setMailingConfigTemplate');}
$K.windows['wid_'+parentWinID].refreshMailingTemplate=function(name,filename,templateid,preview){var panelRef=$('wid_'+parentWinID+'_templatepanel').down('.mk_templatecontainer');if(panelRef){panelRef.up('.cntblockcontainer').down('input').value=templateid;new Ajax.Updater(panelRef,$K.appdir+'template_info/',{onComplete:function(){panelRef.next().hide();panelRef.show();$K.windows['wid_'+parentWinID].refresh();},asynchronous:true,evalScripts:true,method:'post',parameters:{template:templateid,mode:'details',us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}});}else{$K.log('Panel not there, nothing to update...',$K.Log.INFO);}}
$K.windows['wid_'+parentWinID].changeTemplateRoot=function(templateId){var data=Array('noevent',{yg_property:'setMailingConfigTemplateRoot',params:{templateId:templateId,wid:parentWinID}});$K.yg_AjaxCallback(data,'setMailingConfigTemplateRoot');}
$K.windows['wid_'+parentWinID].refreshMailingTemplateRoot=function(templateId,name){var panelRef=$('wid_'+parentWinID+'_templaterootpanel');if(panelRef){panelRef.down('input').value=templateId;panelRef.down('.icn').className="icn iconfolder"
panelRef.down('.titlecnt').update(name);$K.windows['wid_'+parentWinID].refresh();}else{$K.log('Panel not there, nothing to update...',$K.Log.INFO);}}}
$K.yg_mailingSaveInfo=function(winRef){winRef=$(winRef);var inputFields=$(winRef.id+'_innercontent').select('input');var parameters={wid:winRef.id};var srch=new RegExp(winRef.id+'_');inputFields.each(function(item){var idxname=item.name.replace(srch,'');if(idxname)parameters[idxname]=item.value;});var data=Array('noevent',{yg_property:'saveMailingInfo',params:parameters});$K.yg_AjaxCallback(data,'saveMailingInfo');}
$K.yg_duplicateMailing=function(mailingId){var data=Array('noevent',{yg_property:'duplicateMailing',params:{mailingId:mailingId}});$K.yg_AjaxCallback(data,'duplicateMailing');}
;$K.yg_initCblockList=function(wndid,listconfig){$K.windows[wndid].tablecols=true;var headercontent=new String;var fakecntcontent=new String;var firstrowcontent=new String;var winWidth=$(wndid+'_ywindowinner').getWidth();var fixedWidth=0;var totalWidth=0;var resizeableMinWidth=0;var resizeableStandardWidth=0;listconfig.each(function(column,i){minwidth=Math.round(column.TITLE.length*5+25);if(column.WIDTH<minwidth)column.WIDTH=minwidth;if(column.MINWIDTH<minwidth)column.MINWIDTH=minwidth;if(column.SORT){$K.windows[wndid].loadparams.pagedir_orderby=i;$K.windows[wndid].loadparams.pagedir_orderdir=1;}
if(column.RESIZEABLE==false){fixedWidth+=column.WIDTH;}else{if(column.MINWIDTH)resizeableMinWidth+=column.MINWIDTH;if(column.WIDTH)resizeableStandardWidth+=column.WIDTH;}});listconfig.each(function(column,i){if(column.RESIZEABLE){if((resizeableMinWidth+fixedWidth)>=winWidth){column.WIDTH=column.MINWIDTH;}else{if((resizeableStandardWidth+fixedWidth)>=winWidth){column.WIDTH=column.MINWIDTH+Math.floor((winWidth-resizeableMinWidth-fixedWidth)*(column.WIDTH/resizeableMinWidth));}else{column.WIDTH=column.WIDTH+Math.floor((winWidth-resizeableStandardWidth-fixedWidth)*(column.WIDTH/resizeableStandardWidth));}}
$K.yg_changeCSS('#'+wndid+' .ccol_'+i,'width',(column.WIDTH-8)+'px',true);$K.yg_changeCSS('#'+wndid+' .ccol_'+i,'min-width',(column.MINWIDTH-8)+'px',true);}else{$K.yg_changeCSS('#'+wndid+' .ccol_'+i,'width',(column.WIDTH-8)+'px',true);$K.yg_changeCSS('#'+wndid+' .ccol_'+i,'min-width',(column.WIDTH-8)+'px',true);}
totalWidth+=column.WIDTH;});for(var i=0;i<listconfig.length;i++){if(listconfig[i].RESIZEABLE){if((listconfig[i].WIDTH+winWidth-totalWidth-1)>listconfig[i].MINWIDTH){listconfig[i].WIDTH+=(winWidth-totalWidth-1);$K.yg_changeCSS('#'+wndid+' .ccol_'+i,'width',(listconfig[i].WIDTH-8)+'px',true);break;}}}
$(wndid+'_tablecols').setStyle({'display':'block'});$K.yg_refreshCblockList(wndid);TableKit.Sortable.sort(wndid+"_tablehead",$K.windows[wndid].loadparams.pagedir_orderby);$(wndid+'_buttons').down('a.add.tree_btn_cblock').removeClassName('disabled');}
$K.yg_refreshCblockList=function(wndid){var oldSelectedIds=new Array();$K.yg_currentfocusobj.each(function(focusObjectItem){if(focusObjectItem){oldSelectedIds.push(focusObjectItem.id);}});if(oldSelectedIds.length>0){$(wndid+'_tablecontent').select('tr.mk_cblock').each(function(trItem){oldSelectedIds.each(function(selId){if(trItem.id==selId){trItem.removeClassName('cntblock');trItem.addClassName('cntblockfocus');$K.yg_currentfocusobj.push(trItem);}});});}
TableKit.unloadTable(wndid+"_tablecontent");TableKit.unloadTable(wndid+"_tablehead");TableKit.Sortable.init(wndid+"_tablehead",{});TableKit.Sortable.init(wndid+"_tablecontent",{});TableKit.Sortable.sort(wndid+"_tablecontent",$K.windows[wndid].loadparams.pagedir_orderby,$K.windows[wndid].loadparams.pagedir_orderdir);TableKit.Resizable.init(wndid+"_tablehead",{});TableKit.Resizable.resize(wndid+"_tablehead",0);$K.yg_loadThumbPreview($(wndid+'_listcontainer'),'.cntblock img');$K.windows[wndid].refresh();}
$K.yg_addListCBlock=function(cblockref){if(cblockref.hasClassName('disabled'))return;var winId=cblockref.up('.ywindow').id;var cblock=$K.windows[winId].yg_id;var site=cblock.split('-')[1];cblock=cblock.split('-')[0];var coListExtensionId=$(winId+'_listview').down('input[type=hidden]').value;var data=Array('noevent',{yg_property:'addCBlock',params:{cblock:cblock,site:site,mode:'list',coListExtensionId:coListExtensionId}});$K.yg_AjaxCallback(data,'addCBlock');}
$K.yg_addListItem=function(coFolderId,coBlockInfo,mode){$K.yg_cleanLookupTable();if(coBlockInfo){coBlockInfo=coBlockInfo.evalJSON();}
for(windowItem in $K.windows){if(($K.windows[windowItem].yg_id==coFolderId)&&($K.windows[windowItem].tab=='CONTENTBLOCK_LIST')){if($K.windows[windowItem].loadparams&&$K.windows[windowItem].loadparams.pagedir_perpage&&(($K.windows[windowItem].loadparams.pagedir_perpage==-1)||($K.windows[windowItem].loadparams.pagedir_perpage>parseInt($(windowItem+'_objcnt').innerHTML,10)))){var targetElement=$(windowItem+'__cblock_list');var targetWindow=$K.windows[windowItem];var listViewExtensionId=$(windowItem+'_listview').down('input[type=hidden]').value;new Ajax.Request($K.appdir+'contentblock_listitem',{onSuccess:function(t){targetElement.insert({bottom:t.responseText});targetWindow.refresh();$K.yg_customAttributeHandler($(targetWindow.id+'_listcontainer'));$(targetWindow.id+'_objcnt').update(parseInt($(targetWindow.id+'_objcnt').innerHTML,10)+1);$K.yg_loadThumbPreview($(targetWindow.id+'_listcontainer'),'.cntblock img');TableKit.Sortable.sort(targetWindow.id+'_tablecontent',targetWindow.loadparams.pagedir_orderby,targetWindow.loadparams.pagedir_orderdir);TableKit.Sortable.sort(targetWindow.id+'_tablecontent',targetWindow.loadparams.pagedir_orderby,targetWindow.loadparams.pagedir_orderdir);},parameters:{us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId(),listViewExtensionId:listViewExtensionId,coId:coBlockInfo.OBJECTID,yg_id:coFolderId+'-cblock'}});}else{$K.windows[windowItem].tabs.select($K.windows[windowItem].tabs.selected,{refresh:1});}
if(coBlockInfo&&(mode=='list')){$K.yg_openObjectDetails(coBlockInfo.OBJECTID,'cblock',coBlockInfo.NAME,'iconcblock','changed');}}}}
$K.yg_switchDynamicListView=function(winId,selection){$K.windows[winId].loadparams.listViewExtensionId=selection;delete $K.windows[winId].loadparams.pagedir_orderby;delete $K.windows[winId].loadparams.pagedir_orderdir;$K.windows[winId].tabs.select($K.windows[winId].tabs.selected,{refresh:0});}
;$K.yg_addChildCBlock=function(cblockref){if(cblockref.hasClassName('tree_btn')){if(cblockref.hasClassName('disabled'))return;var cblock=$K.windows[cblockref.up('.ywindow').id].yg_id;}else{var wid=parseInt(cblockref.up('.ywindow').id.replace(/wid_/g,''));var nodeid=cblockref.id;var cblock=nlsTree['cblocks_tree'+wid+'_tree'].nLst[nodeid].yg_id;}
var site=cblock.split('-')[1];cblock=cblock.split('-')[0];var data=Array('noevent',{yg_property:'addCBlock',params:{cblock:cblock,site:site}});$K.yg_AjaxCallback(data,'addCBlock');}
$K.yg_addChildCBlockFolder=function(cblockref){if(cblockref.hasClassName('tree_btn')){if(cblockref.hasClassName('disabled'))return;var cblock=$K.windows[cblockref.up('.ywindow').id].yg_id;}else{var wid=parseInt(cblockref.up('.ywindow').id.replace(/wid_/g,''));var nodeid=cblockref.id;var cblock=nlsTree['cblocks_tree'+wid+'_tree'].nLst[nodeid].yg_id;}
cblock=cblock.split('-')[0];var data=Array('noevent',{yg_property:'addCBlockChildFolder',params:{cblock:cblock}});$K.yg_AjaxCallback(data,'addCBlockChildFolder');}
$K.yg_actionDeleteCBlock=function(which,multi){$K.yg_deleteElement(which.up(2).reference,multi);}
$K.yg_actionMoveCBlock=function(which){var wid=parseInt(which.up('.ywindow').id.replace(/wid_/g,''));if(which.readAttribute('yg_property')=='listitem'){$K.windows['wid_'+wid].yg_id=which.readAttribute('yg_id');}else{$K.windows['wid_'+wid].yg_id=nlsTree['cblocks_tree'+wid+'_tree'].nLst[which.up(2).reference.id].yg_id;}
new $K.yg_wndobj({config:'CBLOCK_MOVE',loadparams:{opener_reference:which.up('.ywindow').id}});}
$K.yg_actionCopyCBlock=function(which){var wid=parseInt(which.up('.ywindow').id.replace(/wid_/g,''));if(which.readAttribute('yg_property')=='listitem'){$K.windows['wid_'+wid].yg_id=which.readAttribute('yg_id');}else{$K.windows['wid_'+wid].yg_id=nlsTree['cblocks_tree'+wid+'_tree'].nLst[which.up(2).reference.id].yg_id;}
new $K.yg_wndobj({config:'CBLOCK_COPY',loadparams:{opener_reference:which.up('.ywindow').id}});}
$K.yg_actionAddChildCBlock=function(which){$K.yg_addChildCBlock(which.up(2).reference);}
$K.yg_actionAddChildCBlockFolder=function(which){$K.yg_addChildCBlockFolder(which.up(2).reference);}
$K.yg_actionEditCBlock=function(which){which.up(2).reference.onclick();}
$K.yg_actionshowCBlockPreviewTree=function(which){var wid=parseInt(which.up(2).reference.up('.ywindow').id.replace(/wid_/g,''));var nodeid=which.up(2).reference.id;var data=nlsTree['cblocks_tree'+wid+'_tree'].nLst[nodeid].yg_id.split('-');var cblock=data[0];$K.yg_preview({objecttype:'cblock',id:cblock,version:'working'});}
$K.yg_actionsSetCBlockPreviewHref=function(which){var wid=parseInt(which.up(2).reference.up('.ywindow').id.replace(/wid_/g,''));var nodeid=which.up(2).reference.id;var data=nlsTree['cblocks_tree'+wid+'_tree'].nLst[nodeid].yg_id.split('-');var cblock=data[0];which.href=$K.appdir+"?preview=1&objecttype=cblock&id="+cblock+"&version=working";}
$K.yg_changeCBlockPName=function(element){if(Prototype.Browser.WebKit&&$$('.ywindow.pbox.standard').length){return;}
var value=element.value;var yg_id=element.getAttribute('yg_id');if(!element.oldvalue){element.oldvalue=element.readAttribute('oldvalue');}
if(element.value==element.oldvalue){return;}
if(value.strip()==''){element.value=element.oldvalue;$K.yg_promptbox($K.TXT('TXT_CHANGE_CBLOCK_URL_TITLE'),$K.TXT('TXT_CHANGE_CBLOCK_URL_EMPTY'),'alert');return;}
if(!isNaN(value)){element.value=element.oldvalue;$K.yg_promptbox($K.TXT('TXT_CHANGE_CBLOCK_URL_TITLE'),$K.TXT('TXT_CHANGE_CBLOCK_URL_NUMERIC'),'alert');return;}
$K.yg_promptbox($K.TXT('TXT_CHANGE_CBLOCK_URL_TITLE'),$K.TXT('TXT_CHANGE_CBLOCK_URL'),'standard',function(){$K.yg_setEdited(element);element.setAttribute('yg_previous',value);var cblock=yg_id.split('-')[0];var data=Array('noevent',{yg_property:'setCBlockPName',params:{value:value,cblock:cblock}});$K.yg_AjaxCallback(data,'setCBlockPName');},function(){element.value=element.getAttribute('yg_previous');});}
$K.yg_approveCBlock=function(which){which=$(which);var winID=which.up('.ywindow').id.replace(/wid_/,'');var ygId=$K.windows['wid_'+winID].yg_id;var data=Array('noevent',{yg_property:'approveCBlock',params:{cblock:ygId.split('-')[0],winID:winID}});$K.yg_AjaxCallback(data,'approveCBlock');}
;Position.includeScrollOffsets=true;$K.yg_launchFuncs=function(){if(document.body.hasClassName('unauthorized')==false){$K.switchAdmin('start');}}
if($K.isAuthenticated){$K.addOnDOMReady(function(){$K.yg_launchFuncs();});}else{$K.addOnDOMReady(function(){$K.yg_loginbox();});}
$K.addOnDOMReady(function(){$K.yg_customAttributeHandler($('mainnav'));if((BrowserDetect.browser=='Firefox')||(BrowserDetect.browser=='Chrome')){$K.uploadFramework='plupload';}else if(FlashDetect.installed&&FlashDetect.majorAtLeast(8)){if(Prototype.Browser.IE&&((navigator.userAgent.indexOf('MSIE 8.0')>-1)||(navigator.userAgent.indexOf('MSIE 9.0')>-1))){$K.uploadFramework='swfuploader';}else{$K.uploadFramework='plupload';}}else{$K.uploadFramework='plupload';}});$K.switchAdmin=function(admin,siteID){if(!$('maincontainer'))return;currwins=$('maincontainer').immediateDescendants();num=0;var tmparrwids=new Array();for(var i=0;i<currwins.length;i++){if(currwins[i].hasClassName('ywindow')){tmpid=currwins[i].readAttribute('id');tmparrwids[num]=new Object();tmparrwids[num].id=tmpid;tmparrwids[num].width=$K.windows[tmpid].boxwidth;tmparrwids[num].height=$K.windows[tmpid].boxheight;num++;}}
var windowsToClose=new Array();for(var i=0;i<tmparrwids.length;i++){if(!($('maincontainer').hasClassName('mk_horizontal'))){if((tmparrwids.length>1)&&(!($('maincontainer').hasClassName('mk_ignorepanelwidth')))){$K.panelwidth[i]=tmparrwids[i].width;}
$K.panelheight=tmparrwids[i].height;}
windowsToClose.push(tmparrwids[i].id);}
if(($('maincontainer').hasClassName('mk_horizontal'))&&($K.panelheight!=(document.viewport.getHeight()-$K.windowTopDiff-$('toolbar').getHeight()))){$K.panelheight+=$K.winhorizontalDiff;}
var ygIdsToCheck=new Array();windowsToClose.each(function(winToClose){if($K.windows[winToClose].yg_id&&$K.windows[winToClose].yg_type){ygIdsToCheck.push($K.windows[winToClose].yg_id+'|'+$K.windows[winToClose].yg_type);}});ygIdsToCheck=ygIdsToCheck.uniq();var successFunc=function(){windowsToClose.each(function(winToClose){$K.windows[winToClose].remove(true);});$('maincontainer').removeClassName('mk_horizontal');$('maincontainer').removeClassName('mk_ignorepanelwidth');switch(admin){case"start":$('maincontainer').addClassName('mk_horizontal');new $K.yg_wndobj({config:'START_VERSIONS',width:$K.panelwidth[0]+$K.panelwidth[1],height:($K.panelheight-28)/2,loadparams:{yg_id:'-1',yg_type:'recent'}});new $K.yg_wndobj({config:'START_SECTIONS',width:$K.panelwidth[0]+$K.panelwidth[1],height:($K.panelheight-28)/2,loadparams:{yg_id:'-1'}});$K.yg_loadDlgUpload();break;case"tags":new $K.yg_wndobj({config:'TAG_DETAILS',width:$K.panelwidth[1],height:$K.panelheight});new $K.yg_wndobj({config:'TAGS_TREE',width:$K.panelwidth[0],height:$K.panelheight});break;case"pages":new $K.yg_wndobj({config:'PAGE_DETAILS',width:$K.panelwidth[1],height:$K.panelheight});if(siteID){new $K.yg_wndobj({config:'PAGES_TREE',width:$K.panelwidth[0],height:$K.panelheight,loadparams:{site:siteID}});}else{new $K.yg_wndobj({config:'PAGES_TREE',width:$K.panelwidth[0],height:$K.panelheight});}
break;case"contentblocks":new $K.yg_wndobj({config:'CBLOCK_DETAILS',width:$K.panelwidth[1],height:$K.panelheight});new $K.yg_wndobj({config:'CBLOCKS_TREE',width:$K.panelwidth[0],height:$K.panelheight});break;case"files":new $K.yg_wndobj({config:'FILE_DETAILS',width:$K.panelwidth[1],height:$K.panelheight});new $K.yg_wndobj({config:'FILES_TREE',width:$K.panelwidth[0],height:$K.panelheight});break;case"comments":new $K.yg_wndobj({config:'COMMENTS',width:$K.panelwidth[0]+$K.panelwidth[1],yg_id:-1,height:$K.panelheight,loadparams:{yg_id:'-1',type:'allcomments'}});break;case"mailings":new $K.yg_wndobj({config:'MAILINGS',width:$K.panelwidth[0]+$K.panelwidth[1],yg_id:-1,height:$K.panelheight,loadparams:{yg_id:'-1'}});break;case"updates":new $K.yg_wndobj({config:'UPDATES',width:$K.panelwidth[0]+$K.panelwidth[1],yg_id:-1,height:$K.panelheight,loadparams:{yg_id:'-1'}});break;case"sites":new $K.yg_wndobj({config:'SITE_DETAILS',width:$K.panelwidth[1],height:$K.panelheight});new $K.yg_wndobj({config:'SITE_LIST',width:$K.panelwidth[0],height:$K.panelheight});break;case"templates":new $K.yg_wndobj({config:'TEMPLATE_DETAILS',width:$K.panelwidth[1],height:$K.panelheight});new $K.yg_wndobj({config:'TEMPLATES_TREE',width:$K.panelwidth[0],height:$K.panelheight});break;case"entrymasks":new $K.yg_wndobj({config:'ENTRYMASK_DETAILS',width:$K.panelwidth[1],height:$K.panelheight});new $K.yg_wndobj({config:'ENTRYMASKS_TREE',width:$K.panelwidth[0],height:$K.panelheight});break;case"users":$('maincontainer').addClassName('mk_ignorepanelwidth');new $K.yg_wndobj({config:'USER_DETAILS',width:Math.round(($K.panelwidth[0]+$K.panelwidth[1])/2),height:$K.panelheight,loadparams:{mode:'details'}});new $K.yg_wndobj({config:'USERS_LIST',width:Math.round(($K.panelwidth[0]+$K.panelwidth[1])/2),height:$K.panelheight});break;case"usergroups":new $K.yg_wndobj({config:'USERGROUP_DETAILS',width:$K.panelwidth[1],height:$K.panelheight});new $K.yg_wndobj({config:'USERGROUPS_LIST',width:$K.panelwidth[0],height:$K.panelheight});break;case"systemconfig":var tabs=new Array();var tabIndex=0;if($('settitle_systemconfig')&&$('settitle_systemconfig').hasClassName('mk_rproperties')){tabs[tabIndex]=new Array();tabs[tabIndex]['NAME']='CONFIG_PAGE-PROPERTIES';tabs[tabIndex]['CLASS']='header_small';tabs[tabIndex]['TITLE']=$K.TXT('TXT_PAGES');tabs[tabIndex]['CACHE']=0;tabs[tabIndex]['FOLDER']=0;tabIndex++;tabs[tabIndex]=new Array();tabs[tabIndex]['NAME']='CONFIG_CBLOCK-PROPERTIES';tabs[tabIndex]['CLASS']='header_small';tabs[tabIndex]['TITLE']=$K.TXT('TXT_CONTENTBLOCKS');tabs[tabIndex]['CACHE']=0;tabs[tabIndex]['FOLDER']=0;tabIndex++;tabs[tabIndex]=new Array();tabs[tabIndex]['NAME']='CONFIG_FILE-PROPERTIES';tabs[tabIndex]['CLASS']='header_small';tabs[tabIndex]['TITLE']=$K.TXT('TXT_FILES');tabs[tabIndex]['CACHE']=0;tabs[tabIndex]['FOLDER']=0;tabIndex++;tabs[tabIndex]=new Array();tabs[tabIndex]['NAME']='CONFIG_USER-PROPERTIES';tabs[tabIndex]['CLASS']='header_small';tabs[tabIndex]['TITLE']=$K.TXT('TXT_USER');tabs[tabIndex]['CACHE']=0;tabs[tabIndex]['FOLDER']=0;tabIndex++;}
if($('settitle_systemconfig')&&$('settitle_systemconfig').hasClassName('mk_rfiletypes')){tabs[tabIndex]=new Array();tabs[tabIndex]['NAME']='CONFIG_FILE-TYPES';tabs[tabIndex]['CLASS']='header_small';tabs[tabIndex]['TITLE']=$K.TXT('TXT_FILE_TYPES');tabs[tabIndex]['CACHE']=0;tabs[tabIndex]['FOLDER']=0;tabIndex++;}
if($('settitle_systemconfig')&&$('settitle_systemconfig').hasClassName('mk_rviews')){tabs[tabIndex]=new Array();tabs[tabIndex]['NAME']='CONFIG_VIEWS';tabs[tabIndex]['CLASS']='header_small';tabs[tabIndex]['TITLE']=$K.TXT('TXT_VIEWS');tabs[tabIndex]['CACHE']=0;tabs[tabIndex]['FOLDER']=0;tabIndex++;}
if($('settitle_systemconfig')&&$('settitle_systemconfig').hasClassName('mk_rcommentconfig')){tabs[tabIndex]=new Array();tabs[tabIndex]['NAME']='CONFIG_COMMENTS';tabs[tabIndex]['CLASS']='header_small';tabs[tabIndex]['TITLE']=$K.TXT('TXT_COMMENTS');tabs[tabIndex]['CACHE']=0;tabs[tabIndex]['FOLDER']=0;tabIndex++;}
if($('settitle_systemconfig')&&$('settitle_systemconfig').hasClassName('mk_remailingconfig')){tabs[tabIndex]=new Array();tabs[tabIndex]['NAME']='CONFIG_MAILINGS';tabs[tabIndex]['CLASS']='';tabs[tabIndex]['TITLE']=$K.TXT('TXT_MAILINGS');tabs[tabIndex]['CACHE']=0;tabs[tabIndex]['FOLDER']=0;tabs[tabIndex]['INIT']='$K.yg_initMailingConfig(this.wndobj.id.split(\'_\')[1]);';tabIndex++;}
new $K.yg_wndobj({config:'SYSTEMCONFIG',width:$K.panelwidth[0]+$K.panelwidth[1],height:$K.panelheight,tabs:tabs});break;case"extensions":new $K.yg_wndobj({config:'EXTENSION_DETAILS',width:$K.panelwidth[1],height:$K.panelheight});new $K.yg_wndobj({config:'EXTENSION_LIST',width:$K.panelwidth[0],height:$K.panelheight,loadparams:{objecttype:'extensions'}});break;case"data":$K.yg_openUploadProgress();new $K.yg_wndobj({config:'EXTENSION_DETAILS',width:$K.panelwidth[1],height:$K.panelheight});new $K.yg_wndobj({config:'DATA_LIST',width:$K.panelwidth[0],height:$K.panelheight,loadparams:{objecttype:'data'}});break;}
$K.yg_bindWindows();$K.yg_toolbarHistory(admin);$K.yg_currentAdmin=admin;$K.yg_blendNavigation("hide");}
if(ygIdsToCheck.length==1){$K.yg_checkOpenWindows(ygIdsToCheck[0].split('|')[0],ygIdsToCheck[0].split('|')[1],{onSuccess:successFunc.bind(this)});}else{successFunc.bind(this)();}}
$K.yg_checkStatusBar=function(){if(!$('minwins'))return;statwid=$('minwins').getWidth();tmparrstat=$('minwins').childElements();nummins=0;for(var k=0;k<tmparrstat.length;k++){if((tmparrstat[k].hasClassName("klops"))&&(tmparrstat[k].getStyle('display')!='none')){nummins++;}}
maxmins=Math.floor(statwid/186);if(nummins>maxmins){$('winmanager').setStyle({display:'block'});}else{$('winmanager').setStyle({display:'none'});}}
$K.yg_showStatusContext=function(){if($('taskcontext'))$('taskcontext').remove();$('winmanager').appendChild(tmpdiv=document.createElement('div'));tmpdiv.className='taskcontext';tmpdiv.id='taskcontext';statwid=$('minwins').getWidth();maxmins=Math.floor((statwid-25)/145);tmparrstat=$('minwins').childElements();nummins=0;for(var k=0;k<tmparrstat.length;k++){if((tmparrstat[k].hasClassName("klops"))&&(tmparrstat[k].getStyle('display')!='none')){nummins++;if(nummins>maxmins){tmpdiv.appendChild(tmpa=document.createElement('a'));tmpa.id=tmparrstat[k].id.substring(0,tmparrstat[k].id.length-6);tmpa.onclick=function(){$K.windows[this.id].max();}
tmpa.appendChild(document.createTextNode(tmparrstat[k].title));}}}
setTimeout('$K.yg_statusObserve("taskcontext")',100);}
$K.yg_navHover=function(title){$('icondesc').innerHTML=title;}
$K.yg_blendNavigation=function(action,type){$('navextended').setStyle({display:'none'});$('navcollapsed').setStyle({display:'block'});$('navtoolbarcollapsed').setStyle({display:'block'});$('navtoolbarextended').setStyle({display:'none'});if(type=="main"){if(action=="show"){$('navcollapsed').setStyle({display:'none'});$('navextended').setStyle({display:'block'});}}else if(type=="toolbar"){if(action=="show"){$('navtoolbarcollapsed').setStyle({display:'none'});$('navtoolbarextended').setStyle({display:'block'});}}}
$K.yg_navTimer=function(timevar,type){if(!type)type="main";if(timevar=="start"){$K.navtimer=setTimeout("$K.yg_blendNavigation('show','"+type+"')",400);}else if(timevar=="stop"){clearTimeout($K.navtimer);}else if(timevar=="startoff"){$K.navtimeroff=setTimeout("$K.yg_blendNavigation('hide','"+type+"')",150);}else if(timevar=="stopoff"){$K.yg_blendNavigation('show',type);clearTimeout($K.navtimeroff);}}
$K.yg_changeSet=function(id,obj){tmparr=$('navsets').childElements();for(var k=0;k<tmparr.length;k++){tmpidstripped=tmparr[k].id.substring(4,tmparr[k].id.length);if((tmparr[k].getStyle('display')!='none')&&(tmpidstripped!=id)){$('set_'+tmpidstripped).setStyle({display:'none'});$('settitle_'+tmpidstripped).setStyle({display:'none'});}else if((tmparr[k].getStyle('display')!='block')&&(tmpidstripped==id)){$('set_'+tmpidstripped).setStyle({display:'block'});$('settitle_'+tmpidstripped).setStyle({display:'block'});}}
tmparr=$('sets').childElements();for(var k=0;k<tmparr.length;k++){tmparr[k].removeClassName("sel");}
obj.addClassName("sel");}
$K.yg_changeSet=function(id,obj){tmparr=$('navsets').childElements();for(var k=0;k<tmparr.length;k++){tmpidstripped=tmparr[k].id.substring(4,tmparr[k].id.length);if((tmparr[k].getStyle('display')!='none')&&(tmpidstripped!=id)){$('set_'+tmpidstripped).setStyle({display:'none'});$('settitle_'+tmpidstripped).setStyle({display:'none'});}else if((tmparr[k].getStyle('display')!='block')&&(tmpidstripped==id)){$('set_'+tmpidstripped).setStyle({display:'block'});$('settitle_'+tmpidstripped).setStyle({display:'block'});}}
tmparr=$('sets').childElements();for(var k=0;k<tmparr.length;k++){tmparr[k].removeClassName("sel");}
obj.addClassName("sel");}
$K.yg_toggleToolbar=function(){if($('toolbar').hasClassName('expanded')){tmparrx=$('maincontainer').childElements();for(var k=0;k<tmparrx.length;k++){if(tmparrx[k].getStyle('display')!='none'){$K.windows[tmparrx[k].id].boxheight+=30;$K.windows[tmparrx[k].id].init();}}
$('toolbar').removeClassName('expanded');$('navtoolbarextended').down('.mid').removeClassName('expanded');}else{$('toolbar').addClassName('expanded');$('navtoolbarextended').down('.mid').addClassName('expanded');}
$K.yg_windowResized();}
$K.yg_toolbarHistory=function(location){if(location=='start')return;var traceArr=new Array();for(var k=0;k<3;k++){tmpvar=$('toolbar').down(3).next(k).readAttribute('value');if((tmpvar!=null)&&(tmpvar!=location))traceArr.push(tmpvar);}
traceArr.push(location);if(traceArr.length>3)traceArr.splice(0,1);for(var k=0;k<traceArr.length;k++){tmpobj=$('toolbar').down(3).next(k);tmpobj.show();tmpobj.writeAttribute('value',traceArr[k]);tmpobj.down(1).className="icon"+traceArr[k];tmpobj.down(1).next().innerHTML=$K.TXT('TXT_'+traceArr[k].toUpperCase());}}
$K.yg_openObjectDetails=function(id,objecttype,title,icon,style){var yg_id=id;if(yg_id.split('-').length<2){yg_id=yg_id+'-'+objecttype;}
$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if((($K.yg_idlookuptable[yg_id][i].yg_property=='name')&&($K.yg_idlookuptable[yg_id][i].yg_type==objecttype))){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){}else{if($K.yg_idlookuptable[yg_id][i].hasClassName('changed')){style='changed';}else if(style=='changed'){style='';}
if(objecttype=='file'){if($K.yg_idlookuptable[yg_id][i].down('.filetype')){var color=$K.yg_idlookuptable[yg_id][i].down('.filetype').className.replace(/filetype/,'').strip();var typecode=$K.yg_idlookuptable[yg_id][i].down('.filetype').innerHTML.strip();if(icon.color)icon.color=color;if(icon.typecode)icon.typecode=typecode;if($K.yg_idlookuptable[yg_id][i].innerHTML.lastIndexOf('>')!=-1){var titleOffset=$K.yg_idlookuptable[yg_id][i].innerHTML.lastIndexOf('>');if($K.yg_idlookuptable[yg_id][i].innerHTML.substr(titleOffset+1).strip()!=''){title=$K.yg_idlookuptable[yg_id][i].innerHTML.substr(titleOffset+1).strip();}}}else{if($K.yg_idlookuptable[yg_id][i].innerHTML.strip()!=''){title=$K.yg_idlookuptable[yg_id][i].innerHTML.stripScripts().stripTags().strip();}}}else{if($K.yg_idlookuptable[yg_id][i].innerHTML.strip()!=''){title=$K.yg_idlookuptable[yg_id][i].innerHTML.stripScripts().stripTags().strip();}}}}
if((objecttype=='file')&&($K.yg_idlookuptable[yg_id][i].yg_property=='type')&&($K.yg_idlookuptable[yg_id][i].yg_type=='file')){if($K.yg_idlookuptable[yg_id][i].hasClassName('filetype')){var color=$K.yg_idlookuptable[yg_id][i].className.replace(/filetype/,'').strip();var typecode=$K.yg_idlookuptable[yg_id][i].innerHTML.strip();if(icon.color)icon.color=color;if(icon.typecode)icon.typecode=typecode;}}}
switch(objecttype){case'file':icon.objectid=id;new $K.yg_wndobj({title:title,icon:icon,titleclass:style,config:'FILEINFO',loadparams:{yg_id:id+'-file',ot:objecttype}});break;case'page':new $K.yg_wndobj({title:title,icon:icon,titleclass:style,config:'PAGE_DETAILS',type:'dialog',loadparams:{yg_id:id,yg_type:objecttype}});break;case'cblock':new $K.yg_wndobj({title:title,titleclass:style,config:'CBLOCK_DETAILS',type:'dialog',loadparams:{yg_id:id+'-cblock',yg_type:objecttype}});break;case'tag':new $K.yg_wndobj({title:title,titleclass:style,config:'TAG_DETAILS',type:'dialog',loadparams:{yg_id:id+'-tag',yg_type:objecttype}});break;case'mailing':new $K.yg_wndobj({title:title,titleclass:style,config:'MAILING_DETAILS',type:'dialog',loadparams:{mode:'details',yg_id:id+'-mailing',yg_type:objecttype}});break;}}
;$K.yg_initCommentFilter=function(win){if(!$K.windows[win].loadparams.commentfilter_timeframe){$K.windows[win].loadparams.commentfilter_timeframe='ALL';$K.windows[win].loadparams.commentfilter_status='ALL';}else{for(var filtername in $K.windows[win].loadparams){if(filtername.substring(0,13)=="commentfilter"){tmpobj=$(win+"_"+filtername);if(tmpobj)tmparr=tmpobj.immediateDescendants();for(var k=0;k<tmparr.length;k++){if(tmparr[k].readAttribute("value")==$K.windows[win].loadparams[filtername]){tmpobj.previous().down('span').innerHTML=tmparr[k].readAttribute("shortname");}}}}}}
$K.yg_toggleComment=function(obj,ev){Event.stop(ev);commentdiv=$(obj).up('.commentpost');if(commentdiv.hasClassName('less')){commentdiv.removeClassName('less');commentdiv.addClassName('more');}else{commentdiv.removeClassName('more');commentdiv.addClassName('less');}
$K.windows[commentdiv.up('.ywindow').id].refresh();}
$K.yg_filterComments=function(col,value,shorttitle,win){if((col=="timeframe")&&(value=="CUSTOM")){new $K.yg_wndobj({config:'COMMENTS_TIMEFRAME',loadparams:{opener_reference:win,action:'comments',shorttitle:shorttitle}});}else{$K.yg_pageDirReset(win);$(win+'_commentfilter_'+col).previous().down().innerHTML=shorttitle;$K.windows[win].loadparams['commentfilter_'+col]=value;var params=new Object();params.commentfilter_timeframe=$K.windows[win].loadparams.commentfilter_timeframe;params.commentfilter_objecttype=$K.windows[win].loadparams.commentfilter_objecttype;params.commentfilter_status=$K.windows[win].loadparams.commentfilter_status;params.refresh=1;var window=$K.windows[win];window.tabs.select(window.tabs.selected,params);}}
$K.yg_submitCommentTimeframe=function(winID,openerReference,shorttitle){var timeframevar=$('wid_'+winID+'_timeframe_from').value+"###"+$('wid_'+winID+'_timeframe_till').value;$K.yg_filterComments('timeframe',timeframevar,shorttitle,openerReference);$K.windows['wid_'+winID].remove();}
$K.yg_changeCommentStatus=function(obj,status,event){obj=$(obj);var winID=$(obj).up('.ywindow').id;var yg_id=$K.windows[winID].yg_id;var yg_type=$K.windows[winID].yg_type;var selCommentIDs=new Array();var selObjectIDs=new Array();var selTypes=new Array();var selComments=new Array();Event.stop(event);if(obj.down().next().hasClassName('listitempagefocus')){obj.up('.mk_contentgroup').immediateDescendants().each(function(comment){if(!comment.hasClassName('nowrite')&&!comment.hasClassName('cntblockadd')&&(comment.down().next().hasClassName('listitempagefocus'))){selComments.push(comment);if(yg_type=='comments'){selTypes.push(comment.readAttribute('obj_yg_type'));}else{selTypes.push(yg_type);}}});}else{selComments.push(obj);if(yg_type=='comments'){selTypes.push(obj.readAttribute('obj_yg_type'));}else{selTypes.push(yg_type);}}
selComments.each(function(comment){comment.down('.cstatus').className="cstatus "+status;selCommentIDs.push(comment.readAttribute('yg_id').split('-')[0]);selObjectIDs.push(comment.readAttribute('obj_yg_id'))});var data=Array('noevent',{yg_property:'setCommentState',params:{yg_types:selTypes,yg_ids:selObjectIDs,winID:winID,commentIDs:selCommentIDs,newStatus:status}});$K.yg_AjaxCallback(data,'setCommentState');}
$K.yg_toggleCommenting=function(obj){var newStatus;if(obj.up().hasClassName('copened')){obj.up().removeClassName('copened');obj.up().addClassName('cclosed');obj.up('.cntmain').addClassName('mk_comments_closed');newStatus='closed';}else{obj.up().removeClassName('cclosed');obj.up().addClassName('copened');obj.up('.cntmain').removeClassName('mk_comments_closed');newStatus='opened';}
var winID=$(obj).up('.ywindow').id;var yg_id=$K.windows[winID].yg_id;var yg_type=$K.windows[winID].yg_type;var data=Array('noevent',{yg_property:'setCommentingState',params:{yg_type:yg_type,yg_id:yg_id,winID:winID,newStatus:newStatus}});$K.yg_AjaxCallback(data,'setCommentingState');}
$K.yg_saveComment=function(options){var data=Array('noevent',{yg_property:'saveComment',params:options});$K.yg_AjaxCallback(data,'saveComment');}
$K.yg_addComment=function(options){var data=Array('noevent',{yg_property:'addComment',params:options});$K.yg_AjaxCallback(data,'addComment');}
$K.yg_saveCommentsSettings=function(which){which=$(which);var winID=which.up('.ywindow').id;var commentSettings=$(winID+'_CONFIG_COMMENTS').select('input','textarea');var params=new Object();commentSettings.each(function(item){params[item.name]=item.value;});params.winID=winID;var data=Array('noevent',{yg_property:'saveCommentsSettings',params:params});$K.yg_AjaxCallback(data,'saveCommentsSettings');}
$K.yg_updateCommentCount=function(win,comment_count){if($(win+'_head_COMMENTS')){$(win+'_head_COMMENTS').down('.mk_comment_count').update(comment_count);}}
$K.yg_setCommentStatus=function(win,status){switch(status){case'open':if($(win+'_cnttable')){$(win+'_cnttable').down('.cntmain').removeClassName('mk_comments_closed');}
if($(win+'_head_COMMENTS')){$(win+'_head_COMMENTS').down('.headstatus').removeClassName('cclosed').addClassName('copened');}
break;case'closed':if($(win+'_cnttable')){$(win+'_cnttable').down('.cntmain').addClassName('mk_comments_closed');}
if($(win+'_head_COMMENTS')){$(win+'_head_COMMENTS').down('.headstatus').removeClassName('copened').addClassName('cclosed');}
break;}}
;$K.yg_initVersionFilter=function(win){if(!$K.windows[win].loadparams.versionfilter_tab){$K.windows[win].loadparams.versionfilter_tab='ALL';$K.windows[win].loadparams.versionfilter_action='ALL';$K.windows[win].loadparams.versionfilter_timeframe='LAST_WEEK';}else{for(var filtername in $K.windows[win].loadparams){if(filtername.startsWith('versionfilter')){tmpobj=$(win+"_"+filtername);if(tmpobj)tmparr=tmpobj.immediateDescendants();for(var k=0;k<tmparr.length;k++){if(tmparr[k].readAttribute('value')==$K.windows[win].loadparams[filtername]){tmpobj.previous().down('span').innerHTML=tmparr[k].readAttribute('shortname');}}}}}
if(!$K.windows[win].loadparams.trashcanfilter_created){$K.windows[win].loadparams.trashcanfilter_created='ALL';$K.windows[win].loadparams.trashcanfilter_removed='ALL';}else{for(var filtername in $K.windows[win].loadparams){if(filtername.startsWith('trashcanfilter')){tmpobj=$(win+"_"+filtername);if(tmpobj)tmparr=tmpobj.immediateDescendants();for(var k=0;k<tmparr.length;k++){if(tmparr[k].readAttribute('value')==$K.windows[win].loadparams[filtername]){tmpobj.previous().down('span').innerHTML=tmparr[k].readAttribute('shortname');}}}}}
$K.windows[win].loadparams.refresh=undefined;}
$K.yg_filterVersions=function(col,value,shorttitle,win){if((col=="timeframe")&&(value=="CUSTOM")){new $K.yg_wndobj({config:'VERSIONS_TIMEFRAME',loadparams:{opener_reference:win,action:'versions',shorttitle:shorttitle}});}else{$(win+'_versionfilter_'+col).previous().down().innerHTML=shorttitle;$K.windows[win].loadparams['versionfilter_'+col]=value;$K.windows[win].loadparams.refresh=true;$K.windows[win].tabs.select($K.windows[win].tabs.selected,{versionfilter_tab:$K.windows[win].loadparams.versionfilter_tab,versionfilter_action:$K.windows[win].loadparams.versionfilter_action,versionfilter_timeframe:$K.windows[win].loadparams.versionfilter_timeframe,refresh:1});}}
$K.yg_submitVersionTimeframe=function(winID,openerReference,shorttitle){var timeframevar=$('wid_'+winID+'_timeframe_from').value+"###"+$('wid_'+winID+'_timeframe_till').value;$K.yg_filterVersions('timeframe',timeframevar,shorttitle,openerReference);$K.windows['wid_'+winID].remove();}
$K.yg_restorePageVersion=function(element,version){var yg_id=$K.windows[element.up('.ywindow').id].yg_id;var page=yg_id.split('-')[0];var site=yg_id.split('-')[1];var wid=element.up('.ywindow').id.replace(/wid_/g,'');var data=Array('noevent',{yg_property:'restorePageVersion',params:{page:page,site:site,version:version,wid:wid}});$K.yg_AjaxCallback(data,'restorePageVersion');}
$K.yg_restoreMailingVersion=function(element,version){var yg_id=$K.windows[element.up('.ywindow').id].yg_id;var mailingId=yg_id.split('-')[0];var wid=element.up('.ywindow').id.replace(/wid_/g,'');var data=Array('noevent',{yg_property:'restoreMailingVersion',params:{mailingId:mailingId,version:version,wid:wid}});$K.yg_AjaxCallback(data,'restoreMailingVersion');}
$K.yg_restoreCBlockVersion=function(element,version){var yg_id=$K.windows[element.up('.ywindow').id].yg_id;var cblock=yg_id.split('-')[0];var wid=element.up('.ywindow').id.replace(/wid_/g,'');var data=Array('noevent',{yg_property:'restoreCBlockVersion',params:{cblock:cblock,version:version,wid:wid}});$K.yg_AjaxCallback(data,'restoreCBlockVersion');}
$K.yg_restoreFileVersion=function(element,version){var yg_id=$K.windows[element.up('.ywindow').id].yg_id;var file=yg_id.split('-')[0];var site=yg_id.split('-')[1];var wid=element.up('.ywindow').id.replace(/wid_/g,'');var data=Array('noevent',{yg_property:'restoreFileVersion',params:{file:file,site:site,version:version,wid:wid}});$K.yg_AjaxCallback(data,'restoreFileVersion');}
;$K.yg_switchPublishedVersion=function(value,win_reference,element){value=value.substring(8);var tabcontent=$('wid_'+win_reference+'_PUBLISHING')
var default_value=element.getAttribute('yg_previous');var objType=$K.windows['wid_'+win_reference].yg_id.split('-')[1];switch(objType){case'cblock':$K.yg_promptbox($K.TXT('TXT_CHANGE_PUB_VERSION_TITLE'),$K.TXT('TXT_CHANGE_PUB_CBLOCK_VERSION'),'standard',function(){element.setAttribute('yg_previous','version_'+value);$K.yg_setEdited(element);if(value=='latest'){tabcontent.down('.last_approved_version').show();}else{tabcontent.down('.last_approved_version').hide();}
$K.yg_saveCBlockPublishSettings($('wid_'+win_reference),'PUBLISH');},function(){$K.yg_dropdownSelect(element,null,default_value,true);});break;default:case'page':$K.yg_promptbox($K.TXT('TXT_CHANGE_PUB_VERSION_TITLE'),$K.TXT('TXT_CHANGE_PUB_PAGE_VERSION'),'standard',function(){element.setAttribute('yg_previous','version_'+value);$K.yg_setEdited(element);if(value=='latest'){tabcontent.down('.last_approved_version').show();}else{tabcontent.down('.last_approved_version').hide();}
$K.yg_savePagePublishSettings($('wid_'+win_reference),'PUBLISH');},function(){$K.yg_dropdownSelect(element,null,default_value,true);});break;}}
$K.yg_savePagePublishSettings=function(win_reference,which){var wid=win_reference.id.replace(/wid_/g,'');var win=$K.windows['wid_'+wid];var current_tab=win.tab;var tabs=win.tabs;var yg_id=win.yg_id;var page=yg_id.split('-')[0];var site=yg_id.split('-')[1];var tabcontent=$('wid_'+wid+'_PUBLISHING');var currently_published=tabcontent.down('.dropdownbox').down('input[type=hidden]').value.substring(8);var auto_published=new Array();$('autopublishitems_container_'+wid).childElements().each(function(item){var version=$(item.down('.dropdownbox').id+"_ddlist").down('.selected').getAttribute('value');var date=item.down('.frm_date').down('input').value;var time=item.down('.frm_time').down('input').value;var id=item.id.replace(/autopublish_item_/g,'').split('_');id=id[id.length-1];auto_published.push({id:id,version:version,date:date,time:time});});var data=Array('noevent',{yg_property:'savePagePublishingSettings',params:{autopublishData:Object.toJSON(auto_published),changedField:which,page:page,site:site,version:currently_published,wid:wid}});$K.yg_AjaxCallback(data,'savePagePublishingSettings');}
$K.yg_saveCBlockPublishSettings=function(win_reference,which){var wid=win_reference.id.replace(/wid_/g,'');var win=$K.windows['wid_'+wid];var current_tab=win.tab;var tabs=win.tabs;var yg_id=win.yg_id;var cblock=yg_id.split('-')[0];var site=yg_id.split('-')[1];var tabcontent=$('wid_'+wid+'_PUBLISHING')
var currently_published=tabcontent.down('.dropdownbox').down('input[type=hidden]').value.substring(8);var auto_published=new Array();$('autopublishitems_container_'+wid).childElements().each(function(item){var version=$(item.down('.dropdownbox').id+"_ddlist").down('.selected').getAttribute('value');var date=item.down('.frm_date').down('input').value;var time=item.down('.frm_time').down('input').value;var id=item.id.replace(/autopublish_item_/g,'').split('_');id=id[id.length-1];auto_published.push({id:id,version:version,date:date,time:time});});var data=Array('noevent',{yg_property:'saveCBlockPublishingSettings',params:{autopublishData:Object.toJSON(auto_published),changedField:which,cblock:cblock,site:site,version:currently_published,wid:wid}});$K.yg_AjaxCallback(data,'saveCBlockPublishingSettings');}
$K.yg_ddSavePagePublishSettings=function(value1,value2,element){$K.yg_setEdited(element);$K.yg_savePagePublishSettings(element.up('.ywindow'),'VERSION');}
$K.yg_ddSaveCBlockPublishSettings=function(value1,value2,element){$K.yg_setEdited(element);$K.yg_saveCBlockPublishSettings(element.up('.ywindow'),'VERSION');}
$K.yg_resetPublishSettingsEditState=function(win_ref){var publish_tab=$('wid_'+win_ref+'_PUBLISHING');var elements=publish_tab.select('.changed');elements.each(function(item){$K.log('Faded item is:',item,$K.Log.DEBUG);$K.yg_fadeField(item);});}
$K.yg_addAutopublishItem=function(element,position){element=$(element);var wid=element.up('.ywindow').id;var innerContent=element.up('.innercontent');var objectID=$K.windows[wid].yg_id.split('-')[0];var site=$K.windows[wid].yg_id.split('-')[1];if(element.counter!=undefined){element.counter++;}else{element.counter=0;}
var item_index='dummy'+element.counter;new Ajax.Updater(element,$K.appdir+'element_autopublishblock/',{onComplete:function(){$K.windows[wid].refresh("col1");$K.yg_customAttributeHandler(innerContent);},asynchronous:true,evalScripts:true,method:'post',insertion:position,parameters:{objectID:objectID,site:site,item_index:item_index,item_version:9999,us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}});}
;$K.yg_delViewArr=new Array();$K.yg_initViewsTab=function(pageID,parentWinID){var jsTemplate=$K.windows['wid_'+parentWinID].jsTemplate;$K.windows['wid_'+parentWinID].addViewToSortable=function(itemID,itemIdentifier,itemName,itemWidth,itemHeight){var alreadyAdded=false;if(!$('wid_'+parentWinID+'_tab_VIEWS_viewlist')){return;}
$('wid_'+parentWinID+'_tab_VIEWS_viewlist').select('li').each(function(viewItem){if(viewItem.readAttribute('yg_id')==(itemID+'-view')){alreadyAdded=true;}});if(alreadyAdded)return;var item_template=$K.yg_makeTemplate(jsTemplate);var bracket='<span class="bracket">[</span> - <span class="bracket">]</span>';if(itemWidth==0)itemWidth=bracket;if(itemHeight==0)itemHeight=bracket;var newView=item_template.evaluate({item_index:parentWinID+'_'+(Math.random()*1000),item_id:itemID,item_identifier:itemIdentifier,item_name:itemName,item_width:itemWidth,item_height:itemHeight});var itemsArray=new Array();var newItem=itemName.toLowerCase()+'<<>>'+'item_'+parentWinID+'_'+itemID;$('wid_'+parentWinID+'_tab_VIEWS_viewlist').select('li').each(function(item){if(item.readAttribute('yg_id')=="0-view"){itemsArray.push('    <<>>'+item.id);}else{itemsArray.push(item.down('.label').innerHTML.toLowerCase()+'<<>>'+item.id);}});itemsArray.push(newItem);itemsArray.sort();var targetPosition=itemsArray.indexOf(newItem);targetPosition--;if(targetPosition<0){$('wid_'+parentWinID+'_tab_VIEWS_viewlist').insert({top:newView});}else{var targetId=itemsArray[targetPosition].split('<<>>')[1];$(targetId).insert({after:newView});}
$K.yg_delViewArr[itemID]=function(delFileId,isFolder){if($K.yg_idlookuptable[itemID+'-view']&&$K.yg_idlookuptable[itemID+'-view'][0]){$K.yg_cleanLookupTable();$K.yg_idlookuptable[itemID+'-view'].each(function(item){ulRef=item.up('ul');winRef=$(ulRef).up('.ywindow');if($K.windows[winRef.id].yg_id!=(delFileId+'-file'))return;$K.yg_removefromFocus(item);if(item.tagName=='LI'){item.remove();}else{item.up('li').remove();}
$K.windows[winRef.id].refresh($(ulRef));});if(isFolder==true){for(winItem in $K.windows){if(($K.windows[winItem].tab=='VIEWS')&&($K.windows[winItem].type=='dialog')&&($K.windows[winItem].yg_type=='file')){$K.windows[winItem].tabs.select($K.windows[winItem].tabs.selected);}}}}
$K.yg_delViewArr[itemID]=undefined;}
$K.yg_customAttributeHandler($('wid_'+parentWinID+'_tab_VIEWS_viewlist'));$K.initSortable('wid_'+parentWinID+'_'+pageID+'_viewlist');$K.windows['wid_'+parentWinID].refresh();}
$('wid_'+parentWinID+'_'+pageID+'_viewlist').select('li').each(function(viewlistItem){var view=viewlistItem.readAttribute('yg_id').split('-')[0];$K.yg_delViewArr[view]=function(delFileId,isFolder){if($K.yg_idlookuptable[view+'-view']&&$K.yg_idlookuptable[view+'-view'][0]){$K.yg_cleanLookupTable();$K.yg_idlookuptable[view+'-view'].each(function(item){ulRef=item.up('ul');winRef=$(ulRef).up('.ywindow');if($K.windows[winRef.id].yg_id!=(delFileId+'-file'))return;$K.yg_removefromFocus(item);if(item.tagName=='LI'){item.remove();}else{item.up('li').remove();}
$K.windows[winRef.id].refresh($(ulRef));});if(isFolder==true){for(winItem in $K.windows){if(($K.windows[winItem].tab=='VIEWS')&&($K.windows[winItem].type=='dialog')&&($K.windows[winItem].yg_type=='file')){$K.windows[winItem].tabs.select($K.windows[winItem].tabs.selected);}}}}
$K.yg_delViewArr[view]=undefined;}});}
$K.yg_addView=function(fileID,itemID,itemIdentifier,itemName,itemWidth,itemHeight,isFolder){for(winItem in $K.windows){if(($K.windows[winItem].yg_id==(fileID+'-file'))&&($K.windows[winItem].tab=='VIEWS')){if(typeof $K.windows[winItem].addViewToSortable=='function'){$K.windows[winItem].addViewToSortable(itemID,itemIdentifier,itemName,itemWidth,itemHeight);}}else if(($K.windows[winItem].tab=='VIEWS')&&($K.windows[winItem].yg_type=='file')&&(isFolder=='true')){$K.windows[winItem].tabs.select($K.windows[winItem].tabs.selected);}}}
$K.yg_addGenerated=function(fileID,viewIdentifier,itemWidth,itemHeight){if($K.yg_idlookuptable[fileID+'-file']&&$K.yg_idlookuptable[fileID+'-file'][0]){$K.yg_cleanLookupTable();$K.yg_idlookuptable[fileID+'-file'].each(function(item){var winRef=item.up('.ywindow');if(viewIdentifier=='NULL'){if(($(winRef.id).hasClassName('filelist1')||$(winRef.id).hasClassName('filelist2')||$(winRef.id).hasClassName('filelist3'))&&item.down('div.listthumb')){item.down('div.listthumb').update('<div class="nothumb"><div class="noimg">?</div></div>');}else if($(winRef.id).hasClassName('thumbview')&&item.down('div.thumbcnt')){item.down('div.thumbcnt').removeClassName('thumbcnt_loaded').addClassName('thumbcnt_nothumb').update('<table cellspacing="0" cellpadding="0"><tbody><tr><td><div class="noimg">?</div></td></tr></tbody></table>');}}else{if(item.down('img')&&item.down('img').readAttribute('real_src')){if(item.down('img').readAttribute('real_src').indexOf('/'+viewIdentifier+'/')!=-1){item.down('img').src=item.down('img').readAttribute('real_src');item.down('img').removeAttribute('real_src');if($(winRef.id).hasClassName('thumbview')){var alignment='';if(itemWidth&&itemHeight){var ratioPic=(itemWidth/itemHeight);if(ratioPic>(4/3)){alignment='x-scale';}else{alignment='y-scale';}}
if(item.down('.mk_thumbnail')){item.down('.mk_thumbnail').addClassName(alignment);}}}}}});}}
$K.yg_saveFileViews=function(which,winID){which=$(which);var hasError=false;var winRef=which.up('.ywindow');var listRef=$(winRef.id+'_CONFIG_VIEWS');var allFields=listRef.select('input');var parameters={wid:winRef.id};allFields.each(function(item){if(item.name){if(parameters[item.name]!=undefined){parameters[item.name]+=','+item.value;}else{parameters[item.name]=item.value;}}});var names=new Array();var identifiers=new Array();var legalChars=/^[a-zA-Z0-9\-\.\_]*$/;for(parameter_idx in parameters){if(parameter_idx.indexOf('___NEW___')!=-1){continue;}
if(parameter_idx.endsWith('_name')){if((names.indexOf(parameters[parameter_idx])!=-1)||(parameters[parameter_idx].strip()=='')){var errField=$(document.forms['wid_'+winID+'_form'][parameter_idx]);errField.addClassName('error');if(errField.up('li').hasClassName('closed')){$K.yg_listCollapsSwap(errField.up('li'),null);}
hasError=true;}else{$(document.forms['wid_'+winID+'_form'][parameter_idx]).removeClassName('error');}
names.push(parameters[parameter_idx]);}
if(parameter_idx.endsWith('_identifier')){if((identifiers.indexOf(parameters[parameter_idx])!=-1)||(!legalChars.test(parameters[parameter_idx]))||(parameters[parameter_idx].strip()=='')){var errField=$(document.forms['wid_'+winID+'_form'][parameter_idx]);errField.addClassName('error');if(errField.up('li').hasClassName('closed')){$K.yg_listCollapsSwap(errField.up('li'),null);}
hasError=true;}else{$(document.forms['wid_'+winID+'_form'][parameter_idx]).removeClassName('error');}
identifiers.push(parameters[parameter_idx]);}}
if(!hasError){var data=Array('noevent',{yg_property:'saveViews',params:parameters});$K.yg_AjaxCallback(data,'saveViews');}}
$K.yg_addNewView=function(ref){ref=$(ref);var wid=ref.up('.ywindow').id;var newElement=$K.windows[wid].jsTemplate;var newId=0;if(!$(wid+'_views_list')){return;}
$(wid+'_views_list').select('input[type=hidden]').each(function(item){if(item.name.endsWith('_view_ids[]')&&item.value.startsWith('NEW_')){newId=parseInt(item.value.replace(/NEW_/,''));}});newId++;newElement=newElement.replace(/__NEW__/g,'NEW_'+newId);$(wid+'_views_list').insert({bottom:newElement});var listChildren=$(wid+'_views_list').childElements();newElement=listChildren[listChildren.length-1];$K.yg_customAttributeHandler(newElement);$K.windows[wid].refresh();}
$K.yg_updateViewTitle=function(which){which=$(which);if(which.up('li').down('.handler')){which.up('li').down('.handler').update(which.value);}}
$K.yg_updateViewSizes=function(which){which=$(which);var fieldPrefix=which.id.replace(/_width/g,'').replace(/_height/g,'');var newDesc=$(fieldPrefix+'_width').value+' x '+$(fieldPrefix+'_height').value;if(which.up('li').down('.desc')){which.up('li').down('.desc').update(newDesc);}}
$K.yg_openAddViewWindow=function(openerReference,ygId){new $K.yg_wndobj({config:'VIEW_SELECT',openerYgId:ygId,loadparams:{opener_reference:openerReference}});}
$K.viewsSortCallbacks={onUpdate:function(element){$K.yg_updateSortables();}};
;$K.yg_initTagsTab=function(pageID,parentWinID){var jsTemplate=$K.windows['wid_'+parentWinID].jsTemplate;$K.windows['wid_'+parentWinID].addToSortable=function(tag_id,tag_name,tag_path,tag_target,tag_position){openerRef=$('wid_'+parentWinID+'_'+pageID+'_list');var newIdSuffix=openerRef.childNodes.length+1;tag_path=tag_path.join(' <span class="traceicon"></span> ');var item_template=$K.yg_makeTemplate(jsTemplate);var newTag=item_template.evaluate({item_index:newIdSuffix,item_id:tag_id,item_name:tag_name,item_trace:tag_path});if((tag_position!='')&&(tag_position!='into')){var x=openerRef.childNodes;for(var i=0;i<x.length;i++){var actTag=x[i].readAttribute('yg_id').split('-');actTag=actTag[0];if(actTag==tag_target){if(tag_position=='before'){openerRef.childNodes[i].insert({before:newTag});i++;}
if(tag_position=='after'){openerRef.childNodes[i].insert({after:newTag});}}}}else{openerRef.insert(newTag);}
$K.yg_customAttributeHandler(openerRef);$K.initSortable(openerRef);$K.windows[$(openerRef).up('.ywindow').id].refresh($(openerRef));}
$K.windows['wid_'+parentWinID].addFunction=$K.windows['wid_'+parentWinID].addTag=function(tagId,targetTagId,targetPosition){var targetSuffix='';if((targetTagId!=undefined)&&(targetPosition!=undefined)){targetSuffix='-'+targetTagId+'-'+targetPosition;}
var site=$K.windows['wid_'+parentWinID].yg_id.split('-')[1];var objectID=pageID;var data=Array('noevent',{yg_property:'addObjectTag',params:{objectID:objectID,objectType:$K.windows['wid_'+parentWinID].yg_type,site:site,tagId:tagId.split('-')[0],targetId:(targetTagId)?(targetTagId):(''),targetPosition:(targetPosition)?(targetPosition):('')}});$K.yg_AjaxCallback(data,'addObjectTag');}}
$K.yg_addTag=function(yg_type,yg_id,yg_property,newId,newName,parentObjs,targetId,targetPosition){$K.yg_cleanLookupTable();if($K.yg_idlookuptable[yg_id])
for(var i=0;i<$K.yg_idlookuptable[yg_id].length;i++){if(($K.yg_idlookuptable[yg_id][i].yg_property==yg_property)&&($K.yg_idlookuptable[yg_id][i].yg_type==yg_type)){if($K.yg_idlookuptable[yg_id][i].capt!=undefined){}else{var winID=$K.yg_idlookuptable[yg_id][i].up('.ywindow').id;if($K.windows[winID]&&(typeof $K.windows[winID].addToSortable=='function')){$K.windows[winID].addToSortable(newId,newName,parentObjs,targetId,targetPosition);}}}}
return false;}
$K.yg_addChildTag=function(tagref){if(tagref.hasClassName('tree_btn')){if(tagref.hasClassName('disabled'))return;var tag=$K.windows[tagref.up('.ywindow').id].yg_id;}else{var wid=parseInt(tagref.up('.ywindow').id.replace(/wid_/g,''));var nodeid=tagref.id;var tag=nlsTree['tags_tree'+wid+'_tree'].nLst[nodeid].yg_id;}
tag=tag.split('-')[0];var data=Array('noevent',{yg_property:'addTagChildFolder',params:{tag:tag}});$K.yg_AjaxCallback(data,'addTagChildFolder');}
$K.yg_actionAddChildTag=function(which){$K.yg_addChildTag(which.up(2).reference);}
$K.yg_actionDeleteTag=function(which,multi){$K.yg_deleteElement(which.up(2).reference,multi);}
$K.yg_submitTags=function(winID,action,openerWin){if($K.windows['wid_'+winID].yg_id==undefined){$K.windows['wid_'+winID].remove();return;}
var selectedNodes=nlsTree['tags_tree'+winID+'_tree'].getSelNodes();if(($K.windows['wid_'+winID].yg_id=='1-tag')||($K.windows['wid_'+winID].yg_id=='-tag')){return;}
if(action=='choose'){if(!selectedNodes.capt){title=selectedNodes[0].capt;}else{title=selectedNodes.capt;}
if($K.windows['wid_'+winID].loadparams.opener_reference.endsWith('property')){$($K.windows['wid_'+winID].loadparams.opener_reference).update(title);$K.yg_setObjectProperty($($K.windows['wid_'+winID].loadparams.opener_reference),$K.windows['wid_'+winID].yg_id.split('-')[0]);$($K.windows['wid_'+winID].loadparams.opener_reference).up('.selectionmarker').next().value=$K.windows['wid_'+winID].yg_id.split('-')[0];$K.yg_fadeField($($K.windows['wid_'+winID].loadparams.opener_reference).up('.cntblock'));}else{$K.yg_editControl($K.windows['wid_'+winID].loadparams.element,$K.windows['wid_'+winID].loadparams.formfield,false,{yg_id:$K.windows['wid_'+winID].yg_id,title:title});$K.yg_fadeField($K.windows['wid_'+winID].loadparams.element.up('.maskedit'));}
$K.windows['wid_'+winID].remove();}else{if($(openerWin)){var tagListRef=$(openerWin).down('.tag_list').id;for(var i=0;i<selectedNodes.length;i++){if((selectedNodes[i].yg_id!='1-tag')&&(selectedNodes[i].yg_id!='-tag')){$K.windows[openerWin].addTag(selectedNodes[i].yg_id,tagListRef);}}
if((selectedNodes.length>1)||(selectedNodes[0].yg_id!='1-tag')){$K.windows['wid_'+winID].remove();}}}}
$K.yg_submitAddTag=function(winID,openerReference){if(!$('tags_tree'+openerReference.replace(/wid_/,'')+'_actionbutton')){$K.windows['wid_'+winID].remove();return;}
var tagtitle=$('wid_'+winID+'_tagname').value.strip();var openerWin=$(openerReference);var openerTree=nlsTree['tags_tree'+openerReference.replace(/wid_/,'')+'_tree'];if(tagtitle.length<1){$('wid_'+winID+'_tagname').addClassName('error');return;}else{$('wid_'+winID+'_tagname').removeClassName('error');}
if(openerTree.getSelNode()){var parentNode=openerTree.getSelNode().yg_id.split('-')[0];}else{var refId=$('tags_tree'+openerReference.replace(/wid_/,'')+'_actionbutton').reference.id;var parentNode=nlsTree['tags_tree'+openerReference.replace(/wid_/,'')+'_tree'].nLst[refId].yg_id.split('-')[0];}
$('wid_'+winID+'_tagname').value='';var data=Array('noevent',{yg_property:'addTagChildFolder',params:{tag:parentNode,tagName:tagtitle}});$K.yg_AjaxCallback(data,'addTagChildFolder');$K.yg_fadeField($('wid_'+winID+'_tagname'));}
$K.tagsSortCallbacks={onUpdate:function(element){var listArray=Array();for(var i=0;i<element.childNodes.length;i++){var tagId=element.childNodes[i].readAttribute('yg_id').split('-');tagId=tagId[0];listArray.push(tagId);}
var parentWin=$K.windows[this.element.up('.ywindow').id];if(parentWin.yg_id){var siteID=parentWin.yg_id.split('-')[1];var objectID=parentWin.yg_id.split('-')[0];var objectType=parentWin.yg_type;var data=Array('noevent',{yg_property:'orderObjectTag',params:{objectID:objectID,objectType:objectType,site:siteID,listArray:listArray}});$K.yg_AjaxCallback(data,'orderObjectTag');$K.yg_updateSortables();}}};
;$K.yg_dropStackWindow=false;$K.yg_initDropStack=function(win){$K.windows['wid_'+win].addFunction=function(id,type,name,target,position,filetype,filecolor){openerRef=$('wid_'+win+'_list');var newIdSuffix=openerRef.childNodes.length;if(type=="file"){tmparr=name;name=tmparr.split('</span>')[1].stripTags().strip();filetype=tmparr.split('</span>')[0].stripTags().strip();filecolor=tmparr.split('</span>')[0].split('filetype ')[1];filecolor=filecolor.substring(0,filecolor.indexOf('"'));var item_template=$K.yg_makeTemplate($K.windows['wid_'+win].jsTemplateFile);var newItem=item_template.evaluate({item_index:newIdSuffix,item_id:id,item_type:type,item_name:name,item_color:filecolor,item_filetype:filetype});}else{var item_template=$K.yg_makeTemplate($K.windows['wid_'+win].jsTemplate);var newItem=item_template.evaluate({item_index:newIdSuffix,item_id:id,item_type:type,item_name:name});}
var items=openerRef.childNodes;for(var i=0;i<items.length;i++){var actItem=items[i].readAttribute('yg_id');if(actItem==id)return;}
if((position!='')&&(position!=undefined)&&(position!='into')&&(target!=0)){for(var i=0;i<items.length;i++){var actItem=items[i].readAttribute('yg_id');if(actItem==target){if(position=='before'){openerRef.childNodes[i].insert({before:newItem});break;}
if(position=='after'){openerRef.childNodes[i].insert({after:newItem});break;}}}}else{openerRef.insert(newItem);}
$K.yg_customAttributeHandler(openerRef);$K.initSortable(openerRef);$K.windows[$(openerRef).up('.ywindow').id].refresh($(openerRef));}}
$K.yg_openDropStack=function(){if(!$K.yg_dropStackWindow){$K.yg_dropStackWindow=new $K.yg_wndobj({config:'DROPSTACK'});}else{$($K.yg_dropStackWindow.id).show();$($K.yg_dropStackWindow.id).setStyle({zIndex:$K.yg_incrementTopZIndex()});}}
$K.yg_filterDropStack=function(objecttype,shorttitle,win){$(win+'_filterlist').innerHTML=shorttitle;if(objecttype!="ALL"){objs=$(win+'_list').immediateDescendants();objs.each(function(item){if(item.readAttribute("class").indexOf('mk_'+objecttype.toLowerCase())==-1){item.hide();$K.yg_removefromFocus(item.down('.mk_selectable'));}else{item.show();}});}else{objs=$(win+'_list').immediateDescendants();objs.each(function(item){item.show();});}
$K.windows[win].refresh();}
;$K.yg_loginbox=function(){if(($('wid_login').getStyle('visibility')=='hidden')||($('wid_login').getStyle('display')=='none')){$('loginload').hide();$(document.body).addClassName("unauthorized");var submitFunction=function(event){if(event.keyCode==Event.KEY_RETURN){document.forms['loginform-form'].submit();$K.yg_userLogin($('wid_login_okbutton').down());Event.stop(event);}};$('username').value="";$('password').value="";$('username').observe('keypress',submitFunction);$('password').observe('keypress',submitFunction);$('wid_login_checkbox').observe('keydown',submitFunction);$('wid_login_okbutton').observe('keydown',submitFunction);$('wid_login').setStyle({visibility:'visible',display:'block',zIndex:$K.yg_incrementTopZIndex()});$K.yg_customAttributeHandler($('wid_login'));$K.yg_centerWindow($('wid_login'));$('loginform').down('input').focus();}}
$K.yg_loginToggleForms=function(){if($("loginform").visible()){$("loginform").hide();$("recoveryform").show();$("recoveryform").down('input').value=$("loginform").down('input').value;}else{$("password").value="";$("loginform").show();$("recoveryform").hide();if($('newusersetpassword')){$('newusersetpassword').hide();}
if($('recoverpassword')){$('recoverpassword').hide();}
$('recoverypasswordsuccess').hide();$("recoveryformsuccess").hide();}}
$K.yg_removeLogin=function(winID){$('username').stopObserving('keypress');$('password').stopObserving('keypress');$(winID).hide();document.body.removeClassName('unauthorized');}
$K.yg_userLogin=function(which){$('loginload').show();if($('loginerror'))$('loginerror').hide();var winRef=which.up('.ywindow');var winID=winRef.id;if($('recoverpassword')&&$('recoverpassword').getStyle('display')=='block'){$K.yg_userSetNewPassword($('wid_login_recoverbutton').down('a'));}else{var emailField=$('username');var passwordField=$('password');var keepLoggedIn=$(winID+'_keeploggedin');emailField.removeClassName('error');passwordField.removeClassName('error');$('loginerror').hide();var hasError=false;if(emailField.value.strip()==''){emailField.addClassName('error');hasError=true;}
if(passwordField.value.strip()==''){passwordField.addClassName('error');hasError=true;}
if(!hasError){var data=Array('noevent',{yg_property:'userLogin',params:{userName:emailField.value,userPassword:passwordField.value,keepLoggedIn:keepLoggedIn.value,winID:winID}});$K.yg_AjaxCallback(data,'userLogin',true);}else{$('loginload').hide();}}}
$K.yg_showLoginError=function(winID){if($('loginerror')){$('loginload').hide();$('passwordreseterror').hide();$('loginerror').show();}}
$K.yg_showNewPasswordError=function(winID){if($('loginerror')){$('loginload').hide();$('loginerror').hide();$('passwordreseterror').show();}}
$K.yg_doLogin=function(winID,userID){if($('mainnav'))var oldUserId=$('mainnav').down('.user').readAttribute('yg_id').split('-')[0];if(document.body.hasClassName('unauthorized')||(userID!=oldUserId)){$K.isAuthenticated=true;$K.yg_loadAuthContent();}
$K.yg_removeLogin(winID);}
$K.yg_loadAuthContent=function(){var wins=$H($K.windows);wins.each(function(window){window[1].remove(true);});$('authcontainer').innerHTML='';new Ajax.Updater('authcontainer',$K.appdir+'authcontent',{evalScripts:true,method:'post',parameters:{us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}});}
$K.yg_userLogout=function(){$K.isAuthenticated=false;document.body.addClassName('unauthenticated');var data=Array('noevent',{yg_property:'userLogout',params:{}});for(winID in $K.windows){if(winID.split('_')[1]&&$K.windows[winID].yg_type&&$K.windows[winID].yg_id){$K.yg_releaseLock(winID.split('_')[1],$K.windows[winID].yg_type,$K.windows[winID].yg_id);}
$K.windows[winID].remove();}
$K.yg_loginbox();$K.yg_AjaxCallback(data,'userLogout',true);}
$K.yg_userSetNewPassword=function(which){which=$(which);var winRef=which.up('.ywindow');var winID=winRef.id;var password=$('wid_login_reset_password').value;var passwordConfirm=$('wid_login_reset_password_confirm').value;$('wid_login_reset_password').removeClassName('error');$('wid_login_reset_password_confirm').removeClassName('error');if((password!='')&&(password===passwordConfirm)){$('loginload').show();var userPassword=$('wid_login_reset_password').value;var userToken=$('wid_login_reset_password_token').value;var data=Array('noevent',{yg_property:'setNewPassword',params:{userPassword:userPassword,userToken:userToken,winID:winID}});$K.yg_AjaxCallback(data,'setNewPassword',true);}else{$('wid_login_reset_password').addClassName('error');$('wid_login_reset_password_confirm').addClassName('error');$('loginload').hide();}}
$K.yg_setNewPasswordSuccess=function(){if($('newusersetpassword')){$('newusersetpassword').hide();}
if($('recoverpassword')){$('recoverpassword').hide();}
if($('passwordreseterror')){$('passwordreseterror').hide();}
$('username').removeClassName('error');$('password').removeClassName('error');$('recoverypasswordsuccess').show();$('loginload').hide();}
$K.yg_userForgotPassword=function(which){which=$(which);var winRef=which.up('.ywindow');var winID=winRef.id;var emailField=$(winID+'_forgotemail');emailField.removeClassName('error');$('recoverloginerror').hide();var hasError=false;if(emailField.value.strip()==''){emailField.addClassName('error');hasError=true;}
if(!hasError){$('loginload').show();var email=emailField.value;emailField.value='';var data=Array('noevent',{yg_property:'recoverLogin',params:{userEmail:email,winID:winID}});$K.yg_AjaxCallback(data,'recoverLogin',true);}}
$K.yg_userPasswordSent=function(email){$('recoveryform').hide();$('loginload').hide();$('recoveryformsuccessmessage').update($('recoveryformsuccessmessage_default').innerHTML.replace('EMAILADRESS',email));$('recoveryformsuccess').show();}
$K.yg_showRecoverLoginError=function(winID){if($('recoverloginerror')){$('loginload').hide();$('recoverloginerror').show();}}
;$K.yg_initAppearanceTab=function(pageID,winID){$K.windows['wid_'+winID].changeTemplate=function(templateId){$K.yg_changeTemplate(templateId,this.yg_id);}
$K.windows['wid_'+winID].refreshTemplate=function(templateId){var tabRef=$('wid_'+winID+'_APPEARANCE');if(!Object.isUndefined(tabRef)){var panelRef=tabRef.down('.cntblockselection');panelRef.writeAttribute('yg_preselected',templateId);new Ajax.Updater(panelRef,$K.appdir+'template_info/',{onComplete:function(){$K.windows['wid_'+winID].init();},asynchronous:true,evalScripts:true,method:'post',parameters:{template:templateId,mode:'details',us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}});}else{$K.log('Panel not there, nothing to update...',$K.Log.INFO);}}
$K.windows['wid_'+winID].changeNavigation=function(navigationId){var tabRef=$('wid_'+winID+'_APPEARANCE');var panelRef=tabRef.down('.navipanel');var site=this.yg_id.split('-');site=site[1];navigationId=navigationId.split('-');navigationId=navigationId[0];panelRef.writeAttribute('yg_preselected',navigationId);window.$navigationId=navigationId;var data=Array('noevent',{yg_property:'setPageNavigation',params:{page:pageID,site:site,wid:winID,navigationId:navigationId}});$K.yg_AjaxCallback(data,'setPageNavigation');}
$K.windows['wid_'+winID].refreshNavigation=function(or_navi,or_template){var tabRef=$('wid_'+winID+'_APPEARANCE');var navId=parseInt(window.$navigationId);if(or_navi){navId=or_navi;}
if(or_template){var templatePanelRef=tabRef.down('.cntblockselection');templatePanelRef.writeAttribute('yg_preselected',or_template);}
if(!Object.isUndefined(tabRef)){var panelRef=tabRef.down('.navipanel');var templatePanelRef=tabRef.down('.cntblockselection');var templateId=templatePanelRef.readAttribute('yg_preselected');new Ajax.Updater(panelRef,$K.appdir+'navigation_info/',{onComplete:function(){$K.windows['wid_'+winID].init();},asynchronous:true,evalScripts:true,method:'post',parameters:{navigation:navId,template:templateId,us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}});}else{$K.log('Panel not there, nothing to update...',$K.Log.INFO);}}
if($("wid_"+winID+"_templatepanel"))$('wid_'+winID+'_templatepanel').observe('mouseleave',function(){$K.yg_setDropAllowed(false);});if($('sortlist'+winID)){$K.yg_initSortable('sortlist'+winID);}}
$K.subpagesSortCallbacks={onUpdate:function(element){var listArray=Array();for(var i=0;i<element.childNodes.length;i++){var tagId=element.childNodes[i].readAttribute('yg_id').split('-');tagId=tagId[0];listArray.push(tagId);}
var parentWin=$K.windows[this.element.up('.ywindow').id];var siteID=parentWin.yg_id.split('-')[1];var pageID=parentWin.yg_id.split('-')[0];var data=Array('noevent',{yg_property:'orderPageSubpages',params:{page:pageID,site:siteID,listArray:listArray}});$K.yg_AjaxCallback(data,'orderPageSubpages');$K.yg_updateSortables();}};
;$K.yg_addFormfieldToList=function(winID,element,sourceElement){$K.yg_updateSortables();var activeDragInfo=$K.yg_activeDragInfo;var target=$K.yg_activeDragInfo.target;var position=activeDragInfo.position;if(position=='after')$K.yg_currentdragobj.reverse();var formfieldId=sourceElement.up('li').readAttribute('yg_id').split('-')[0];var maxIdx=1;element.childElements().each(function(childItem){var elemIdx=parseInt(childItem.id.split('_').last());if(elemIdx>maxIdx)maxIdx=elemIdx;});maxIdx++;var item_template=$K.yg_makeTemplate(formfieldTemplates[formfieldId]);var newFormfield=item_template.evaluate({new_idx:maxIdx,new_id:'__NEW_ID_'+maxIdx+'__'});switch(position){case'before':target.insert({before:newFormfield});break;case'after':target.insert({after:newFormfield});break;default:case'into':target=element;target.insert({bottom:newFormfield});break;}
$K.yg_customAttributeHandler(element);$K.yg_drawTopborder(null,true);newFormfield.evalScripts();$K.windows[winID].refresh();$K.initSortable(winID+'_formfields_list');}
$K.yg_initEntrymaskConfigTab=function(winID){if(!$('wid_'+winID+'_formfields_list'))return;var formfieldTemplates=$K.windows['wid_'+winID].formfieldTemplates;}
$K.yg_saveEntryMaskFormfields=function(which){which=$(which);$K.yg_fireLateOnChange();var winRef=which.up('.ywindow');var winID=winRef.id;var hasError=false;var identifierBlackList=['URL','PAGE_ID','SITE_ID','FILE_ID','CBLOCK_ID','TAG_ID','VALUE','LINKID','ENTRYMASKID','CODE','ENTRYMASKNAME','IDENTIFIER','TYPE','ID','FORMFIELD','ENTRYMASKFORMFIELD','LNK','NAME','CBID','PRESET','WIDTH','MAXLENGTH','CONFIG','CUSTOM','VALUE01','VALUE02','VALUE03','VALUE04','VALUE05','VALUE06','VALUE07','VALUE08'];var uniqueValueElements=new Array();var frmElements=$(winID+'_ENTRYMASKCONFIG').select('input','textarea');frmElements.each(function(item){if(item.name=='code'){if(item.value.strip().indexOf(' ')!=-1){item.addClassName('error');hasError=true;}else{item.removeClassName('error');}}
if(item.readAttribute('unique')!=null){var isNotUnique=false;uniqueValueElements.push(item);uniqueValueElements.each(function(unique_item){if(((unique_item!=item)&&(unique_item.value==item.value))||(identifierBlackList.indexOf(item.value.toUpperCase())!=-1)){isNotUnique=true;}
if(item.value.strip().indexOf(' ')!=-1){isNotUnique=true;}});if(isNotUnique){item.addClassName('error');item.isNotUnique=true;}else{if(item.name!='code'){item.removeClassName('error');item.isNotUnique=false;}}}});frmElements.each(function(item){if((item.readAttribute('unique')!=null)&&(item.isNotUnique)){item.addClassName('error');}
if((item.readAttribute('mandatory')!=null)&&(item.value.strip()=='')){item.addClassName('error');}else if(item.readAttribute('mandatory')&&(item.value.strip()!='')&&(!item.isNotUnique)){if(item.name!='code'){item.removeClassName('error');}}
if((item.readAttribute('mandatory')!=null)&&!item.name.endsWith('-NAME')&&(item.value.indexOf('-')!=-1)){item.addClassName('error');}
if(item.hasClassName('error')){hasError=true;if(item.up('li')&&!item.up('li').hasClassName('opened')){$K.yg_listCollapsSwap(item.up('li'));}}});if(hasError){$(winID).down('.error').focus();}
var parameters=Form.serializeElements(frmElements,{hash:true,submit:false});parameters.objectID=$K.windows[winID].yg_id.split('-')[0];parameters.wid=winID;if(!hasError){var data=Array('noevent',{yg_property:'entrymaskSaveConfig',params:parameters});$K.yg_AjaxCallback(data,'entrymaskSaveConfig');}}
$K.yg_removeEntry=function(which){which=$(which);var winID=which.up('.ywindow').id;which.remove();$K.windows[winID].refresh();$K.yg_hilite('entrymask',$K.windows[winID].yg_id,'name');}
$K.yg_removeListEntry=function(which){which=$(which);var formfieldContainer=which.up('.gridfixed');if(formfieldContainer.down('.dropdownbox')){$K.yg_dropdownRemove(formfieldContainer.down('.dropdownbox'),which.down('input').value);}
which.remove();$K.yg_updateInnerContent(formfieldContainer.down('.sortablelist'));$K.scrollbars[formfieldContainer.down('.sortlist').id].setBarSize();}
$K.yg_updateTitle=function(which){which=$(which);if(which.up('li').down('.desc')){which.up('li').down('.desc').update(which.value);}else if(which.up('li').down('.icn')){which.up('li').down('.icn').update(which.value);}}
$K.yg_addEntryToEntryList=function(which){which=$(which);var formfieldContainer=which.up('.gridfixed');var listContainer=formfieldContainer.down('ul');var listEntryTemplate=formfieldContainer.down('.entry_template').innerHTML;var inputField=which.up('tr').down('input');if(inputField.value.strip()==''){inputField.addClassName('error');return;}else{inputField.removeClassName('error');}
var maxEntryIdx=1;var alreadyInList=false;listContainer.childElements().each(function(item){if(item.down('input').value==inputField.value.strip()){alreadyInList=true;}
var entryIdx=parseInt(item.readAttribute('yg_id').split('-')[0]);if(entryIdx>maxEntryIdx){maxEntryIdx=entryIdx;}});maxEntryIdx++;if(alreadyInList){inputField.addClassName('error');return;}
if(formfieldContainer.down('.dropdownbox')){$K.yg_dropdownInsert(formfieldContainer.down('.dropdownbox'),inputField.value,inputField.value,false);if(formfieldContainer.down('.dropdownbox').down('.dropdownlist').childElements().length==1){$K.yg_dropdownSelect(formfieldContainer.down('.dropdownbox'),formfieldContainer.down('.dropdownbox').down('.dropdownlist').down('div'));}}
var listEntryNew=listEntryTemplate.replace(/__ID__/g,maxEntryIdx).replace(/__TITLE__/g,inputField.value).replace(/listitempagefocus/g,'listitempage');listContainer.insert({bottom:listEntryNew});inputField.value='';$K.scrollbars[formfieldContainer.down('.sortlist').id].setBarSize();$K.yg_customAttributeHandler(listContainer);$K.initSortable(listContainer);$K.yg_updateInnerContent(formfieldContainer.down('.sortablelist'));}
$K.yg_addChildEntrymask=function(entrymaskref){if(entrymaskref.hasClassName('tree_btn')){if(entrymaskref.hasClassName('disabled'))return;var entrymask=$K.windows[entrymaskref.up('.ywindow').id].yg_id;}else{var wid=parseInt(entrymaskref.up('.ywindow').id.replace(/wid_/g,''));var nodeid=entrymaskref.id;var entrymask=nlsTree['entrymasks_tree'+wid+'_tree'].nLst[nodeid].yg_id;}
entrymask=entrymask.split('-')[0];var data=Array('noevent',{yg_property:'addEntrymask',params:{entrymask:entrymask}});$K.yg_AjaxCallback(data,'addEntrymask');}
$K.yg_addChildEntrymaskFolder=function(entrymaskref){if(entrymaskref.hasClassName('tree_btn')){if(entrymaskref.hasClassName('disabled'))return;var entrymask=$K.windows[entrymaskref.up('.ywindow').id].yg_id;}else{var wid=parseInt(entrymaskref.up('.ywindow').id.replace(/wid_/g,''));var nodeid=entrymaskref.id;var entrymask=nlsTree['entrymasks_tree'+wid+'_tree'].nLst[nodeid].yg_id;}
entrymask=entrymask.split('-')[0];var data=Array('noevent',{yg_property:'addEntrymaskChildFolder',params:{entrymask:entrymask}});$K.yg_AjaxCallback(data,'addEntrymaskChildFolder');}
$K.yg_actionAddChildEntrymask=function(which){$K.yg_addChildEntrymask(which.up(2).reference);}
$K.yg_actionAddChildEntrymaskFolder=function(which){$K.yg_addChildEntrymaskFolder(which.up(2).reference);}
$K.yg_actionDeleteEntrymask=function(which,multi){$K.yg_deleteElement(which.up(2).reference,multi);}
;$K.yg_initUserMgr=function(wndid){$K.windows[wndid].tablecols=true;innerwidth=$(wndid+"_innercontent").getWidth();colwidth=Math.floor((innerwidth)/3)-9;$K.yg_changeCSS('#'+wndid+' .fcol_name','width',colwidth+'px',true);$K.yg_changeCSS('#'+wndid+' .fcol_company','width',(colwidth+1)+'px',true);$K.yg_changeCSS('#'+wndid+' .fcol_email','width',(colwidth+1)+'px',true);$K.yg_refreshUserMgr(wndid);}
$K.yg_editUser=function(which,e){which=$(which);var winId=which.up('.ywindow').id;var trItem=which.up('tr');trItem.up('tbody').select('tr.cntblockfocus').each(function(item){item.removeClassName('cntblockfocus');});trItem.removeClassName('cntblock');trItem.addClassName('cntblockfocus');$K.yg_currentfocusobj=[trItem];$K.yg_selectNode(trItem,e);$($K.windows[winId].boundWindow).removeClassName('boxghost');}
$K.yg_refreshUserMgr=function(wndid){var count=parseInt($(wndid+'_userlist_table').readAttribute('count'),10);var countFiltered=parseInt($(wndid+'_userlist_table').readAttribute('count_filtered'),10);$(wndid+'_objcnt').update(count);if(count!=countFiltered){$(wndid+'_objcnt_filtered').update(countFiltered);$(wndid+'_objcnt_filtered').up('span').show();}else{$(wndid+'_objcnt_filtered').up('span').hide();}
if($K.windows[wndid].yg_id){var userID=$K.windows[wndid].yg_id.split('-')[0];if(!$('users_'+wndid.replace(/wid_/g,'')+'_'+userID)){$K.windows[wndid].yg_id=userID+'-user';if($K.windows[$K.windows[wndid].boundWindow].yg_id!=userID+'-user'){$K.windows[$K.windows[wndid].boundWindow].yg_id=userID+'-user';$K.windows[$K.windows[wndid].boundWindow].tabs.select($K.windows[$K.windows[wndid].boundWindow].tabs.selected);$($K.windows[wndid].boundWindow).removeClassName('boxghost');}}else{if($K.windows[$K.windows[wndid].boundWindow].yg_id!=userID+'-user'){$K.yg_selectNode($('users_'+wndid.replace(/wid_/g,'')+'_'+userID));}
$K.yg_blockSelect($('users_'+wndid.replace(/wid_/g,'')+'_'+userID),null);}}
$K.windows[wndid].refresh();TableKit.unloadTable(wndid+"_tablecontent");TableKit.unloadTable(wndid+"_tablehead");TableKit.Sortable.init(wndid+"_tablehead");TableKit.Sortable.init(wndid+"_tablecontent");TableKit.Resizable.init(wndid+"_tablehead");if($K.windows[wndid].loadparams.pagedir_orderby=='lastname'&&$K.windows[wndid].loadparams.pagedir_orderdir==1){$(wndid+"_tablehead").down('.fcol_name').addClassName("sortcol");$(wndid+"_tablehead").down('.fcol_name').addClassName("sortasc");TableKit.Sortable.sort(wndid+"_tablecontent",$K.windows[wndid].loadparams.pagedir_orderby,1);}
TableKit.Sortable.sort(wndid+"_tablecontent",$K.windows[wndid].loadparams.pagedir_orderby,$K.windows[wndid].loadparams.pagedir_orderdir*-1);TableKit.Sortable.sort(wndid+"_tablecontent",$K.windows[wndid].loadparams.pagedir_orderby,1);}
$K.yg_focusUserSearch=function(which,e){var preset=which.readAttribute('data-preset');if(which.value==preset){which.value='';which.removeClassName('preset');}}
$K.yg_blurUserSearch=function(which,e){var preset=which.readAttribute('data-preset');if(!which.hasChanged){which.value=preset;which.addClassName('preset');}}
$K.yg_resetUserSearch=function(which,e){which.hasChanged=false;$K.yg_blurUserSearch(which,e);}
$K.yg_changeUserSearch=function(which,e){which.hasChanged=true;if(which.value==''){which.hasChanged=false;}
$K.yg_changeUserFilter(which,e);}
$K.yg_initUserPermissionsTab=function(pageID,parentWinID,readOnly,maxLevels){maxLevels--;window.openAddUserGroupWindow=function(openerReference){var site=$K.windows['wid_'+parentWinID].yg_id.split('-');site=site[1];new Ajax.Updater('dialogcontainer',$K.appdir+'window?wt=dialog&display=usergroups',{asynchronous:true,evalScripts:true,method:'post',insertion:'bottom',onComplete:function(){},parameters:{opener_reference:openerReference,us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}});}
$('wid_'+parentWinID).select('div.perm_line_header','div.mk_innertable_container').each(function(item){var columnHighlight=function(e){var target=e.findElement();if(target.hasClassName('mk_rread')||target.hasClassName('mk_rwrite')||target.hasClassName('mk_rdelete')||target.hasClassName('mk_rsub')||target.hasClassName('mk_rstage')||target.hasClassName('mk_rmoderate')||target.hasClassName('mk_rcomment')||target.hasClassName('mk_rsend')||target.hasClassName('mk_rread_head')||target.hasClassName('mk_rwrite_head')||target.hasClassName('mk_rdelete_head')||target.hasClassName('mk_rsub_head')||target.hasClassName('mk_rstage_head')||target.hasClassName('mk_rmoderate_head')||target.hasClassName('mk_rcomment_head')||target.hasClassName('mk_rsend_head')){var currentColumn;var outListContainer=target.up('.usergroup_list');target.className.split(' ').each(function(classItem){if(classItem.startsWith('mk_r')){currentColumn=classItem.replace(/_head/g,'');}});switch(e.type){case'mouseover':outListContainer.addClassName('mk_hilite_'+currentColumn.replace(/mk_/g,''));break;case'mouseout':outListContainer.removeClassName('mk_hilite_rread').removeClassName('mk_hilite_rwrite').removeClassName('mk_hilite_rdelete').removeClassName('mk_hilite_rsub').removeClassName('mk_hilite_rstage').removeClassName('mk_hilite_rmoderate').removeClassName('mk_hilite_rcomment').removeClassName('mk_hilite_rsend');break;}}}
item.stopObserving('mouseover');item.stopObserving('mouseout');item.observe('mouseover',columnHighlight);item.observe('mouseout',columnHighlight);item.stopObserving('click');item.observe('click',function(e){var target=e.findElement();if(target.hasClassName('perm_tree_minusb')||target.hasClassName('perm_tree_minusnb')||target.hasClassName('perm_tree_minusnl')||target.hasClassName('perm_tree_plusb')||target.hasClassName('perm_tree_plusnb')||target.hasClassName('perm_tree_plusnl')){var currLevel=target.readAttribute('currentlevel');if(!target.up('.perm_line').alreadyLoaded){var yg_id=target.up('.perm_line').readAttribute('yg_id');var nodeTitle=target.up('.perm_line').down('.perm_title');nodeTitle.oldTitle=nodeTitle.innerHTML;nodeTitle.update($K.TXT('TXT_LOADING')+'...');var leadingLines='';target.up('.perm_line').down('.perm_tree_lines').select('div').each(function(item){if(item.hasClassName('perm_tree_line')||item.hasClassName('perm_tree_minusb')||item.hasClassName('perm_tree_plusb')){leadingLines+='1';}else{leadingLines+='0';}});var objectType=target.up('.perm_container').readAttribute('yg_type');new Ajax.Request($K.appdir+'permission_nodes',{onSuccess:function(t){nodeTitle.update(nodeTitle.oldTitle);var subNodes=new Element('div',{className:'perm_line_container'});subNodes.update(t.responseText);if(target.up('.perm_line').next()&&target.up('.perm_line').next().hasClassName('perm_line_container')){subNodes.className=target.up('.perm_line').next().className;target.up('.perm_line').next().replace(subNodes);}else{target.up('.perm_line').insert({after:subNodes});}
var currentLine=target.up('.perm_line');if(target.className.startsWith('perm_tree_minus')){target.className=target.className.replace(/minus/g,'plus');if(currentLine.down('.perm_tree_icon_folder_open')){currentLine.down('.perm_tree_icon_folder_open').addClassName('perm_tree_icon_folder');currentLine.down('.perm_tree_icon_folder_open').removeClassName('perm_tree_icon_folder_open');}}else if(target.className.startsWith('perm_tree_plus')){target.className=target.className.replace(/plus/g,'minus');if(currentLine.down('.perm_tree_icon_folder')){currentLine.down('.perm_tree_icon_folder').addClassName('perm_tree_icon_folder_open');currentLine.down('.perm_tree_icon_folder').removeClassName('perm_tree_icon_folder');}}
target.up('.perm_line').alreadyLoaded=true;$K.windows['wid_'+parentWinID].refresh();},onFailure:function(){},parameters:{yg_type:objectType,yg_id:yg_id,role_id:$K.windows['wid_'+parentWinID].yg_id,leadingLines:leadingLines,us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}});}else{var currentLine=target.up('.perm_line');var subNodesBlock=currentLine.next();if(target.className.startsWith('perm_tree_minus')){target.className=target.className.replace(/minus/g,'plus');if(currentLine.down('.perm_tree_icon_folder_open')){currentLine.down('.perm_tree_icon_folder_open').addClassName('perm_tree_icon_folder');currentLine.down('.perm_tree_icon_folder_open').removeClassName('perm_tree_icon_folder_open');}
subNodesBlock.hide();}else if(target.className.startsWith('perm_tree_plus')){target.className=target.className.replace(/plus/g,'minus');subNodesBlock.show();if(currentLine.down('.perm_tree_icon_folder')){currentLine.down('.perm_tree_icon_folder').addClassName('perm_tree_icon_folder_open');currentLine.down('.perm_tree_icon_folder').removeClassName('perm_tree_icon_folder');}}
$K.windows['wid_'+parentWinID].refresh();}}
if(target.hasClassName('perm_ok')||target.hasClassName('perm_nok')||target.hasClassName('perm_user_ok')||target.hasClassName('perm_user_nok')){if(target.hasClassName('mk_readonly')){return;}
target.down('input').addClassName('mk_changed');var newState,oldState;var parentContainer=target.up('.perm_line_container');var backgroundStyle=(target.getStyle('backgroundPosition'))||(target.currentStyle.backgroundPositionY);if(!backgroundStyle&&target.currentStyle){backgroundStyle=target.getStyle('backgroundPositionY');if(backgroundStyle=='bottom'){backgroundStyle='50% 100%';}else{backgroundStyle='50% 0%';}}
if(Prototype.Browser.IE){if(backgroundStyle=='bottom'){backgroundStyle='50% 100%';}else{backgroundStyle='50% 0%';}}
var currentRight='';if(target.hasClassName('mk_rread')){currentRight='mk_rread';}else if(target.hasClassName('mk_rwrite')){currentRight='mk_rwrite';}else if(target.hasClassName('mk_rdelete')){currentRight='mk_rdelete';}else if(target.hasClassName('mk_rsub')){currentRight='mk_rsub';}else if(target.hasClassName('mk_rstage')){currentRight='mk_rstage';}else if(target.hasClassName('mk_rmoderate')){currentRight='mk_rmoderate';}else if(target.hasClassName('mk_rcomment')){currentRight='mk_rcomment';}else if(target.hasClassName('mk_rsend')){currentRight='mk_rsend';}
if(backgroundStyle=='50% 100%'){target.down('input').value='0';target.removeClassName('perm_user_ok');target.addClassName('perm_user_nok');newState='removeClassName';oldState='addClassName';}else if(backgroundStyle=='50% 0%'){target.down('input').value='1';target.removeClassName('perm_user_nok');target.addClassName('perm_user_ok');newState='addClassName';oldState='removeClassName';}
var currentLine=target.up('.perm_line');switch(currentRight){case'mk_rread':if(newState=='removeClassName'){currentLine.select('.mk_rwrite','.mk_rdelete','.mk_rsub','.mk_rstage','.mk_rmoderate','.mk_rcomment','.mk_rsend').each(function(subItem){subItem.down('input').value='0';subItem.removeClassName('perm_user_ok');subItem.addClassName('perm_user_nok');});}
break;case'mk_rdelete':if(newState=='addClassName'){currentLine.select('.mk_rwrite').each(function(subItem){subItem.down('input').value='1';subItem.removeClassName('perm_user_nok');subItem.addClassName('perm_user_ok');});}
case'mk_rstage':case'mk_rmoderate':case'mk_rcomment':case'mk_rsend':if(newState=='addClassName'){currentLine.select('.mk_rread').each(function(subItem){subItem.down('input').value='1';subItem.removeClassName('perm_user_nok');subItem.addClassName('perm_user_ok');});}
break;}
var currObjectType=target.up('.perm_container').readAttribute('yg_type');if((newState=='addClassName')&&(currObjectType!='usergroups')){var parentLines=new Array();currentLine.ancestors().each(function(item){if(item.up('div.perm_container[yg_type]')&&item.previous()){parentLines.push(item.previous());}});parentLines.each(function(item){item.select('.mk_rread').each(function(subItem){subItem.down('input').addClassName('mk_changed');subItem.removeClassName('perm_user_nok');subItem.addClassName('perm_user_ok');});});}
var subNodeContainer=target.up('.perm_line').next();if(subNodeContainer&&subNodeContainer.hasClassName('perm_line_container')){var cleanUserSetPermissions=function(userPermission){subNodeContainer.select('.mk_'+userPermission+'.perm_user_ok','.mk_'+userPermission+'.perm_user_nok').each(function(subItem){subItem.removeClassName('perm_user_ok');subItem.removeClassName('perm_user_nok');});subNodeContainer.select('.mk_hasno'+userPermission,'.mk_has'+userPermission).each(function(subItem){subItem.removeClassName('mk_hasno'+userPermission);subItem.removeClassName('mk_has'+userPermission);});subNodeContainer.select('.mk_'+userPermission+' input').each(function(subItem){subItem.removeClassName('mk_changed');subItem.value='';});}
switch(currentRight){case'mk_rread':cleanUserSetPermissions('rread');subNodeContainer[newState]('mk_hasrread');subNodeContainer[oldState]('mk_hasnorread');if(newState=='removeClassName'){cleanUserSetPermissions('rwrite');cleanUserSetPermissions('rdelete');cleanUserSetPermissions('rsub');cleanUserSetPermissions('rstage');cleanUserSetPermissions('rsend');subNodeContainer[newState]('mk_hasrwrite');subNodeContainer[oldState]('mk_hasnorwrite');subNodeContainer[newState]('mk_hasrdelete');subNodeContainer[oldState]('mk_hasnordelete');subNodeContainer[newState]('mk_hasrsub');subNodeContainer[oldState]('mk_hasnorsub');subNodeContainer[newState]('mk_hasrstage');subNodeContainer[oldState]('mk_hasnorstage');subNodeContainer[newState]('mk_hasrsend');subNodeContainer[oldState]('mk_hasnorsend');subNodeContainer[newState]('mk_hasrmoderate');subNodeContainer[oldState]('mk_hasnormoderate');subNodeContainer[newState]('mk_hasrcomment');subNodeContainer[oldState]('mk_hasnorcomment');}
break;case'mk_rwrite':cleanUserSetPermissions('rwrite');subNodeContainer[newState]('mk_hasrwrite');subNodeContainer[oldState]('mk_hasnorwrite');break;case'mk_rdelete':cleanUserSetPermissions('rdelete');subNodeContainer[newState]('mk_hasrdelete');subNodeContainer[oldState]('mk_hasnordelete');break;case'mk_rsub':cleanUserSetPermissions('rsub');subNodeContainer[newState]('mk_hasrsub');subNodeContainer[oldState]('mk_hasnorsub');break;case'mk_rstage':cleanUserSetPermissions('rstage');subNodeContainer[newState]('mk_hasrstage');subNodeContainer[oldState]('mk_hasnorstage');break;case'mk_rmoderate':cleanUserSetPermissions('rmoderate');subNodeContainer[newState]('mk_hasrmoderate');subNodeContainer[oldState]('mk_hasnormoderate');break;case'mk_rcomment':cleanUserSetPermissions('rcomment');subNodeContainer[newState]('mk_hasrcomment');subNodeContainer[oldState]('mk_hasnorcomment');break;case'mk_rsend':cleanUserSetPermissions('rsend');subNodeContainer[newState]('mk_hasrsend');subNodeContainer[oldState]('mk_hasnorsend');break;}
if((currentRight!='mk_rread')&&(newState=='addClassName')){cleanUserSetPermissions('rread');subNodeContainer[newState]('mk_hasrread');subNodeContainer[oldState]('mk_hasnorread');}
if((currentRight=='mk_rdelete')&&(newState=='addClassName')){cleanUserSetPermissions('rwrite');subNodeContainer[newState]('mk_hasrwrite');subNodeContainer[oldState]('mk_hasnorwrite');}}}});});}
$K.yg_switchPermissionSite=function(which){var winRef=which.up('.ywindow');var winID=winRef.id;var newSite=which.up('.dropdown').next('input[type=hidden]').value;var innerTable=which.up('.perm_line_header').next('.mk_innertable_container');var alreadyLoaded=false;innerTable.select('.mk_innertable').each(function(item){item.hide();if(item.id==(innerTable.id+'_'+newSite)){alreadyLoaded=true;}});if(alreadyLoaded){$(innerTable.id+'_'+newSite).show();$K.windows[winID].refresh();}else{$(winID+'_ywindowinner').addClassName('tab_loading');new Ajax.Updater(innerTable,$K.appdir+'tab_usergroup_pages_inner',{asynchronous:true,evalScripts:true,method:'post',insertion:'top',onComplete:function(){$(winID+'_ywindowinner').removeClassName('tab_loading');$K.windows[winID].refresh();},parameters:{refresh:0,seq:winID.replace(/wid_/g,''),wid:winID,yg_id:$K.windows[winID].yg_id,yg_type:'usergroup',site:newSite,us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}});}}
$K.yg_checkAllPermissions=function(which){var currentLine=which.up('.perm_line');var subNodeContainer=currentLine.next();var addClasses=['mk_hasrread','mk_hasrwrite','mk_hasrdelete','mk_hasrsub','mk_hasrstage','mk_hasrmoderate','mk_hasrcomment','mk_hasrsend'];var removeClasses=['mk_hasnorread','mk_hasnorwrite','mk_hasnordelete','mk_hasnorsub','mk_hasnorstage','mk_hasnormoderate','mk_hasnorcomment','mk_hasnorsend'];var cntRights=currentLine.down('.perm_chkboxes').select('div').length-1;var cntChecked=currentLine.down('.perm_chkboxes').select('input[value=1]').length;if((cntRights==cntChecked)){var tmp=addClasses;addClasses=removeClasses;removeClasses=tmp;}
currentLine.down('.perm_chkboxes').select('div').each(function(subItem){if(!subItem.hasClassName('perm_select_all')){if((cntRights==cntChecked)){if(!subItem.hasClassName('mk_readonly')){subItem.down('input').value='0';subItem.removeClassName('perm_user_ok');subItem.addClassName('perm_user_nok');}}else{subItem.down('input').value='1';subItem.removeClassName('perm_user_nok');subItem.addClassName('perm_user_ok');}
subItem.down('input').addClassName('mk_changed');}});var currObjectType=which.up('.perm_container').readAttribute('yg_type');if((cntRights!=cntChecked)&&(currObjectType!='usergroups')){var parentLines=new Array();currentLine.ancestors().each(function(item){if(item.up('div.perm_container[yg_type]')&&item.previous()){parentLines.push(item.previous());}});parentLines.each(function(item){item.select('.mk_rread').each(function(subItem){subItem.down('input').addClassName('mk_changed');subItem.removeClassName('perm_user_nok');subItem.addClassName('perm_user_ok');});});}
if(subNodeContainer&&subNodeContainer.hasClassName('perm_line_container')){var cleanUserSetPermissions=function(userPermission){subNodeContainer.select('.mk_'+userPermission+'.perm_user_ok','.mk_'+userPermission+'.perm_user_nok').each(function(subItem){subItem.removeClassName('perm_user_ok');subItem.removeClassName('perm_user_nok');});subNodeContainer.select('.mk_hasno'+userPermission,'.mk_has'+userPermission).each(function(subItem){subItem.removeClassName('mk_hasno'+userPermission);subItem.removeClassName('mk_has'+userPermission);});subNodeContainer.select('.mk_'+userPermission+' input').each(function(subItem){subItem.removeClassName('mk_changed');subItem.value='';});}
cleanUserSetPermissions('rread');cleanUserSetPermissions('rwrite');cleanUserSetPermissions('rdelete');cleanUserSetPermissions('rsub');cleanUserSetPermissions('rstage');cleanUserSetPermissions('rmoderate');cleanUserSetPermissions('rcomment');cleanUserSetPermissions('rsend');var isReadOnly=(subNodeContainer.previous().down('.mk_rread').hasClassName('mk_readonly'));removeClasses.each(function(currentClass){if(!isReadOnly||(currentClass!='mk_hasrread')){subNodeContainer.removeClassName(currentClass);}});addClasses.each(function(currentClass){if(!isReadOnly||(currentClass!='mk_hasnorread')){subNodeContainer.addClassName(currentClass);}});}}
$K.savePermissions=function(which){var winRef=which.up('.ywindow');var winID=winRef.id;var tabContent=$(winID+'_'+$K.windows[winID].tab);var objectName=$K.windows[winID].tab.replace(/USERGROUP_/g,'');var yg_id=$K.windows[winID].yg_id.split('-')[0];if($(winID+'_newsite')){var currentSite=$(winID+'_newsite').down('input[type=hidden]').value;}else{var currentSite=0;}
var allPermissions={};var allPermissionFields=tabContent.select('input.mk_changed').each(function(item){if(item.value!==''){allPermissions[item.name]=item.value;}});allPermissions.objectType=objectName;allPermissions.winID=winID;allPermissions.roleID=yg_id;allPermissions.currentSite=currentSite;if(objectName=='GENERAL'){allPermissions.objectName=tabContent.down('input[name=objectname]').value;}
$(winID+'_ywindowinner').addClassName('tab_loading');$(winID+'_'+$K.windows[winID].tab).update('');var data=Array('noevent',{yg_property:'savePermissions',params:allPermissions});$K.yg_AjaxCallback(data,'savePermissions');}
$K.yg_deleteRole=function(buttonReference){if(buttonReference.hasClassName('tree_btn_role')){if(buttonReference.hasClassName('disabled')){return;}
var yg_id=$K.windows[$(buttonReference).up('.ywindow').id].yg_id.split('-')[0];}else{var itemReference=$(buttonReference).up('li');var yg_id=itemReference.readAttribute('yg_id').split('-')[0];}
var data=Array('noevent',{yg_property:'deleteRole',params:{roleID:yg_id,wid:$(buttonReference).up('.ywindow').id}});$K.yg_AjaxCallback(data,'deleteRole');}
$K.yg_addRole=function(buttonReference){buttonReference=$(buttonReference);if(buttonReference.hasClassName('disabled')){return;}
var data=Array('noevent',{yg_property:'addRole',params:{wid:$(buttonReference).up('.ywindow').id}});$K.yg_AjaxCallback(data,'addRole');}
$K.yg_addRoleItem=function(winID,roleID,roleName){if($K.windows[winID]&&$K.windows[winID].jsTemplate){var item_template=$K.yg_makeTemplate($K.windows[winID].jsTemplate);var newRoleItem=item_template.evaluate({new_id:roleID,new_name:roleName});if($(winID+'__usergrouplist')){$(winID+'__usergrouplist').insert({bottom:newRoleItem});$K.yg_customAttributeHandler($(winID+'_usergroups_'+roleID).up());$K.windows[winID].refresh();$K.yg_resortRolesList(winID);$K.yg_selectNode($(winID+'_usergroups_'+roleID+'_selector'));$K.yg_blockSelect($(winID+'_usergroups_'+roleID+'_selector'),null);}
if($(winID+'_tab_USERGROUP_LIST_usergrouplist')){$(winID+'_tab_USERGROUP_LIST_usergrouplist').insert({bottom:newRoleItem});$K.yg_customAttributeHandler($(winID+'_usergroups_'+roleID).up());$K.windows[winID].refresh();$K.yg_resortRolesList(winID);$K.yg_selectNode($(winID+'_usergroups_'+roleID+'_selector'));$K.yg_blockSelect($(winID+'_usergroups_'+roleID+'_selector'),null);}}}
$K.yg_resortRolesList=function(winID){for(winID in $K.windows){if($(winID+'__usergrouplist')){var roleList=$(winID+'__usergrouplist');}
if($(winID+'_tab_USERGROUP_LIST_usergrouplist')){var roleList=$(winID+'_tab_USERGROUP_LIST_usergrouplist');}
if(roleList){var rolesSortList=new Array();roleList.select('li').each(function(roleItem){var id=roleItem.id;var txt=$(roleItem.id+'_txt').innerHTML;rolesSortList.push(txt.toLowerCase()+'>||<'+id);});rolesSortList=rolesSortList.sort();rolesSortList.each(function(roleItem){var id=roleItem.split('>||<')[1];roleList.insert({bottom:$(id)});});}}}
$K.yg_changeUserFilter=function(which,e){if(which!=e)Event.stop(e);var winRef=which.up('.ywindow');var winID=winRef.id;var newSearchText=which.up('table').down('input[type=text]').value;if(which.up('table').down('input[type=text]').value==which.up('table').down('input[type=text]').readAttribute('data-preset')){newSearchText='';}
var newRole=which.up('table').down('.dropdown').next('input[type=hidden]').value;$K.windows[winID].loadparams.newRole=newRole;$K.windows[winID].loadparams.newSearchText=newSearchText;$K.windows[winID].loadparams.pagedir_page=1;$K.yg_pageDir($(winID+'_pagedir_USERLIST'));}
$K.yg_addUser=function(buttonReference){buttonReference=$(buttonReference);if(buttonReference.hasClassName('disabled')){return;}
var data=Array('noevent',{yg_property:'addUser',params:{wid:$(buttonReference).up('.ywindow').id}});$K.yg_AjaxCallback(data,'addUser');}
$K.yg_addUserItem=function(winID,userID,userName){if($K.windows[winID]&&$K.windows[winID].jsTemplate){if($(winID+'_userlist_table')){$K.windows[winID].yg_id=userID+'-user';$K.yg_refreshUserTable(winID);}}}
$K.yg_refreshUserTable=function(winID,property){TableKit.unloadTable(winID+"_tablecontent");TableKit.unloadTable(winID+"_tablehead");TableKit.Sortable.init(winID+"_tablehead",{});TableKit.Sortable.init(winID+"_tablecontent",{});TableKit.Resizable.init(winID+"_tablehead",{});if(property){if(property.toLowerCase()!=$K.windows[winID].loadparams.pagedir_orderby.toLowerCase())return;}
$K.windows[winID].tabs.select($K.windows[winID].tabs.selected,{refresh:1});}
$K.yg_generateNewPassword=function(userEmail,element){var data=Array('noevent',{yg_property:'recoverLogin',params:{userEmail:userEmail,newUser:true}});$K.yg_AjaxCallback(data,'recoverLogin',true);$(element).previous().show();$(element).hide();}
;$K.yg_initUsergroupsTab=function(pageID,parentWinID){var readOnly=true;if($('wid_'+parentWinID+'_'+pageID+'_usergrouplist').hasClassName('perm_RWRITE')){readOnly=false;}
$K.windows['wid_'+parentWinID].addToSortable=function(role_id,role_name,role_target,role_position){openerRef=$('wid_'+parentWinID+'_'+pageID+'_usergrouplist');var newIdSuffix=openerRef.childNodes.length+1;var item_template=$K.yg_makeTemplate($K.windows['wid_'+parentWinID].jsTemplate);var newRole=item_template.evaluate({item_index:newIdSuffix,new_id:role_id.split('-')[0],new_name:role_name});if((role_position!='')&&(role_position!='into')){var x=openerRef.childNodes;for(var i=0;i<x.length;i++){var actUsergroup=x[i].readAttribute('yg_id').split('-');actUsergroup=actUsergroup[0];if(actUsergroup==role_target){if(role_position=='before'){openerRef.childNodes[i].insert({before:newRole});i++;}
if(role_position=='after'){openerRef.childNodes[i].insert({after:newRole});}}}}else{openerRef.insert(newRole);}
$K.yg_customAttributeHandler(openerRef);$K.windows[$(openerRef).up('.ywindow').id].refresh($(openerRef));$K.initSortable(openerRef);}
$K.windows['wid_'+parentWinID].addFunction=$K.windows['wid_'+parentWinID].addUserGroup=function(openerRef,roleId,refresh){if($K.windows[openerRef].loadparams.yg_type=='mailing'){var mailingId=$K.windows[openerRef].yg_id.split('-')[0];var params={mode:'mailing',mailingId:mailingId,roleId:roleId,openerRefId:openerRef,refresh:refresh.toString()};}else{var userId=$K.windows[openerRef].yg_id.split('-')[0];var params={mode:'user',userId:userId,roleId:roleId,openerRefId:openerRef,refresh:refresh.toString()};}
var data=Array('noevent',{yg_property:'addUsergroup',params:params});$K.yg_AjaxCallback(data,'addUsergroup');}}
$K.yg_selectRole=function(winID,openerReference){var openerWid=$(openerReference).up('.ywindow').id;var focusobjs=$K.yg_getFocusObj($('wid_'+winID));var userIDs=new Array();if(focusobjs.length>0){focusobjs.each(function(item){userIDs.push(item.up('li').readAttribute('yg_id').split('-')[0]);});}else if($K.windows['wid_'+winID].yg_id!=undefined){var yg_id=$K.windows['wid_'+winID].yg_id;var userID=yg_id.split('-')[0];userIDs.push(userID);}
if(userIDs.length==0){$K.windows['wid_'+winID].remove();return;}
if(typeof $K.windows[openerWid].addUserGroup=='function'){userIDs.each(function(userIDItem){$K.windows[openerWid].addUserGroup(openerWid,userIDItem,true);});}
$K.windows['wid_'+winID].remove();}
$K.usergrouplistSortCallbacks={onUpdate:function(element){var listArray=Array();for(var i=0;i<element.childNodes.length;i++){var roleID=element.childNodes[i].readAttribute('yg_id').split('-');roleID=roleID[0];listArray.push(roleID);}
var parentWin=$K.windows[this.element.up('.ywindow').id];var siteID=parentWin.yg_id.split('-')[1];var objectID=parentWin.yg_id.split('-')[0];var data=Array('noevent',{yg_property:'orderObjectUsergroup',params:{objectID:objectID,site:siteID,listArray:listArray}});$K.yg_AjaxCallback(data,'orderObjectUsergroup');}};
;$K.yg_switchExtensionType=function(wndid,value,objecttype){container=$(wndid+'_innercontent').down(0);container.update('')
container.setStyle({width:'auto'})
container.addClassName('tab_loading');$K.windows[wndid].refresh();new Ajax.Updater(container,$K.appdir+'extension_info',{asynchronous:true,evalScripts:true,method:'post',insertion:'bottom',onComplete:function(){$K.yg_customAttributeHandler(container);container.removeClassName('tab_loading');$K.windows[wndid].refresh();},parameters:{extensiontype:value,objecttype:objecttype,mode:'refresh',us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId(),win_no:wndid.replace(/wid_/,'')}});}
$K.yg_saveExtensionProperties=function(winRef,extensionType,fromDataAdmin){var contentRef=$(winRef.id+'_PROPERTIES');var yg_id=$K.windows[winRef.id].yg_id.split('-')[0];var inputFields=contentRef.select('input','textarea');var propertiesData={}
inputFields.each(function(item){if(item.up('.checkbox')){var tSuffix=item.up('.checkbox').readAttribute('yg_property');}else{var tSuffix=item.readAttribute('yg_property');}
if(tSuffix){propertiesData['prop_'+tSuffix]=item.value;}});var data=Array('noevent',{yg_property:'setExtensionProperties',params:Object.extend({extension:yg_id,wid:winRef.id,propertiesData:propertiesData,extensionType:extensionType,fromDataAdmin:fromDataAdmin},propertiesData)});$K.yg_AjaxCallback(data,'setExtensionProperties');}
$K.yg_installExtension=function(buttonReference){var yg_id=$K.windows[$(buttonReference).up('.ywindow').id].yg_id.split('-')[0];var data=Array('noevent',{yg_property:'installExtension',params:{extension:yg_id,wid:$(buttonReference).up('.ywindow').id}});$K.yg_AjaxCallback(data,'installExtension');}
$K.yg_uninstallExtension=function(buttonReference){if(buttonReference.hasClassName('tree_btn_extension')){if(buttonReference.hasClassName('disabled')){return;}
var yg_id=$K.windows[$(buttonReference).up('.ywindow').id].yg_id.split('-')[0];}else{var itemReference=$(buttonReference).up('li');var yg_id=itemReference.readAttribute('yg_id').split('-')[0];}
var data=Array('noevent',{yg_property:'uninstallExtension',params:{extension:yg_id,wid:$(buttonReference).up('.ywindow').id}});$K.yg_AjaxCallback(data,'uninstallExtension');}
$K.yg_setExtensionInstalled=function(extensionId,windowId,setInstalled){windowId=windowId.replace(/wid_/,'');if(setInstalled){$('item_'+windowId+'_'+extensionId).down('.actionhover').down('.del').show();}else{$('item_'+windowId+'_'+extensionId).down('.actionhover').down('.del').hide();}}
$K.yg_addExtensionDialog=function(openerReference){new Ajax.Updater('dialogcontainer',$K.appdir+'window',{asynchronous:true,evalScripts:true,method:'post',insertion:'bottom',onComplete:function(){},parameters:{display:'extensions',opener_reference:$(openerReference).id,yg_id:$K.windows[openerReference.id].yg_id,wt:'dialog',ot:'extension',selectiondialog:true,us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}});}
$K.yg_initExtensionDataUploadButtons=function(winID,objectID){var uploadFieldIndex=1;var uploadFields=$('wid_'+winID+'_PROPERTIES').select('.mk_uploadpanel');uploadFields.each(function(item){if($K.uploadFramework=='swfuploader'){var swfuploadSettings=Object.clone($K.yg_SWFUploadSettings);Object.extend(swfuploadSettings,{upload_url:$K.appdir+'responder?handler=uploadExtensionImportData',flash_url:$K.jsdir+'3rd/swfupload/swfupload.swf',button_placeholder_id:item.down().id,button_height:"50",file_types:"*.*",file_types_description:"ImportData",custom_settings:{uploadButtonId:'wid_'+winID+'_okbutton',uploadTitle:'N/A',uploadType:'importData',fileID:objectID+'-'+item.readAttribute('yg_property'),winID:winID,timestamp:($('wid_'+winID+'_timestamp'))?($('wid_'+winID+'_timestamp').value):(0),autoUpload:false,extensionDataUpload:true},button_action:SWFUpload.BUTTON_ACTION.SELECT_FILE});$K.yg_SWFUploadObjects['wid_'+winID+'_'+uploadFieldIndex]=new SWFUpload(swfuploadSettings);}
if($K.uploadFramework=='plupload'){var customSettings={uploadButtonId:'wid_'+winID+'_okbutton',uploadTitle:'N/A',uploadType:'importData',fileID:objectID+'-'+item.readAttribute('yg_property'),winID:winID,timestamp:($('wid_'+winID+'_timestamp'))?($('wid_'+winID+'_timestamp').value):(0),autoUpload:false,extensionDataUpload:true};$K.yg_UploadInit('wid_'+winID+'_'+uploadFieldIndex,item.down().identify(),null,{handler:'uploadExtensionImportData'},customSettings,[],false,true);}
uploadFieldIndex++;});}
$K.yg_saveExtensionImportProperties=function(winRef){$K.yg_saveExtensionProperties(winRef,'data',true);new $K.yg_wndobj({config:'DATA_IMPORT',loadparams:{opener_reference:winRef.id}});}
$K.yg_saveExtensionExportProperties=function(winRef){$K.yg_saveExtensionProperties(winRef,'data',true);new $K.yg_wndobj({config:'DATA_EXPORT',loadparams:{opener_reference:winRef.id}});}
$K.yg_addImportExtensionFileId=function(filePrefix,uploadID,extensionId,uploadWinId){$('wid_'+uploadWinId+'_innercontent').select('li').each(function(item){if(item.readAttribute('yg_id')==uploadID+'-file'){item.filePrefix=filePrefix;item.extensionId=extensionId;}});}
$K.yg_setImportExtensionStatusOK=function(filePrefix,uploadWinId){$(uploadWinId+'_innercontent').select('li').each(function(item){if(item.filePrefix==filePrefix){item.removeClassName('uploadprocessing');item.addClassName('uploaddone');item.down('.uploadpercent').update('OK');}});}
$K.yg_setImportExtensionStatusERROR=function(filePrefix,uploadWinId,errorMessage){$(uploadWinId+'_innercontent').select('li').each(function(item){if(item.filePrefix==filePrefix){item.removeClassName('uploadprocessing');item.addClassName('uploaderror');item.down('.uploadpercent').update('ERROR');item.observe('mouseover',function(ev){$K.yg_showHelp(errorMessage);});item.observe('mouseout',function(ev){$K.yg_showHelp(false);});}});}
;$K.yg_initContentTab=function(ygID,displayMode,winID,objectType){if(!ygID)return;var pageID=ygID.split('-')[0];var siteID=ygID.split('-')[1];var contentareaIDList=$K.windows[winID].contentareaIDList;var contentareaIDListExt=$K.windows[winID].contentareaIDListExt;if(!contentareaIDList||!contentareaIDListExt)return;if(contentareaIDListExt.length==0){if($(winID+'_column2innercontentinner')){$K.windows[winID].refresh('col2');$(winID+'_column2innercontentinner').removeClassName('tab_loading');}
if($(winID+'_nocontentareas'))$(winID+'_nocontentareas').show();return;}
if($(winID+'_column2innercontentinner')){$(winID+'_column2innercontentinner').addClassName('tab_loading');}else{$(winID+'_ywindowinner').addClassName('tab_loading');}
var containments=new Array();$K.windows[winID].makeContentareasSortable=function(){contentareaIDList.each(function(contentareaID){containments.push(winID+'_scp_'+contentareaID+'_list');});var newcontainments=containments;containments.push(winID+'_co_contentarea_');if(displayMode=='dialog'){$A(Sortable.sortables[$K.windows[winID].loadparams.opener_reference].containment).each(function(cont_item){containments.push(cont_item);});}
containments=$A(containments).uniq();$K.log('Containments are now: ',containments,$K.Log.DEBUG);contentareaIDList.each(function(contentareaID){var srtId=winID+'_scp_'+contentareaID+'_list';var sortableAccepts='cblock,entrymask,pagesextras';var sortableObjectType='cblock';if(objectType=='cblock'){sortableAccepts='cblock,entrymask,pagesextras';}else if(objectType=='extpage'){sortableAccepts='extpage';sortableObjectType='extpage';}else if(objectType=='extcblock'){sortableAccepts='extcblock';sortableObjectType='extcblock';}else if(objectType=='extfile'){sortableAccepts='extfile';sortableObjectType='extfile';}else if(objectType=='extmailing'){sortableAccepts='extmailing';sortableObjectType='extmailing';}
Sortable.create(srtId,{accepts:sortableAccepts,objectType:sortableObjectType,dropOnEmpty:true,constraint:false,yg_clone:(displayMode=='dialog')?(true):(false),ghosting:true,starteffect:function(element){Draggable._dragging[element]=true;window.$ordersubmitted=false;},endeffect:function(element){Draggable._dragging[element]=false},onUpdate:function(element){if(element.select('li.loading_placeholder').length>0){return;}
$K.yg_fireLateOnChange();if(displayMode!='dialog'){var chldElements=$A($(element).childNodes);var realChldElements=new Array();$(chldElements).each(function(item){if(item.nodeType==1)realChldElements.push($(item));});chldElements=realChldElements;$K.log('99########',chldElements,$K.Log.DEBUG);if(!window.$ordersubmitted){var cnt_scp_list=new Object();var hasDupes=false;containments.each(function(carea){var cnt_scp_items=new Array();if((!Object.isUndefined($(carea)))&&($(carea)!=null)){var chldElems=$A($(carea).childNodes);if(chldElems){chldElems.each(function(cblock){if(cblock.nodeName=='LI'&&cblock.readAttribute('yg_id')){if(cblock.id.startsWith('clone%%emblock')){cnt_scp_items.push(['emblock',cblock.readAttribute('yg_id').split('-')[0]]);}else{cnt_scp_items.push([cblock.readAttribute('yg_id').split('-')[0],cblock.id.split('_')[4]]);}}});}}
if(carea!=winID+'_co_contentarea_'){var cblockIdList=new Array();cnt_scp_items.each(function(itm){cblockIdList.push(itm[0]);});var firstCblockCount=cblockIdList.length;cblockIdList=cblockIdList.uniq();var secondCblockCount=cblockIdList.length;if(firstCblockCount!=secondCblockCount){hasDupes=true;}
cnt_scp_list[carea.split('_')[3]]=cnt_scp_items;}});$K.log($K.yg_activeDragInfo,$K.Log.DEBUG);if(objectType=='page'){var backendAction='orderPageContentblock';}else if(objectType=='mailing'){var backendAction='orderMailingContentblock';}if(objectType=='cblock'){var backendAction='orderEditContentblock';}
if($K.yg_activeDragInfo.origElement&&$K.yg_activeDragInfo.origElement.up('.ywindow')&&$K.yg_activeDragInfo.origElement.up('.ywindow').hasClassName('ydialog')){var origElement=$K.yg_activeDragInfo.origElement;if($K.windows[origElement.up('.ywindow').id]&&$K.windows[origElement.up('.ywindow').id].tab=='copy'){var data=Array('noevent',{yg_property:backendAction,params:{page:pageID,site:siteID,winID:winID.split('_')[1],mode:'copy',newcolists:Object.toJSON(cnt_scp_list)}});}else{var data=Array('noevent',{yg_property:backendAction,params:{page:pageID,site:siteID,winID:winID.split('_')[1],mode:'',newcolists:Object.toJSON(cnt_scp_list)}});}}else{var data=Array('noevent',{yg_property:backendAction,params:{page:pageID,site:siteID,winID:winID.split('_')[1],mode:'',newcolists:Object.toJSON(cnt_scp_list)}});}
if((objectType!='page')&&(objectType!='mailing'))hasDupes=false;if(hasDupes){$K.yg_promptbox('Error',$K.TXT('TXT_DUPLICATE_CBLOCK'),'alert',function(){Koala.windows[winID].tabs.select(Koala.windows[winID].tabs.selected,{refresh:1});});window.$ordersubmitted=true;}else{$K.log('data:',cnt_scp_list,$K.Log.DEBUG);$K.yg_AjaxCallback(data,backendAction);window.$ordersubmitted=true;}
return;}
$K.windows[winID].refresh("col1");}}});});$K.log('Makesortable finished!',$K.Log.DEBUG);}
var contentData=new Array();contentareaIDListExt.each(function(contentareaInfo){contentareaInfo.list.each(function(contentareaInfoList){contentData.push(Array(contentareaInfoList.id,contentareaInfo.code,contentareaInfo.id,contentareaInfoList.linkid));$K.log('Loading contentblock "'+contentareaInfoList.name+' ('+contentareaInfoList.id+' ['+contentareaInfoList.linkid+'])" into contentarea "'+contentareaInfo.name+' ('+contentareaInfo.code+')"...',$K.Log.DEBUG);});});if($(winID+'_column2innercontentinner')&&(contentareaIDListExt.length==0)){$(winID+'_column2innercontentinner').removeClassName('tab_loading');$K.windows[winID].refresh('col2');}
var data_cnt=contentData.length;if((siteID!='')&&(pageID!='')){$K.windows[winID].allContentareasLoaded=function(objects,onFinish,real_parent){if($(winID+'_column2innercontentinner')){$(winID+'_column2innercontentinner').removeClassName('tab_loading');}else{$(winID+'_ywindowinner').removeClassName('tab_loading');}
var temp_element=temp_element2='';if(displayMode!='dialog'){contentareaIDList.each(function(contentareaID){temp_element=$(winID+'_panel'+contentareaID);temp_element2=temp_element.down('ul');temp_element.setStyle({display:'block'});$K.yg_customAttributeHandler(temp_element);temp_element2.cleared=undefined;});}else{winID=real_parent.up('.ywindow').id.replace(/wid_/,'');if(!$(winID+'_column2innercontentinner')){$(winID+'_innercontent').down('.mk_contentgroup').childElements().each(function(elem){temp_element=elem;temp_element2=temp_element.down('ul');temp_element.setStyle({display:'block'});$K.yg_customAttributeHandler(temp_element);temp_element2.cleared=undefined;});}else{$(winID+'_column2innercontentinner').down().childElements().each(function(elem){elem.show();$K.yg_customAttributeHandler(elem);});$K.windows[winID].refresh("col2");$(winID+'_column2innercontentinner').removeClassName('tab_loading');}}
if(real_parent){if(!real_parent.hasClassName('mk_nowrite')&&(real_parent.up('.ywindow').down('.ywindowinner'))&&(typeof $K.windows[real_parent.up('.ywindow').id].makeContentareasSortable=='function')){$K.windows[real_parent.up('.ywindow').id].makeContentareasSortable();}}else{$K.windows[winID].makeContentareasSortable();}
$K.windows[winID].refresh("col1");if(real_parent){$K.windows[real_parent.up('.ywindow').id].refresh("col1");}
if(real_parent){var innerContent=real_parent.up('.innercontent');var contentImages=innerContent.select('td.elemcontent img');contentImages.each(function(item){var handleImage=true;var hasWidth=false;var hasHeight=false;for(var j=0;j<item.attributes.length;j++){if(item.attributes[j].nodeName=='width')hasWidth=true;if(item.attributes[j].nodeName=='height')hasHeight=true;}
if(item.style.width!='')hasWidth=true;if(item.style.height!='')hasHeight=true;if(hasWidth&&hasHeight){handleImage=false;}
if(handleImage){$(item).observe('load',function(event){$K.windows[winID].refresh("col1");if(real_parent){$K.windows[real_parent.up('.ywindow').id].refresh("col1");}});}});}
if(typeof onFinish=='function')onFinish();}
$K.windows[winID].getContentareaDataFuncs=function(objects,backend,onFinish){data_cnt=objects.length;var rel_contentareas=new Object;for(var k=0;k<objects.length;k++){rel_contentareas[objects[k][2]]=objects[k][2];}
if(backend){var displaymode='';}else{if(displayMode=='dialog'){var displaymode='dialog';}else{var displaymode='';}}
new Ajax.Request($K.appdir+'cblocks',{asynchronous:true,method:'post',parameters:{site:siteID,page:pageID,objecttype:objectType,win_no:this.num,displaymode:displaymode,data:Object.toJSON(objects),us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()},onComplete:function(transport){var contentarea_id=0;var real_parent=null;var dataHolder=document.createElement('DIV');dataHolder.innerHTML=transport.responseText;dataHolder=$(dataHolder);var children=dataHolder.childElements();for(var j=0;j<children.length;j++){if(children[j].tagName!='UL')continue;contentarea_id=parseInt(children[j].readAttribute('yg_id').split('-')[0]);real_parent=$(winID+'_scp_'+contentarea_id+'_list');if(real_parent==null){$K.log('Inserting from Dialog into normal Window...',$K.Log.DEBUG);if($(winID)){var openerWin=$(winID).openerWin;}else{var openerWin=window.lastOpenerWin;}
real_parent=$(openerWin+'_scp_'+contentarea_id+'_list');}
if(!real_parent.cleared){real_parent.cleared=true;}
real_parent.select('li.loading_placeholder').each(function(liItem){liItem.remove();});var item=children[j].firstDescendant();$K.log('before check of skipitems',$K.Log.DEBUG);var skip_item=false;var curr_items=real_parent.childElements();for(var c=0;c<curr_items.length;c++){var old_lnkid=curr_items[c].id.split('_')[4];var new_lnkid=item.id.split('_')[4];if(old_lnkid==new_lnkid){skip_item=curr_items[c];}}
if(skip_item==false){$K.log('Trying to insert ',item,' into ',real_parent,$K.Log.DEBUG);real_parent.insert(item);if((Prototype.Version=='1.6.0.2')&&((Prototype.Browser.IE)||(Prototype.Browser.WebKit))&&item.down('script')){$K.warn('WORKAROUND FOR SAFARI/IE "evalScripts()" Bug.. (1)',$K.Log.DEBUG);item.select('script').each(function(script_item){eval(script_item.innerHTML);});}}else{$K.log('Trying to insert (skip_item) ',skip_item,' into ',real_parent,$K.Log.DEBUG);real_parent.insert(skip_item);if((Prototype.Version=='1.6.0.2')&&((Prototype.Browser.IE)||(Prototype.Browser.WebKit))&&skip_item.down('script')){$K.warn('WORKAROUND FOR SAFARI/IE "evalScripts()" Bug.. (2)',$K.Log.DEBUG);skip_item.select('script').each(function(script_item){eval(script_item.innerHTML);});}}
data_cnt--;$K.log('data_cnt: ',data_cnt,item.getAttribute('yg_id'),$K.Log.DEBUG);if(!backend){if(data_cnt==0){$K.windows[winID].allContentareasLoaded(objects,onFinish,real_parent);}}}
if(!backend){if(children.length<=1){if(real_parent){$K.windows[winID].allContentareasLoaded(objects,onFinish,real_parent);}else{$K.windows[winID].allContentareasLoaded(objects,onFinish,$(winID).down('ul'));}}}else{$K.windows[winID].allContentareasLoaded(objects,onFinish,real_parent);}}});}
$K.windows[winID].getContentareaDataFuncs(contentData);$K.windows[winID].addContentBlock=function(contentblockId,contentareaID,refresh){var site=this.yg_id.split('-')[1];contentblockId=contentblockId.split('-')[0];var data=Array('noevent',{yg_property:'addPageContentblock',params:{page:pageID,site:site,contentblockId:contentblockId,contentareaID:contentareaID,openerRefID:this.num,refresh:refresh.toString()}});$K.yg_AjaxCallback(data,'addPageContentblock');}
$K.windows[winID].addEntryMask=function(entrymaskId,contentareaID,refresh){var site=this.yg_id.split('-')[1];entrymaskId=entrymaskId.split('-')[0];var backendAction='addPageEntrymask';if(objectType=='cblock'){backendAction='addCBlockEntrymask';}
var data=Array('noevent',{yg_property:backendAction,params:{page:pageID,site:site,entrymaskId:entrymaskId,contentareaID:contentareaID,openerRefID:this.num,refresh:refresh.toString()}});$K.yg_AjaxCallback(data,backendAction);}
$K.windows[winID].addFunction=$K.windows[winID].addContentPositioned=function(objectID,targetId,targetPosition,refresh,openerRef,type,sourceElement){if(Object.isUndefined(refresh))refresh=false;if(objectID.substring(0,5)=="dummy")objectID=objectID.substring(5,objectID.length);var contentareaID=openerRef.split('_')[3];var site=this.yg_id.split('-')[1];var copymode=false;if(type=="cblock"){var backendFunction='addPageContentblock';if(sourceElement){var winId=sourceElement.up('.ywindow').id;var treeMode=$K.windows[winId].loadparams.treemode;if((treeMode=='pages')||(treeMode=='pages_with_cblocks')){objectID=sourceElement.id.split('_')[3];}
var srcWinId='wid_'+sourceElement.id.split('_')[1];if($K.windows[srcWinId]&&$K.windows[srcWinId].tabs.selected==2){copymode=true;}}
if(site=='cblock'){backendFunction='addEditContentblock';}}else if(type=="entrymask"){var backendFunction='addPositionedPageEntrymask';if(objectID.split('-')[1]=='emblock'){copymode=true;}
if(site=='cblock'){var backendFunction='addPositionedControlEntrymask';}}
var data=Array('noevent',{yg_property:backendFunction,params:{page:pageID,site:site,copymode:copymode,entrymaskId:objectID.split('-')[0],contentblockId:objectID.split('-')[0],contentareaID:contentareaID,openerRefID:this.num,targetId:targetId,targetPosition:targetPosition,refresh:refresh.toString()}});$K.yg_AjaxCallback(data,backendFunction);}}
if(contentareaIDList.length==0){$(winID+'_ywindowinner').removeClassName('tab_loading');}
$K.windows[winID].addTagtoFormfield=function(targetFormfield,sourceYgID,sourceName){$K.yg_editControl($(targetFormfield).down('.title_txt'),'8',true,{yg_id:sourceYgID,title:sourceName,href:'',target:''});$K.yg_fadeField($(targetFormfield));};$K.windows[winID].addPagetoFormfield=function(targetFormfield,sourceYgID,sourceName){if($(targetFormfield).hasClassName('mk_page')){$K.yg_editControl($(targetFormfield).down('.title_txt'),'15',true,{yg_id:sourceYgID,title:sourceName,objecttype:'page'});}else{$K.yg_editControl($(targetFormfield).down('.title_txt'),'5',true,{yg_id:sourceYgID,title:sourceName,objecttype:'page'});}
$K.yg_fadeField($(targetFormfield));};$K.windows[winID].addContentblocktoFormfield=function(targetFormfield,sourceYgID,sourceName){$K.yg_editControl($(targetFormfield).down('.title_txt'),'7',true,{yg_id:sourceYgID,title:sourceName});$K.yg_fadeField($(targetFormfield).down().up('.maskedit'));};if($K.windows[winID].type=='dialog'){$K.yg_updatePreviewUrls(winID,$K.windows[winID].url);}}
$K.yg_createSortableContentareas=function(winID,coContentarea){coContentarea=winID+'_co_contentarea_'+coContentarea;Sortable.create(coContentarea,{accepts:'none',objectType:'cblock',dropOnEmpty:true,constraint:false,ghosting:true,yg_clone:true,starteffect:function(element){Draggable._dragging[element]=true;window.$ordersubmitted=false;},endeffect:function(element){Draggable._dragging[element]=false},onUpdate:function(element){var temp_wid=$(coContentarea).id.split('_')[1];var temp_selNode=$K.windows['wid_'+coContentarea.split('_')[1]].yg_id;}});}
$K.yg_removeLoadingPlaceholder=function(){$$('li.loading_placeholder').each(function(liItem){liItem.remove();});}
;$K.previewRefreshInt=false;$K.yg_preview=function(params){if(params.onload){if($('ygpreviewclosediv'))$('ygpreviewclosediv').remove();params.fullscreen=true;}
if(params.objecttype=="file"){if(params.fullscreen){$('previewcontainer').setStyle({display:'block'});$('filepreview').setStyle({display:'block'});$('filepreview').addClassName("tab_loading");$('filepreviewcontainer').setStyle({visibility:'visible'});new Draggable($('filepreviewcontainer'),{});$('filepreviewwrap').innerHTML="";$('filepreviewwrap').appendChild(previmg=document.createElement('img'));config="PREVIEW_FULLSCREEN_FILE";}else{config="PREVIEW_WINDOW_FILE";}
if(!params.crop)params.crop=false;if(!params.onload)params.onload=false;var data={objecttype:params.objecttype,objectid:params.id,view:params.view,version:params.version,crop:params.crop,zoom:params.zoom,onload:params.onload}
wndobj=new $K.yg_wndobj({config:config,loadparams:data});if(!params.fullscreen)$(wndobj.id).hide();}
if(params.objecttype=="page"){data={objecttype:params.objecttype,site:params.site,objectid:params.id,version:params.version}
wndobj=new $K.yg_wndobj({config:'PREVIEW_FULLSCREEN_PAGE',loadparams:data});$(wndobj.id).hide();$('previewcontainer').setStyle({display:'block'});$('previewcontainer').addClassName("page");$('previewiframe').setStyle({display:'block'});previewurl=params.url;if(params.version){previewurl+="?version="+params.version+"&";}else{previewurl+="?";}
previewurl+="nocache=true";$('previewiframe').src=previewurl;}
if(params.objecttype=="mailing"){data={objecttype:params.objecttype,objectid:params.id,version:params.version}
wndobj=new $K.yg_wndobj({config:'PREVIEW_FULLSCREEN_MAILING',loadparams:data});$(wndobj.id).hide();$('previewcontainer').setStyle({display:'block'});$('previewcontainer').addClassName("page");$('previewiframe').setStyle({display:'block'});previewurl=$K.appdir+"mailing/"+params.id+"?";if(params.version)previewurl+="&version="+params.version;previewurl+="&nocache=true";$('previewiframe').src=previewurl;}
if(params.objecttype=="cblock"){alert("PREVIEWING CBLOCK");}}
$K.yg_switchPreviewVersion=function(params){window.clearTimeout($K.previewRefreshInt);switch(params.objecttype){case'mailing':previewurl=$K.appdir+"mailing/"+params.id;if(params.version)previewurl+="?version="+params.version;$('previewiframe').src=previewurl;break;case'page':if($('previewiframe').src.indexOf('?')>-1){previewurl=$('previewiframe').src.split("?")[0];}else{previewurl=$('previewiframe').src;}
if(params.version)previewurl+="?version="+params.version;$('previewiframe').src=previewurl;break;case'file':var data=Array('noevent',{params:params});if(params.fullscreen){$('filepreviewwrap').innerHTML="";$('filepreview').addClassName('tab_loading');}else{$('wid_'+params.win+'_innercontent').down().innerHTML="";$K.windows['wid_'+params.win].refresh();$('wid_'+params.win+'_innercontent').addClassName('tab_loading');}
$K.yg_AjaxCallback(data,'refreshFileVersionDetails');break;}}
$K.yg_switchPreviewView=function(params){window.clearTimeout($K.previewRefreshInt);view=params.view.split('#!#!#')[0];viewtype=params.view.split('#!#!#')[1];if((viewtype==null)||(viewtype=="null")||(viewtype=="")){$K.yg_switchPreviewVersion({objecttype:'file',win:params.win,id:params.id,fullscreen:params.fullscreen,crop:params.crop,zoom:params.zoom,view:view,version:params.version,url:params.url});}else{$K.yg_renderFilePreview({id:params.id,view:view,version:params.version,viewtype:viewtype,zoom:params.zoom,win:params.win,fullscreen:params.fullscreen,url:params.url});}}
$K.yg_switchPreviewZoom=function(params){if(params.fullscreen){obj=$('filepreviewwrap').down('img');}else{obj=$('wid_'+params.win+'_innercontent').down(1);}
obj.writeAttribute('zoomlevel',params.zoom);newwidth=Math.round(parseInt(obj.readAttribute('origwidth'))*params.zoom/100);newheight=Math.round(parseInt(obj.readAttribute('origheight'))*params.zoom/100);obj.setStyle({width:newwidth+'px'});obj.setStyle({height:newheight+'px'});if(params.fullscreen){if($K.yg_cropInstance!=false){$K.yg_cropPreview(params.win,false,params.zoom);$K.yg_cropPreview(params.win,false,params.zoom);$K.yg_cropZoom=params.zoom;}
$K.yg_centerPreview();}else{$K.windows['wid_'+params.win].refresh();}}
$K.yg_updateFilePreview=function(id,version,views,zoom,win,fullscreen,versions,url){if(!($("wid_"+win)))return;views=views.evalJSON();if(versions&&(versions!='false')&&(versions!='null')){versions=versions.evalJSON();if(versions[0]){$K.yg_dropdownInsert($("wid_"+win+"_ddversion"),versions[0]["TITLE"],versions[0]["VERSION"],true,'top');}}
$("wid_"+win+"_ddview_ddlist").down().innerHTML="";for(var i=0;i<views.length;i++){title=views[i]["NAME"];if(views[i]["IDENTIFIER"]=="YGSOURCE")title=$K.TXT('TXT_SOURCEFILE');title+=": ";if((views[i]["WIDTH"]!=0)&&(views[i]["WIDTH"]!=null)){title+=views[i]["WIDTH"]}else{title+="[-]";}
title+=" x ";if((views[i]["HEIGHT"]!=0)&&(views[i]["HEIGHT"]!=null)){title+=views[i]["HEIGHT"]}else{title+="[-]";}
value=views[i]["IDENTIFIER"]+"#!#!#"+views[i]["VIEWTYPE"]+"#!#!#"+views[i]["WIDTH"]+"#!#!#"+views[i]["CONSTRAINWIDTH"]+"#!#!#"+views[i]["HEIGHT"]+"#!#!#"+views[i]["CONSTRAINHEIGHT"];selected=false;if(views[i]["SEL"])selected=true;$K.yg_dropdownInsert($("wid_"+win+"_ddview"),title,value,selected);if(views[i]["SEL"]){$K.yg_renderFilePreview({id:id,url:url,view:views[i]["IDENTIFIER"],version:version,viewtype:views[i]["VIEWTYPE"],zoom:$("wid_"+win+"_ddzoom").down().next('input').value,win:win,fullscreen:fullscreen,viewwidth:views[i]["WIDTH"],constrainwidth:views[i]["CONSTRAINWIDTH"],viewheight:views[i]["HEIGHT"],constrainheight:views[i]["CONSTRAINHEIGHT"]});}}
$K.yg_initDropdown($("wid_"+win+"_ddview"));}
$K.yg_renderFilePreview=function(params){if((params.fullscreen==undefined)||(params.fullscreen==null))params.fullscreen=false;if(params.fullscreen){$('filepreviewwrap').innerHTML="";$('filepreview').addClassName('tab_loading');$('filepreviewcontainer').writeAttribute('yg_draggable','false');$('filepreviewcontainer').addClassName('nodrag');}else{$('wid_'+params.win+'_innercontent').down().innerHTML="";$('wid_'+params.win+'_innercontent').addClassName('tab_loading');}
if($("wid_"+params.win+"_croplink")){$("wid_"+params.win+"_croplink").removeClassName("disabled");}
if($("wid_"+params.win+"_downloadlink")&&params.url){$("wid_"+params.win+"_downloadlink").removeClassName("disabled");$("wid_"+params.win+"_downloadlink").onclick=function(){};$("wid_"+params.win+"_downloadlink").writeAttribute("href",params.url+"?version="+params.version);}
if((params.viewtype==null)||(params.viewtype=="null")||(params.viewtype=="")){if(params.fullscreen){$('filepreviewwrap').innerHTML=$('wid_'+params.win+'_notgenerated').innerHTML;$('filepreviewwrap').addClassName('nopreview');$('filepreview').removeClassName('tab_loading');$K.yg_centerPreview();}else{$('wid_'+params.win+'_innercontent').down().innerHTML=$('wid_'+params.win+'_notgenerated').innerHTML;$('wid_'+params.win+'_innercontent').removeClassName('tab_loading');}
if($("wid_"+params.win+"_downloadlink")){$("wid_"+params.win+"_downloadlink").onclick=function(ev){Event.stop(ev);}
$("wid_"+params.win+"_downloadlink").addClassName("disabled");$("wid_"+params.win+"_downloadlink").writeAttribute("href","");}
if($("wid_"+params.win+"_croplink")){$("wid_"+params.win+"_croplink").addClassName("disabled");}
params.objecttype='file';$K.previewRefreshInt=$K.yg_switchPreviewVersion.delay(1,params);}else if(parseInt(params.viewtype)==0){if(params.fullscreen){$('filepreviewwrap').innerHTML=$('wid_'+params.win+'_nopreview').innerHTML;$('filepreviewwrap').addClassName('nopreview');$('filepreview').removeClassName('tab_loading');$K.yg_centerPreview();}else{$('wid_'+params.win+'_innercontent').down().innerHTML=$('wid_'+params.win+'_nopreview').innerHTML;$('wid_'+params.win+'_innercontent').removeClassName('tab_loading');}
if($("wid_"+params.win+"_downloadlink")){$("wid_"+params.win+"_downloadlink").onclick=function(ev){Event.stop(ev);}
$("wid_"+params.win+"_downloadlink").addClassName("disabled");$("wid_"+params.win+"_downloadlink").writeAttribute("href","");}
if($("wid_"+params.win+"_croplink")){$("wid_"+params.win+"_croplink").addClassName("disabled");}}else if(parseInt(params.viewtype)==1){if((params.view!="YGSOURCE")&&($("wid_"+params.win+"_ddversion_ddlist"))&&(params.version!=$("wid_"+params.win+"_ddversion_ddlist").down().down().readAttribute("value"))){if($("wid_"+params.win+"_croplink")){$("wid_"+params.win+"_croplink").addClassName("disabled");}}
previewurl=$K.appdir+"image/"+params.id;if((params.view!="YGSOURCE")&&(params.crop!=true))previewurl+="/"+params.view;if(params.version)previewurl+="/?version="+params.version+"&rnd="+Math.random()*10000000;if(params.fullscreen){$('filepreviewwrap').innerHTML="";$('filepreviewwrap').appendChild(tmpimg=document.createElement('img'));}else{$('wid_'+params.win+'_innercontent').down().innerHTML="";$('wid_'+params.win+'_innercontent').down().addClassName("filepreviewcontainer");$('wid_'+params.win+'_innercontent').down().appendChild(tmpimg=document.createElement('img'));}
tmpimg.src=previewurl;tmpimg.writeAttribute("zoomlevel",params.zoom);tmpimg.writeAttribute("fullscreen",params.fullscreen);tmpimg.writeAttribute("win",params.win);if(params.crop==undefined)params.crop=false;tmpimg.writeAttribute("crop",params.crop);tmpimg.onload=function(){$K.yg_filePreviewLoaded(this,this.readAttribute('win'),this.readAttribute('zoomlevel'),this.readAttribute('fullscreen'));if(this.readAttribute('crop'))$K.yg_cropPreview(this.readAttribute('win'),true);}
tmpimg.hide();tmpimg.addClassName("mk_verticalcenter");}
$K.windows['wid_'+params.win].refresh();}
$K.yg_filePreviewLoaded=function(obj,win,zoom,fullscreen){var tmpImage=new Image();tmpImage.src=obj.src;obj.writeAttribute("origwidth",tmpImage.width);obj.writeAttribute("origheight",tmpImage.height);dim={width:Math.round(tmpImage.width*zoom/100),height:Math.round(tmpImage.height*zoom/100)};obj.setStyle({width:dim.width+'px'});obj.setStyle({height:dim.height+'px'});delete tmpImage;obj.show();if(fullscreen){$('filepreview').removeClassName('tab_loading');$K.yg_centerPreview();$('filepreviewcontainer').writeAttribute('yg_draggable','true');$('filepreviewwrap').removeClassName('nopreview');$('filepreviewcontainer').removeClassName('nodrag');}else{if($('wid_'+win+'_innercontent'))$('wid_'+win+'_innercontent').removeClassName('tab_loading');$K.windows['wid_'+win].refresh();}
if($('wid_'+win+'_ddzoom')){$('wid_'+win+'_ddzoom').down(0).next('input').value=zoom}}
$K.yg_initDlgFilePreview=function(winID,filename,fileid,filecolor,filetypecode,filewidth,fileheight,fileview,fileversion,crop){$K.yg_showHelp('');viewportdims=document.viewport.getDimensions();if(filewidth!=0){filewidth+=50;fileheight+=150;if(filewidth>(viewportdims.width-200))filewidth=viewportdims.width-200;if(filewidth<$K.windows['wid_'+winID].minwidth)filewidth=$K.windows['wid_'+winID].minwidth;if(fileheight<$K.windows['wid_'+winID].minheight)fileheight=$K.windows['wid_'+winID].minheight;if(fileheight>(viewportdims.height-160))fileheight=viewportdims.height-160;$K.windows['wid_'+winID].boxwidth=filewidth;$K.windows['wid_'+winID].boxheight=fileheight;$K.windows['wid_'+winID].init();}
if($('wid_'+winID).descendantOf($('previewcontainer'))==false)$K.yg_centerWindow($('wid_'+winID));$('wid_'+winID).show();$K.windows['wid_'+winID].cancel=function(){$K.yg_cropPreview(winID);}
$K.windows['wid_'+winID].yg_id=fileid+"-file";$K.windows['wid_'+winID].setCaption(filename,'file');$K.windows['wid_'+winID].setFileType('<span class="filetype '+filecolor+'" yg_type="file" yg_id="'+fileid+'-file" yg_property="type">'+filetypecode+'</span>');}
$K.yg_closePreview=function(){if($K.cookiedomain!=''){top.document.cookie='version=; domain='+$K.cookiedomain+'; path='+$K.webroot+'; expires=Thu, 01-Jan-1970 00:00:01 GMT';}else{top.document.cookie='version=; path='+$K.webroot+'; expires=Thu, 01-Jan-1970 00:00:01 GMT';}
$('previewcontainer').setStyle({display:'none'});$('previewcontainer').removeClassName("page");var wins=$('previewcontainer').immediateDescendants();wins.each(function(item){if($(item).hasClassName('ywindow')){if($K.windows[item.id])$K.windows[item.id].remove();}});if($('filepreview').getStyle("display")=="block"){$('filepreview').setStyle({display:'none'});if($('yg_filepreviewimg'))$('yg_filepreviewimg').remove();}
if($('previewiframe').getStyle("display")=="block"){$('previewiframe').src="";$('previewiframe').setStyle({display:'none'});}}
$K.yg_centerPreview=function(){if($('previewcontainer')&&($('previewcontainer').getStyle('display')=='block')){obj=$('filepreviewcontainer');objdims=obj.getDimensions();viewportdims=document.viewport.getDimensions();if((objdims.width>viewportdims.width)||(objdims.height>viewportdims.height)){}
leftpos=Math.round((viewportdims.width-objdims.width)/2);toppos=Math.round((viewportdims.height-objdims.height)/2);obj.setStyle({left:leftpos+'px'});obj.setStyle({top:toppos+'px'});}}
$K.yg_cropInstance=false;$K.yg_cropCoords=new Array();$K.yg_cropZoom=100;$K.yg_cropPreview=function(win,cropping,zooming){if($K.yg_cropInstance==false){$('wid_'+win).removeClassName('mk_filepreviewer');$('wid_'+win).addClassName('mk_filecropper');$('croppreviewarea').hide();obj=$('filepreviewwrap').down();viewdetails=$('wid_'+win+'_ddview').down(0).next('input').value.split('#!#!#');viewwidth=$K.yg_cropCoords["width"]=viewdetails[2];constrainwidth=$K.yg_cropCoords["constrainwidth"]=viewdetails[3];viewheight=$K.yg_cropCoords["height"]=viewdetails[4];constrainheight=$K.yg_cropCoords["constrainheight"]=viewdetails[5];if(($('wid_'+win+'_ddview').down(0).next('input').value.split('#!#!#')[0]!="YGSOURCE")&&(cropping!=true)){$K.yg_renderFilePreview({id:$K.windows['wid_'+win].yg_id.split('-')[0],view:$('wid_'+win+'_ddview').down(0).next('input').value.split('#!#!#')[0],version:$('wid_'+win+'_ddversion').down(0).next('input').value,viewtype:$('wid_'+win+'_ddview').down(0).next('input').value.split('#!#!#')[1],zoom:$('wid_'+win+'_ddzoom').down(0).next('input').value,win:win,fullscreen:true,crop:true,viewwidth:viewwidth,constrainwidth:constrainwidth,viewheight:viewheight,constrainheight:constrainheight});return;}
minwidth=10;minheight=10;function onEndCrop(coords){$K.yg_cropCoords["x1"]=coords.x1;$K.yg_cropCoords["y1"]=coords.y1;$K.yg_cropCoords["x2"]=coords.x2;$K.yg_cropCoords["y2"]=coords.y2;$K.yg_renderCropCoords();}
ratiodimarr=new Array();maxratiodimarr=new Array();loadcoordsarr=false;cropparams=new Array();cropparams.displayOnInit=true;cropparams.onEndCrop=onEndCrop;cropparams.minWidth=minwidth;cropparams.minHeight=minheight;previewwidth=previewheight=0;if(zooming>0){cropparams.onloadCoords=new Array();cropparams.onloadCoords.x1=parseInt($K.yg_cropCoords["x1"])/(parseInt($K.yg_cropZoom)/100)*zooming/100;cropparams.onloadCoords.y1=parseInt($K.yg_cropCoords["y1"])/(parseInt($K.yg_cropZoom)/100)*zooming/100;cropparams.onloadCoords.x2=parseInt($K.yg_cropCoords["x2"])/(parseInt($K.yg_cropZoom)/100)*zooming/100;cropparams.onloadCoords.y2=parseInt($K.yg_cropCoords["y2"])/(parseInt($K.yg_cropZoom)/100)*zooming/100;$K.windows["wid_"+win].boxheight=$K.windows["wid_"+win].boxheight;}
if((constrainwidth==1)&&(constrainheight==1)){cropparams.ratioDim=new Array();cropparams.ratioDim.x=parseInt(viewwidth);cropparams.ratioDim.y=parseInt(viewheight);previewwidth=viewwidth;previewheight=viewheight;if((previewwidth>150)||(previewheight>150)){if(previewwidth>previewheight){previewwidth=150;previewheight=previewheight*150/previewwidth;}else{previewheight=150;previewwidth=previewwidth*150/previewheight;}}
cropparams.previewWidth=previewwidth;cropparams.previewHeight=previewheight;cropparams.previewWrap='previewArea';$('croppreviewarea').show();}else if(((constrainwidth==0)&&(constrainheight==1))||((constrainwidth==1)&&(constrainheight==0))){cropparams.maxRatioDim=new Array();cropparams.maxRatioDim.x=parseInt(viewwidth);cropparams.maxRatioDim.y=parseInt(viewheight);}else{if(!(zooming)){zoom=$('wid_'+win+'_ddzoom').down(0).next('input').value;conwidth=viewwidth*(zoom/100)-60;conheight=viewheight*(zoom/100)-60;viewportdims=document.viewport.getDimensions();if(conwidth>=(viewportdims.width-60))conwidth=viewportdims.width-60;if(conheight>=(viewportdims.height-60))conheight=viewportdims.height-60;if(conwidth<=minwidth)conwidth=minwidth;if(conheight<=minheight)conheight=minheight;if(conwidth>(viewwidth*(zoom/100)-60))conwidth=viewwidth*(zoom/100);if(conheight>(viewheight*(zoom/100)-60))conheight=viewheight*(zoom/100);cropparams.onloadCoords=new Array();cropparams.onloadCoords.x1=((viewwidth*(zoom/100)-conwidth)/2);cropparams.onloadCoords.y1=((viewheight*(zoom/100)-conheight)/2);cropparams.onloadCoords.x2=((viewwidth*(zoom/100)-conwidth)/2)+conwidth;cropparams.onloadCoords.y2=((viewheight*(zoom/100)-conheight)/2)+conheight;}}
if((!(zooming))&&(previewheight>0)){$K.windows["wid_"+win].boxheight=parseInt($K.windows["wid_"+win].minheight)+parseInt(previewheight);$K.windows["wid_"+win].init();}
$K.yg_cropInstance=new Cropper.ImgWithPreview(obj,cropparams);$K.yg_renderCropCoords();}else{$('wid_'+win).addClassName('mk_filepreviewer');$('wid_'+win).removeClassName('mk_filecropper');$K.windows["wid_"+win].boxheight=$K.windows["wid_"+win].minheight;$K.windows["wid_"+win].init();$K.yg_cropInstance.remove();$K.yg_cropInstance=false;if(($('wid_'+win+'_ddview').down(0).next('input').value.split('#!#!#')[0]!="YGSOURCE")&&(!(zooming))){$K.yg_renderFilePreview({id:$K.windows['wid_'+win].yg_id.split('-')[0],view:$('wid_'+win+'_ddview').down(0).next('input').value.split('#!#!#')[0],version:$('wid_'+win+'_ddversion').down(0).next('input').value,viewtype:$('wid_'+win+'_ddview').down(0).next('input').value.split('#!#!#')[1],zoom:$('wid_'+win+'_ddzoom').down(0).next('input').value,win:win,fullscreen:true,crop:false});}}}
$K.yg_submitCrop=function(winID){$('filepreview').addClassName('tab_loading');$('filepreviewcontainer').writeAttribute('yg_draggable','false');$('filepreviewcontainer').addClassName('nodrag');$K.yg_cropPreview(winID);$('filepreviewwrap').innerHTML="";var data=Array('noevent',{params:{objecttype:'file',win:winID,id:$K.windows['wid_'+winID].yg_id.split('-')[0],view:$('wid_'+winID+'_ddview').down(0).next('input').value.split('#!#!#')[0],version:$('wid_'+winID+'_ddversion').down(0).next('input').value,zoom:$('wid_'+winID+'_ddzoom').down(0).next('input').value,x1:$K.yg_cropCoords.x1,y1:$K.yg_cropCoords.y1,x2:$K.yg_cropCoords.x2,y2:$K.yg_cropCoords.y2}});$K.yg_AjaxCallback(data,'cropFile');}
$K.yg_renderCropCoords=function(){if($("yg_cropdim_dim")){zoom=$($("yg_cropdim_dim").up('.ywindow').id+'_ddzoom').down(0).next('input').value;width=Math.round((parseInt($K.yg_cropCoords["x2"])-parseInt($K.yg_cropCoords["x1"]))/zoom*100);height=Math.round((parseInt($K.yg_cropCoords["y2"])-parseInt($K.yg_cropCoords["y1"]))/zoom*100);if(($K.yg_cropCoords["constrainwidth"]=="1")&&($K.yg_cropCoords["constrainheight"]=="0")){height=Math.round(parseInt($K.yg_cropCoords["width"])/width*height);width=Math.round(parseInt($K.yg_cropCoords["width"]));}else if(($K.yg_cropCoords["constrainwidth"]=="0")&&($K.yg_cropCoords["constrainheight"]=="1")){width=Math.round(parseInt($K.yg_cropCoords["height"])/height*width);height=Math.round(parseInt($K.yg_cropCoords["height"]));}else if(($K.yg_cropCoords["constrainwidth"]=="1")&&($K.yg_cropCoords["constrainheight"]=="1")){width=Math.round(parseInt($K.yg_cropCoords["width"]));height=Math.round(parseInt($K.yg_cropCoords["height"]));}
$("yg_cropdim_dim").innerHTML=width+"x"+height;$("yg_cropdim_xy1").innerHTML=Math.round(parseInt($K.yg_cropCoords["x1"])/zoom*100)+":"+Math.round(parseInt($K.yg_cropCoords["y1"])/zoom*100);$("yg_cropdim_xy2").innerHTML=Math.round(parseInt($K.yg_cropCoords["x2"])/zoom*100)+":"+Math.round(parseInt($K.yg_cropCoords["y2"])/zoom*100);}}
;$K.yg_filterTrashcan=function(col,value,shorttitle,win,openerRef){$K.yg_pageDirReset(win);if(value=="CUSTOM"){new $K.yg_wndobj({config:'TRASHCAN_TIMEFRAME',loadparams:{opener_reference:openerRef,shorttitle:shorttitle,col:col}});}else{$(win+'_trashcanfilter_'+col).previous().down().innerHTML=shorttitle;$K.windows[win].loadparams['trashcanfilter_'+col]=value;var params=new Object();params.trashcanfilter_created=$K.windows[win].loadparams.trashcanfilter_created;params.trashcanfilter_removed=$K.windows[win].loadparams.trashcanfilter_removed;params.refresh=1;var window=$K.windows[win];var current_tab=window.tab;for(var i=0;i<window.tabs.elements.length;i++){if(window.tabs.elements[i]["NAME"]==current_tab)var current_tab_no=i;}
window.tabs.select(current_tab_no,params);}}
$K.yg_submitTrashcanTimeframe=function(winID,openerReference,shorttitle){var timeframevar=$('wid_'+winID+'_timeframe_from').value+"###"+$('wid_'+winID+'_timeframe_till').value;$K.yg_filterTrashcan(openerReference.split('_')[3],timeframevar,shorttitle,'wid_'+openerReference.split('_')[1],'wid_'+openerReference.split('_')[1]);$K.windows['wid_'+winID].remove();}
$K.yg_shredderObject=function(which){which=$(which);var objectType=which.readAttribute('yg_type');var winID=which.up('.ywindow').id;var focusobjs=$K.yg_getFocusObj(which.up('.mk_contentgroup'));var inselection=false;focusobjs.each(function(item){if(item==which){inselection=true;throw $break;}});if((focusobjs.length>0)&&inselection){var objectYGIDs=new Array();focusobjs.each(function(selObject){objectYGIDs.push(selObject.readAttribute('yg_id'));});var dlgText=focusobjs.length+' '+$K.TXT('TXT_OBJECTS');}else{var objectYGIDs=[which.readAttribute('yg_id')];var dlgText='1 '+$K.TXT('TXT_OBJECT');}
$K.yg_promptbox($K.TXT('TXT_APPROVE_DELETE_TITLE'),$K.TXT('TXT_APPROVE_DELETE_P1')+dlgText+$K.TXT('TXT_APPROVE_DELETE_P2'),'standard',function(){objectYGIDs.each(function(shredItem){var data=Array('noevent',{yg_property:'shredderObject',params:{yg_id:shredItem,yg_type:objectType,winID:winID}});$K.yg_AjaxCallback(data,'shredderObject');});},function(){});}
$K.yg_restoreObject=function(which){which=$(which);var objectType=which.up('.cntblockcontainer').readAttribute('yg_type');var objectYGID=which.up('.cntblockcontainer').readAttribute('yg_id');var winID=which.up('.ywindow').id;var focusobjs=$K.yg_getFocusObj(which.up('.mk_contentgroup'));if(focusobjs.length>1){var multiYGIDs=new Array();focusobjs.each(function(selObject){multiYGIDs.push(selObject.up('.cntblockcontainer').readAttribute('yg_id'));});$K.windows[winID].restore_yg_id=multiYGIDs;}else{$K.windows[winID].restore_yg_id=[objectYGID];}
console.warn('SELECTED:',$K.windows[winID].restore_yg_id);switch(objectType){case'page':new $K.yg_wndobj({config:'PAGE_MOVE',loadparams:{action:'restore',opener_reference:winID,site:objectYGID.split('-')[1]}});break;case'cblock':new $K.yg_wndobj({config:'CBLOCK_MOVE',loadparams:{action:'restore',opener_reference:winID}});break;case'file':new $K.yg_wndobj({config:'FILE_MOVE',loadparams:{action:'restore',opener_reference:winID,type:'file'}});break;}}
;$K.yg_templateSaveInfo=function(winRef){winRef=$(winRef);var inputFields=$(winRef.id+'_innercontent').select('input','textarea');var parameters={objectID:$K.windows[winRef.id].yg_id.split('-')[0],wid:winRef.id};var srch=new RegExp(winRef.id+'_');var hasError=false;inputFields.each(function(item){item.removeClassName('error');if(item.value.indexOf('-')!=-1){hasError=true;item.addClassName('error');}
var idxname=item.name.replace(srch,'');if(idxname)parameters[idxname]=item.value;if(item.name==winRef.id+'_template_identifier'){if(item.value.trim()==''){hasError=true;item.addClassName('error');}}});if(!hasError){var data=Array('noevent',{yg_property:'saveTemplateInfo',params:parameters});$K.yg_AjaxCallback(data,'saveTemplateInfo');}}
$K.yg_removeTemplatePreview=function(reference){var winRef=reference.up('.ywindow');var yg_id=$K.windows[winRef.id].yg_id.split('-')[0];var imgRef=reference.down('img');$(winRef.id+'_templatepreviewname').update($K.TXT('TXT_SELECTOR_PREVIEW_UPLOAD'));$(winRef.id+'_previewchanged').value='';imgRef.hide();imgRef.next().value='true';$K.yg_hilite('template',$K.windows[winRef.id].yg_id,'name',true);}
$K.yg_initTemplateUploadButtons=function(winID,objectID){if(!$('wid_'+winID+'_addtemplatebutton'))return;if($K.uploadFramework=='swfuploader'){var swfuploadSettings=Object.clone($K.yg_SWFUploadSettings);Object.extend(swfuploadSettings,{upload_url:$K.appdir+'responder?handler=uploadTemplate',flash_url:$K.jsdir+'3rd/swfupload/swfupload.swf',button_placeholder_id:'wid_'+winID+'_addtemplatebutton',file_types:"*",file_types_description:"Templates",custom_settings:{uploadButtonId:'wid_'+winID+'_okbutton',uploadTitle:'N/A',uploadType:'template',fileID:objectID,winID:winID,timestamp:($('wid_'+winID+'_timestamp'))?($('wid_'+winID+'_timestamp').value):(0),autoUpload:true},button_action:SWFUpload.BUTTON_ACTION.SELECT_FILE});var swfuploadSettings2=Object.clone($K.yg_SWFUploadSettings);Object.extend(swfuploadSettings2,{upload_url:$K.appdir+'responder?handler=uploadTemplatePreview',flash_url:$K.jsdir+'3rd/swfupload/swfupload.swf',button_placeholder_id:'wid_'+winID+'_addtemplatepreviewbutton',file_types:"*.jpg;*.jpeg;*.gif;*.png",file_types_description:"Images",custom_settings:{uploadButtonId:'wid_'+winID+'_okbutton',uploadTitle:'N/A',uploadType:'templatePreview',fileID:objectID,winID:winID,autoUpload:true},button_height:'2000',button_action:SWFUpload.BUTTON_ACTION.SELECT_FILE});$K.yg_SWFUploadObjects['wid_'+winID]=new SWFUpload(swfuploadSettings);$K.yg_SWFUploadObjects['wid_'+winID+'_2']=new SWFUpload(swfuploadSettings2);}
if($K.uploadFramework=='plupload'){var customSettings={uploadButtonId:'wid_'+winID+'_okbutton',uploadTitle:'N/A',uploadType:'template',fileID:objectID,winID:winID,timestamp:($('wid_'+winID+'_timestamp'))?($('wid_'+winID+'_timestamp').value):(0),autoUpload:true};$K.yg_UploadInit('wid_'+winID,'wid_'+winID+'_addtemplatebutton',null,{handler:'uploadTemplate'},customSettings,[{title:'Templates',extensions:'htm,html'}],false,true);var customSettings2={uploadButtonId:'wid_'+winID+'_okbutton',uploadTitle:'N/A',uploadType:'templatePreview',fileID:objectID,winID:winID,autoUpload:true};$K.yg_UploadInit('wid_'+winID+'_2','wid_'+winID+'_addtemplatepreviewbutton',null,{handler:'uploadTemplatePreview'},customSettings2,[{title:'Images',extensions:'jpg,jpeg,gif,png'}],false,true);}}
$K.yg_setTemplatePreviewPicture=function(winID,fileName,previewURL){if($('wid_'+winID+'_templatepreview')){$('wid_'+winID+'_templatepreviewname').update(fileName);$('wid_'+winID+'_templatepreview').src=previewURL;$('wid_'+winID+'_templatepreview').show();}}
$K.yg_setTemplateFileName=function(winID,fileName){if($('wid_'+winID+'_templatename')){$('wid_'+winID+'_templatename').update(fileName);}}
$K.yg_refreshTemplateconfig=function(which){which=$(which);$K.windows[which.up('.ywindow').id].refresh();var panelHeight=which.up('.cntblockcontainer').getHeight();var flashContainer=which.up('.cntblockcontainer').down('.mk_uploadpanel');flashContainer.setStyle({height:panelHeight+'px'});if(flashContainer.down('object'))flashContainer.down('object').setStyle({height:panelHeight+'px'});}
$K.yg_addTemplateChildFolder=function(templateref){if(templateref.hasClassName('tree_btn')){if(templateref.hasClassName('disabled'))return;var template=$K.windows[templateref.up('.ywindow').id].yg_id;}else{var wid=parseInt(templateref.up('.ywindow').id.replace(/wid_/g,''));var nodeid=templateref.id;var template=nlsTree['templates_tree'+wid+'_tree'].nLst[nodeid].yg_id;}
template=template.split('-')[0];var data=Array('noevent',{yg_property:'addTemplateChildFolder',params:{template:template}});$K.yg_AjaxCallback(data,'addTemplateChildFolder');}
$K.yg_changeNavigationName=function(which){which=$(which);var newNavValue=which.value;var navName=which.name.split('_')[3];$(which.up('.mk_contentgroup').down('.dropdownbox').id+"_ddlist").down().select('div').each(function(item){if(item.readAttribute('value').toLowerCase()==navName){item.update(newNavValue);if(item.hasClassName('selected')){which.up('.mk_contentgroup').down('.dropdowninner').down('input').value=newNavValue;}}});}
$K.yg_addTemplateContentareaField=function(winID,code){var container=$('wid_'+winID+'_contentareas_list');var templateLine=container.down('.mk_template').outerHTML;templateLine=templateLine.replace(/__FIELDNAME__/g,code.toLowerCase());templateLine=templateLine.replace(/__fieldname__/g,code.toLowerCase());templateLine=templateLine.replace(/__FIELDTITLE__/g,code);templateLine=templateLine.replace(/__fieldtitle__/g,code);templateLine=templateLine.replace(/display:none;/g,'');templateLine=templateLine.replace(/display: none;/g,'');container.insert(templateLine);container.previous().hide();container.show();$K.windows['wid_'+winID].refresh();}
$K.yg_removeTemplateContentareaField=function(winID,code){var container=$('wid_'+winID+'_contentareas_list');container.select('input').each(function(item){if(item.name=='wid_'+winID+'_contentarea_'+code.toLowerCase()+'_name'){item.up('li').remove();}});if(container.select('li').length==1){container.hide();container.previous().show();}
$K.windows['wid_'+winID].refresh();}
$K.yg_addTemplateNavigationField=function(winID,code,selected){var container=$('wid_'+winID+'_navigations');var templateLine=container.down('.mk_template').outerHTML;templateLine=templateLine.replace(/__FIELDNAME__/g,code.toLowerCase());templateLine=templateLine.replace(/__fieldname__/g,code.toLowerCase());templateLine=templateLine.replace(/__FIELDTITLE__/g,code);templateLine=templateLine.replace(/__fieldtitle__/g,code);templateLine=templateLine.replace(/display:none;/g,'');templateLine=templateLine.replace(/display: none;/g,'');container.insert(templateLine);container.previous().hide();container.show();$K.yg_dropdownInsert($('wid_'+winID+'_default_navigation'),code,code,false);if(selected){$('wid_'+winID+'_default_navigation').down('input').value=code;$('wid_'+winID+'_default_navigation').down('input[type=hidden]').value=code;}
$('wid_'+winID+'_navidropdown').show();$K.windows['wid_'+winID].refresh();}
$K.yg_updateTemplateIdentifier=function(which){which=$(which);var winRef=which.up('.ywindow');if($(winRef.id+'_template_identifier').value.strip()==''){var newName=which.value.strip();newName=newName.replace(/ /g,'_');newName=newName.replace(/&/g,'');newName=newName.replace(/\//g,'_');$(winRef.id+'_template_identifier').value=newName;}}
$K.yg_removeTemplateNavigationField=function(winID,code){var container=$('wid_'+winID+'_navigations');container.select('input').each(function(item){if(item.name=='wid_'+winID+'_navigation_'+code.toLowerCase()+'_name'){item.up('tr').remove();}});$($('wid_'+winID+'_default_navigation').id+"_ddlist").down('.dropdownlist').select('div').each(function(item){if(item.readAttribute('value').toLowerCase()==code.toLowerCase()){item.remove();return;}
if(item.value&&item.value.toLowerCase()==code.toLowerCase()){item.remove();return;}});if(container.select('tr').length==1){container.hide();$('wid_'+winID+'_navidropdown').hide();container.previous().show();}
$K.windows['wid_'+winID].refresh();}
$K.yg_checkTemplatePName=function(element){var value=element.value;if(!element.oldvalue){element.oldvalue=element.readAttribute('oldvalue');}
if(value.strip()==''){element.value=element.oldvalue;$K.yg_promptbox($K.TXT('TXT_CHANGE_TEMPLATE_IDENTIFIER'),$K.TXT('TXT_CHANGE_TEMPLATE_IDENTIFIER_EMPTY'),'alert');return false;}
return true;}
$K.yg_addTemplate=function(templateref){if(templateref.hasClassName('tree_btn')){if(templateref.hasClassName('disabled'))return;var template=$K.windows[templateref.up('.ywindow').id].yg_id;}else{var wid=parseInt(templateref.up('.ywindow').id.replace(/wid_/g,''));var nodeid=templateref.id;var template=nlsTree['templates_tree'+wid+'_tree'].nLst[nodeid].yg_id;}
template=template.split('-')[0];var data=Array('noevent',{yg_property:'addTemplate',params:{template:template}});$K.yg_AjaxCallback(data,'addTemplate');}
$K.yg_actionDeleteTemplate=function(which,multi){$K.yg_deleteElement(which.up(2).reference,multi);}
$K.yg_actionAddTemplateFolder=function(which){$K.yg_addTemplateChildFolder(which.up(2).reference);}
$K.yg_actionAddTemplate=function(which){$K.yg_addTemplate(which.up(2).reference);}
;$K.yg_initSiteList=function(winID){var winRef=$('wid_'+winID);$K.windows['wid_'+winID].sortList=function(){var container=$('wid_'+winID+'_tab_SITELIST_list');var listEntries=container.select('li');var sortList=new Array();listEntries.each(function(listItem){var itemName=listItem.down('.title.txt').innerHTML.toUpperCase();var itemID=listItem.id;sortList.push(itemName+'<<||>>'+itemID);});sortList.sort();sortList.each(function(listItem){var itemID=listItem.split('<<||>>')[1];container.insert({bottom:$(itemID)});});}}
$K.yg_initSiteConfig=function(parentWinID){$K.windows['wid_'+parentWinID].changeTemplate=function(templateId){var siteID=$K.windows['wid_'+parentWinID].yg_id.split('-')[0];var data=Array('noevent',{yg_property:'setSiteTemplate',params:{siteID:siteID,templateId:templateId,openerRefID:parentWinID}});$K.yg_AjaxCallback(data,'setSiteTemplate');}
$K.windows['wid_'+parentWinID].refreshSiteTemplate=function(name,filename,templateid,preview){var panelRef=$('wid_'+parentWinID+'_templatepanel').down('.mk_templatecontainer');if(panelRef){panelRef.up('.cntblockcontainer').down('input').value=templateid;new Ajax.Updater(panelRef,$K.appdir+'template_info/',{onComplete:function(){panelRef.next().hide();panelRef.show();$K.windows['wid_'+parentWinID].refresh();},asynchronous:true,evalScripts:true,method:'post',parameters:{template:templateid,mode:'details',us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}});}else{$K.log('Panel not there, nothing to update...',$K.Log.INFO);}}
$K.windows['wid_'+parentWinID].changeTemplateRoot=function(templateId){var siteID=$K.windows['wid_'+parentWinID].yg_id.split('-')[0];var data=Array('noevent',{yg_property:'setSiteTemplateRoot',params:{siteID:siteID,templateId:templateId,openerRefID:parentWinID}});$K.yg_AjaxCallback(data,'setSiteTemplateRoot');}
$K.windows['wid_'+parentWinID].refreshSiteTemplateRoot=function(templateId,name){var panelRef=$('wid_'+parentWinID+'_templaterootpanel');if(panelRef){panelRef.down('input').value=templateId;panelRef.down('.icn').className="icn iconfolder"
panelRef.down('.titlecnt').update(name);$K.windows['wid_'+parentWinID].refresh();}else{$K.log('Panel not there, nothing to update...',$K.Log.INFO);}}}
$K.yg_siteSaveInfo=function(winRef){winRef=$(winRef);var inputFields=$(winRef.id+'_innercontent').select('input');var parameters={objectID:$K.windows[winRef.id].yg_id.split('-')[0],wid:winRef.id};var srch=new RegExp(winRef.id+'_');inputFields.each(function(item){var idxname=item.name.replace(srch,'');if(idxname)parameters[idxname]=item.value;});var data=Array('noevent',{yg_property:'saveSiteInfo',params:parameters});$K.yg_AjaxCallback(data,'saveSiteInfo');}
$K.yg_resetSiteDefaulttemplate=function(which){which=$(which);which.up('.cntblockcontainer').down('.icn').className="icn noicon";which.up('.cntblockcontainer').down('.mk_templatecontainer').hide();which.up('.cntblockcontainer').down('.mk_templatecontainer').next().show();which.up('.cntblockcontainer').down('input').value=-1;}
$K.yg_resetSiteTemplateroot=function(which){which=$(which);which.up('.cntblockcontainer').down('.icn').className="icn noicon";which.up('.cntblockcontainer').down('.titlecnt').innerHTML=$K.TXT('TXT_SELECTOR_FOLDER');which.up('.cntblockcontainer').down('input').value=-1;}
$K.yg_addSite=function(buttonReference){if(buttonReference.hasClassName('disabled')){return;}
var data=Array('noevent',{yg_property:'addSite',params:{wid:$(buttonReference).up('.ywindow').id}});$K.yg_AjaxCallback(data,'addSite');}
$K.yg_addSiteItem=function(winID,siteID,siteName){if($K.windows[winID]&&$K.windows[winID].jsTemplate){var item_template=$K.yg_makeTemplate($K.windows[winID].jsTemplate);var newSiteItem=item_template.evaluate({new_id:siteID,new_name:siteName});$(winID+'_tab_SITELIST_list').insert({bottom:newSiteItem});$K.windows[winID].sortList();$K.yg_customAttributeHandler($('sites_'+winID.split('_')[1]+'_'+siteID));$K.windows[winID].refresh();$K.yg_selectNode($('sites_'+siteID+'_selector'));$K.yg_blockSelect($('sites_'+siteID+'_selector'),null);}}
$K.yg_checkSitePName=function(element){var value=element.value;if(!element.oldvalue){element.oldvalue=element.readAttribute('oldvalue');}
if(value.strip()==''){element.value=element.oldvalue;$K.yg_promptbox($K.TXT('TXT_CHANGE_SITE_URL_TITLE'),$K.TXT('TXT_CHANGE_SITE_URL_EMPTY'),'alert');return false;}
if(!isNaN(value)){element.value=element.oldvalue;$K.yg_promptbox($K.TXT('TXT_CHANGE_SITE_URL_TITLE'),$K.TXT('TXT_CHANGE_SITE_URL_NUMERIC'),'alert');return false;}
return true;}
;$K.yg_submitContentEditor=function(winID,formfield,saveOnly){tinyMCE.triggerSave();if($(formfield)){if(formfield.endsWith('comment')){var src_content=$(formfield).down('.mk_longcomment');}else{var src_content=$(formfield).down('.textbox');}
src_content.innerHTML=$('textarea_'+winID).value;src_content.realHTML=$('textarea_'+winID).value;src_content.select('img').each(function(imageItem){$(imageItem).observe('load',function(event){$K.windows[src_content.up('.ywindow').id].refresh("col1");});});}
if($K.windows['wid_'+winID].loadparams.commentMode){var loadParams=$K.windows['wid_'+winID].loadparams;if($K.windows['wid_'+winID].loadparams.commentMode=='edit'){if($(formfield)){var longComment=$('textarea_'+winID).value.stripScripts();var shortComment=$('textarea_'+winID).value.stripScripts().stripTags().truncate(336,'...');if(longComment!=shortComment){if(!$(formfield).down('div.less').down('a.cmtcontrol')){$(formfield).down('div.less').insert('<a onclick="$K.yg_toggleComment(this, event);" class="cmtcontrol">'+$K.TXT('TXT_MORE')+'</a>');}
if(!$(formfield).down('div.more').down('a.cmtcontrol')){$(formfield).down('div.more').insert('<a onclick="$K.yg_toggleComment(this, event);" class="cmtcontrol">'+$K.TXT('TXT_LESS')+'</a>');}}else{if($(formfield).down('.commentpost').hasClassName('more')){$(formfield).down('.commentpost').removeClassName('more');$(formfield).down('.commentpost').addClassName('less');}
if($(formfield).down('div.less').down('a.cmtcontrol')){$(formfield).down('div.less').down('a.cmtcontrol').remove();}
if($(formfield).down('div.more').down('a.cmtcontrol')){$(formfield).down('div.more').down('a.cmtcontrol').remove();}}
$(formfield).down('.mk_shortcomment').update(shortComment);$(formfield).down('.mk_longcomment').update(longComment);}
var saveOptions={winID:loadParams.openerWinID,yg_type:loadParams.openerType,yg_id:loadParams.openerYgID,commentID:loadParams.commentID,commentText:$('textarea_'+winID).value};$K.yg_saveComment(saveOptions);$K.yg_fadeField(src_content.up('.cntblockcontainer'));}else if($K.windows['wid_'+winID].loadparams.commentMode=='add'){var saveOptions={winID:loadParams.openerWinID,yg_type:loadParams.openerType,yg_id:loadParams.openerYgID,parentCommentID:loadParams.parentCommentID,commentText:$('textarea_'+winID).value};$K.yg_addComment(saveOptions);}}else if($(formfield)&&formfield.endsWith('property')){$K.yg_setObjectProperty(src_content);$K.yg_fadeField(src_content.up('.cntblock'));src_content.next('textarea').value=$('textarea_'+winID).value;}else if($(formfield)){$K.yg_editControl(src_content,3);$K.yg_fadeField(src_content.up('.maskedit'));}
if(src_content){$K.windows[src_content.up('.ywindow').id].refresh("col1");}
if(!saveOnly){$K.windows['wid_'+winID].remove();}}
$K.yg_defaultTinyMCEButtonLayout=[{group1:['bold','italic','underline','strikethrough','sub','sup','removeformat'],group2:['image','media'],group3:['table','row_props','cell_props','merge_cells','split_cells'],group4:['cut','copy','paste','code','replace'],group5:['styleselect']},{group1:['justifyleft','justifycenter','justifyright','justifyfull','bullist','numlist','outdent','indent'],group2:['hr'],group3:['row_before','row_after','delete_row','col_before','col_after','delete_col'],group4:['link','unlink','anchor','cleanup'],group5:['formatselect']}];$K.yg_tinyMCEOptions={mode:'none',theme:'yeager',plugins:'safari,style,yeager_table,save,paste,advhr,yeager_advlink,yeager_media,yeager_searchreplace,yeager_contextmenu,noneditable,visualchars,template,inlinepopups',theme_advanced_buttons1:'bold,italic,underline,strikethrough,sub,sup,|,removeformat,||,image,media,||,table,row_props,cell_props,merge_cells,split_cells,|,||,cut,copy,paste,code,replace,||,styleselect',theme_advanced_buttons2:'justifyleft,justifycenter,justifyright,justifyfull,bullist,numlist,outdent,indent,||,hr,||,|,row_before,row_after,delete_row,col_before,col_after,delete_col ,||,link,unlink,anchor,cleanup,||,formatselect',theme_advanced_customscrollbars:false,doctype:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',extended_valid_elements:'iframe[*],embed[*],object[*],param[*],a[*]',media_strict:false,add_form_submit_trigger:false,submit_patch:false,cleanup_on_startup:true,force_br_newlines:false,force_p_newlines:false,forced_root_block:false,cleanup:true,entity_encoding:'named',entities:'160,nbsp',relative_urls:false,urlconverter_callback:'$K.yg_urlCallback',save_onsavecallback:'$K.yg_saveContenteditor',debug:false,init_instance_callback:'$K.yg_onInitCE',handle_node_change_callback:'yeagerCEnodeChange'}
$K.yg_generateTinyMCEToolbar=function(configString){if(configString.indexOf('tables')!=-1){configString=configString.replace(/tables/,'table,row_props,cell_props,merge_cells,split_cells,row_before,row_after,delete_row,col_before,col_after,delete_col');}
if(configString.indexOf('alignment')!=-1){configString=configString.replace(/alignment/,'justifyleft,justifycenter,justifyright,justifyfull');}
if(configString.indexOf('links')!=-1){configString=configString.replace(/links/,'link,unlink');}
var configStringArray=configString.replace(/ /,'').split(',');var groupsCount=new Array();for(var i=0;i<$K.yg_defaultTinyMCEButtonLayout.length;i++){for(var groupName in $K.yg_defaultTinyMCEButtonLayout[i]){if(groupsCount[i]==undefined)groupsCount[i]={};$K.yg_defaultTinyMCEButtonLayout[i][groupName].each(function(buttonItem){if(configStringArray.indexOf(buttonItem)!=-1){if(groupsCount[i][groupName]==undefined){groupsCount[i][groupName]=0;}
groupsCount[i][groupName]++;}});}}
var targetGroupsCount={};for(var groupName in groupsCount[0]){var maxButtonsInGroup=0;for(var i=0;i<groupsCount.length;i++){if(groupsCount[i][groupName]>maxButtonsInGroup){maxButtonsInGroup=groupsCount[i][groupName];}}
targetGroupsCount[groupName]=maxButtonsInGroup;}
var buttonsLine1=new Array();for(var groupName in $K.yg_defaultTinyMCEButtonLayout[0]){var buttonsInGroup=0;$K.yg_defaultTinyMCEButtonLayout[0][groupName].each(function(buttonItem){if(configStringArray.indexOf(buttonItem)!=-1){buttonsLine1.push(buttonItem);buttonsInGroup++;}});if((buttonsInGroup>0)&&(buttonsInGroup<targetGroupsCount[groupName])){for(var i=0;i<(targetGroupsCount[groupName]-buttonsInGroup);i++){buttonsLine1.push('|');}}
if(buttonsInGroup>0){buttonsLine1.push('||');}}
var buttonsLine2=new Array();for(var groupName in $K.yg_defaultTinyMCEButtonLayout[1]){var buttonsInGroup=0;$K.yg_defaultTinyMCEButtonLayout[1][groupName].each(function(buttonItem){if(configStringArray.indexOf(buttonItem)!=-1){buttonsLine2.push(buttonItem);buttonsInGroup++;}});if((buttonsInGroup>0)&&(buttonsInGroup<targetGroupsCount[groupName])){for(var i=0;i<(targetGroupsCount[groupName]-buttonsInGroup);i++){buttonsLine2.push('|');}}
if(buttonsInGroup>0){buttonsLine2.push('||');}}
if(buttonsLine1.last()=='||')buttonsLine1.pop();if(buttonsLine2.last()=='||')buttonsLine2.pop();buttonsLine1=buttonsLine1.join(',')
buttonsLine2=buttonsLine2.join(',');var blockFormats='p,address,pre,h1,h2,h3,h4,h5,h6';var blockFormatsArray=new Array();blockFormats.split(',').each(function(optionItem){if(configStringArray.indexOf(optionItem)!=-1){blockFormatsArray.push(optionItem);}});blockFormats=blockFormatsArray.join(',');var output={theme_advanced_buttons1:buttonsLine1,theme_advanced_buttons2:buttonsLine2,theme_advanced_blockformats:blockFormats};return output;}
$K.yg_initContenteditor=function(winID,formfield,configString,customCSS){var currentTinyMCEOptions=$K.yg_tinyMCEOptions;if(!configString){configString='bold,italic,underline,strikethrough,sub,sup,removeformat,image,media,tables,code,pasteword,alignment,bullist,numlist,outdent,indent,hr,tables,links,anchor,cleanup,replace,p,address,pre,h1,h2,h3,h4,h5,h6,formatselect,styleselect';}
Object.extend(currentTinyMCEOptions,$K.yg_generateTinyMCEToolbar(configString));if(customCSS&&(customCSS!='')&&customCSS.endsWith('.css')){Object.extend(currentTinyMCEOptions,{content_css:customCSS});}
if($K.lang!=''){Object.extend(currentTinyMCEOptions,{lang:$K.lang,setup:function(ed){ed.onMouseUp.add(function(ed,e){window.parent.Koala.yg_customSortableOnDrop(ed);});}});}
tinyMCE.init(currentTinyMCEOptions);$K.windows['wid_'+winID].onResize=function(){if(tinyMCE.editors['textarea_'+winID]&&tinyMCE.editors['textarea_'+winID].theme.YeagerTheme){tinyMCE.editors['textarea_'+winID].theme.resizeTo((this.boxwidth-44),(this.boxheight-90));}}
$('textarea_'+winID).setStyle({width:($K.windows['wid_'+winID].boxwidth-44)+'px'});$('textarea_'+winID).setStyle({height:($K.windows['wid_'+winID].boxheight-107)+'px'});var src_content,contentHTML;if($(formfield)){if(formfield.endsWith('comment')){src_content=$(formfield).down('.mk_longcomment');}else{src_content=$(formfield).down('.textbox');if(!src_content)src_content=$(formfield).down('.changed');}
contentHTML=src_content.innerHTML;contentHTML=contentHTML.replace(/%C2%A7%C2%A7/g,'');if(contentHTML.toLowerCase()==$K.TXT('TXT_CHOOSE_SELECTOR'))contentHTML='';$('textarea_'+winID).value=contentHTML;}
tinyMCE.execCommand('mceAddControl',false,'textarea_'+winID);window.setTimeout(function(){innerDoc=$('textarea_'+winID+'_ifr').contentDocument||$('textarea_'+winID+'_ifr').contentWindow.document;if(innerDoc&&innerDoc.addEventListener){innerDoc.addEventListener('mousemove',function(e){if(window.parent&&window.parent.Koala)window.parent.Koala.yg_checkIframeDrop(winID,Event.pointerX(e),Event.pointerY(e));});}},1000);}
$K.yg_initCEEmbedded=function(winID){var origData=$K.windows['wid_'+winID].ceData;var jsEncode=function(s){s=s.replace(new RegExp('\\\\','g'),'\\\\');s=s.replace(new RegExp('"','g'),'\\"');s=s.replace(new RegExp("'",'g'),"\\'");return s;};var setBool=function(pl,p,n){if(typeof(pl[n])=='undefined')
return;if(pl[n]){document.forms['wid_'+winID+'_linkForm'].elements[p+"_"+n].value='1';$(document.forms['wid_'+winID+'_linkForm'].elements[p+"_"+n]).up().className='checkboxiconsel';}else{document.forms['wid_'+winID+'_linkForm'].elements[p+"_"+n].value='0';$(document.forms['wid_'+winID+'_linkForm'].elements[p+"_"+n]).up().className='checkboxicon';}};var getBool=function(p,n,d,tv,fv){if(!tv)tv='true';if(!fv)fv='false';var v=(document.forms['wid_'+winID+'_linkForm'].elements[p+"_"+n].value==1);return(v==d)?'':n+(v?':'+tv+',':':'+fv+',');};var getStr=function(p,n,d){var e=document.forms['wid_'+winID+'_linkForm'].elements[(p!=null?p+"_":"")+n];if((e.type=='text')||(e.type=='hidden')){var v=e.value}else{var v;}
if(n=='src'){v=tinyMCE.activeEditor.convertURL(v,'src',null);}
return((n==d||v=='')?'':n+":'"+jsEncode(v)+"',");};var setStr=function(pl,p,n){var f=document.forms['wid_'+winID+'_linkForm'],e=f.elements[(p!=null?p+"_":'')+n];if(typeof(pl[n])=='undefined')
return;if(e&&(e.type=="text")){e.value=pl[n];}else{if(pl[n]!=''){if(f.elements[(p!=null?p+"_":'')+n]){$K.yg_dropdownSelect(f.elements[(p!=null?p+"_":'')+n],false,pl[n],true);}}}};var getInt=function(p,n,d){var e=document.forms['wid_'+winID+'_linkForm'].elements[(p!=null?p+"_":"")+n];if((e.type=='text')||(e.type=='hidden')){var v=e.value;}else{var v;}
return((n==d||v=='')?'':n+":"+v.replace(/[^0-9]+/g,'')+",");};var changedType=function(t){$('flash_options').hide();$('qt_options').hide();$('shockwave_options').hide();$('wmp_options').hide();if(t){$(t+'_options').show();}
$K.windows["wid_"+winID].refresh("col1");};window.changedType=changedType;yeagerCE_saveSelection();var pl='',f,val;var type='flash',fe,i;ed=tinyMCE.activeEditor;f=document.forms['wid_'+winID+'_linkForm'];fe=ed.selection.getNode();type=origData.type;switch(type){default:case'flash':$K.yg_dropdownSelect($('dd_types'),false,'flash',true);changedType('flash');setBool(origData.params,'flash','play');setBool(origData.params,'flash','loop');setBool(origData.params,'flash','menu');setBool(origData.params,'flash','swliveconnect');setStr(origData.params,'flash','quality');setStr(origData.params,'flash','scale');setStr(origData.params,'flash','salign');setStr(origData.params,'flash','wmode');setStr(origData.params,'flash','base');setStr(origData.params,'flash','flashvars');break;case'shockwave':$K.yg_dropdownSelect($('dd_types'),false,'shockwave',true);changedType('shockwave');setBool(origData.params,'shockwave','sound');setBool(origData.params,'shockwave','progress');setBool(origData.params,'shockwave','autostart');setBool(origData.params,'shockwave','swliveconnect');setStr(origData.params,'shockwave','swvolume');setStr(origData.params,'shockwave','swstretchstyle');setStr(origData.params,'shockwave','swstretchhalign');setStr(origData.params,'shockwave','swstretchvalign');break;case'quicktime':$K.yg_dropdownSelect($('dd_types'),false,'qt',true);changedType('qt');setBool(origData.params,'qt','loop');setBool(origData.params,'qt','autoplay');setBool(origData.params,'qt','cache');setBool(origData.params,'qt','controller');setBool(origData.params,'qt','correction');setBool(origData.params,'qt','enablejavascript');setBool(origData.params,'qt','kioskmode');setBool(origData.params,'qt','autohref');setBool(origData.params,'qt','playeveryframe');setBool(origData.params,'qt','tarsetcache');setStr(origData.params,'qt','scale');setStr(origData.params,'qt','starttime');setStr(origData.params,'qt','endtime');setStr(origData.params,'qt','tarset');setStr(origData.params,'qt','qtsrcchokespeed');setStr(origData.params,'qt','volume');setStr(origData.params,'qt','qtsrc');break;case'windowsmedia':$K.yg_dropdownSelect($('dd_types'),false,'wmp',true);changedType('wmp');setBool(origData.params,'wmp','autostart');setBool(origData.params,'wmp','enabled');setBool(origData.params,'wmp','enablecontextmenu');setBool(origData.params,'wmp','fullscreen');setBool(origData.params,'wmp','invokeurls');setBool(origData.params,'wmp','mute');setBool(origData.params,'wmp','stretchtofit');setBool(origData.params,'wmp','windowlessvideo');setStr(origData.params,'wmp','balance');setStr(origData.params,'wmp','baseurl');setStr(origData.params,'wmp','captioningid');setStr(origData.params,'wmp','currentmarker');setStr(origData.params,'wmp','currentposition');setStr(origData.params,'wmp','defaultframe');setStr(origData.params,'wmp','playcount');setStr(origData.params,'wmp','rate');setStr(origData.params,'wmp','uimode');setStr(origData.params,'wmp','volume');break;}
setStr(origData.params,null,'src');setStr(origData,null,'id');setStr(origData,null,'name');setStr(origData,null,'vspace');setStr(origData,null,'hspace');setStr(origData,null,'bgcolor');setStr(origData,null,'align');setStr(origData,null,'width');setStr(origData,null,'height');serializeParameters=function(){var d=document,f=document.forms['wid_'+winID+'_linkForm'],s='';switch(f.dd_types.value){case'flash':s+=getBool('flash','play',false);s+=getBool('flash','loop',false);s+=getBool('flash','menu',false);s+=getBool('flash','swliveconnect',false);s+=getStr('flash','scale');s+=getStr('flash','wmode');break;case'qt':s+=getBool('qt','loop',false);s+=getBool('qt','autoplay',false);s+=getBool('qt','cache',false);s+=getBool('qt','controller',false);s+=getBool('qt','kioskmode',false);s+=getBool('qt','autohref',false);s+=getBool('qt','playeveryframe',false);s+=getBool('qt','targetcache',true);break;case'shockwave':s+=getBool('shockwave','sound',false);s+=getBool('shockwave','progress',false);s+=getBool('shockwave','autostart',false);s+=getBool('shockwave','swliveconnect',false);s+=getStr('shockwave','swstretchstyle');s+=getStr('shockwave','swstretchhalign');s+=getStr('shockwave','swstretchvalign');break;case'wmp':s+=getBool('wmp','autostart',false);s+=getBool('wmp','enabled',false);s+=getBool('wmp','enablecontextmenu',false);s+=getBool('wmp','fullscreen',false);s+=getBool('wmp','invokeurls',false);s+=getBool('wmp','mute',false);s+=getBool('wmp','stretchtofit',false);s+=getBool('wmp','windowlessvideo',false);break;}
s+=getStr(null,'id');s+=getStr(null,'name');s+=getStr(null,'src');s+=getStr(null,'align');s+=getInt(null,'vspace');s+=getInt(null,'hspace');s+=getStr(null,'width');s+=getStr(null,'height');s=s.length>0?s.substring(0,s.length-1):s;return s;};$K.windows['wid_'+winID].submitCE_embedded=function(){var fe,f=document.forms['wid_'+winID+'_linkForm'],h;winID=this.num;yeagerCE_restoreSelection();f.width.value=f.width.value==''?100:f.width.value;f.height.value=f.height.value==''?100:f.height.value;var myData={params:{},video:{}};myData.width=f.width.value;myData.height=f.height.value;myData.name=f.name.value;myData.id=f.id.value;myData.align=$(f.dd_align).up('.dropdownbox').down('input[type=hidden]').value;myData.hspace=f.hspace.value;myData.vspace=f.vspace.value;switch(f.dd_types.value){default:case'flash':myData.type='flash';myData.params.play=f.flash_play.value;myData.params.loop=f.flash_loop.value;myData.params.menu=f.flash_menu.value;myData.params.swliveconnect=f.flash_swliveconnect.value;myData.params.wmode=f.flash_wmode.value;myData.params.scale=f.flash_scale.value;break;case'shockwave':myData.type='shockwave';myData.params.autostart=f.shockwave_autostart.value;myData.params.sound=f.shockwave_sound.value;myData.params.progress=f.shockwave_progress.value;myData.params.swliveconnect=f.shockwave_swliveconnect.value;myData.params.swstretchstyle=f.shockwave_swstretchstyle.value;myData.params.swstretchhalign=f.shockwave_swstretchhalign.value;myData.params.swstretchvalign=f.shockwave_swstretchhalign.value;break;case'qt':myData.type='quicktime';myData.params.autoplay=f.qt_autoplay.value;myData.params.loop=f.qt_loop.value;myData.params.cache=f.qt_cache.value;myData.params.controller=f.qt_controller.value;myData.params.kioskmode=f.qt_kioskmode.value;myData.params.playeveryframe=f.qt_playeveryframe.value;myData.params.targetcache=f.qt_cache.value;myData.params.autohref=f.qt_autohref.value;break;case'wmp':myData.type='windowsmedia';myData.params.autostart=f.wmp_autostart.value;myData.params.enabled=f.wmp_enabled.value;myData.params.fullscreen=f.wmp_fullscreen.value;myData.params.mute=f.wmp_mute.value;myData.params.stretchtofit=f.wmp_stretchtofit.value;myData.params.invokeurls=f.wmp_invokeurls.value;myData.params.windowlessvideo=f.wmp_windowlessvideo.value;myData.params.enablecontextmenu=f.wmp_enablecontextmenu.value;break;}
myData.params.src=f.src.value;ed.execCommand('mceRepaint');yeagerCE_restoreSelection();ed.selection.setNode(ed.plugins.yeager_media.dataToImg(myData));$K.windows['wid_'+winID].remove();}}
$K.yg_initCEFindReplace=function(winID){var ed=tinyMCE.activeEditor;var search_string=ed.selection.getContent({format:'text'});var f=document.forms['wid_'+winID+'_linkForm'];var t=winID;var m=$K.windows['wid_'+winID].tab;yeagerCE_saveSelection();var win=$('wid_'+winID);var lf,f,lt=$K.windows['wid_'+winID].lastTab;yeagerCE_restoreSelection();if(lt!=m){if(!lt)lt='CONTENTEDITOR_FIND';f=document.forms['wid_'+winID+'_linkForm_'+m];lf=document.forms['wid_'+winID+'_linkForm_'+lt];f[m+'_panel_searchstring'].value=lf[lt+'_panel_searchstring'].value;if(lf[lt+'_panel_backwards'].value==lt+'_panel_backwardsd'){if(f[m+'_panel_backwards'].value!=m+'_panel_backwardsd'){f[m+'_panel_backwards'].value=m+'_panel_backwardsd';$K.yg_radioboxClick($(m+'_panel_backwardsd'));$K.yg_radioboxSelect($(m+'_panel_backwardsd'));}}else{if(f[m+'_panel_backwards'].value!=m+'_panel_backwardsu'){f[m+'_panel_backwards'].value=m+'_panel_backwardsu';$K.yg_radioboxClick($(m+'_panel_backwardsu'));$K.yg_radioboxSelect($(m+'_panel_backwardsu'));}}
if(lf[lt+'_panel_casesensitivebox'].value=='1'){if(f[m+'_panel_casesensitivebox'].value!=1){f[m+'_panel_casesensitivebox'].value=1;$K.yg_checkboxClick($('chk_'+m+'_panel_casesensitivebox'));$K.yg_checkboxSelect($('chk_'+m+'_panel_casesensitivebox'));}}else{if(f[m+'_panel_casesensitivebox'].value!=0){f[m+'_panel_casesensitivebox'].value=0;$K.yg_checkboxClick($('chk_'+m+'_panel_casesensitivebox'));$K.yg_checkboxSelect($('chk_'+m+'_panel_casesensitivebox'));}}
$K.windows['wid_'+winID].lastTab=m;}}
$K.yg_initCEHTML=function(winID){var loadParams=$K.windows['wid_'+winID].loadparams;if(loadParams&&loadParams.commentMode){$K.windows['wid_'+winID].submitCE_html=function(){if($(loadParams.formfield)){if(loadParams.formfield.endsWith('comment')){var src_content=$(loadParams.formfield).down('.mk_longcomment');}else{var src_content=$(loadParams.formfield).down('.textbox');}
src_content.innerHTML=$('wid_'+winID+'_htmlSource').value.stripScripts().stripTags();src_content.select('img').each(function(imageItem){$(imageItem).observe('load',function(event){$K.windows[src_content.up('.ywindow').id].refresh("col1");});});}
if($K.windows['wid_'+winID].loadparams.commentMode=='edit'){if($(loadParams.formfield)){$(loadParams.formfield).down('.mk_shortcomment').update($('wid_'+winID+'_htmlSource').value.stripScripts().stripTags().truncate(350,'...'));}
var saveOptions={winID:loadParams.openerWinID,yg_type:loadParams.openerType,yg_id:loadParams.openerYgID,commentID:loadParams.commentID,commentText:$('wid_'+winID+'_htmlSource').value.stripScripts().stripTags()};$K.yg_saveComment(saveOptions);$K.yg_fadeField(src_content.up('.cntblockcontainer'));}else if($K.windows['wid_'+winID].loadparams.commentMode=='add'){var saveOptions={winID:loadParams.openerWinID,yg_type:loadParams.openerType,yg_id:loadParams.openerYgID,parentCommentID:loadParams.parentCommentID,commentText:$('wid_'+winID+'_htmlSource').value.stripScripts().stripTags()};$K.yg_addComment(saveOptions);}
if(src_content){$K.windows[src_content.up('.ywindow').id].refresh("col1");}
this.remove();}
if($(loadParams.formfield)){if(loadParams.formfield.endsWith('comment')){src_content=$(loadParams.formfield).down('.mk_longcomment');}else{src_content=$(loadParams.formfield).down('.textbox');if(!src_content)src_content=$(loadParams.formfield).down('.changed');}
contentHTML=src_content.innerHTML;if(contentHTML.toLowerCase()==$K.TXT('TXT_CHOOSE_SELECTOR'))contentHTML='';$('wid_'+winID+'_htmlSource').value=contentHTML;}}else{$K.windows['wid_'+winID].submitCE_html=function(){tinyMCE.activeEditor.setContent($('wid_'+winID+'_htmlSource').value);this.remove();}
$('wid_'+winID+'_htmlSource').value=tinyMCE.activeEditor.getContent();}}
$K.yg_initCEImage=function(winID){var f=document.forms['wid_'+winID+'_linkForm'],ed=tinyMCE.activeEditor;var allCustomClasses=ed.dom.getClasses();for(var i=0;i<allCustomClasses.length;i++){$K.yg_dropdownInsert($(f.dd_class).up('.dropdownbox'),allCustomClasses[i]['class'],allCustomClasses[i]['class'],false,'bottom');}
e=ed.selection.getNode();if(e.nodeName=='IMG'){if($(f.src).readAttribute('preset')!='true'){f.src.value=ed.dom.getAttrib(e,'src');}
f.alt.value=ed.dom.getAttrib(e,'alt');f.title.value=ed.dom.getAttrib(e,'title');f.vspace.value=yeagerCE_getAttrib(e,'vspace');f.hspace.value=yeagerCE_getAttrib(e,'hspace');f.width.value=ed.dom.getAttrib(e,'width');f.height.value=ed.dom.getAttrib(e,'height');f.style.value=ed.dom.getAttrib(e,'style');var align_value=yeagerCE_getAttrib(e,'align');if(align_value!='')$K.yg_dropdownSelect(f.dd_align,false,align_value,true);var className=yeagerCE_getAttrib(e,'class');if(className!='')$K.yg_dropdownSelect(f.dd_class,false,className,true);f.style.value=yeagerCE_updateStyle(f.style.value,f);}
$K.windows['wid_'+winID].submitCE_image=function(){var f=document.forms['wid_'+winID+'_linkForm'],nl=f.elements,ed=tinyMCE.activeEditor,args={},el;yeagerCE_restoreSelection();f.style.value=yeagerCE_updateStyle(f.style.value,f);if(f.src.value===''){if(ed.selection.getNode().nodeName=='IMG'){ed.dom.remove(ed.selection.getNode());ed.execCommand('mceRepaint');}
$K.windows['wid_'+winID].remove();return;}
if(!ed.settings.inline_styles){args=tinymce.extend(args,{vspace:nl.vspace.value,hspace:nl.hspace.value,align:nl.dd_aligns.value});}else{args.style=f.style.value;}
tinymce.extend(args,{src:f.src.value,alt:f.alt.value,width:f.width.value,height:f.height.value,title:f.title.value});tinymce.extend(args,{'class':f.dd_classes.value});el=ed.selection.getNode();if(el&&el.nodeName=='IMG'){ed.dom.setAttribs(el,args);}else{ed.execCommand('mceInsertContent',false,'<img id="__mce_tmp" />',{skip_undo:1});ed.dom.setAttribs('__mce_tmp',args);ed.dom.setAttrib('__mce_tmp','id','');ed.undoManager.add();}
$K.windows['wid_'+winID].remove();}}
$K.yg_initCEAnchor=function(winID){$K.windows['wid_'+winID].submitCE_anchor=function(){var ed=tinyMCE.activeEditor;var f=document.forms['wid_'+winID+'_linkForm'];yeagerCE_restoreSelection();if(f.insert.value!='update')
ed.selection.collapse(1);if(tinymce.isWebKit)
ed.execCommand('mceInsertContent',0,ed.dom.createHTML('img',{mce_name:'a',name:document.forms['wid_'+winID+'_linkForm'].anchorName.value,'class':'mceItemAnchor'}));else
ed.execCommand('mceInsertContent',0,ed.dom.createHTML('a',{name:document.forms['wid_'+winID+'_linkForm'].anchorName.value,'class':'mceItemAnchor'},''));$K.windows['wid_'+winID].remove();}
var ed=tinyMCE.activeEditor;var action,elm,f=document.forms['wid_'+winID+'_linkForm'];yeagerCE_saveSelection();elm=ed.dom.getParent(ed.selection.getNode(),'A,IMG');v=ed.dom.getAttrib(elm,'name');if(v){f.insert.value='update';f.anchorName.value=v;}}
$K.yg_onInitCE=function(instance){if(Prototype.Browser.IE){$(instance.editorId+'_toolbar1').down('td').siblings().last().style.width='auto';$(instance.editorId+'_toolbar2').down('td').siblings().last().style.width='auto';}}
$K.yg_initCETable=function(winID){var tmpEd=ed=tinyMCE.activeEditor;var allCustomClasses=tmpEd.dom.getClasses();for(var i=0;i<allCustomClasses.length;i++){$K.yg_dropdownInsert($('dd_class'),allCustomClasses[i]['class'],allCustomClasses[i]['class'],false,'bottom');}
$K.windows['wid_'+winID].submitCE_table=function(){var formObj=document.forms['wid_'+winID+'_linkForm'];var inst=tinyMCE.activeEditor,dom=inst.dom;var cols=2,rows=2,border=0,cellpadding=-1,cellspacing=-1,align,width,height,className,caption,frame,rules;var html='',capEl,elm;var style='';yeagerCE_restoreSelection();var elm=dom.getParent(inst.selection.getNode(),'table');action=elm?'update':'insert';if(!AutoValidator.validate(formObj)){$K.yg_promptbox($K.TXT('TXT_INVALID_DATA'),$K.TXT('TXT_INVALID_DATA'),'alert');return false;}
elm=dom.getParent(inst.selection.getNode(),'table');cols=formObj.elements['cols'].value;rows=formObj.elements['rows'].value;border=formObj.elements['border'].value!=""?formObj.elements['border'].value:0;cellpadding=formObj.elements['cellpadding'].value!=""?formObj.elements['cellpadding'].value:"";cellspacing=formObj.elements['cellspacing'].value!=""?formObj.elements['cellspacing'].value:"";align=formObj.elements['dd_alignment'].value;width=formObj.elements['width'].value;height=formObj.elements['height'].value;className=formObj.elements['dd_class'].value;if(action=="update"){inst.execCommand('mceBeginUndoLevel');dom.setAttrib(elm,'cellPadding',cellpadding,true);dom.setAttrib(elm,'cellSpacing',cellspacing,true);dom.setAttrib(elm,'border',border);dom.setAttrib(elm,'align',align);dom.setAttrib(elm,'frame',frame);dom.setAttrib(elm,'rules',rules);dom.setAttrib(elm,'class',className);dom.setAttrib(elm,'style',style);dom.setAttrib(elm,'id',id);dom.setAttrib(elm,'summary',summary);dom.setAttrib(elm,'dir',dir);dom.setAttrib(elm,'lang',lang);capEl=inst.dom.select('caption',elm)[0];if(capEl&&!caption)
capEl.parentNode.removeChild(capEl);if(!capEl&&caption){capEl=elm.ownerDocument.createElement('caption');if(!tinymce.isIE)
capEl.innerHTML='<br mce_bogus="1"/>';elm.insertBefore(capEl,elm.firstChild);}
if(width&&inst.settings.inline_styles){dom.setStyle(elm,'width',width);dom.setAttrib(elm,'width','');}else{dom.setAttrib(elm,'width',width,true);dom.setStyle(elm,'width','');}
dom.setAttrib(elm,'borderColor','');dom.setAttrib(elm,'bgColor','');dom.setAttrib(elm,'background','');if(height&&inst.settings.inline_styles){dom.setStyle(elm,'height',height);dom.setAttrib(elm,'height','');}else{dom.setAttrib(elm,'height',height,true);dom.setStyle(elm,'height','');}
if(background!='')
elm.style.backgroundImage="url('"+background+"')";else
elm.style.backgroundImage='';if(bordercolor!=""){elm.style.borderColor=bordercolor;elm.style.borderStyle=elm.style.borderStyle==""?"solid":elm.style.borderStyle;elm.style.borderWidth=border==""?"1px":border;}else
elm.style.borderColor='';elm.style.backgroundColor=bgcolor;inst.addVisual();inst.nodeChanged();inst.execCommand('mceEndUndoLevel');if(formObj.width.value!=orgTableWidth||formObj.height.value!=orgTableHeight)
inst.execCommand('mceRepaint');$K.windows['wid_'+winID].remove();return;}
html+='<table';html+=yeagerCE_makeAttrib('border',border,formObj);html+=yeagerCE_makeAttrib('cellpadding',cellpadding,formObj);html+=yeagerCE_makeAttrib('cellspacing',cellspacing,formObj);if(width){style+='width:'+width+'px;';}
if(height){style+='height:'+height+'px;';}
html+=yeagerCE_makeAttrib('align',align,formObj);html+=yeagerCE_makeAttrib('class',className,formObj);html+=yeagerCE_makeAttrib('style',style,formObj);html+='>';for(var y=0;y<rows;y++){html+="<tr>";for(var x=0;x<cols;x++){if(!tinymce.isIE)
html+='<td><br mce_bogus="1"/></td>';else
html+='<td></td>';}
html+="</tr>";}
html+="</table>";inst.execCommand('mceBeginUndoLevel');inst.execCommand('mceInsertContent',false,html);inst.addVisual();inst.execCommand('mceEndUndoLevel');$K.windows['wid_'+winID].remove();}
yeagerCE_saveSelection();var formObj=document.forms['wid_'+winID+'_linkForm'];var inst=tinyMCE.activeEditor,dom=inst.dom;var elm=dom.getParent(inst.selection.getNode(),'table');var action=elm?'update':'insert';if(action=='update'){var rowsAr=elm.rows;var cols=0;for(var i=0;i<rowsAr.length;i++)
if(rowsAr[i].cells.length>cols)
cols=rowsAr[i].cells.length;rows=rowsAr.length;st=dom.parseStyle(dom.getAttrib(elm,"style"));border=yeagerCE_trimSize(yeagerCE_getStyle(elm,'border','borderWidth'));cellpadding=dom.getAttrib(elm,'cellpadding',"");cellspacing=dom.getAttrib(elm,'cellspacing',"");width=yeagerCE_trimSize(yeagerCE_getStyle(elm,'width','width'));height=yeagerCE_trimSize(yeagerCE_getStyle(elm,'height','height'));bordercolor=yeagerCE_convertRGBToHex(yeagerCE_getStyle(elm,'bordercolor','borderLeftColor'));bgcolor=yeagerCE_convertRGBToHex(yeagerCE_getStyle(elm,'bgcolor','backgroundColor'));align=dom.getAttrib(elm,'align');frame=dom.getAttrib(elm,'frame');rules=dom.getAttrib(elm,'rules');className=tinymce.trim(dom.getAttrib(elm,'class').replace(/mceItem.+/g,''));id=dom.getAttrib(elm,'id');summary=dom.getAttrib(elm,'summary');style=dom.serializeStyle(st);dir=dom.getAttrib(elm,'dir');lang=dom.getAttrib(elm,'lang');background=yeagerCE_getStyle(elm,'background','backgroundImage').replace(new RegExp("url\\('?([^']*)'?\\)",'gi'),"$1");orgTableWidth=width;orgTableHeight=height;$K.yg_dropdownSelect(formObj.dd_align,false,align,true);formObj.cols.value=cols;formObj.rows.value=rows;formObj.border.value=border;formObj.cellpadding.value=cellpadding;formObj.cellspacing.value=cellspacing;formObj.width.value=width;formObj.height.value=height;formObj.style.value=style;if(className!='')$K.yg_dropdownSelect(formObj.dd_class,false,className,true);if(action=='update'){formObj.cols.disabled=true;formObj.rows.disabled=true;}}}
$K.yg_initCEMergeCells=function(winID){yeagerCE_saveSelection();var f=document.forms['wid_'+winID+'_linkForm'],v;if(window.sp!=undefined){f.numcols.value=window.sp.colspan;f.numrows.value=window.sp.rowspan;}
$K.windows['wid_'+winID].submitCE_mergecells=function(){var args=[],f=document.forms['wid_'+winID+'_linkForm'];yeagerCE_restoreSelection();if(!AutoValidator.validate(f)){$K.yg_promptbox($K.TXT('TXT_INVALID_DATA'),$K.TXT('TXT_INVALID_DATA'),'alert');return false;}
args['numcols']=f.numcols.value;args['numrows']=f.numrows.value;tinyMCE.execCommand("mceTableMergeCells",false,args);$K.windows['wid_'+winID].remove();}}
$K.yg_initCEPasteWord=function(winID){$K.windows['wid_'+winID].onResize=function(){var wHeight=this.boxheight-109;var elm=document.getElementById('frmData');if(elm){elm.style.height=Math.abs(wHeight)+'px';}
$K.windows['wid_'+winID].refresh();}
$K.windows['wid_'+winID].submitCE_pasteWord=function(){yeagerCE_restoreSelection();var html=document.getElementById("frmData").contentWindow.document.body.innerHTML;if(html!=''){tinyMCE.execCommand('mcePasteWord',false,html);}
$K.windows['wid_'+winID].remove();}
yeagerCE_saveSelection();}
$K.yg_initIframe=function(doc){var dir=tinyMCE.activeEditor.settings.directionality;doc.body.dir=dir;if(tinymce.isGecko)
doc.body.spellcheck=tinyMCE.activeEditor.getParam("gecko_spellcheck");var wHeight=$('frmData').up('.ywindow').clientHeight-109;var elm=document.getElementById('frmData');if(elm){elm.style.height=Math.abs(wHeight)+'px';}}
$K.yg_initCETableCell=function(winID){yeagerCE_saveSelection();ed=tinyMCE.activeEditor;var inst=ed;var tdElm=ed.dom.getParent(ed.selection.getNode(),"td,th");var formObj=document.forms['wid_'+winID+'_linkForm'];var st=ed.dom.parseStyle(ed.dom.getAttrib(tdElm,"style"));var celltype=tdElm.nodeName.toLowerCase();var align=ed.dom.getAttrib(tdElm,'align');var valign=ed.dom.getAttrib(tdElm,'valign');var width=yeagerCE_trimSize(yeagerCE_getStyle(tdElm,'width','width'));var height=yeagerCE_trimSize(yeagerCE_getStyle(tdElm,'height','height'));var bordercolor=yeagerCE_convertRGBToHex(yeagerCE_getStyle(tdElm,'bordercolor','borderLeftColor'));var bgcolor=yeagerCE_convertRGBToHex(yeagerCE_getStyle(tdElm,'bgcolor','backgroundColor'));var className=ed.dom.getAttrib(tdElm,'class');var backgroundimage=yeagerCE_getStyle(tdElm,'background','backgroundImage').replace(new RegExp("url\\('?([^']*)'?\\)",'gi'),"$1");;var id=ed.dom.getAttrib(tdElm,'id');var lang=ed.dom.getAttrib(tdElm,'lang');var dir=ed.dom.getAttrib(tdElm,'dir');var scope=ed.dom.getAttrib(tdElm,'scope');var allCustomClasses=ed.dom.getClasses();for(var i=0;i<allCustomClasses.length;i++){$K.yg_dropdownInsert($(formObj.dd_class).up('.dropdownbox'),allCustomClasses[i]['class'],allCustomClasses[i]['class'],false,'bottom');}
formObj.width.value=width;formObj.height.value=height;if(align!='')$K.yg_dropdownSelect(formObj.dd_align,false,align,true);if(valign!='')$K.yg_dropdownSelect(formObj.dd_valign,false,valign,true);if(celltype!='')$K.yg_dropdownSelect(formObj.dd_celltype,false,celltype,true);if(className!='')$K.yg_dropdownSelect(formObj.dd_class,false,className,true);$K.windows['wid_'+winID].submitCE_tableCell=function(){var ed=tinyMCE.activeEditor;var el,inst=ed,tdElm,trElm,tableElm,formObj=document.forms['wid_'+winID+'_linkForm'];yeagerCE_restoreSelection();el=ed.selection.getNode();tdElm=ed.dom.getParent(el,"td,th");trElm=ed.dom.getParent(el,"tr");tableElm=ed.dom.getParent(el,"table");ed.execCommand('mceBeginUndoLevel');var nextCell=function(elm){while((elm=elm.nextSibling)!=null){if(elm.nodeName=="TD"||elm.nodeName=="TH")
return elm;}
return null;}
var updateCell=function(td,skip_id){var inst=ed;var formObj=document.forms['wid_'+winID+'_linkForm'];var curCellType=td.nodeName.toLowerCase();var celltype=formObj.dd_celltypes.value;var doc=inst.getDoc();var dom=ed.dom;if(!skip_id)
td.setAttribute('id',formObj.id.value);td.setAttribute('align',formObj.dd_aligns.value);td.setAttribute('vAlign',formObj.dd_valigns.value);td.setAttribute('class',formObj.dd_classes.value);td.setAttribute('style',ed.dom.serializeStyle(ed.dom.parseStyle(formObj.style.value)));ed.dom.setAttrib(td,'width','');ed.dom.setAttrib(td,'height','');ed.dom.setAttrib(td,'bgColor','');ed.dom.setAttrib(td,'borderColor','');ed.dom.setAttrib(td,'background','');td.style.width=yeagerCE_getCSSSize(formObj.width.value);td.style.height=yeagerCE_getCSSSize(formObj.height.value);if(curCellType!=celltype){var newCell=doc.createElement(celltype);for(var c=0;c<td.childNodes.length;c++)
newCell.appendChild(td.childNodes[c].cloneNode(1));for(var a=0;a<td.attributes.length;a++)
ed.dom.setAttrib(newCell,td.attributes[a].name,ed.dom.getAttrib(td,td.attributes[a].name));td.parentNode.replaceChild(newCell,td);td=newCell;}
dom.setAttrib(td,'style',dom.serializeStyle(dom.parseStyle(td.style.cssText)));return td;}
switch(formObj.dd_actions.value){case"cell":var celltype=formObj.dd_celltypes.value;function doUpdate(s){if(s){updateCell(tdElm);ed.addVisual();ed.nodeChanged();inst.execCommand('mceEndUndoLevel');tinyMCEPopup.close();}};updateCell(tdElm);break;case"row":var cell=trElm.firstChild;if(cell.nodeName!="TD"&&cell.nodeName!="TH")
cell=nextCell(cell);do{cell=updateCell(cell,true);}while((cell=nextCell(cell))!=null);break;case"all":var rows=tableElm.getElementsByTagName("tr");for(var i=0;i<rows.length;i++){var cell=rows[i].firstChild;if(cell.nodeName!="TD"&&cell.nodeName!="TH")
cell=nextCell(cell);do{cell=updateCell(cell,true);}while((cell=nextCell(cell))!=null);}
break;}
ed.addVisual();ed.nodeChanged();inst.execCommand('mceEndUndoLevel');$K.windows['wid_'+winID].remove();}}
$K.yg_initCETableRow=function(winID){var updateRow=function(tr_elm,skip_id,skip_parent){var inst=tinyMCE.activeEditor;var formObj=document.forms['wid_'+winID+'_linkForm'];var dom=inst.dom;var curRowType=tr_elm.parentNode.nodeName.toLowerCase();var rowtype=formObj.dd_rowtypes.value;var doc=inst.getDoc();if(!skip_id)
tr_elm.setAttribute('id',formObj.id.value);tr_elm.setAttribute('align',formObj.dd_aligns.value);tr_elm.setAttribute('vAlign',formObj.dd_valigns.value);tr_elm.setAttribute('class',formObj.dd_classes.value);tr_elm.setAttribute('background','');tr_elm.setAttribute('bgColor','');tr_elm.setAttribute('height','');tr_elm.style.height=yeagerCE_getCSSSize(formObj.height.value);if(curRowType!=rowtype&&!skip_parent){var newRow=tr_elm.cloneNode(1);var theTable=dom.getParent(tr_elm,"table");var dest=rowtype;var newParent=null;for(var i=0;i<theTable.childNodes.length;i++){if(theTable.childNodes[i].nodeName.toLowerCase()==dest)
newParent=theTable.childNodes[i];}
if(newParent==null){newParent=doc.createElement(dest);if(dest=="thead"){if(theTable.firstChild.nodeName=='CAPTION')
inst.dom.insertAfter(newParent,theTable.firstChild);else
theTable.insertBefore(newParent,theTable.firstChild);}else
theTable.appendChild(newParent);}
newParent.appendChild(newRow);tr_elm.parentNode.removeChild(tr_elm);tr_elm=newRow;}
dom.setAttrib(tr_elm,'style',dom.serializeStyle(dom.parseStyle(tr_elm.style.cssText)));}
yeagerCE_saveSelection();var inst=tinyMCE.activeEditor;var dom=inst.dom;var trElm=dom.getParent(inst.selection.getNode(),"tr");var formObj=document.forms['wid_'+winID+'_linkForm'];var st=dom.parseStyle(dom.getAttrib(trElm,"style"));var rowtype=trElm.parentNode.nodeName.toLowerCase();var align=dom.getAttrib(trElm,'align');var valign=dom.getAttrib(trElm,'valign');var height=yeagerCE_trimSize(yeagerCE_getStyle(trElm,'height','height'));var className=dom.getAttrib(trElm,'class');var bgcolor=yeagerCE_convertRGBToHex(yeagerCE_getStyle(trElm,'bgcolor','backgroundColor'));var backgroundimage=yeagerCE_getStyle(trElm,'background','backgroundImage').replace(new RegExp("url\\('?([^']*)'?\\)",'gi'),"$1");;var id=dom.getAttrib(trElm,'id');var lang=dom.getAttrib(trElm,'lang');var dir=dom.getAttrib(trElm,'dir');var allCustomClasses=dom.getClasses();for(var i=0;i<allCustomClasses.length;i++){$K.yg_dropdownInsert($(formObj.dd_class).up('.dropdownbox'),allCustomClasses[i]['class'],allCustomClasses[i]['class'],false,'bottom');}
$K.windows['wid_'+winID].submitCE_tableRow=function(){var inst=tinyMCE.activeEditor,dom=inst.dom,trElm,tableElm,formObj=document.forms['wid_'+winID+'_linkForm'];var action=formObj.dd_actions.value;yeagerCE_restoreSelection();trElm=dom.getParent(inst.selection.getNode(),"tr");tableElm=dom.getParent(inst.selection.getNode(),"table");inst.execCommand('mceBeginUndoLevel');switch(action){case"row":updateRow(trElm);break;case"all":var rows=tableElm.getElementsByTagName("tr");for(var i=0;i<rows.length;i++)
updateRow(rows[i],true);break;case"odd":case"even":var rows=tableElm.getElementsByTagName("tr");for(var i=0;i<rows.length;i++){if((i%2==0&&action=="odd")||(i%2!=0&&action=="even"))
updateRow(rows[i],true,true);}
break;}
inst.addVisual();inst.nodeChanged();inst.execCommand('mceEndUndoLevel');$K.windows['wid_'+winID].remove();}
formObj.height.value=height;formObj.style.value=dom.serializeStyle(st);if(align!='')$K.yg_dropdownSelect(formObj.dd_align,false,align,true);if(valign!='')$K.yg_dropdownSelect(formObj.dd_valign,false,valign,true);if(rowtype!='')$K.yg_dropdownSelect(formObj.dd_rowtypes,false,rowtype,true);if(className!='')$K.yg_dropdownSelect(formObj.dd_class,false,className,true);}
$K.yg_saveContenteditor=function(editorReference){var editorWinID=$K.windows[$(editorReference.editorId).up('.ywindow').id].num;var sourceFormfield=$K.windows[$(editorReference.editorId).up('.ywindow').id].loadparams['formfield'];$K.yg_submitContentEditor(editorWinID,sourceFormfield,true);return true;}
;$K.yg_submitEntrymasks=function(winID,openerReference){if($K.windows['wid_'+winID].yg_id==undefined){$K.windows['wid_'+winID].remove();return;}
var selectedNodes=nlsTree['entrymasks_tree'+winID+'_tree'].getSelNodes();var opener_wid=$(openerReference).up('.ywindow').id;var contentarea=$(openerReference).up('.mk_contentarea').id;for(var i=0;i<selectedNodes.length;i++){var emask_id=selectedNodes[i].yg_id.split('-')[0];if(typeof $K.windows[opener_wid].addEntryMask=='function'){$K.windows[opener_wid].addEntryMask(emask_id,contentarea,true);}}
$('wid_'+winID).hide();}
$K.yg_submitCBlocks=function(winID,openerReference){if($K.windows['wid_'+winID].yg_id==undefined){$K.windows['wid_'+winID].remove();return;}
var opener_wid=$(openerReference).up('.ywindow').id;var selectedNodes=nlsTree['cblocks_tree'+winID+'_tree'].getSelNodes();var contentarea=$(openerReference).up('.mk_contentarea').id;for(var i=0;i<selectedNodes.length;i++){var coblock_id=selectedNodes[i].yg_id.split('-')[0];if(typeof $K.windows[opener_wid].addContentBlock=='function'){$K.windows[opener_wid].addContentBlock(coblock_id,contentarea,true);}}
$('wid_'+winID).hide();}
$K.yg_submitCopyContent=function(winID,openerReference){var focusobjs=$K.yg_getFocusObj($('wid_'+winID+'_column2innercontent'));if(focusobjs.length==0){$K.log('Nothing selected!',$K.Log.INFO);return;}else{for(var i=0;i<focusobjs.length;i++){var currentFocusObj=focusobjs[i];var backendFunction;var openerRefID=openerReference.split('_')[1];var contentareaID=openerReference.split('_')[3];var pageID=$K.windows['wid_'+openerRefID].yg_id.split('-')[0];var siteID=$K.windows['wid_'+openerRefID].yg_id.split('-')[1];var objectID=currentFocusObj.up('li').readAttribute('yg_id').split('-')[0];var treeMode=$K.windows['wid_'+winID].loadparams.treemode;if((treeMode=='pages')||(treeMode=='pages_with_cblocks')){objectID=currentFocusObj.id.split('_')[3];}
backendFunction='addPageContentblock';if(currentFocusObj.id.endsWith('_cblock__')){backendFunction='addPositionedPageEntrymask';}
var data=Array('noevent',{yg_property:backendFunction,params:{page:pageID,site:siteID,copymode:true,entrymaskId:objectID,contentblockId:objectID,contentareaID:contentareaID,openerRefID:openerRefID,targetId:null,targetPosition:'into',refresh:'true'}});$K.yg_AjaxCallback(data,backendFunction);}}
$('wid_'+winID).hide();}
;$K.yg_submitNavigation=function(winID,openerReference){var selectedNavigation=$K.windows['wid_'+winID].yg_id;if(!selectedNavigation){selectedNavigation=$K.yg_getFocusObj($('wid_'+winID))[0].up('li').readAttribute('yg_id');}
$K.windows[openerReference].changeNavigation(selectedNavigation);$K.windows['wid_'+winID].remove();}
$K.yg_initDlgNavigations=function(winID,preselected){if(!preselected)preselected=0;preselitem=$('item_'+winID+'_'+preselected+'_selector');$K.yg_blockSelect(preselitem);}
$K.navigationListSortCallbacks={starteffect:function(element){var parentWin=$K.windows[element.up('.ywindow').id];parentWin.yg_id=element.readAttribute('yg_id');}};
;$K.yg_submitExtensions=function(winID,openerReference){if($K.windows['wid_'+winID].yg_id==undefined){$K.windows['wid_'+winID].remove();return;}
var yg_id=$K.windows['wid_'+winID].yg_id;if(typeof $K.windows[openerReference].addExtension=='function'){$K.windows[openerReference].addExtension(yg_id,$K.windows[openerReference].yg_id,yg_id.split('-')[1],true);}
$K.windows['wid_'+winID].remove();}
$K.yg_initDlgExtensions=function(winID,openerReference){$K.windows[openerReference].addExtension=function(src_id,target_id,src_type,refresh){var page=target_id.split('-')[0];var site=target_id.split('-')[1];extensionId=src_id.split('-')[0];var data=Array('noevent',{yg_property:'addObjectExtension',params:{page:page,site:site,extensionId:extensionId,openerRefID:this.num,refresh:refresh.toString()}});$K.yg_AjaxCallback(data,'addObjectExtension');}
Position.includeScrollOffsets=true;}
$K.extensionslistSortCallbacks={starteffect:function(element){var parentWin=$K.windows[element.up('.ywindow').id];parentWin.yg_id=element.readAttribute('yg_id');}};
;$K.yg_initDlgExport=function(winID,openerRef){var mode=$K.windows['wid_'+winID].loadparams['mode'];var openerWinRef=$($K.windows['wid_'+winID].loadparams['opener_reference']);var uploadStatusPanel=$('wid_'+winID).down('.mk_uploadpanel');var uploadTemplateOrig=$('wid_'+winID).down('.mk_upload_templates').innerHTML;switch(mode){case'import':if($K.uploadFramework=='swfuploader'){for(swfUploadObjectIdx in $K.yg_SWFUploadObjects){if(swfUploadObjectIdx.startsWith(openerWinRef.id)){var currSWFUploadObject=$K.yg_SWFUploadObjects[swfUploadObjectIdx];currSWFUploadObject.customSettings.uploadWinId='wid_'+winID;var swfUploadFile=currSWFUploadObject.getFile('!!!YG-ID!!!');if(swfUploadFile){uploadTemplate=uploadTemplateOrig;uploadTemplate=uploadTemplate.replace(/__TEMPLATEID__/g,swfUploadFile.id);uploadTemplate=uploadTemplate.replace(/__TEMPLATEINDEX__/g,swfUploadFile.index);uploadTemplate=uploadTemplate.replace(/__TEMPLATENAME__/g,swfUploadFile.name);uploadStatusPanel.insert({bottom:uploadTemplate});currSWFUploadObject.addFileParam(swfUploadFile.id,'uploadWinId',winID);currSWFUploadObject.addFileParam(swfUploadFile.id,'extensionId',$K.windows[openerWinRef.id].yg_id);$K.yg_SWFUploadGlobalFileInfo[swfUploadFile.id]=swfUploadFile;$K.windows['wid_'+winID].refresh();if(!$K.yg_SWFUploadQueueProcessing){$K.yg_SWFUploadProcessQueue();}
currSWFUploadObject.startUpload();}}}}
if($K.uploadFramework=='plupload'){for(plUploadObjectIdx in $K.yg_PLUploadObjects){if(plUploadObjectIdx.startsWith(openerWinRef.id)){var currPLUploadObject=$K.yg_PLUploadObjects[plUploadObjectIdx];currPLUploadObject.settings.custom_settings.uploadWinId='wid_'+winID;var plUploadFile=currPLUploadObject.files[0];if(plUploadFile){uploadTemplate=uploadTemplateOrig;uploadTemplate=uploadTemplate.replace(/__TEMPLATEINDEX__/g,currPLUploadObject.files.length+1);uploadTemplate=uploadTemplate.replace(/__TEMPLATEID__/g,plUploadFile.id);uploadTemplate=uploadTemplate.replace(/__TEMPLATENAME__/g,plUploadFile.name);uploadStatusPanel.insert({bottom:uploadTemplate});var addFileParam=Object.toQueryString({uploadWinId:winID,extensionId:$K.windows[openerWinRef.id].yg_id});plUploadFile.addFileParam+='&'+addFileParam;$K.yg_PLUploadGlobalFileInfo[plUploadFile.id]=plUploadFile;$K.windows['wid_'+winID].refresh();if(!$K.yg_PLUploadQueueProcessing){$K.yg_PLUploadProcessQueue();}
currPLUploadObject.start();}}}}
break;case'export':var extensionId=$K.windows[openerWinRef.id].yg_id.split('-')[0];var data=Array('noevent',{yg_property:'extensionExportData',params:{extensionId:extensionId,uploadWinId:winID,openerWinId:openerWinRef.id}});$K.yg_AjaxCallback(data,'extensionExportData');break;}}
$K.yg_addExtensionExportFile=function(winID,extensionId,fileIndex,fileName,mimeType){var winRef=$('wid_'+winID);var uploadStatusPanel=winRef.down('.mk_uploadpanel');var uploadTemplateOrig=winRef.down('.mk_upload_templates').innerHTML;if(fileIndex==1){uploadStatusPanel.update('');}
uploadTemplate=uploadTemplateOrig;uploadTemplate=uploadTemplate.replace(/__TEMPLATEID__/g,fileIndex);uploadTemplate=uploadTemplate.replace(/__TEMPLATEINDEX__/g,fileIndex);uploadTemplate=uploadTemplate.replace(/__TEMPLATENAME__/g,fileName);uploadStatusPanel.insert({bottom:uploadTemplate});var downloadFunc=function(ev){Event.stop(ev);window.open($K.appdir+'fetchExport?extensionId='+extensionId+'&fileName='+fileName+'&mimeType='+mimeType);};$('item_'+winID+'_'+fileIndex).down('a.download').observe('click',downloadFunc);$('item_'+winID+'_'+fileIndex).observe('click',downloadFunc);$K.windows[winRef.id].refresh();}
;$K.yg_submitFormfields=function(winID,openerReference,displayMode){var listName='_formfields_list';var selectedItems=$K.yg_getFocusObj($('wid_'+winID));var openerWin=$(openerReference);var maxIdx=1;$(openerWin.id+listName).childElements().each(function(childItem){var elemIdx=parseInt(childItem.id.split('_').last());if(elemIdx>maxIdx)maxIdx=elemIdx;});maxIdx++;var realSelectedItems=new Array();if(selectedItems.length>0){selectedItems.each(function(item){if(!item||!item.up('li')||!item.up('ul')||(item.up('ul').id!='wid_'+winID+'_formfieldlist')){return;}
realSelectedItems.push(item);});}
selectedItems=realSelectedItems;var formfieldIds=new Array();selectedItems.each(function(item){formfieldIds.push(item.up('li').readAttribute('yg_id').split('-')[0]);});if($K.windows['wid_'+winID].yg_id){if(formfieldIds.indexOf($K.windows['wid_'+winID].yg_id.split('-')[0])==-1){formfieldIds=new Array();formfieldIds.push($K.windows['wid_'+winID].yg_id.split('-')[0]);}}
formfieldIds.each(function(formfieldId){switch(displayMode){case'properties':var item_template=$K.yg_makeTemplate($K.windows[openerWin.id].formfieldTemplates[formfieldId]);var newFormfield=item_template.evaluate({new_idx:maxIdx,new_id:'__NEW_ID_'+maxIdx+'__'});$(openerWin.id+listName).insert({bottom:newFormfield});newFormfield.evalScripts();$K.yg_customAttributeHandler($(openerWin.id+'_formfield_'+maxIdx));break;case'normal':default:var item_template=$K.yg_makeTemplate($K.windows[openerWin.id].formfieldTemplates[formfieldId]);var newFormfield=item_template.evaluate({new_idx:maxIdx,new_id:'__NEW_ID_'+maxIdx+'__'});$(openerWin.id+listName).insert({bottom:newFormfield});newFormfield.evalScripts();$K.yg_customAttributeHandler($(openerWin.id+'_formfield_'+maxIdx));$K.yg_hilite('entrymask',$K.windows[openerWin.id].yg_id,'name',true);break;}
maxIdx++;});$K.initSortable(openerWin.id+listName);$K.windows[openerWin.id].refresh();$K.windows['wid_'+winID].remove();};$K.formFieldsSortCallbacks={onUpdate:function(element){var parentWin=$K.windows[this.element.up('.ywindow').id];$K.initSortable($(parentWin.loadparams.opener_reference+'_formfields_list'));}};$K.formFieldListSortCallbacks={onCreate:function(element){$K.yg_initSortable(this.up('.sortlist').id);},onUpdate:function(element){$K.yg_updateSortables();}};
;$K.yg_submitViews=function(openerReference,winID){var openerWin=$(openerReference).up('.ywindow').id;var focusobjs=$K.yg_getFocusObj($('wid_'+winID+'_viewlist'));if(focusobjs.length>0){focusobjs.each(function(item){var viewID=item.up('li').readAttribute('yg_id').split('-')[0];var fileID=$K.windows[openerWin].yg_id.split('-')[0];var data=Array('noevent',{yg_property:'addFileView',params:{file:fileID,view:viewID}});$K.yg_AjaxCallback(data,'addFileView');});}else if($K.windows['wid_'+winID].yg_id){var viewID=$K.windows['wid_'+winID].yg_id.split('-')[0];var fileID=$K.windows[openerWin].yg_id.split('-')[0];var data=Array('noevent',{yg_property:'addFileView',params:{file:fileID,view:viewID,openerWin:openerWin}});$K.yg_AjaxCallback(data,'addFileView');}
$K.windows['wid_'+winID].remove();}
$K.viewListSortCallbacks={starteffect:function(element){var parentWin=$K.windows[element.up('.ywindow').id];parentWin.yg_id=element.readAttribute('yg_id');}};
;$K.yg_initDlgUpload=function(winID,preselected){var innerDiv=new Element('div',{id:'wid_'+winID+'_addfilebutton_top'}).update('&nbsp;');var outerDiv=new Element('div',{style:'padding-top:5px;'});outerDiv.insert({top:innerDiv});$('wid_'+winID+'_addfilebutton_top_container').insert({top:outerDiv});var innerDiv2=new Element('div').update('&nbsp;');var outerDiv2=new Element('div',{id:'wid_'+winID+'_addfilebutton_top_template',style:'display:none;'});outerDiv2.insert({top:innerDiv2});$('wid_'+winID+'_addfilebutton_top_container').insert({after:outerDiv2});if(preselected){$K.yg_loadDlgUpload(preselected);}}
$K.yg_initDlgUploadProgress=function(show){if($K.uploadFramework=='plupload'){$('wid_uploadprogress').addClassName('plupload');}
if(show){$('wid_uploadprogress').show();}}
$K.yg_openUploadProgress=function(show){if(!$K.windows['wid_uploadprogress']){new $K.yg_wndobj({config:'UPLOAD_PROGRESS',loadparams:{show:show}});}else if(show){$('wid_uploadprogress').show();}}
$K.yg_loadDlgUpload=function(yg_id,show){if(!$K.windows['wid_upload']){new $K.yg_wndobj({config:'UPLOAD',loadparams:{yg_id:yg_id}});$K.yg_openUploadProgress();if(show){$K.windows['wid_upload'].initShow=true;}
return;}
if(!yg_id){return;}
$K.windows['wid_upload'].yg_id=yg_id.split('-')[0];;$('wid_upload').show();$('wid_upload').style.zIndex=$K.yg_incrementTopZIndex()+10;$K.windows['wid_upload'].init();$K.yg_centerWindow($('wid_upload'));$('wid_upload_filetitle').value='';$K.yg_dropdownSelect($('wid_upload_filetype'),false,'automatic',true);$('wid_upload_filestoupload').update('');if($K.uploadFramework=='swfuploader'){var swfuploadSettings=Object.clone($K.yg_SWFUploadSettings);Object.extend(swfuploadSettings,{upload_url:$K.appdir+'responder?handler=uploadFile',flash_url:$K.jsdir+'3rd/swfupload/swfupload.swf',button_placeholder_id:'wid_upload_addfilebutton',custom_settings:{uploadButtonId:'wid_upload_okbutton',statusPanelTemplate:'wid_upload_filestoupload_template',uploadTitle:'wid_upload_filetitle',uploadType:'wid_upload_filetype'}});var swfuploadSettings2=Object.clone($K.yg_SWFUploadSettings);Object.extend(swfuploadSettings2,{upload_url:$K.appdir+'responder?handler=uploadFile',flash_url:$K.jsdir+'3rd/swfupload/swfupload.swf',button_placeholder_id:'wid_upload_addfilebutton_top',button_width:"23",button_height:"23",custom_settings:{uploadButtonId:'wid_upload_okbutton',statusPanelTemplate:'wid_upload_filestoupload_template',uploadTitle:'wid_upload_filetitle',uploadType:'wid_upload_filetype'}});if(!$('wid_upload_addfilebutton')){var tmpTemplate=$('wid_upload_addfilebutton_template');tmpTemplate.previous().update(tmpTemplate.innerHTML);tmpTemplate.previous().down().id='wid_upload_addfilebutton';tmpTemplate.previous().down().writeAttribute('id','wid_upload_addfilebutton');}
if(!$('wid_upload_addfilebutton_top')){var tmpTemplate=$('wid_upload_addfilebutton_top_template');tmpTemplate.previous().down().update(tmpTemplate.innerHTML);tmpTemplate.previous().down().down().id='wid_upload_addfilebutton_top';tmpTemplate.previous().down().down().writeAttribute('id','wid_upload_addfilebutton_top');}
$K.yg_SWFUploadObjects['wid_upload']=new SWFUpload(swfuploadSettings);$K.yg_SWFUploadObjects['wid_upload_2']=new SWFUpload(swfuploadSettings2);if(Prototype.Browser.WebKit||Prototype.Browser.IE&&$('wid_upload_UPLOAD').down('div.selectionmarker')){$('wid_upload_UPLOAD').down('div.selectionmarker').remove();}}
if($K.uploadFramework=='plupload'){var customSettings={uploadButtonId:'wid_upload_okbutton',statusPanelTemplate:'wid_upload_filestoupload_template',uploadTitle:'wid_upload_filetitle',uploadType:'wid_upload_filetype'};$K.yg_UploadInit('wid_upload_2','wid_upload_addfilebutton','wid_upload_ywindowinnerie',{handler:'uploadFile'},customSettings,[],true);$K.yg_UploadInit('wid_upload_3','wid_upload_addfilebutton_top','wid_upload_addfilebutton_top',{handler:'uploadFile'},customSettings,[],true);if(Prototype.Browser.WebKit||Prototype.Browser.IE){$('wid_upload_addfilebutton').up().setStyle({marginTop:'-37px'});}else if($(document.body).hasClassName('MAC')){$('wid_upload_addfilebutton').up().setStyle({marginTop:'-39px'});}else{$('wid_upload_addfilebutton').up().setStyle({marginTop:'-39px'});}
if(Prototype.Browser.IE&&$('wid_upload_addfilebutton_template').next()&&($('wid_upload_addfilebutton_template').next().tagName=='FORM')){$('wid_upload_addfilebutton_template').next().setStyle({top:'0px',width:'100%',height:'57px'});}
if(Prototype.Browser.IE&&(($K.yg_PLUploadObjects['wid_upload_2'].runtime=='html4')||($K.yg_PLUploadObjects['wid_upload_2'].runtime=='html5'))){if($('wid_upload_addfilebutton').previous().down('.selectionmarker')){$('wid_upload_addfilebutton').previous().down('.selectionmarker').remove();}
if($('wid_upload_cnttable').down('form')&&$('wid_upload_cnttable').down('form').down('form')){$('wid_upload_cnttable').down('form').down('form').setStyle({top:'0px',width:'100%',height:'57px'});}
if($('wid_upload_cnttable').down('div.plupload.html5')){$('wid_upload_cnttable').down('div.plupload.html5').setStyle({top:'0px',width:'100%',height:'57px'});}}}}
$K.yg_removeUploadItem=function(which){which=$(which);var file_id=which.up('li').readAttribute('yg_id').replace(/-file/,'');var winID=which.up('.ywindow').id;if($K.uploadFramework=='swfuploader'){for(SWFUploadInstance in $K.yg_SWFUploadObjects){if(file_id.indexOf($K.yg_SWFUploadObjects[SWFUploadInstance].movieName)==0){try{$K.yg_SWFUploadObjects[SWFUploadInstance].cancelUpload(file_id,true);}catch(ex){}}}}
if($K.uploadFramework=='plupload'){for(PLUploadInstance in $K.yg_PLUploadObjects){if($K.yg_PLUploadObjects[PLUploadInstance].files.length>0){for(var i=0;i<$K.yg_PLUploadObjects[PLUploadInstance].files.length;i++){$K.yg_PLUploadObjects[PLUploadInstance].removeFile($K.yg_PLUploadObjects[PLUploadInstance].files[i]);}}}}
which.up('li').remove();if($K.uploadFramework=='swfuploader'){$K.yg_SWFUploadGlobalFileInfoRemove(file_id);}
$K.windows[winID].refresh();}
$K.yg_SWFUploadGlobalFileInfoRemove=function(which){for(FileInfoItemIdx in $K.yg_SWFUploadGlobalFileInfo){if($K.yg_SWFUploadGlobalFileInfo[FileInfoItemIdx].id==which){delete $K.yg_SWFUploadGlobalFileInfo[FileInfoItemIdx];}}}
$K.yg_calcSWFUploadGlobalFilesizes=function(){var globalSize=0;for(FileInfoIdx in $K.yg_SWFUploadGlobalFileInfo){globalSize+=$K.yg_SWFUploadGlobalFileInfo[FileInfoIdx].size;}
return globalSize;}
$K.yg_onUploadTimeout=function(){var uploadStatusPanel=$('wid_uploadprogress').down('.mk_uploadpanel');uploadStatusPanel.select('li').each(function(item){item.removeClassName('uploading');item.addClassName('uploaderror');item.down('.uploadpercent').update('ERROR');item.observe('mouseover',function(){$K.yg_showHelp($K.TXT('TXT_FILE_UPLOAD_TIMEOUT'));});item.observe('mouseout',function(){$K.yg_showHelp(false);});window.hadUploadError=false;window.hadUploadErrorMsg=undefined;});}
$K.yg_startUpload=function(winID){$('wid_'+winID).setStyle({top:'-10000px',left:'-10000px'});$('wid_uploadprogress').show();$('wid_uploadprogress').style.zIndex=$K.yg_incrementTopZIndex();$K.windows['wid_uploadprogress'].init();if($K.uploadFramework=='swfuploader'){var uploadStats;if($K.yg_SWFUploadObjects['wid_upload']){uploadStats=$K.yg_SWFUploadObjects['wid_upload'].getStats();}
if($K.yg_SWFUploadObjects['wid_upload_2']&&(!uploadStats||(uploadStats.files_queued==0))){uploadStats=$K.yg_SWFUploadObjects['wid_upload_2'].getStats();}
var uploadStatusPanel=$('wid_uploadprogress').down('.mk_uploadpanel');var uploadTemplateOrig=$('wid_uploadprogress').down('.mk_upload_templates').innerHTML;pageID=$K.windows['wid_upload'].yg_id;$('wid_'+winID).down('.mk_uploadpanel').select('li').each(function(item){var swfUploadFile=$K.yg_SWFUploadObjects['wid_upload'].getFile(item.readAttribute('yg_id').replace(/-file/,''));if(!swfUploadFile){swfUploadFile=$K.yg_SWFUploadObjects['wid_upload_2'].getFile(item.readAttribute('yg_id').replace(/-file/,''));}
var data=Array('noevent',{yg_property:'uploadFile',params:{folderId:pageID,uploadID:swfUploadFile.id,uploadIndex:swfUploadFile.id,filesQueued:uploadStats.files_queued,title:$('wid_'+winID+'_filetitle').value,type:$('wid_'+winID+'_filetype').down('input[type=hidden]').value}});$K.yg_SWFUploadObjects['wid_upload'].addFileParam(swfUploadFile.id,'data',Object.toJSON(data));if($K.yg_SWFUploadObjects['wid_upload_2']){$K.yg_SWFUploadObjects['wid_upload_2'].addFileParam(swfUploadFile.id,'data',Object.toJSON(data));}
uploadTemplate=uploadTemplateOrig;uploadTemplate=uploadTemplate.replace(/__TEMPLATEID__/g,swfUploadFile.id);uploadTemplate=uploadTemplate.replace(/__TEMPLATEINDEX__/g,swfUploadFile.index);uploadTemplate=uploadTemplate.replace(/__TEMPLATENAME__/g,swfUploadFile.name);uploadStatusPanel.insert({bottom:uploadTemplate});$K.yg_SWFUploadGlobalFileInfo[swfUploadFile.id]=swfUploadFile;});$K.windows['wid_uploadprogress'].refresh();$K.yg_SWFUploadQueue['wid_'+winID]=$K.yg_SWFUploadObjects['wid_upload'].movieName;if($K.yg_SWFUploadObjects['wid_upload_2']){$K.yg_SWFUploadQueue['wid_'+winID+'_2']=$K.yg_SWFUploadObjects['wid_upload_2'].movieName;}
if(!$K.yg_SWFUploadQueueProcessing){$K.yg_SWFUploadProcessQueue();}}
if($K.uploadFramework=='plupload'){var uploadStatusPanel=$('wid_uploadprogress').down('.mk_uploadpanel');var uploadTemplateOrig=$('wid_uploadprogress').down('.mk_upload_templates').innerHTML;var uploadObject=$K.yg_PLUploadObjects['wid_'+winID];var uploadObject2=$K.yg_PLUploadObjects['wid_'+winID+'_2'];var uploadObject3=$K.yg_PLUploadObjects['wid_'+winID+'_3'];if(uploadObject){var fileIndex=uploadObject.files.length;}else if(uploadObject2){var fileIndex=uploadObject2.files.length;}else if(uploadObject3){var fileIndex=uploadObject3.files.length;}
pageID=$K.windows['wid_upload'].yg_id;$('wid_'+winID+'_innercontent').down('.mk_uploadpanel').select('li').each(function(item){fileIndex++;var uploadFile,filesQueued;if(uploadObject){uploadFile=uploadObject.getFile(item.readAttribute('yg_id').replace(/-file/,''));filesQueued=uploadObject.files.length+1;}
if(!uploadFile&&uploadObject2){uploadFile=uploadObject2.getFile(item.readAttribute('yg_id').replace(/-file/,''));filesQueued=uploadObject2.files.length+1;}
if(!uploadFile&&uploadObject3){uploadFile=uploadObject3.getFile(item.readAttribute('yg_id').replace(/-file/,''));filesQueued=uploadObject3.files.length+1;}
if(!uploadFile){return;}
var data=Array('noevent',{yg_property:'uploadFile',params:{folderId:pageID,uploadID:uploadFile.id,uploadIndex:fileIndex,filesQueued:filesQueued,title:$('wid_'+winID+'_filetitle').value,type:$('wid_'+winID+'_filetype').down('input[type=hidden]').value}});var addFileParam=Object.toQueryString({data:Object.toJSON(data)});uploadFile.addFileParam=addFileParam;uploadTemplate=uploadTemplateOrig;uploadTemplate=uploadTemplate.replace(/__TEMPLATEINDEX__/g,fileIndex);uploadTemplate=uploadTemplate.replace(/__TEMPLATEID__/g,uploadFile.id);uploadTemplate=uploadTemplate.replace(/__TEMPLATENAME__/g,uploadFile.name);uploadStatusPanel.insert({bottom:uploadTemplate});$K.yg_PLUploadGlobalFileInfo[uploadFile.id]=uploadFile;});$K.windows['wid_uploadprogress'].refresh();if(uploadObject)$K.yg_PLUploadQueue['wid_'+winID]=uploadObject.id;if(uploadObject2)$K.yg_PLUploadQueue['wid_'+winID+'_2']=uploadObject2.id;if(uploadObject3)$K.yg_PLUploadQueue['wid_'+winID+'_3']=uploadObject3.id;if(!$K.yg_PLUploadQueueProcessing){$K.yg_PLUploadProcessQueue();}}}
$K.yg_clearUploadProgress=function(winID){$('wid_'+winID).down('.mk_uploadpanel').select('li').each(function(item){if(item.hasClassName('uploaddone')||item.hasClassName('uploaderror')){item.remove();}});$K.windows['wid_'+winID].refresh();}
;$K.yg_openLinkChooserWindow=function(which,objectid,formfield){if(which.up('.maskedit'))which=$(which.up('.maskedit'));site=$K.windows[which.up('.ywindow').id].yg_id.split('-')[1];if(site!=parseInt(site))site="";var src_data={param01:which.readAttribute('param01'),param02:which.readAttribute('param02'),param03:which.readAttribute('param03'),param04:which.readAttribute('param04')};if(!src_data.param01&&which.up('.selectionmarker')&&which.up('.selectionmarker').next('input')){src_data.param01=which.up('.selectionmarker').next('input').value;}
var openerYgId=$K.windows[which.up('.ywindow').id].yg_id;var wndobj=new $K.yg_wndobj({config:'LINK_SELECT',openerYgId:openerYgId,loadparams:{site:site,opener_reference:which.identify(),special_url:src_data.param01}});var href=src_data.param01;var onclick=src_data.param04;sel="LINK_SELECT_PAGE";if(which.up('.editlink')){var iconElement=which.up('.editlink').down('div.icn');}else{var iconElement=which.down('div.icn');}
if((iconElement==undefined)||(iconElement&&(iconElement.style.display=='none'))){sel="LINK_SELECT_FILE";}else{if(src_data.param01.startsWith('mailto:')){sel="LINK_SELECT_EMAIL";}}
for(var i=0;i<wndobj.tabs.elements.length;i++){if(wndobj.tabs.elements[i]['NAME']==sel){wndobj.tabs.select(i);wndobj.linkType=sel;}}}
$K.yg_initLink=function(winID,openerRef){if(openerRef.endsWith('property')){var src_data={param01:$(openerRef).readAttribute('param01'),param02:$(openerRef).readAttribute('param02'),param03:$(openerRef).readAttribute('param03'),param04:$(openerRef).readAttribute('param04')};formObj=document.forms['wid_'+winID+'_'+$K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']];var href=src_data.param01;var onclick=src_data.param04;if(($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_PAGE')&&($K.windows['wid_'+winID].linkType=='LINK_SELECT_PAGE')){if($(openerRef).hasClassName('mk_property')){var openerBlock=$(openerRef);}else{var openerBlock=$(openerRef).up('.mk_property');}
if(openerBlock.down('.icn')&&openerBlock.down('.icn').hasClassName('iconlink')){formObj.pagename.value='';}else{formObj.pagename.value=openerBlock.down('.title_txt').innerHTML.strip();}
if($(formObj.elements['href']).readAttribute('preset')!='true'){yeagerCE_setFormValue('href',href,formObj);}
yeagerCE_setFormValue('onclick',onclick,formObj);if(onclick!=null&&onclick.indexOf('window.open')!=-1){yeagerCE_parseWindowOpen(onclick,formObj);}else if(onclick!=null){yeagerCE_parseFunction(onclick);}
if(formObj.dd_target){$K.yg_dropdownSelect(formObj.dd_target,false,src_data.param02,true);}}else if(($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_EMAIL')&&($K.windows['wid_'+winID].linkType=='LINK_SELECT_EMAIL')){if($(formObj.elements['email']).readAttribute('preset')!='true'){formObj.email.value=href.replace(/mailto:/,'');formObj.href.value='';}}else if(($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_FILE')&&($K.windows['wid_'+winID].linkType=='LINK_SELECT_FILE')){if($(formObj.elements['href']).readAttribute('preset')!='true'){formObj.href.value=href;}
formObj.filetitle=$(openerRef).readAttribute('param03');}}else{var src_data={param01:$(openerRef).readAttribute('param01'),param02:$(openerRef).readAttribute('param02'),param03:$(openerRef).readAttribute('param03'),param04:$(openerRef).readAttribute('param04')};formObj=document.forms['wid_'+winID+'_'+$K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']];var href=src_data.param01;var onclick=src_data.param04;if(($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_PAGE')&&($K.windows['wid_'+winID].linkType=='LINK_SELECT_PAGE')){if($(openerRef).down('.icn')&&$(openerRef).down('.icn').hasClassName('iconlink')){formObj.pagename.value='';}else{formObj.pagename.value=$(openerRef).down('.title_txt').innerHTML;}
if($(formObj.elements['href']).readAttribute('preset')!='true'){yeagerCE_setFormValue('href',href,formObj);}
yeagerCE_setFormValue('onclick',onclick,formObj);if(onclick!=null&&onclick.indexOf('window.open')!=-1){yeagerCE_parseWindowOpen(onclick,formObj);}else{yeagerCE_parseFunction(onclick);}
if(formObj.dd_target){$K.yg_dropdownSelect(formObj.dd_target,false,src_data.param02,true);}}else if(($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_EMAIL')&&($K.windows['wid_'+winID].linkType=='LINK_SELECT_EMAIL')){if($(formObj.elements['email']).readAttribute('preset')!='true'){formObj.email.value=href.replace(/mailto:/,'');formObj.href.value='';}}else if(($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_FILE')&&($K.windows['wid_'+winID].linkType=='LINK_SELECT_FILE')){if($(formObj.elements['href']).readAttribute('preset')!='true'){formObj.href.value=href;}
if($(openerRef).down('span.filetype')){formObj.filecolor.value=$(openerRef).down('span.filetype').className.replace(/filetype/,'').strip();formObj.filetype.value=$(openerRef).down('span.filetype').innerHTML.strip();formObj.filetitle.value=$(openerRef).down('.title_txt').innerHTML.replace(/<(.*)>/,'');}else{formObj.filecolor.value='';formObj.filetype.value='';formObj.filetitle.value='';}}}}
$K.yg_submitLink=function(winID,openerRef){var src_content=$(openerRef).down('.title_txt');var data=new Object();if($('wid_'+winID+'_LINK_SELECT_PAGE')&&($('wid_'+winID+'_LINK_SELECT_PAGE').style.display!='none')){formObj=document.forms['wid_'+winID+'_LINK_SELECT_PAGE'];if(formObj.ispopup){formObj.ispopup.value='0';}
if(formObj.pagename.value.strip()==$K.TXT('TXT_SELECTOR_LINK')){formObj.pagename.value='';}
var link_matches=formObj.href.value.match($K.urlParseRegEx);if((link_matches!=null)||((formObj.pagename.value)&&(formObj.href.value))){data['objecttype']='page';if(formObj.pagename.value){data['title']=formObj.pagename.value;}else{data['title']=formObj.href.value;}}else{data['objecttype']='link';data['title']=formObj.href.value;}
if(formObj['wid_'+winID+'_dd_targets']){data['target']=formObj['wid_'+winID+'_dd_targets'].value;}
if(formObj.onclick){data['onclick']=formObj.onclick.value;}}else if($('wid_'+winID+'_LINK_SELECT_EMAIL')&&($('wid_'+winID+'_LINK_SELECT_EMAIL').style.display!='none')){data['objecttype']='email';formObj=document.forms['wid_'+winID+'_LINK_SELECT_EMAIL'];if(formObj.email.value!=''){formObj.href.value='mailto:'+formObj.email.value;}else{formObj.href.value='';}
data['title']=formObj.href.value.replace(/mailto:/,'');}else if($('wid_'+winID+'_LINK_SELECT_FILE')&&($('wid_'+winID+'_LINK_SELECT_FILE').style.display!='none')){data['objecttype']='file';formObj=document.forms['wid_'+winID+'_LINK_SELECT_FILE'];data['yg_id']=formObj.file.value;data['filecolor']=formObj.filecolor.value;data['filetype']=formObj.filetype.value;data['title']=formObj.filetitle.value;}
data['href']=formObj.href.value;if(openerRef.endsWith('property')){var updateFunc=function(pageName){if(pageName){data.objecttype='page';data.title=pageName;}
$(openerRef).update(data.title);$(openerRef).up('.selectionmarker').next().value=data.href;$K.yg_setObjectProperty($(openerRef),data.href);$K.yg_fadeField($(openerRef).up('.cntblock'));}
if(data&&data['objecttype']&&data['objecttype']=='link'){$(openerRef).up('.title').previous().className='icn iconlink';$(openerRef).up('.title').previous().show();new Ajax.Request($K.appdir+'responder',{asynchronous:true,method:'post',parameters:{data:Object.toJSON(['noevent',{yg_property:'checkLinkExternal',params:{url:formObj.href.value,us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}}]),handler:'checkLinkExternal',us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()},onSuccess:function(transport){if(transport.responseText.stripScripts().strip()!='external'){updateFunc(transport.responseText.stripScripts().strip());}else{updateFunc();}}});}else{if(data&&data['objecttype']&&data['objecttype']=='page'){$(openerRef).up('.title').previous().className='icn iconpage';$(openerRef).up('.title').previous().show();}else if(data&&data['objecttype']&&data['objecttype']=='email'){$(openerRef).up('.title').previous().className='icn iconemail';$(openerRef).up('.title').previous().show();}else if(data&&data['objecttype']&&data['objecttype']=='file'){$(openerRef).up('.title').previous().hide();}
if((!data['title'])||(data['title']=='')){$(openerRef).up('.title').previous().className='icn iconlink';$(openerRef).up('.title').previous().show();}
updateFunc();}}else{var updateFunc=function(pageName){if(pageName){data.objecttype='page';data.title=pageName;}
$K.yg_editControl($(openerRef).down('.title_txt'),'5',false,data);$K.yg_fadeField($(openerRef));}
if(data&&data['objecttype']&&data['objecttype']=='link'){new Ajax.Request($K.appdir+'responder',{asynchronous:true,method:'post',parameters:{data:Object.toJSON(['noevent',{yg_property:'checkLinkExternal',params:{url:formObj.href.value,us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}}]),handler:'checkLinkExternal',us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()},onSuccess:function(transport){if(transport.responseText.stripScripts().strip()!='external'){updateFunc(transport.responseText.stripScripts());}else{updateFunc();}}});}else{updateFunc();}}
$K.windows['wid_'+winID].remove();}
$K.yg_openCELinkChooserWindow=function(inst){yeagerCE_saveSelection();var site=$K.windows[$($K.windows[$(inst.editorId).up('.ywindow').id].loadparams['formfield']).up('.ywindow').id].yg_id.split('-')[1];if(site!=parseInt(site))site="";var elm=inst.selection.getNode();var action='insert';elm=inst.dom.getParent(elm,'A');if(elm!=null&&elm.nodeName=='A')action='update';var origLink=inst.dom.getAttrib(elm,'href');var openFunc=function(linkInfo){var wndobj=new $K.yg_wndobj({config:'CONTENTEDITOR_LINK_SELECT',loadparams:{opener_reference:inst.editorId,site:site,special_url:origLink}});sel="LINK_SELECT_PAGE";if(action=='update'){var href=inst.dom.getAttrib(elm,'href');var onclick=inst.dom.getAttrib(elm,'onclick');if(href.startsWith('mailto:')){sel="LINK_SELECT_EMAIL";}
if(href.charAt(0)=='#'){sel="LINK_SELECT_ANCHOR";}
if((linkInfo.TYPE=='DOWN')||(linkInfo.TYPE=='IMG')){sel="LINK_SELECT_FILE";}}
for(var i=0;i<wndobj.tabs.elements.length;i++){if(wndobj.tabs.elements[i]['NAME']==sel){wndobj.tabs.select(i);wndobj.linkType=sel;}}}
new Ajax.Request($K.appdir+'responder',{asynchronous:true,method:'post',parameters:{data:Object.toJSON(['noevent',{yg_property:'checkSpecialLinkType',params:{url:inst.dom.getAttrib(elm,'href'),us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()}}]),handler:'checkSpecialLinkType',us:document.body.id,lh:$K.yg_getLastGuiSyncHistoryId()},onSuccess:function(transport){openFunc(transport.responseText.stripScripts().evalJSON());}});}
$K.yg_initCELink=function(winID,editor){formObj=document.forms['wid_'+winID+'_'+$K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']];var inst=tinyMCE.editors[editor];var elm=inst.selection.getNode();var action='insert';elm=inst.dom.getParent(elm,'A');if(elm!=null&&elm.nodeName=='A')action='update';if($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_ANCHOR'){var nodes=inst.dom.select('a.mceItemAnchor,img.mceItemAnchor'),name,i;for(i=0;i<nodes.length;i++){if((name=inst.dom.getAttrib(nodes[i],"name"))!=""){$K.yg_dropdownInsert('wid_'+winID+'_dd_anchors',name,'#'+name,0);}}}
if(action=='update'){var href=inst.dom.getAttrib(elm,'href');var onclick=inst.dom.getAttrib(elm,'onclick');if($(formObj.elements['href']).readAttribute('preset')!='true'){yeagerCE_setFormValue('href',href,formObj);}
if(($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_PAGE')&&($K.windows['wid_'+winID].linkType=='LINK_SELECT_PAGE')){yeagerCE_setFormValue('onclick',onclick,formObj);if(onclick!=null&&onclick.indexOf('window.open')!=-1){yeagerCE_parseWindowOpen(onclick,formObj);}else{yeagerCE_parseFunction(onclick,formObj);}
if(formObj.dd_target){$K.yg_dropdownSelect(formObj.dd_target,false,inst.dom.getAttrib(elm,'target'),true);}}else if(($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_EMAIL')&&($K.windows['wid_'+winID].linkType=='LINK_SELECT_EMAIL')){formObj.email.value=href.replace(/mailto:/,'');}else if(($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_ANCHOR')&&($K.windows['wid_'+winID].linkType=='LINK_SELECT_ANCHOR')){$K.yg_dropdownSelect(formObj.dd_anchor,false,href,true);}else if(($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_FILE')&&($K.windows['wid_'+winID].linkType=='LINK_SELECT_FILE')){formObj.file.value=href;}
if(($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_PAGE')&&($K.windows['wid_'+winID].linkType!='LINK_SELECT_PAGE')){formObj.href.value='';}else if(($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_EMAIL')&&($K.windows['wid_'+winID].linkType!='LINK_SELECT_EMAIL')){formObj.email.value='';}else if(($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_FILE')&&($K.windows['wid_'+winID].linkType!='LINK_SELECT_FILE')){formObj.href.value='';formObj.file.value='';}}else if(action=="insert"){if(formObj.href)formObj.href.value='';if(formObj.email)formObj.email.value='';if(formObj.file)formObj.file.value='';}}
$K.yg_submitCE_link=function(winID,editor){var inst=tinyMCE.editors[editor];var elm,elementArray,i;yeagerCE_restoreSelection();elm=inst.selection.getNode();formObj=document.forms['wid_'+winID+'_'+$K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']];yeagerCE_checkPrefix(formObj.href);elm=inst.dom.getParent(elm,'A');if($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_PAGE'){formObj.ispopup.value='0';}else if($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_EMAIL'){if(formObj.email.value!=''){formObj.href.value='mailto:'+formObj.email.value;}else{formObj.href.value='';}}else if($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_ANCHOR'){if(formObj['wid_'+winID+'_dd_anchors'].value!=''){formObj.href.value=formObj['wid_'+winID+'_dd_anchors'].value;}else{formObj.href.value='';}}else if($K.windows['wid_'+winID].tabs.elements[$K.windows['wid_'+winID].tabs.selected]['NAME']=='LINK_SELECT_FILE'){}
if(!formObj.href.value){tinyMCE.execCommand('mceBeginUndoLevel');i=inst.selection.getBookmark();inst.dom.remove(elm,1);inst.selection.moveToBookmark(i);tinyMCE.execCommand('mceEndUndoLevel');$K.windows['wid_'+winID].remove();return;}
tinyMCE.execCommand('mceBeginUndoLevel');if(elm==null){tinyMCE.execCommand('CreateLink',false,'#mce_temp_url#',{skip_undo:1});elementArray=tinymce.grep(inst.dom.select('a'),function(n){return inst.dom.getAttrib(n,'href')=='#mce_temp_url#';});for(i=0;i<elementArray.length;i++){yeagerCE_setAllAttribs(elm=elementArray[i],formObj,editor);}}else{yeagerCE_setAllAttribs(elm,formObj,editor);}
if(elm.childNodes.length!=1||elm.firstChild.nodeName!='IMG'){inst.focus();inst.selection.select(elm);inst.selection.collapse(0);}
tinyMCE.execCommand('mceEndUndoLevel');$K.windows['wid_'+winID].remove();}
;$K.yg_submitPages=function(winID,action,openerReference){var selectedNode=nlsTree['pages_tree'+winID+'_tree'].getSelNode();var recursive=0;if(action=='copy'){if($('wid_'+winID+'_copyrecursive').value==1){recursive=1;}}
if(selectedNode){var target=selectedNode.yg_id;}else{var target=false;}
if(target!=false){if(action!='choose'){var source=$K.windows[openerReference].yg_id;}
if(action=='copy'){var data=Array('noevent',{yg_property:'copyPage',params:{sourceSite:source.split('-')[1],source:source.split('-')[0],targetSite:target.split('-')[1],target:target.split('-')[0],recursive:recursive,openerRef:openerReference,orgAction:action}});$K.yg_AjaxCallback(data,'copyPage');}
if(action=='move'){var data=Array('noevent',{yg_property:'movePage',params:{sourceSite:source.split('-')[1],source:source.split('-')[0],targetSite:target.split('-')[1],target:target.split('-')[0],openerRef:openerReference,orgAction:action}});$K.yg_AjaxCallback(data,'movePage');}
if(action=='restore'){source=$K.windows[openerReference].restore_yg_id;source.each(function(sourceItem,idx){var lastItem='false';if(idx==source.length-1){lastItem='true';}
var data=Array('noevent',{yg_property:'movePage',params:{sourceSite:sourceItem.split('-')[1],source:sourceItem.split('-')[0],targetSite:target.split('-')[1],target:target.split('-')[0],openerRef:openerReference,orgAction:action,lastItem:lastItem}});$K.yg_AjaxCallback(data,'movePage');});}
if(action=='choose'){if(document.forms[openerReference+'_LINK_SELECT_PAGE']){document.forms[openerReference+'_LINK_SELECT_PAGE'].pagename.value=selectedNode.capt;}else if(openerReference.endsWith('property')){$($K.windows['wid_'+winID].loadparams.opener_reference).update(selectedNode.capt);var pageInfo={page:target.split('-')[0],site:target.split('-')[1]};$K.yg_setObjectProperty($($K.windows['wid_'+winID].loadparams.opener_reference),pageInfo);$($K.windows['wid_'+winID].loadparams.opener_reference).up('.selectionmarker').next().value=Object.toJSON(pageInfo);$K.yg_fadeField($($K.windows['wid_'+winID].loadparams.opener_reference).up('.cntblock'));}else{$K.yg_editControl($($K.windows['wid_'+winID].loadparams.opener_reference).down('.title_txt'),'15',false,{yg_id:selectedNode.yg_id,title:selectedNode.capt});$K.yg_fadeField($($K.windows['wid_'+winID].loadparams.opener_reference));}
fieldReference=$K.windows['wid_'+winID].loadparams['field_reference'];if($(fieldReference)){var site=target.split('-')[1];var page=target.split('-')[0];var currentNode=selectedNode;var fullPath=currentNode.pname;while(currentNode.pr){currentNode=currentNode.pr;fullPath=currentNode.pname+'/'+fullPath;}
fullPath=$K.webroot+fullPath+'/';$(fieldReference).value=fullPath;}}}
$K.windows['wid_'+winID].remove();}
;$K.yg_submitCBlockWindow=function(winID,action,openerReference){var selectedNode=nlsTree['cblocks_tree'+winID+'_tree'].getSelNode();if(selectedNode.yg_id){var target=selectedNode.yg_id;}else{var target=false;}
if(target!=false){if(action!='choose'){var source=$K.windows[openerReference].yg_id;var opener=openerReference;}
if(action=='copy'){var data=Array('noevent',{yg_property:'copyCBlock',params:{sourceSite:source.split('-')[1],source:source.split('-')[0],targetSite:target.split('-')[1],target:target.split('-')[0],openerRef:opener,orgAction:action}});$K.yg_AjaxCallback(data,'copyCBlock');}
if(action=='move'){if($K.windows[opener].tab=='CONTENTBLOCK_LIST'){opener=$K.windows[opener].boundWindow;}
var data=Array('noevent',{yg_property:'moveCBlock',params:{sourceSite:source.split('-')[1],source:source.split('-')[0],targetSite:target.split('-')[1],target:target.split('-')[0],openerRef:opener,orgAction:action}});$K.yg_AjaxCallback(data,'moveCBlock');}
if(action=='restore'){source=$K.windows[openerReference].restore_yg_id;source.each(function(sourceItem,idx){var lastItem='false';if(idx==source.length-1){lastItem='true';}
var data=Array('noevent',{yg_property:'moveCBlock',params:{sourceSite:sourceItem.split('-')[1],source:sourceItem.split('-')[0],targetSite:target.split('-')[1],target:target.split('-')[0],openerRef:opener,orgAction:action,lastItem:lastItem}});$K.yg_AjaxCallback(data,'moveCBlock');});}
if(action=='choose'){if($K.windows['wid_'+winID].loadparams.opener_reference.endsWith('property')){$($K.windows['wid_'+winID].loadparams.opener_reference).update(selectedNode.capt);$K.yg_setObjectProperty($($K.windows['wid_'+winID].loadparams.opener_reference),selectedNode.yg_id.split('-')[0]);$($K.windows['wid_'+winID].loadparams.opener_reference).up('.selectionmarker').next().value=selectedNode.yg_id.split('-')[0];$K.yg_fadeField($($K.windows['wid_'+winID].loadparams.opener_reference).up('.cntblock'));}else{$K.yg_editControl($($K.windows['wid_'+winID].loadparams.opener_reference).down('.title_txt'),'7',false,{yg_id:selectedNode.yg_id,title:selectedNode.capt});$K.yg_fadeField($($K.windows['wid_'+winID].loadparams.opener_reference));}}}
$K.windows['wid_'+winID].remove();}
;$K.yg_submitFileWindow=function(winID,action,openerReference){var selectedNode=nlsTree['files_tree'+winID+'_tree'].getSelNode();var target=selectedNode.yg_id;if((action!='choose')&&(action!='restore')&&(action!='choosefolder')){var opener=openerReference;var source=$K.windows['wid_'+winID].loadparams.sourceYgId;if(!source){source=nlsTree['files_tree'+opener.split('_')[1]+'_tree'].selNd.yg_id;}}
if(action=='copy'){var data=Array('noevent',{yg_property:'copyFile',params:{source:source.split('-')[0],target:target.split('-')[0],openerRef:opener,orgAction:action}});$K.yg_AjaxCallback(data,'copyFile');}
if(action=='move'){var data=Array('noevent',{yg_property:'moveFile',params:{source:source.split('-')[0],target:target.split('-')[0],openerRef:opener,orgAction:action}});$K.yg_AjaxCallback(data,'moveFile');}
if(action=='restore'){var opener=openerReference;source=$K.windows[openerReference].restore_yg_id;source.each(function(sourceItem,idx){var lastItem='false';if(idx==source.length-1){lastItem='true';}
var data=Array('noevent',{yg_property:'moveFile',params:{source:sourceItem.split('-')[0],target:target.split('-')[0],openerRef:opener,orgAction:action,lastItem:lastItem}});$K.yg_AjaxCallback(data,'moveFile');});}
if(action=='choosefolder'){var data=new Array();data['yg_id']=selectedNode.yg_id;data['title']=selectedNode.capt;$K.yg_editControl($K.windows['wid_'+winID].loadparams['opener_reference'],'16',false,data);$K.yg_fadeField($($K.windows['wid_'+winID].loadparams['opener_reference']).up('.maskedit'));}
$K.windows['wid_'+winID].remove();}
;$K.yg_initDlgFilechooser=function(openerReference,winID,yg_id){$K.windows['wid_'+winID].openerReference=openerReference;$('wid_'+winID).openerReference=openerReference;if($(openerReference)){$K.windows['wid_'+winID].openerWin=$(openerReference).up('.ywindow').id;$('wid_'+winID).openerWin=$(openerReference).up('.ywindow').id;}
if(yg_id){$K.windows['wid_'+winID].yg_id=yg_id;}
$K.yg_switchFileView('wid_'+winID,'listview');if(!yg_id){$K.yg_switchFileListView('wid_'+winID,0.5);}
$K.windows['wid_'+winID].addFileToFolder=function(fileData){var jsTemplateList=$K.windows['wid_'+winID].jsTemplateList;var jsTemplateThumb=$K.windows['wid_'+winID].jsTemplateThumb;if($('wid_'+winID).hasClassName('filelist1')||$('wid_'+winID).hasClassName('filelist2')||$('wid_'+winID).hasClassName('filelist3')){var item_template=$K.yg_makeTemplate(jsTemplateList);var thumbnailData=$K.yg_makeThumb(fileData);var newFile=item_template.evaluate({item_objectid:fileData.objectid,item_thumbnail:thumbnailData,item_color:fileData.color,item_identifier:fileData.identifier,item_name:fileData.name,item_pname:fileData.pname,item_tags:fileData.tags,item_filesize:$K.yg_filesize(fileData.filesize),item_ref_count:fileData.ref_count,item_datum:fileData.datum,item_timestamp:fileData.timestamp,item_uhrzeit:fileData.uhrzeit,item_uid:fileData.uid,item_username:fileData.username,item_filename:fileData.filename,item_width:fileData.width,item_height:fileData.height,win_no:winID});fileData.targetTable.down('tbody').insert({bottom:newFile});}else if($('wid_'+winID).hasClassName('thumbview')){var item_template=$K.yg_makeTemplate(jsTemplateThumb);var alignment='';if(fileData.width){var ratioPic=(fileData.width/fileData.height);if((ratioPic>(4/3))||(fileData.thumb!='1')){alignment='x-scale';}else{alignment='y-scale';}}
var full_filename='';if(fileData.width&&fileData.height){full_filename=fileData.width+'x'+fileData.height+', ';}
full_filename+=$K.yg_filesize(fileData.filesize);var thumbnailData='<div class="thumbcnt ';if(fileData.thumb!='1')thumbnailData+='thumbcnt_nothumb';thumbnailData+='">';if((alignment=='x-scale')||(fileData.thumb!='1'))thumbnailData+='<table cellspacing="0" cellpadding="0"><tr><td>';if(fileData.thumb=='1'){var randomSuffix='?rnd='+parseInt(Math.random()*10000000);thumbnailData+='<img class="noload" real_src="'+$K.appdir+'image/'+fileData.objectid+'/yg-thumb/'+randomSuffix+'" onload="$K.yg_setThumbPreviewLoaded(this);">';}else{thumbnailData+='<div class="noimg">?</div>';}
if((alignment=='x-scale')||(fileData.thumb!='1'))thumbnailData+='</td></tr></table>';thumbnailData+='</div>';var newFile=item_template.evaluate({item_objectid:fileData.objectid,item_thumbnail:thumbnailData,item_color:fileData.color,item_identifier:fileData.identifier,item_name:fileData.name,item_pname:fileData.pname,item_full_filename:full_filename,alignment:alignment,win_no:winID});var itemsArray=new Array();var newItem=fileData.name.toLowerCase()+'<<>>'+'file_'+winID+'_'+fileData.objectid;fileData.targetContainer.select('li').each(function(item){itemsArray.push(item.down('.filetitle').innerHTML.toLowerCase()+'<<>>'+item.id);});itemsArray.push(newItem);itemsArray.sort();var targetPosition=itemsArray.indexOf(newItem);targetPosition--;if(targetPosition<0){fileData.targetContainer.insert({top:newFile});}else{var targetId=itemsArray[targetPosition].split('<<>>')[1];$(targetId).insert({after:newFile});}}
var oldFileCount=parseInt($('wid_'+winID+'_objcnt').innerHTML);$('wid_'+winID+'_objcnt').update(++oldFileCount);$K.yg_customAttributeHandler($('file_'+winID+'_'+fileData.objectid).up());$K.initSortable('wid_'+winID+'_'+$K.windows['wid_'+winID].yg_id.replace(/-file/,'')+'_files_list');$K.yg_refreshFileMgr('wid_'+winID);}
$K.windows['wid_'+winID].submit=function(){$K.yg_hideFileHint();if($K.yg_hoverInt){clearTimeout($K.yg_hoverInt);}
$('yg_fileHint').hide();var focusobjs=$K.yg_getFocusObj($(this.id));if(focusobjs.length>0){if(this.loadparams['type']=='property'){var titlefield=$(this.loadparams['opener_reference']).down('.title_txt');titlefield.update(focusobjs[0].down('.filetitle').innerHTML);var valuefield=$(this.loadparams['opener_reference']).down('input[type=hidden]');if(valuefield.readAttribute('yg_property')=='favicon'){valuefield.value=focusobjs[0].readAttribute('yg_id').split('-')[0];}else{valuefield.value=focusobjs[0].readAttribute('yg_id').split('-')[0];}
if(!$(this.loadparams['opener_reference']).hasClassName('mk_noautosave')){$K.yg_setObjectProperty(valuefield);if($(this.loadparams['opener_reference']).up('.cntblock')){$K.yg_fadeField($(this.loadparams['opener_reference']).up('.cntblock'));}}}
if((this.loadparams['type']=='formfield')&&(this.loadparams['property']=='file')){var data=new Array();data['yg_id']=focusobjs[0].yg_id;data['title']=focusobjs[0].down('.filetitle').innerHTML;data['filecolor']=focusobjs[0].down('.filetype').className.replace(/filetype/,'').strip();data['filetype']=focusobjs[0].down('.filetype').innerHTML.strip();$K.yg_editControl(this.loadparams['opener_reference'],'6',false,data);$K.yg_fadeField($(this.loadparams['opener_reference']).up('.maskedit'));}
if((this.loadparams['type']=='formfield')&&(this.loadparams['property']=='link')){document.forms[this.loadparams.opener_reference].file.value=focusobjs[0].yg_id;document.forms[this.loadparams.opener_reference].filecolor.value=focusobjs[0].down('.filetype').className.replace(/filetype/,'').strip();document.forms[this.loadparams.opener_reference].filetype.value=focusobjs[0].down('.filetype').innerHTML.strip();document.forms[this.loadparams.opener_reference].filetitle.value=focusobjs[0].down('.filetitle').innerHTML.replace(/<(.*)>/,'');document.forms[this.loadparams.opener_reference].href.value=$K.webroot+'download/'+focusobjs[0].readAttribute('pname');}
if(this.loadparams['type']=='image'){document.forms[this.loadparams.opener_reference].src.value=$K.webroot+'image/'+focusobjs[0].readAttribute('pname');if($(this.id+'_viewselect')&&($(this.id+'_viewselect').down().next('input').value!="")){document.forms[this.loadparams.opener_reference].src.value+="/"+$(this.id+'_viewselect').down().next('input').value;}}}
$K.yg_hideFileHint();if($K.yg_hoverInt){clearTimeout($K.yg_hoverInt);}
$('yg_fileHint').hide();$K.windows['wid_'+winID].remove();}
$('wid_'+winID).down('.ywindowfiltercolumn2').hide();$('wid_'+winID).down('.ywindowheadcolumn2').hide();if($('wid_'+winID+'_tablecontent'))$('wid_'+winID+'_tablecontent').hide();if($('wid_'+winID+'_uploadbtn'))$('wid_'+winID+'_uploadbtn').hide();$K.windows['wid_'+winID].init();}
$K.yg_resetPageInfo=function(which){which=$(which);which.up('form').select('input[type=hidden]').each(function(item){item.value='';});}
;$K.yg_submitUserSettings=function(winID){var inputError=false;var inputFields=$('wid_'+winID+'_innercontent').select('input[name]');var paramData={winID:winID};var prefixFilter=new RegExp('wid_'+winID+'_','g');inputFields.each(function(item){item.removeClassName('error');paramData[item.name.replace(prefixFilter,'')]=item.value;});if(paramData.firstname.strip().length==0){$('wid_'+winID+'_firstname').addClassName('error');inputError=true;}
if(paramData.lastname.strip().length==0){$('wid_'+winID+'_lastname').addClassName('error');inputError=true;}
if(paramData.email.strip().length==0){$('wid_'+winID+'_email').addClassName('error');inputError=true;}
if(paramData.email!=paramData.oldemail){var emailError=false;if(paramData.email!=paramData.emailconfirm){$('wid_'+winID+'_email').addClassName('error');$('wid_'+winID+'_emailconfirm').addClassName('error');inputError=true;emailError=true;}
if(!emailError){paramData['emailChanged']=true;}}
if((paramData.password!=paramData.oldpassword)&&(paramData.password.strip().length>0)){if(paramData.password.strip().length==0){$('wid_'+winID+'_password').addClassName('error');$('wid_'+winID+'_passwordconfirm').addClassName('error');inputError=true;}else if(paramData.password!=paramData.passwordconfirm){$('wid_'+winID+'_password').addClassName('error');$('wid_'+winID+'_passwordconfirm').addClassName('error');inputError=true;$K.yg_promptbox($K.TXT('TXT_NOTIFICATION'),$K.TXT('TXT_PASSWORD_ERROR_NOT_IDENTICAL'),'alert');}else{paramData['passwordChanged']=true;}}
if(paramData.language!=paramData.oldlanguage){paramData['guiDataChanged']=true;}
if(paramData.timezone!=paramData.oldtimezone){paramData['guiDataChanged']=true;}
if(paramData.dateformat!=paramData.olddateformat){paramData['guiDataChanged']=true;}
if(paramData.timeformat!=paramData.oldtimeformat){paramData['guiDataChanged']=true;}
if(paramData.weekstart!=paramData.oldweekstart){paramData['guiDataChanged']=true;}
if(inputError){$('wid_'+winID+'_USER_SETTINGS').down('.error').focus();}else{var data=Array('noevent',{yg_property:'saveUserProfile',params:paramData});$K.yg_AjaxCallback(data,'saveUserProfile');}}
$K.yg_initDlgUserSettings=function(winID){$K.yg_loadDlgUpload();if($K.uploadFramework=='swfuploader'){var swfuploadSettings=Object.clone($K.yg_SWFUploadSettings);Object.extend(swfuploadSettings,{upload_url:$K.appdir+'responder?handler=uploadUserProfilePicture',flash_url:$K.jsdir+'3rd/swfupload/swfupload.swf',button_placeholder_id:'wid_'+winID+'_uploadbutton',button_height:"70",file_types:"*.jpg;*.jpeg;*.gif;*.png",file_types_description:"Images",custom_settings:{uploadButtonId:'wid_'+winID+'_uploadbutton',uploadTitle:'N/A',uploadType:'userProfilePicture',fileID:'wid_'+winID+'_profilepicture',winID:winID,timestamp:($('wid_'+winID+'_timestamp'))?($('wid_'+winID+'_timestamp').value):(0),autoUpload:true,userProfilePictureUpload:true},button_action:SWFUpload.BUTTON_ACTION.SELECT_FILE});$K.yg_SWFUploadObjects['wid_'+winID]=new SWFUpload(swfuploadSettings);}
if($K.uploadFramework=='plupload'){var customSettings={uploadButtonId:'wid_'+winID+'_uploadbutton',uploadTitle:'N/A',uploadType:'userProfilePicture',fileID:'wid_'+winID+'_profilepicture',winID:winID,timestamp:($('wid_'+winID+'_timestamp'))?($('wid_'+winID+'_timestamp').value):(0),userProfilePictureUpload:true,autoUpload:true};$K.yg_UploadInit('wid_'+winID,'wid_'+winID+'_uploadbutton',null,{handler:'uploadUserProfilePicture'},customSettings,[{title:'Images',extensions:'jpg,jpeg,gif,png'}],false);}}
$K.yg_setUserProfilePreviewPicture=function(itemID,pictureSrc){var winRef=$('wid_'+$(itemID).srcWindow);var tempUserPic=winRef.down('img.mk_tempuserpic');tempUserPic.src=pictureSrc+'?rnd='+(Math.random()*10000000);}
$K.yg_initUserPropertiesPictureupload=function(winID,userID){$K.yg_loadDlgUpload();if($K.uploadFramework=='swfuploader'){var swfuploadSettings=Object.clone($K.yg_SWFUploadSettings);Object.extend(swfuploadSettings,{upload_url:$K.appdir+'responder?handler=uploadUserProfilePicture',flash_url:$K.jsdir+'3rd/swfupload/swfupload.swf',button_placeholder_id:'wid_'+winID+'_uploadbutton',button_height:"70",file_types:"*.jpg;*.jpeg;*.gif;*.png",file_types_description:"Images",custom_settings:{uploadButtonId:'wid_'+winID+'_uploadbutton',uploadTitle:'N/A',uploadType:'userProfilePicture',fileID:'wid_'+winID+'_profilepicture',userID:userID,winID:winID,timestamp:($('wid_'+winID+'_timestamp'))?($('wid_'+winID+'_timestamp').value):(0),autoUpload:true,userProfilePictureUpload:true},button_action:SWFUpload.BUTTON_ACTION.SELECT_FILE});$K.yg_SWFUploadObjects['wid_'+winID]=new SWFUpload(swfuploadSettings);}
if($K.uploadFramework=='plupload'){var customSettings={uploadButtonId:'wid_'+winID+'_uploadbutton',uploadTitle:'N/A',uploadType:'userProfilePicture',fileID:'wid_'+winID+'_profilepicture',userID:userID,winID:winID,timestamp:($('wid_'+winID+'_timestamp'))?($('wid_'+winID+'_timestamp').value):(0),userProfilePictureUpload:true,autoUpload:true};$K.yg_UploadInit('wid_'+winID,'wid_'+winID+'_uploadbutton',null,{handler:'uploadUserProfilePicture'},customSettings,[{title:'Images',extensions:'jpg,jpeg,gif,png'}],false,true);}}
;$K.yg_updatesToInstall=new Array();$K.yg_installUpdate=function(which){which=$(which);var allRevisions=new Array();var allRevisionContainers=which.up('.mk_contentgroup').select('.mk_update');allRevisionContainers.each(function(item){if(!item.down('.status_info').hasClassName('installed')){allRevisions.push({rev:item.down('.mk_revision').innerHTML,ver:item.down('.versioninfo').innerHTML.replace(/v/,''),url:item.readAttribute('update_url')});}});var selectedVersion=which.up('.mk_update').down('.versioninfo').innerHTML.replace(/v/,'');$K.yg_updatesToInstall=new Array();allRevisions.each(function(item){if($K.yg_versionCompare(selectedVersion,item.ver)>=0){$K.yg_updatesToInstall.push(item);}});if($K.yg_updatesToInstall.length>0){allRevisionContainers.each(function(item){if(item.down('.mk_revision').innerHTML==$K.yg_updatesToInstall[0].rev){item.down('.status_info').addClassName('inprogress');}});var data=Array('noevent',{yg_property:'installUpdate',params:{installRevision:$K.yg_updatesToInstall[0]}});$K.yg_AjaxCallback(data,'installUpdate',false,null);}};$K.yg_startUpdate=function(url,updateRevision){var allRevisionContainers=$('wid_updates').select('.mk_update');if(url.endsWith('.update')){url.replace(/\.update/,'.php');}
allRevisionContainers.each(function(item){if(item.down('.mk_revision')&&!item.hasClassName('mk_currentversion')&&(item.down('.mk_revision').innerHTML==$K.yg_updatesToInstall[0].rev)){item.down('iframe').src=url+'?r='+updateRevision;}});};$K.yg_updaterOnSuccess=function(updateRevision){var allRevisionContainers=$('wid_updates').select('.mk_update');allRevisionContainers.each(function(item){if(item.down('.mk_revision')&&!item.hasClassName('mk_currentversion')&&(item.down('.mk_revision').innerHTML==$K.yg_updatesToInstall[0].rev)){var currVer=item.down('.versioninfo').innerHTML.strip();var currRev=item.down('.mk_revision').innerHTML.strip();var currDate=item.down('.mk_versiondate').innerHTML.strip();item.down('.status_info').removeClassName('inprogress');item.down('.status_info').addClassName('installed');item.down('iframe').src='about:blank';$('wid_updates').down('.mk_currentversion').down('.versioninfo').update(currVer);$('wid_updates').down('.mk_currentversion').down('.mk_revision').update(currRev);$('wid_updates').down('.mk_currentversion').down('.mk_versiondate').update(currDate);var data=Array('noevent',{yg_property:'updateInstalled',params:{revision:$K.yg_updatesToInstall[0].rev}});$K.yg_AjaxCallback(data,'updateInstalled',false,null);}});$K.yg_updatesToInstall.shift();if($K.yg_updatesToInstall.length>0){allRevisionContainers.each(function(item){if(item.down('.mk_revision')&&!item.hasClassName('mk_currentversion')&&(item.down('.mk_revision').innerHTML==$K.yg_updatesToInstall[0].rev)){item.down('.status_info').addClassName('inprogress');}});var data=Array('noevent',{yg_property:'installUpdate',params:{installRevision:$K.yg_updatesToInstall[0]}});$K.yg_AjaxCallback(data,'installUpdate',false,null);}else{$K.yg_updatesToInstall=new Array();}};$K.yg_updaterOnStart=function(data){};$K.yg_versionCompare=function(v1,v2,options){var lexicographical=options&&options.lexicographical,zeroExtend=options&&options.zeroExtend,v1parts=v1.split('.'),v2parts=v2.split('.');function isValidPart(x){return(lexicographical?/^\d+[A-Za-z]*$/:/^\d+$/).test(x);}
if(!v1parts.every(isValidPart)||!v2parts.every(isValidPart)){return NaN;}
if(zeroExtend){while(v1parts.length<v2parts.length)v1parts.push("0");while(v2parts.length<v1parts.length)v2parts.push("0");}
if(!lexicographical){v1parts=v1parts.map(Number);v2parts=v2parts.map(Number);}
for(var i=0;i<v1parts.length;++i){if(v2parts.length==i){return 1;}
if(v1parts[i]==v2parts[i]){continue;}
else if(v1parts[i]>v2parts[i]){return 1;}
else{return-1;}}
if(v1parts.length!=v2parts.length){return-1;}
return 0;}
$K.yg_updaterOnSkip=function(data){var allRevisionContainers=$('wid_updates').select('.mk_update');allRevisionContainers.each(function(item){if(item.down('.mk_revision')&&!item.hasClassName('mk_currentversion')&&(item.down('.mk_revision').innerHTML==data)){item.down('.status_info').removeClassName('inprogress');item.down('.status_info').addClassName('skipped');item.down('.progress').setStyle({width:'0%'});item.down('iframe').src='about:blank';}});$K.yg_updatesToInstall.shift();if($K.yg_updatesToInstall.length>0){allRevisionContainers.each(function(item){if(item.down('.mk_revision')&&!item.hasClassName('mk_currentversion')&&(item.down('.mk_revision').innerHTML==$K.yg_updatesToInstall[0].rev)){item.down('.status_info').addClassName('skipped');}});var data=Array('noevent',{yg_property:'installUpdate',params:{installRevision:$K.yg_updatesToInstall[0]}});$K.yg_AjaxCallback(data,'installUpdate',false,null);}else{$K.yg_updatesToInstall=new Array();}};$K.yg_updaterOnError=function(data,message){var allRevisionContainers=$('wid_updates').select('.mk_update');allRevisionContainers.each(function(item){if(item.down('.mk_revision')&&!item.hasClassName('mk_currentversion')&&(item.down('.mk_revision').innerHTML==data)){item.down('.status_info').removeClassName('inprogress');item.down('.status_info').addClassName('cancelled');item.down('.progress').setStyle({width:'0%'});item.down('iframe').src='about:blank';}});$K.yg_promptbox('Error',message,'alert');};$K.yg_updaterSetProgress=function(data,percent){var allRevisionContainers=$('wid_updates').select('.mk_update');allRevisionContainers.each(function(item){if(item.down('.mk_revision')&&!item.hasClassName('mk_currentversion')&&(item.down('.mk_revision').innerHTML==data)){item.down('.progress').setStyle({width:percent+'%'});if(item.down('.status_info').hasClassName('cancelled')){item.down('.status_info').addClassName('inprogress');item.down('.status_info').removeClassName('cancelled');}}});};$K.yg_updaterReloadAll=function(data){$K.yg_promptbox($K.TXT('TXT_PICKDATE'),$K.TXT('TXT_UPDATER_RELOAD_REQUIRED'),'alert',function(){window.location.reload();});};$K.yg_updaterNewVersion=function(winID,newVersionNo,newVersionDate,newVersionText){if($(winID)&&$(winID).down('.mk_updater')){$(winID).down('.mk_updater').removeClassName('nosubline');var noBr=new Element('nobr').update(newVersionText+': v'+newVersionNo+', '+newVersionDate);$(winID).down('.mk_updater').insert({bottom:noBr});}}
;$K.yg_submitTemplate=function(winID,openerReference){if($K.windows['wid_'+winID].yg_id==undefined){$K.windows['wid_'+winID].remove();return;}
$K.windows[openerReference].changeTemplate($K.windows['wid_'+winID].yg_id.split('-')[0]);$K.windows['wid_'+winID].remove();}
$K.yg_submitTemplateFolder=function(winID,openerReference){var yg_id=$K.windows['wid_'+winID].yg_id;if(yg_id){var openerWin=$(openerReference);if($K.windows[openerWin.id]&&$K.windows[openerWin.id].changeTemplateRoot){$K.windows[openerWin.id].changeTemplateRoot(yg_id.split('-')[0]);}}
$K.windows['wid_'+winID].remove();}
$K.yg_changeTemplate=function(templateID,targetID){var pageID=targetID.split('-')[0];var siteID=targetID.split('-')[1];var data=Array('noevent',{yg_property:'setPageTemplate',params:{page:pageID,site:siteID,templateId:templateID}});$K.yg_AjaxCallback(data,'setPageTemplate');}
$K.yg_updateTemplate=function(yg_id,templateID){for(var winID in $K.windows){if(($K.windows[winID].yg_id==yg_id)&&($K.windows[winID].tab=='APPEARANCE')&&(typeof($K.windows[winID].refreshTemplate)=='function')){$K.windows[winID].refreshTemplate(templateID);}}}
$K.yg_updateNavigation=function(yg_id,navigationID,templateID){for(var winID in $K.windows){if(($K.windows[winID].yg_id==yg_id)&&($K.windows[winID].tab=='APPEARANCE')&&(typeof($K.windows[winID].refreshNavigation)=='function')){$K.windows[winID].refreshNavigation(navigationID,templateID);}}}